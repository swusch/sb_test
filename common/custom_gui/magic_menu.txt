# This section prevents error spam from topbar.gui bug
	#custom_text_box
	custom_button = { name = magic_menu_magic_advancement_xp_main potential = { always = no } }
	custom_button = { name = magic_menu_patron_info_text potential = { always = no } }
	custom_button = { name = magic_menu_advancement_textbox potential = { always = no } }
	custom_button = { name = magic_advancement_current_xp potential = { always = no } }
	custom_button = { name = magic_menu_mana_values potential = { always = no } }
	custom_button = { name = magic_advancement_current_subject potential = { always = no } }
	custom_button = { name = magical_fortress_project.name potential = { always = no } }
	custom_button = { name = summon_extraplanars_project.name potential = { always = no } }
	custom_button = { name = orb_of_omniscience_project.name potential = { always = no } }
	custom_button = { name = artifact_of_enthrallment_project.name potential = { always = no } }
	custom_button = { name = battlemage_academy_project.name potential = { always = no } }
	custom_button = { name = theatre_of_simulacra_project.name potential = { always = no } }
	custom_button = { name = lichdom_project.name potential = { always = no } }
	custom_button = { name = homunculus_project.name potential = { always = no } }
	custom_button = { name = regional_projects_none }
	custom_button = { name = tag_projects_none }
	custom_button = { name = magical_infrastructure_modifier potential = { always = no } }
	custom_button = { name = magic_study_xp_modifier potential = { always = no } tooltip = magic_study_xp_mod_summary }
	custom_button = { name = magic_menu_max_xp_spellbook potential = { always = no } }
	custom_button = { name = magic_menu_regen_xp_spellbook potential = { always = no } }
	custom_button = { name = magic_menu_cast_spell_slot_1 potential = { always = no } }
	custom_button = { name = magic_menu_cast_spell_slot_2 potential = { always = no } }
	custom_button = { name = magic_menu_cast_spell_slot_3 potential = { always = no } }
	custom_button = { name = magic_menu_cast_spell_slot_4 potential = { always = no } }
	custom_button = { name = magic_menu_cast_spell_slot_5 potential = { always = no } }
	custom_button = { name = magic_menu_cast_spell_slot_6 potential = { always = no } }
	custom_button = { name = magic_menu_cast_spell_slot_1_2 potential = { always = no } }
	custom_button = { name = magic_menu_cast_spell_slot_2_2 potential = { always = no } }
	custom_button = { name = magic_menu_cast_spell_slot_3_2 potential = { always = no } }
	custom_button = { name = magic_menu_cast_spell_slot_4_2 potential = { always = no } }
	custom_button = { name = magic_menu_cast_spell_slot_5_2 potential = { always = no } }
	custom_button = { name = magic_menu_cast_spell_slot_6_2 potential = { always = no } }
	custom_button = { name = magic_menu_patron_interaction_text potential = { always = no } }
	custom_button = { name = magic_menu_patron_seek_patron_text potential = { always = no } }

	custom_button = { name = magic_menu_infamy_types potential = { always = no } tooltip = magic_menu_infamy_breakdown }
	custom_button = { name = magic_menu_infamy_text potential = { always = no } tooltip = magic_menu_infamy_breakdown }
	custom_button = { name = magic_menu_patron_name potential = { always = no } tooltip = magic_menu_patron_tt }
	custom_button = { name = last_months_xp_gain_val potential = { always = no } tooltip = last_months_xp_gain_tooltip }
	custom_button = { name = total_experience_mod_val potential = { always = no } tooltip = experience_mod_breakdown }
	custom_button = { name = magic_menu_mana_regen_rate potential = { always = no } tooltip = magic_menu_mana_regen_breakdown }

	#custom_button
	custom_text_box = { name = decisions_magic_ui_open_button potential = { always = no } }
	custom_text_box = { name = decisions_magicui_open_spellbook potential = { always = no } }
	custom_text_box = { name = magicui_close_button potential = { always = no } }
	custom_text_box = { name = magicui_back_button potential = { always = no } }
	custom_text_box = { name = magicui_open_home potential = { always = no } }
	custom_text_box = { name = magicui_open_advancements potential = { always = no } }
	custom_text_box = { name = magicui_open_spellbook potential = { always = no } }
	custom_text_box = { name = magicui_open_patrons potential = { always = no } }
	custom_text_box = { name = patron_interaction_event potential = { always = no } }
	custom_text_box = { name = patron_seek_event potential = { always = no } }
	custom_text_box = { name = magic_menu_magic_xp_bar potential = { always = no } }
	custom_text_box = { name = magic_menu_magic_mana_bar potential = { always = no } }
	custom_text_box = { name = mana_debug_increase_button potential = { always = no } }
	custom_text_box = { name = mana_debug_decrease_button potential = { always = no } }
	custom_text_box = { name = mastery_button_abjuration potential = { always = no } }
	custom_text_box = { name = mastery_button_conjuration potential = { always = no } }
	custom_text_box = { name = mastery_button_divination potential = { always = no } }
	custom_text_box = { name = mastery_button_enchantment potential = { always = no } }
	custom_text_box = { name = mastery_button_evocation potential = { always = no } }
	custom_text_box = { name = mastery_button_illusion potential = { always = no } }
	custom_text_box = { name = mastery_button_necromancy potential = { always = no } }
	custom_text_box = { name = mastery_button_transmutation potential = { always = no } }
	custom_text_box = { name = magic_menu_back_out_button_advancement potential = { always = no } }
	custom_text_box = { name = magic_menu_close_window_button_advancement potential = { always = no } }
	custom_text_box = { name = magic_menu_abort_advancement potential = { always = no } }
	custom_text_box = { name = debug_experience_increase_button potential = { always = no } }
	custom_text_box = { name = magic_menu_study_button potential = { always = no } }
	custom_text_box = { name = magical_infrastructure_button potential = { always = no } }
	custom_text_box = { name = magical_fortress_project_button potential = { always = no } }
	custom_text_box = { name = summon_extraplanars_project_button potential = { always = no } }
	custom_text_box = { name = orb_of_omniscience_project_button potential = { always = no } }
	custom_text_box = { name = artifact_of_enthrallment_project_button potential = { always = no } }
	custom_text_box = { name = battlemage_academy_project_button potential = { always = no } }
	custom_text_box = { name = theatre_of_simulacra_project_button potential = { always = no } }
	custom_text_box = { name = lichdom_project_button potential = { always = no } }
	custom_text_box = { name = homunculus_project_button potential = { always = no } }
	custom_text_box = { name = study_select_ruler potential = { always = no } }
	custom_text_box = { name = study_select_heir potential = { always = no } }
	custom_text_box = { name = study_select_estate potential = { always = no } }
	custom_text_box = { name = study_select_abjuration potential = { always = no } }
	custom_text_box = { name = study_select_conjuration potential = { always = no } }
	custom_text_box = { name = study_select_divination potential = { always = no } }
	custom_text_box = { name = study_select_enchantment potential = { always = no } }
	custom_text_box = { name = study_select_evocation potential = { always = no } }
	custom_text_box = { name = study_select_illusion potential = { always = no } }
	custom_text_box = { name = study_select_necromancy potential = { always = no } }
	custom_text_box = { name = study_select_transmutation potential = { always = no } }
	custom_text_box = { name = study_confirm_button potential = { always = no } }
	custom_text_box = { name = study_back_button potential = { always = no } }
	custom_text_box = { name = magic_menu_back_out_button_spellbook potential = { always = no } }
	custom_text_box = { name = magic_menu_button_change_school_abjuration_spellbook potential = { always = no } }
	custom_text_box = { name = magic_menu_button_change_school_conjuration_spellbook potential = { always = no } }
	custom_text_box = { name = magic_menu_button_change_school_divination_spellbook potential = { always = no } }
	custom_text_box = { name = magic_menu_button_change_school_enchantment_spellbook potential = { always = no } }
	custom_text_box = { name = magic_menu_button_change_school_evocation_spellbook potential = { always = no } }
	custom_text_box = { name = magic_menu_button_change_school_illusion_spellbook potential = { always = no } }
	custom_text_box = { name = magic_menu_button_change_school_necromancy_spellbook potential = { always = no } }
	custom_text_box = { name = magic_menu_button_change_school_transmutation_spellbook potential = { always = no } }
	custom_text_box = { name = magic_menu_divination_spell_1_button potential = { always = no } }
	custom_text_box = { name = magic_menu_divination_spell_2_button potential = { always = no } }
	custom_text_box = { name = magic_menu_divination_spell_3_button potential = { always = no } }
	custom_text_box = { name = magic_menu_divination_spell_4_button potential = { always = no } }
	custom_text_box = { name = magic_menu_divination_spell_5_button potential = { always = no } }
	custom_text_box = { name = magic_menu_divination_spell_6_button potential = { always = no } }
	custom_text_box = { name = magic_cast_enchantment_spell1_button potential = { always = no } }
	custom_text_box = { name = magic_cast_enchantment_spell2_button potential = { always = no } }
	custom_text_box = { name = magic_cast_enchantment_spell3_button potential = { always = no } }
	custom_text_box = { name = magic_cast_enchantment_spell4_button potential = { always = no } }
	custom_text_box = { name = magic_cast_enchantment_spell5_button potential = { always = no } }
	custom_text_box = { name = magic_cast_enchantment_spell6_button potential = { always = no } }
	custom_text_box = { name = magic_cast_abjuration_spell1_button potential = { always = no } }
	custom_text_box = { name = magic_cast_abjuration_spell2_button potential = { always = no } }
	custom_text_box = { name = magic_cast_abjuration_spell3_button potential = { always = no } }
	custom_text_box = { name = magic_cast_abjuration_spell4_button potential = { always = no } }
	custom_text_box = { name = magic_cast_abjuration_spell5_button potential = { always = no } }
	custom_text_box = { name = magic_cast_abjuration_spell6_button potential = { always = no } }
	custom_text_box = { name = magic_cast_transmutation_spell1_button potential = { always = no } }
	custom_text_box = { name = magic_cast_transmutation_spell2_button potential = { always = no } }
	custom_text_box = { name = magic_cast_transmutation_spell3_button potential = { always = no } }
	custom_text_box = { name = magic_cast_transmutation_spell4_button potential = { always = no } }
	custom_text_box = { name = magic_cast_transmutation_spell5_button potential = { always = no } }
	custom_text_box = { name = magic_cast_transmutation_spell6_button potential = { always = no } }
	custom_text_box = { name = magic_cast_evocation_spell1_button potential = { always = no } }
	custom_text_box = { name = magic_cast_evocation_spell2_button potential = { always = no } }
	custom_text_box = { name = magic_cast_evocation_spell3_button potential = { always = no } }
	custom_text_box = { name = magic_cast_evocation_spell4_button potential = { always = no } }
	custom_text_box = { name = magic_cast_evocation_spell5_button potential = { always = no } }
	custom_text_box = { name = magic_cast_evocation_spell6_button potential = { always = no } }
	custom_text_box = { name = magic_cast_illusion_spell1_button potential = { always = no } }
	custom_text_box = { name = magic_cast_illusion_spell2_button potential = { always = no } }
	custom_text_box = { name = magic_cast_illusion_spell3_button potential = { always = no } }
	custom_text_box = { name = magic_cast_illusion_spell4_button potential = { always = no } }
	custom_text_box = { name = magic_cast_illusion_spell5_button potential = { always = no } }
	custom_text_box = { name = magic_cast_illusion_spell6_button potential = { always = no } }
	custom_text_box = { name = magic_cast_necromancy_spell1_button potential = { always = no } }
	custom_text_box = { name = magic_cast_necromancy_spell2_button potential = { always = no } }
	custom_text_box = { name = magic_cast_necromancy_spell3_button potential = { always = no } }
	custom_text_box = { name = magic_cast_necromancy_spell4_button potential = { always = no } }
	custom_text_box = { name = magic_cast_necromancy_spell5_button potential = { always = no } }
	custom_text_box = { name = magic_cast_necromancy_spell6_button potential = { always = no } }
	custom_text_box = { name = magic_cast_conjuration_spell1_button potential = { always = no } }
	custom_text_box = { name = magic_cast_conjuration_spell2_button potential = { always = no } }
	custom_text_box = { name = magic_cast_conjuration_spell3_button potential = { always = no } }
	custom_text_box = { name = magic_cast_conjuration_spell4_button potential = { always = no } }
	custom_text_box = { name = magic_cast_conjuration_spell5_button potential = { always = no } }
	custom_text_box = { name = magic_cast_conjuration_spell6_button potential = { always = no } }
	
	#custom_icon
	custom_text_box = { name = magic_menu_magic_xp_bar_frame potential = { always = no } tooltip = magic_menu_experience_tt }
	custom_text_box = { name = magic_advancement_progress_bar potential = { always = no } tooltip = magic_advancement_current_xp }
	custom_text_box = { name = magic_menu_magic_mana_bar_frame potential = { always = no } tooltip = magic_menu_mana_values }
	custom_text_box = { name = magical_infrastructure_level_strip potential = { always = no } tooltip = magical_infrastructure_icon_tt }
	custom_button = { name = magic_menu_magic_xp_bar_frame potential = { always = no } tooltip = magic_menu_experience_tt }
	custom_button = { name = magic_advancement_progress_bar potential = { always = no } tooltip = magic_advancement_current_xp }
	custom_button = { name = magic_menu_magic_mana_bar_frame potential = { always = no } tooltip = magic_menu_mana_values }
	custom_button = { name = magical_infrastructure_level_strip potential = { always = no } tooltip = magical_infrastructure_icon_tt }
	
	custom_text_box = { name = back_bg potential = { always = no } }
	custom_text_box = { name = magic_school_icon_strip_x34 potential = { always = no } }
	custom_text_box = { name = patron_favoured_school_1 potential = { always = no } }
	custom_text_box = { name = patron_favoured_school_2 potential = { always = no } }
	custom_text_box = { name = patron_disfavoured_school_1 potential = { always = no } }
	custom_text_box = { name = patron_disfavoured_school_2 potential = { always = no } }
	custom_text_box = { name = patron_approval_bar potential = { always = no } }
	custom_text_box = { name = magical_fortress_project_progress potential = { always = no } }
	custom_text_box = { name = summon_extraplanars_project_progress potential = { always = no } }
	custom_text_box = { name = orb_of_omniscience_project_progress potential = { always = no } }
	custom_text_box = { name = artifact_of_enthrallment_project_progress potential = { always = no } }
	custom_text_box = { name = battlemage_academy_project_progress potential = { always = no } }
	custom_text_box = { name = theatre_of_simulacra_project_progress potential = { always = no } }
	custom_text_box = { name = lichdom_project_progress potential = { always = no } }
	custom_text_box = { name = homunculus_project_progress potential = { always = no } }
	custom_text_box = { name = magic_menu_spellbook_school_icons_strip potential = { always = no } }
	custom_text_box = { name = magic_menu_cast_spell_slot_1_icon potential = { always = no } }
	custom_text_box = { name = magic_menu_cast_spell_slot_2_icon potential = { always = no } }
	custom_text_box = { name = magic_menu_cast_spell_slot_3_icon potential = { always = no } }
	custom_text_box = { name = magic_menu_cast_spell_slot_4_icon potential = { always = no } }
	custom_text_box = { name = magic_menu_cast_spell_slot_5_icon potential = { always = no } }
	custom_text_box = { name = magic_menu_cast_spell_slot_6_icon potential = { always = no } }
#

#######################################
######## MAGIC SYSTEM UI BELOW ########
#######################################

##########
##########
############# Window scripting - to change how groups of UI elements are shown
custom_window = {
	name = magic_menu_parent
	potential = {
		OR = {
			has_country_flag = magic_menu_main_flag
			has_country_flag = magic_menu_advancement_flag
			has_country_flag = magic_menu_spellbook_flag
			has_country_flag = magic_menu_patron_flag
		}
	}
}
custom_window = {
	name = magic_menu_main
	potential = {
		has_country_flag = magic_menu_main_flag
	}
}

custom_window = {
	name = magic_menu_advancement_window
	potential = {
		has_country_flag = magic_menu_advancement_flag
	}
}

custom_window = {
	name = magic_menu_advancement_study_window
	potential = {
		has_country_flag = magic_menu_study_flag
	}
}

custom_window = {
	name = magic_menu_spellbook_window
	potential = {
		has_country_flag = magic_menu_spellbook_flag
	}
}
custom_window = {
	name = magic_menu_patron_window
	potential = {
		has_country_flag = magic_menu_patron_flag
	}
}
#Project windows
custom_window = {
	name = advancement_default_projects_window
	potential = {
		NOT = { has_country_flag = show_unique_projects }
	}
}
custom_window = {
	name = advancement_unique_projects_window
	potential = {
		has_country_flag = show_unique_projects
	}
}


# Spellbook selection windows
	custom_window = {
		name = magic_menu_spellbook_divination
		potential = {
			has_country_flag = magic_menu_spellbook_divination_flag
		}
	}
	custom_window = {
		name = magic_menu_spellbook_enchantment
		potential = {
			has_country_flag = magic_menu_spellbook_enchantment_flag
		}
	}
	custom_window = {
		name = magic_menu_spellbook_abjuration
		potential = {
			has_country_flag = magic_menu_spellbook_abjuration_flag
		}
	}
	custom_window = {
		name = magic_menu_spellbook_transmutation
		potential = {
			has_country_flag = magic_menu_spellbook_transmutation_flag
		}
	}
	custom_window = {
		name = magic_menu_spellbook_evocation
		potential = {
			has_country_flag = magic_menu_spellbook_evocation_flag
		}
	}
	custom_window = {
		name = magic_menu_spellbook_illusion
		potential = {
			has_country_flag = magic_menu_spellbook_illusion_flag
		}
	}
	custom_window = {
		name = magic_menu_spellbook_necromancy
		potential = {
			has_country_flag = magic_menu_spellbook_necromancy_flag
		}
	}
	custom_window = {
		name = magic_menu_spellbook_conjuration
		potential = {
			has_country_flag = magic_menu_spellbook_conjuration_flag
		}
	}
#End spellbook selection windows

##########
##########

# countrydecisionsview
#Open UI Button
custom_button = {
	name = decisions_magic_ui_open_button
	trigger = {
		if = {
			limit = { is_lesser_in_union = yes }
			is_lesser_in_union = no
		}
		if = {
			limit = { can_use_magic = no }
			can_use_magic = yes
		}
		if = {
			limit = {
				has_country_flag = magic_artificery_artificery_only
				NOT = { has_estate_privilege = artifice_invention_korashi_tuners }
			}
			is_not_in_artificery_mode = yes
		}
	}
	effect = {
		custom_tooltip = overall_magic_levels_summary
		hidden_effect = {
			if = {
				limit = { has_ruler_flag = is_a_vampire }
				set_country_flag = mage_vampire
			}
			update_magic_menu_effect = yes
			close_all_magic_menus = yes
			set_country_flag = magic_menu_main_flag
		}
	}
	tooltip = open_magic_menu_tt
}
#Open spellbook directly button
custom_button = { #Main Menu Open Spellbook Button
	name = decisions_magicui_open_spellbook
	trigger = {
		if = {
			limit = { is_lesser_in_union = yes }
			is_lesser_in_union = no
		}
		if = {
			limit = { can_use_magic = no }
			can_use_magic = yes
		}
		if = {
			limit = {
				has_country_flag = magic_artificery_artificery_only
				NOT = { has_estate_privilege = artifice_invention_korashi_tuners }
			}
			is_not_in_artificery_mode = yes
		}
	}
	effect = {
		update_magic_menu_effect = yes
		hidden_effect = {
			close_all_magic_menus = yes
			set_country_flag = magic_menu_spellbook_flag
			if = {
				limit = {
					NOT = {
						has_country_flag = magic_menu_spellbook_abjuration_flag
						has_country_flag = magic_menu_spellbook_conjuration_flag
						has_country_flag = magic_menu_spellbook_divination_flag
						has_country_flag = magic_menu_spellbook_enchantment_flag
						has_country_flag = magic_menu_spellbook_evocation_flag
						has_country_flag = magic_menu_spellbook_illusion_flag
						has_country_flag = magic_menu_spellbook_necromancy_flag
						has_country_flag = magic_menu_spellbook_transmutation_flag
					}
				}
				set_country_flag = magic_menu_spellbook_divination_flag
			}
		}
	}
	tooltip = open_spellbook_menu_tt
}
#Click advancement progressbar to access advancements tab
custom_button = {
	name = decisions_magic_xp_bar_frame
	trigger = {
		if = {
			limit = { is_lesser_in_union = yes }
			is_lesser_in_union = no
		}
		if = {
			limit = { can_use_magic = no }
			can_use_magic = yes
		}
		if = {
			limit = {
				has_country_flag = magic_artificery_artificery_only
				NOT = { has_estate_privilege = artifice_invention_korashi_tuners }
			}
			is_not_in_artificery_mode = yes
		}
	}
	effect = {
		update_magic_menu_effect = yes
		hidden_effect = {
			close_all_magic_menus = yes
			set_country_flag = magic_menu_advancement_flag
		}
		custom_tooltip = open_advancement_menu_tt
	}
	tooltip = magic_menu_experience_tt
}
custom_button = {
	name = decisions_magic_menu_magic_xp_bar
	potential = {
		is_lesser_in_union = no
		can_use_magic = yes
		if = {
			limit = {
				has_country_flag = magic_artificery_artificery_only
				NOT = { has_estate_privilege = artifice_invention_korashi_tuners }
			}
			is_not_in_artificery_mode = yes
		}
	}
	frame_variable = current_experience_percent
}

#Grey out the progressbar frame if no mages
custom_button = {
	name = decisions_magic_mana_bar_frame
	trigger = {
		if = {
			limit = { is_lesser_in_union = yes }
			is_lesser_in_union = no
		}
		if = {
			limit = { can_use_magic = no }
			can_use_magic = yes
		}
		if = {
			limit = {
				has_country_flag = magic_artificery_artificery_only
				NOT = { has_estate_privilege = artifice_invention_korashi_tuners }
			}
			is_not_in_artificery_mode = yes
		}
	}
	effect = {
		update_magic_menu_effect = yes
		hidden_effect = {
			close_all_magic_menus = yes
			set_country_flag = magic_menu_spellbook_flag
			if = {
				limit = {
					NOT = {
						has_country_flag = magic_menu_spellbook_abjuration_flag
						has_country_flag = magic_menu_spellbook_conjuration_flag
						has_country_flag = magic_menu_spellbook_divination_flag
						has_country_flag = magic_menu_spellbook_enchantment_flag
						has_country_flag = magic_menu_spellbook_evocation_flag
						has_country_flag = magic_menu_spellbook_illusion_flag
						has_country_flag = magic_menu_spellbook_necromancy_flag
						has_country_flag = magic_menu_spellbook_transmutation_flag
					}
				}
				set_country_flag = magic_menu_spellbook_divination_flag
			}
		}
		custom_tooltip = open_spellbook_menu_tt
	}
	tooltip = magic_menu_mana_values
}
custom_button = {
	name = decisions_magic_menu_magic_mana_bar
	potential = {
		is_lesser_in_union = no
		can_use_magic = yes
		if = {
			limit = {
				has_country_flag = magic_artificery_artificery_only
				NOT = { has_estate_privilege = artifice_invention_korashi_tuners }
			}
			is_not_in_artificery_mode = yes
		}
	}
	frame_variable = current_mana_percent
}
#################
### MAIN MENU ###
#################


custom_button = { #Main Menu Close Magic Menu Button
	name = magicui_close_button
	effect = {
		update_magic_menu_effect = yes
		hidden_effect = {
			close_all_magic_menus = yes
		}
	}
	tooltip = close_magic_menu_tt
}
custom_icon = {
	name = back_bg
	potential = {
		OR = {
			has_country_flag = magic_menu_advancement_flag
			has_country_flag = magic_menu_spellbook_flag
			has_country_flag = magic_menu_patron_flag
		}
	}
}
## magic_menu buttons
	custom_button = { #Main Menu Open Button
		name = magicui_open_home
		effect = {
			update_magic_menu_effect = yes
			hidden_effect = {
				close_all_magic_menus = yes
				set_country_flag = magic_menu_main_flag
			}
		}
		frame = {
			number = 1
			trigger = { NOT = { has_country_flag = magic_menu_main_flag } }
		}
		frame = {
			number = 2
			trigger = { has_country_flag = magic_menu_main_flag }
		}
		tooltip = open_magic_menu_tt
	}
	custom_button = { #Main Menu Open Advancement Menu Button
		name = magicui_open_advancements
		effect = {
			update_magic_menu_effect = yes
			hidden_effect = {
				close_all_magic_menus = yes
				set_country_flag = magic_menu_advancement_flag
			}
		}
		frame = {
			number = 1
			trigger = { NOT = { has_country_flag = magic_menu_advancement_flag } }
		}
		frame = {
			number = 2
			trigger = { has_country_flag = magic_menu_advancement_flag }
		}
		tooltip = open_advancement_menu_tt
	}

	custom_button = { #Main Menu Open Spellbook Button
		name = magicui_open_spellbook
		effect = {
			update_magic_menu_effect = yes
			hidden_effect = {
				close_all_magic_menus = yes
				set_country_flag = magic_menu_spellbook_flag
				if = {
					limit = {
						NOT = {
							has_country_flag = magic_menu_spellbook_abjuration_flag
							has_country_flag = magic_menu_spellbook_conjuration_flag
							has_country_flag = magic_menu_spellbook_divination_flag
							has_country_flag = magic_menu_spellbook_enchantment_flag
							has_country_flag = magic_menu_spellbook_evocation_flag
							has_country_flag = magic_menu_spellbook_illusion_flag
							has_country_flag = magic_menu_spellbook_necromancy_flag
							has_country_flag = magic_menu_spellbook_transmutation_flag
						}
					}
					set_country_flag = magic_menu_spellbook_divination_flag
				}
			}
		}
		frame = {
			number = 1
			trigger = { NOT = { has_country_flag = magic_menu_spellbook_flag } }
		}
		frame = {
			number = 2
			trigger = { has_country_flag = magic_menu_spellbook_flag }
		}
		tooltip = open_spellbook_menu_tt
	}
	custom_button = { #Main Menu Open Patron Button
		name = magicui_open_patrons
		# potential = {
		# 	OR = {
		# 		has_a_patron_trigger = yes
		# 		has_ruler_flag = spirit_patron_delayed
		# 	}
		# 	is_lesser_in_union = no
		# }
		effect = {
			update_magic_menu_effect = yes
			hidden_effect = {
				close_all_magic_menus = yes
				set_country_flag = magic_menu_patron_flag
			}
		}
		frame = {
			number = 1
			trigger = { NOT = { has_country_flag = magic_menu_patron_flag } }
		}
		frame = {
			number = 2
			trigger = { has_country_flag = magic_menu_patron_flag }
		}
		tooltip = open_patron_menu_tt
	}
## End magic_menu buttons

#magic_school_icon_strip_x34
custom_icon = {
	name = magic_school_icon_strip_x34
	potential = { always = yes }
	frame = {
		number = 1
		trigger = {	is_overall_advancing_school = { school = abjuration } }
	}
	frame = {
		number = 2
		trigger = {	is_overall_advancing_school = { school = conjuration } }
	}
	frame = {
		number = 3
		trigger = {	is_overall_advancing_school = { school = divination } }
	}
	frame = {
		number = 4
		trigger = {	is_overall_advancing_school = { school = enchantment } }
	}
	frame = {
		number = 5
		trigger = {	is_overall_advancing_school = { school = evocation } }
	}
	frame = {
		number = 6
		trigger = {	is_overall_advancing_school = { school = illusion } }
	}
	frame = {
		number = 7
		trigger = {	is_overall_advancing_school = { school = necromancy } }
	}
	frame = {
		number = 8
		trigger = {	is_overall_advancing_school = { school = transmutation } }
	}
	frame = {
		number = 9
		trigger = {	always = yes }
	}
}

# Magic xp textboxes - good
custom_text_box = { #Main Menu XP Text
	name = magic_menu_magic_advancement_xp_main
	potential = {
		always = yes
	}
}

custom_icon = {
	name = magical_infrastructure_level_strip
	potential = { always = yes }
	tooltip = magical_infrastructure_icon_tt
	# frame = { number = 6 trigger = { has_country_modifier = magical_infrastructure_5 } }
	frame = { number = 5 trigger = { has_country_modifier = magical_infrastructure_4 } }
	frame = { number = 4 trigger = { has_country_modifier = magical_infrastructure_3 } }
	frame = { number = 3 trigger = { has_country_modifier = magical_infrastructure_2 } }
	frame = { number = 2 trigger = { has_country_modifier = magical_infrastructure_1 } }
	frame = { number = 1 }
}

custom_text_box = {
	name = magic_menu_infamy_types
	potential = { always = yes }
	tooltip = magic_menu_infamy_breakdown
}
custom_text_box = {
	name = magic_menu_infamy_text
	potential = { always = yes }
	tooltip = magic_menu_infamy_breakdown
}

#Patron UI
	custom_text_box = {
		name = magic_menu_patron_name
		tooltip = magic_menu_patron_tt
	}
	custom_icon = {
		name = patron_favoured_school_1
		frame = {
			number = 1
			trigger = { has_ruler_modifier = patron_favoured_abjuration }
		}
		frame = {
			number = 2
			trigger = { has_ruler_modifier = patron_favoured_conjuration }
		}
		frame = {
			number = 3
			trigger = { has_ruler_modifier = patron_favoured_divination }
		}
		frame = {
			number = 4
			trigger = { has_ruler_modifier = patron_favoured_enchantment }
		}
		frame = {
			number = 5
			trigger = { has_ruler_modifier = patron_favoured_evocation }
		}
		frame = {
			number = 6
			trigger = { has_ruler_modifier = patron_favoured_illusion }
		}
		frame = {
			number = 7
			trigger = { has_ruler_modifier = patron_favoured_necromancy }
		}
		frame = {
			number = 8
			trigger = { has_ruler_modifier = patron_favoured_transmutation }
		}
		frame = {
			number = 9
			trigger = { always = yes }
		}
	}
	custom_icon = {
		name = patron_favoured_school_2

		frame = {
			number = 8
			trigger = { has_ruler_modifier = patron_favoured_transmutation }
		}
		frame = {
			number = 7
			trigger = { has_ruler_modifier = patron_favoured_necromancy }
		}
		frame = {
			number = 6
			trigger = { has_ruler_modifier = patron_favoured_illusion }
		}
		frame = {
			number = 5
			trigger = { has_ruler_modifier = patron_favoured_evocation }
		}
		frame = {
			number = 4
			trigger = { has_ruler_modifier = patron_favoured_enchantment }
		}
		frame = {
			number = 3
			trigger = { has_ruler_modifier = patron_favoured_divination }
		}
		frame = {
			number = 2
			trigger = { has_ruler_modifier = patron_favoured_conjuration }
		}
		frame = {
			number = 1
			trigger = { has_ruler_modifier = patron_favoured_abjuration }
		}
		frame = {
			number = 9
			trigger = { always = yes }
		}
	}
	custom_icon = {
		name = patron_disfavoured_school_1
		frame = {
			number = 1
			trigger = { has_ruler_modifier = patron_disfavoured_abjuration }
		}
		frame = {
			number = 2
			trigger = { has_ruler_modifier = patron_disfavoured_conjuration }
		}
		frame = {
			number = 3
			trigger = { has_ruler_modifier = patron_disfavoured_divination }
		}
		frame = {
			number = 4
			trigger = { has_ruler_modifier = patron_disfavoured_enchantment }
		}
		frame = {
			number = 5
			trigger = { has_ruler_modifier = patron_disfavoured_evocation }
		}
		frame = {
			number = 6
			trigger = { has_ruler_modifier = patron_disfavoured_illusion }
		}
		frame = {
			number = 7
			trigger = { has_ruler_modifier = patron_disfavoured_necromancy }
		}
		frame = {
			number = 8
			trigger = { has_ruler_modifier = patron_disfavoured_transmutation }
		}
		frame = {
			number = 9
			trigger = { always = yes }
		}
	}
	custom_icon = {
		name = patron_disfavoured_school_2

		frame = {
			number = 8
			trigger = { has_ruler_modifier = patron_disfavoured_transmutation }
		}
		frame = {
			number = 7
			trigger = { has_ruler_modifier = patron_disfavoured_necromancy }
		}
		frame = {
			number = 6
			trigger = { has_ruler_modifier = patron_disfavoured_illusion }
		}
		frame = {
			number = 5
			trigger = { has_ruler_modifier = patron_disfavoured_evocation }
		}
		frame = {
			number = 4
			trigger = { has_ruler_modifier = patron_disfavoured_enchantment }
		}
		frame = {
			number = 3
			trigger = { has_ruler_modifier = patron_disfavoured_divination }
		}
		frame = {
			number = 2
			trigger = { has_ruler_modifier = patron_disfavoured_conjuration }
		}
		frame = {
			number = 1
			trigger = { has_ruler_modifier = patron_disfavoured_abjuration }
		}
		frame = {
			number = 9
			trigger = { always = yes }
		}
	}
	custom_icon = {
		name = patron_approval_bar
		potential = { has_a_patron_trigger = yes }
		frame = {
			number = 80
			trigger = { check_variable = { PatronApproval = 8 } }
		}
		frame = {
			number = 70
			trigger = { check_variable = { PatronApproval = 7 } }
		}
		frame = {
			number = 60
			trigger = { check_variable = { PatronApproval = 6 } }
		}
		frame = {
			number = 50
			trigger = { check_variable = { PatronApproval = 5 } }
		}
		frame = {
			number = 40
			trigger = { check_variable = { PatronApproval = 4 } }
		}
		frame = {
			number = 30
			trigger = { check_variable = { PatronApproval = 3 } }
		}
		frame = {
			number = 20
			trigger = { check_variable = { PatronApproval = 2 } }
		}
		frame = {
			number = 10
			trigger = { check_variable = { PatronApproval = 1 } }
		}
		frame = {
			number = 0
			trigger = { always = yes }
		}
	}
	custom_text_box = {
		name = magic_menu_patron_info_text
	}
	custom_text_box = {
		name = magic_menu_patron_interaction_text
	}
	custom_button = {
		name = patron_interaction_event
		trigger = {
			hidden_trigger = {
				has_a_patron_trigger = yes
			}
			if = { limit = { is_lesser_in_union = yes }
				is_lesser_in_union = no
			}
		}
		effect = {
			update_magic_menu_effect = yes
			hidden_effect = {
				country_event = { id = patrons_events.1 }
			}
		}
	}
	custom_text_box = {
		name = magic_menu_patron_seek_patron_text
		potential = {
			has_a_patron_trigger = no
			OR = {
				has_ruler_flag = spirit_patron_delayed
				capital_scope = {
					OR = {
						superregion = yanshen_superregion
						superregion = gozengun_superregion
						superregion = vimdatrong_superregion
						superregion = rahen_superregion
					}
				}
			}
		}
	}
	custom_button = {
		name = patron_seek_event
		potential = {
			has_a_patron_trigger = no
			OR = {
				has_ruler_flag = spirit_patron_delayed
				capital_scope = {
					OR = {
						superregion = yanshen_superregion
						superregion = gozengun_superregion
						superregion = vimdatrong_superregion
						superregion = rahen_superregion
					}
				}
			}
		}
		trigger = {
			if = {
				limit = { NOT = { tag = Y26 } }
				adm_power = 50
				dip_power = 50
				mil_power = 50
				OR = {
					is_ruler_conjuration_level_3 = yes
					AND = {
						is_ruler_conjuration_level_2 = yes
						is_ruler_divination_level_2_minimum = yes
					}
				}
				# if = { limit = { is_or_was_tag = { tag = Y26 } }
				# 	custom_trigger_tooltip = {
				# 		tooltip = we_are_yinquan_tt
				# 		always = no
				# 	}
				# }
				if = { limit = { has_ruler_flag = magic_project_summoning_started }
					custom_trigger_tooltip = {
						tooltip = magic_project_started_tt
						always = no
					}
				}
				if = { limit = { has_ruler_flag = magic_project_summoning_complete }
					custom_trigger_tooltip = {
						tooltip = magic_project_already_done_tt
						always = no
					}
				}
			}
			if = { limit = { has_country_modifier = patron_succession_cooldown }
				NOT = { has_country_modifier = patron_succession_cooldown }
			}
			if = {
				limit = { has_country_flag = seek_patron_randomisation_ptm }
				hidden_trigger = {
					NOT = { has_country_flag = seek_patron_randomisation_ptm }
				}
			}
			# if = {
			# 	limit = { capital_scope = { has_active_triggered_province_modifier = seek_patron_randomisation_ptm } }
			# 	NOT = { capital_scope = { has_active_triggered_province_modifier = seek_patron_randomisation_ptm } }
			# }
			if = { limit = { is_lesser_in_union = yes }
				is_lesser_in_union = no
			}
		}
		effect = {
			update_magic_menu_effect = yes
			if = { #Y26
				limit = { has_ruler_flag = spirit_patron_delayed }
				tooltip = {
					country_event = { id = patrons_on_action.1 days = 1 }
				}
				hidden_effect = {
					set_country_flag = seek_patron_randomisation_ptm_Y26
				}
			}
			else = {
				add_adm_power = -50
				add_dip_power = -50
				add_mil_power = -50
				tooltip = {
					country_event = { id = magic_project_summoning.1 days = 1 }
				}
				custom_tooltip = magic_summoning_desc_tt
			}
			hidden_effect = {
				capital_scope = { add_province_triggered_modifier = seek_patron_randomisation_ptm }
				set_country_flag = seek_patron_randomisation_ptm
			}
		}
	}
#End Patron stuff

#Magic XP UI
	#Must first check who is advancing [ruler, heir, country]
	custom_text_box = { #Magic advancement title + icon
		name = magic_menu_advancement_textbox
	}
	custom_text_box = { #Current magical advancement experience
		name = magic_advancement_current_xp
	}
	custom_text_box = {
		name = last_months_xp_gain_val
		tooltip = last_months_xp_gain_tooltip
	}
	custom_text_box = { #Magical advancement xp modifier
		name = total_experience_mod_val
		tooltip = experience_mod_breakdown
	}
	custom_button = {
		name = magic_menu_magic_xp_bar
		frame_variable = current_experience_percent
	}
	custom_icon = {
		name = magic_menu_magic_xp_bar_frame
		tooltip = magic_menu_experience_tt
	}
#End Magic xp UI

#Mana window UI elements
	custom_text_box = { #Main Menu XP Regen Text
		name = magic_menu_mana_regen_rate
		tooltip = magic_menu_mana_regen_breakdown
	}
	custom_button = {
		name = magic_menu_magic_mana_bar
		frame_variable = current_mana_percent
	}
	custom_icon = {
		name = magic_menu_magic_mana_bar_frame
		tooltip = magic_menu_mana_values
	}
#End Mana window UI elements

# Debug buttons
	custom_button = {
		name = mana_debug_increase_button
		potential = {
			has_country_flag = magic_debug
		}
		effect = {
			change_mana = { amount = 100 }
			update_magic_menu_effect = yes
		}
		tooltip = "Increase mana by 100"
	}
	custom_button = {
		name = mana_debug_decrease_button
		potential = {
			has_country_flag = magic_debug
		}
		effect = {
			change_mana = { amount = -100 }
			update_magic_menu_effect = yes
		}
		tooltip = "Decrease mana by 100"
	}
# End Debug buttons


##scripted icon on main menu
	custom_button = {
		name = mastery_button_abjuration
		tooltip = open_abjuration_spellbook_tt
		effect = {
			update_magic_menu_effect = yes
			custom_tooltip = abjuration_magic_levels_summary
			hidden_effect = {
				close_all_magic_menus = yes
				clear_spellbook_flags = yes
				set_country_flag = magic_menu_spellbook_flag
				set_country_flag = magic_menu_spellbook_abjuration_flag
			}
		}
		frame = {
			number = 4
			trigger = { is_overall_abjuration_level_3 = yes }
		}
		frame = {
			number = 3
			trigger = { is_overall_abjuration_level_2 = yes }
		}
		frame = {
			number = 2
			trigger = { is_overall_abjuration_level_1 = yes }
		}
		frame = { number = 1 }
	}
	custom_button = {
		name = mastery_button_conjuration
		tooltip = open_conjuration_spellbook_tt
		effect = {
			update_magic_menu_effect = yes
			custom_tooltip = conjuration_magic_levels_summary
			hidden_effect = {
				close_all_magic_menus = yes
				clear_spellbook_flags = yes
				set_country_flag = magic_menu_spellbook_flag
				set_country_flag = magic_menu_spellbook_conjuration_flag
			}
		}
		frame = {
			number = 4
			trigger = { is_overall_conjuration_level_3 = yes }
		}
		frame = {
			number = 3
			trigger = { is_overall_conjuration_level_2 = yes }
		}
		frame = {
			number = 2
			trigger = { is_overall_conjuration_level_1 = yes }
		}
		frame = { number = 1 }
	}
	custom_button = {
		name = mastery_button_divination
		tooltip = open_divination_spellbook_tt
		effect = {
			update_magic_menu_effect = yes
			custom_tooltip = divination_magic_levels_summary
			hidden_effect = {
				close_all_magic_menus = yes
				clear_spellbook_flags = yes
				set_country_flag = magic_menu_spellbook_flag
				set_country_flag = magic_menu_spellbook_divination_flag
			}
		}
		frame = {
			number = 4
			trigger = { is_overall_divination_level_3 = yes }
		}
		frame = {
			number = 3
			trigger = { is_overall_divination_level_2 = yes }
		}
		frame = {
			number = 2
			trigger = { is_overall_divination_level_1 = yes }
		}
		frame = { number = 1 }
	}
	custom_button = {
		name = mastery_button_enchantment
		tooltip = open_enchantment_spellbook_tt
		effect = {
			update_magic_menu_effect = yes
			custom_tooltip = enchantment_magic_levels_summary
			hidden_effect = {
				close_all_magic_menus = yes
				clear_spellbook_flags = yes
				set_country_flag = magic_menu_spellbook_flag
				set_country_flag = magic_menu_spellbook_enchantment_flag
			}
		}
		frame = {
			number = 4
			trigger = { is_overall_enchantment_level_3 = yes }
		}
		frame = {
			number = 3
			trigger = { is_overall_enchantment_level_2 = yes }
		}
		frame = {
			number = 2
			trigger = { is_overall_enchantment_level_1 = yes }
		}
		frame = { number = 1 }
	}
	custom_button = {
		name = mastery_button_evocation
		tooltip = open_evocation_spellbook_tt
		effect = {
			update_magic_menu_effect = yes
			custom_tooltip = evocation_magic_levels_summary
			hidden_effect = {
				close_all_magic_menus = yes
				clear_spellbook_flags = yes
				set_country_flag = magic_menu_spellbook_flag
				set_country_flag = magic_menu_spellbook_evocation_flag
			}
		}
		frame = {
			number = 4
			trigger = { is_overall_evocation_level_3 = yes }
		}
		frame = {
			number = 3
			trigger = { is_overall_evocation_level_2 = yes }
		}
		frame = {
			number = 2
			trigger = { is_overall_evocation_level_1 = yes }
		}
		frame = { number = 1 }
	}
	custom_button = {
		name = mastery_button_illusion
		tooltip = open_illusion_spellbook_tt
		effect = {
			update_magic_menu_effect = yes
			custom_tooltip = illusion_magic_levels_summary
			hidden_effect = {
				close_all_magic_menus = yes
				clear_spellbook_flags = yes
				set_country_flag = magic_menu_spellbook_flag
				set_country_flag = magic_menu_spellbook_illusion_flag
			}
		}
		frame = {
			number = 4
			trigger = { is_overall_illusion_level_3 = yes }
		}
		frame = {
			number = 3
			trigger = { is_overall_illusion_level_2 = yes }
		}
		frame = {
			number = 2
			trigger = { is_overall_illusion_level_1 = yes }
		}
		frame = { number = 1 }
	}
	custom_button = {
		name = mastery_button_necromancy
		tooltip = open_necromancy_spellbook_tt
		effect = {
			update_magic_menu_effect = yes
			custom_tooltip = necromancy_magic_levels_summary
			hidden_effect = {
				close_all_magic_menus = yes
				clear_spellbook_flags = yes
				set_country_flag = magic_menu_spellbook_flag
				set_country_flag = magic_menu_spellbook_necromancy_flag
			}
		}
		frame = {
			number = 4
			trigger = { is_overall_necromancy_level_3 = yes }
		}
		frame = {
			number = 3
			trigger = { is_overall_necromancy_level_2 = yes }
		}
		frame = {
			number = 2
			trigger = { is_overall_necromancy_level_1 = yes }
		}
		frame = { number = 1 }
	}
	custom_button = {
		name = mastery_button_transmutation
		tooltip = open_transmutation_spellbook_tt
		effect = {
			update_magic_menu_effect = yes
			custom_tooltip = transmutation_magic_levels_summary
			hidden_effect = {
				close_all_magic_menus = yes
				clear_spellbook_flags = yes
				set_country_flag = magic_menu_spellbook_flag
				set_country_flag = magic_menu_spellbook_transmutation_flag
			}
		}
		frame = {
			number = 4
			trigger = { is_overall_transmutation_level_3 = yes }
		}
		frame = {
			number = 3
			trigger = { is_overall_transmutation_level_2 = yes }
		}
		frame = {
			number = 2
			trigger = { is_overall_transmutation_level_1 = yes }
		}
		frame = { number = 1 }
	}
## End scripted icons for main menu


########################
### ADVANCEMENT MENU ###
########################

custom_button = { #Advancement Menu Back Main Menu Button
	name = magic_menu_back_out_button_advancement
	potential = {
		always = yes
	}
	effect = {
		update_magic_menu_effect = yes
		hidden_effect = {
			clr_country_flag = magic_menu_advancement_flag
		}
	}
	tooltip = close_advancement_menu_tt
}
custom_button = { #Advancement Menu Close Window Button
	name = magic_menu_close_window_button_advancement
	potential = { always = yes }
	effect = {
		update_magic_menu_effect = yes
		hidden_effect = {
			clr_country_flag = magic_menu_advancement_flag
			clr_country_flag = magic_menu_main_flag
		}
	}
	tooltip = close_magic_menu_tt
}


custom_button = {
	name = magic_menu_abort_advancement
	tooltip = magic_advancement_abort_all_effect_tt
	potential = { always = yes }
	trigger = {
		if = {
			limit = { is_overall_not_advancing_magic = yes }
			is_overall_advancing_magic = yes
		}
		hidden_trigger = {
			NOT = {
				has_ruler_flag = in_magic_progress_event
				has_heir_flag = in_magic_progress_event
				has_country_flag = in_magic_progress_event
			}
		}
	}
	effect = {
		country_event = { id = magic_system.86 }
		update_magic_menu_effect = yes
	}
}

custom_text_box = {
	name = magic_advancement_current_subject
	potential = { always = yes }
}

#Advancement menu progress bar
custom_icon = {
	name = magic_advancement_progress_bar
	potential = { always = yes }
	frame_variable = current_experience_percent
	tooltip = magic_advancement_current_xp
}
custom_button = {
	name = debug_experience_increase_button
	potential = {
			has_country_flag = magic_debug
		}
	trigger = { always = yes }
	effect = {
		if = {
			limit = { has_ruler_flag = magic_advancement }
			set_variable = {
				which = ruler_magic_experience
				which = magic_experience_target
			}
		}
		else_if = {
			limit = { has_heir_flag = magic_advancement }
			set_variable = {
				which = heir_magic_experience
				which = magic_experience_target
			}
	
		}
		else_if = {
			limit = { has_country_flag = magic_advancement }
			set_variable = {
				which = country_magic_experience
				which = magic_experience_target
			}
		}
		increase_magic_experience = { amount = 0 }
		update_magic_menu_effect = yes
	}
	tooltip = "Debug: Finish Advancement"
}

custom_button = {
	name = magic_menu_study_button
	potential = { always = yes }
	trigger = {
		if = { #Hide the tooltip
			limit = { is_overall_advancing_magic = yes }
			is_overall_not_advancing_magic = yes
		}
	}
	effect = {
		update_magic_menu_effect = yes
		hidden_effect = {
			set_country_flag = magic_menu_study_flag
			set_country_flag = magic_advancement_setup_study_advancement_flag
			magic_study_selection_clear_school_flags = yes
			magic_study_selection_clear_type_flags = yes
			study_experience_preview_effect = yes
		}
	}
	tooltip = open_study_menu_tt
}
custom_text_box = { name = regional_projects_none }
custom_text_box = { name = tag_projects_none }
custom_text_box = { name = magical_infrastructure_modifier }

custom_button = {
	name = magical_infrastructure_button
	potential = { always = yes }
	trigger = {
		if = { #Hide the tooltip
			limit = { is_overall_advancing_magic = yes }
			is_overall_not_advancing_magic = yes
		}

		if = { limit = { has_country_modifier = magical_infrastructure_4 }
			can_upgrade_to_magical_infrastructure_5 = yes
		}
		else_if = { limit = { has_country_modifier = magical_infrastructure_3 }
			can_upgrade_to_magical_infrastructure_4 = yes
		}
		else_if = { limit = { has_country_modifier = magical_infrastructure_2 }
			can_upgrade_to_magical_infrastructure_3 = yes
		}
		else_if = { limit = { has_country_modifier = magical_infrastructure_1 }
			can_upgrade_to_magical_infrastructure_2 = yes
		}
		else = { #MI 0
			can_upgrade_to_magical_infrastructure_1 = yes
		}
	}
	effect = {
		update_magic_menu_effect = yes

		custom_tooltip = start_country_magic_advancement_tt

		set_country_flag = magic_advancement
		set_country_flag = magical_infrastructure
		add_country_modifier = { name = advancing_magical_infrastructure_mod duration = -1 desc = until_advancement_concludes }

		if = { #Level 4 = requires Global Trade
			limit = { exactly_magical_infrastructure_level = { level = 3 } }
			if = {
				limit = { NOT = { has_institution = printing_press } } #has_unembraced_institution doesn't work if the institution hasn't spawned
				custom_tooltip = MI_4_missing_two_institutions_tt
				add_country_modifier = { name = magical_infrastructure_2_institution_penalty duration = -1 desc = until_advancement_concludes }
			}
			else_if = {
				limit = { NOT = { has_institution = global_trade } }
				custom_tooltip = MI_4_missing_institution_tt
				add_country_modifier = { name = magical_infrastructure_institution_penalty duration = -1 desc = until_advancement_concludes }
			}
		}
		else_if = { #Level 3 = requires Printing Press
			limit = { exactly_magical_infrastructure_level = { level = 2 } }
			if = {
				limit = { NOT = { has_institution = new_world_i } }
				custom_tooltip = MI_3_missing_two_institutions_tt
				add_country_modifier = { name = magical_infrastructure_2_institution_penalty duration = -1 desc = until_advancement_concludes }
			}
			else_if = {
				limit = { NOT = { has_institution = printing_press } }
				custom_tooltip = MI_3_missing_institution_tt
				add_country_modifier = { name = magical_infrastructure_institution_penalty duration = -1 desc = until_advancement_concludes }
			}
		}
		else_if = { #Level 2 = requires Colonialism
			limit = { exactly_magical_infrastructure_level = { level = 1 } }
			if = {
				limit = { NOT = { has_institution = renaissance } }
				custom_tooltip = MI_2_missing_two_institutions_tt
				add_country_modifier = { name = magical_infrastructure_2_institution_penalty duration = -1 desc = until_advancement_concludes }
			}
			else_if = {
				limit = { NOT = { has_institution = new_world_i } }
				custom_tooltip = MI_2_missing_institution_tt
				add_country_modifier = { name = magical_infrastructure_institution_penalty duration = -1 desc = until_advancement_concludes }
			}
		}
		else_if = { #Level 1 = requires Renaissance
			limit = { has_magical_infrastructure_level_0 = yes }
			if = {
				limit = { NOT = { has_institution = feudalism } }
				custom_tooltip = MI_1_missing_two_institutions_tt
				add_country_modifier = { name = magical_infrastructure_2_institution_penalty duration = -1 desc = until_advancement_concludes }
			}
			else_if = {
				limit = { NOT = { has_institution = renaissance } }
				custom_tooltip = MI_1_missing_institution_tt
				add_country_modifier = { name = magical_infrastructure_institution_penalty duration = -1 desc = until_advancement_concludes }
			}
		}
		
		hidden_effect = {
			set_magic_experience_target = { type = country infrastructure = yes }
			set_variable = { which = country_magic_experience value = 0 }
			update_magic_ui_experience_modifiers = yes
		}
	}
	tooltip = improve_magical_infrastructure
	

	# frame = { number = 6 trigger = { has_country_modifier = magical_infrastructure_5 } }
	# frame = { number = 5 trigger = { has_country_modifier = magical_infrastructure_4 } }
	# frame = { number = 4 trigger = { has_country_modifier = magical_infrastructure_3 } }
	# frame = { number = 3 trigger = { has_country_modifier = magical_infrastructure_2 } }
	# frame = { number = 2 trigger = { has_country_modifier = magical_infrastructure_1 } }
	# frame = { number = 1 }
}

# Project navigation stuff
custom_text_box = { name = magicui_default_projects_tab } #tooltip = ""
custom_text_box = { name = magicui_unique_projects_tab } #tooltip = ""

custom_button = {
	name = magicui_default_projects_tab
	effect = {
		clr_country_flag = show_unique_projects
	}
	tooltip = "Show Standard Magical Projects"
	frame = { number = 1 trigger = { has_country_flag = show_unique_projects } }
	frame = { number = 2 trigger = { NOT = { has_country_flag = show_unique_projects } } }
}
custom_button = {
	name = magicui_unique_projects_tab
	effect = {
		set_country_flag = show_unique_projects
	}
	tooltip = "Show Unique Magical Projects"
	frame = { number = 1 trigger = { NOT = { has_country_flag = show_unique_projects } } }
	frame = { number = 2 trigger = { has_country_flag = show_unique_projects } }
}


## Project elements
	custom_button = { # Magical Fortress
		name = magical_fortress_project_button
		trigger = { can_upgrade_project = { project = magical_fortress school = abjuration } }
		effect = {
			start_magic_project = {
				project = magical_fortress
				school = abjuration
				event_1 = magic_project_magical_fortress.1
				event_2 = magic_project_magical_fortress.5
				event_3 = magic_project_magical_fortress.9
			}
		}
		tooltip = magical_fortress_project.desc
	}
	custom_button = { # Summon Extraplanars
		name = summon_extraplanars_project_button
		trigger = { can_upgrade_project = { project = summon_extraplanars school = conjuration } }
		effect = {
			start_magic_project = {
				project = summon_extraplanars
				school = conjuration
				event_1 = magic_project_summon_extraplanars.1
				event_2 = magic_project_summon_extraplanars.5
				event_3 = magic_project_summon_extraplanars.9
			}
		}
		tooltip = summon_extraplanars_project.desc
	}
	custom_button = { # Orb Of Omniscience
		name = orb_of_omniscience_project_button
		trigger = { can_upgrade_project = { project = orb_of_omniscience school = divination } }effect = {
			start_magic_project = {
				project = orb_of_omniscience
				school = divination
				event_all = magic_project_orb_of_omniscience.1
			}
		}
		tooltip = orb_of_omniscience_project.desc
	}
	custom_button = { # Artifact of Enthrallment
		name = artifact_of_enthrallment_project_button
		trigger = { can_upgrade_project = { project = artifact_of_enthrallment school = enchantment } }
		effect = {
			start_magic_project = {
				project = artifact_of_enthrallment
				school = enchantment
				event_all = magic_project_artifact_of_enthrallment.1
			}
		}
		tooltip = artifact_of_enthrallment_project.desc
	}
	custom_button = { # Battlemage Academy
		name = battlemage_academy_project_button
		trigger = {
			can_upgrade_project = { project = battlemage_academy school = evocation }
			has_enabled_estate_action_with_tooltip = { estate_action = RECRUIT_WAR_WIZARD }
			at_least_magical_infrastructure_level_1 = yes
		}
		effect = {
			start_magic_project = {
				project = battlemage_academy
				school = evocation
				event_all = magic_project_battlemage_academy.1
			}
		}
		tooltip = battlemage_academy_project.desc
	}
	custom_button = { # Theatre of Simulacra
		name = theatre_of_simulacra_project_button
		trigger = { can_upgrade_project = { project = theatre_of_simulacra school = illusion } }
		effect = {
			start_magic_project = {
				project = theatre_of_simulacra
				school = illusion
				event_1 = magic_project_theatre_of_simulacra.1
				event_2 = magic_project_theatre_of_simulacra.5
				event_3 = magic_project_theatre_of_simulacra.9
			}
		}
		tooltip = theatre_of_simulacra_project.desc
	}
	custom_button = { # Lichdom
		name = lichdom_project_button
		trigger = {
			ruler_is_powerful_mage = yes
			can_upgrade_project = { project = lichdom } #no school, schools are special for lichdom
			if = {
				limit = { ruler_is_lich = yes }
				ruler_is_not_lich = yes
			}
			else_if = {
				limit = { has_ruler_modifier = lichdom_mod_2 } ###Separated out for tooltip reasons
				OR = {
					is_ruler_necromancy_level_3 = yes
					is_estate_necromancy_level_3 = yes
				}
			}
			else_if = {
				limit = { has_ruler_modifier = lichdom_mod_1 }
				OR = {
					is_ruler_necromancy_level_2_minimum = yes
					is_estate_necromancy_level_2_minimum = yes
				}
			}
			else = {
				OR = {
					is_ruler_necromancy_level_1_minimum = yes
					is_estate_necromancy_level_1_minimum = yes
				}
			}
			ruler_is_not_immortal = yes
			NOT = { ruler_has_personality = xhazobs_chosen_personality }
			has_not_banned_necromancy = yes
			if = {
				limit = { has_country_flag = gemradcurt_immariel_rules }
				custom_trigger_tooltip = {
					tooltip = immariel_cant_into_lich_tt
					always = no
				}
			}
		}
		effect = {
			country_event = { id = magic_project_lichdom.1 }
			custom_tooltip = tooltip_magic_project_lookahead
			custom_tooltip = lichdom_lookahead
		}
		tooltip = lichdom_project.desc
	}
	custom_button = { # Homunculus
		name = homunculus_project_button
		trigger = { can_upgrade_project = { project = homunculus school = transmutation } }
		effect = {
			start_magic_project = {
				project = homunculus
				school = transmutation
				event_all = magic_project_homunculus.2
			}
		}
		tooltip = homunculus_project.desc
	}
	custom_icon = { # Magical Fortress
		name = magical_fortress_project_progress
		frame = {
			number = 100
			trigger = { exactly_magic_project_level = { project = magical_fortress level = 3 } }
		}
		frame = {
			number = 66
			trigger = { exactly_magic_project_level = { project = magical_fortress level = 2 } }
		}
		frame = {
			number = 33
			trigger = { exactly_magic_project_level = { project = magical_fortress level = 1 } }
		}
		frame = {
			number = 0
			trigger = { always = yes }
		}
	}
	custom_icon = { # Summon Extraplanars
		name = summon_extraplanars_project_progress
		frame = {
			number = 100
			trigger = { exactly_magic_project_level = { project = summon_extraplanars level = 3 } }
		}
		frame = {
			number = 66
			trigger = { exactly_magic_project_level = { project = summon_extraplanars level = 2 } }
		}
		frame = {
			number = 33
			trigger = { exactly_magic_project_level = { project = summon_extraplanars level = 1 } }
		}
		frame = {
			number = 0
			trigger = { always = yes }
		}
	}
	custom_icon = { # Orb Of Omniscience
		name = orb_of_omniscience_project_progress
		frame = {
			number = 100
			trigger = { exactly_magic_project_level = { project = orb_of_omniscience level = 3 } }
		}
		frame = {
			number = 66
			trigger = { exactly_magic_project_level = { project = orb_of_omniscience level = 2 } }
		}
		frame = {
			number = 33
			trigger = { exactly_magic_project_level = { project = orb_of_omniscience level = 1 } }
		}
		frame = {
			number = 0
			trigger = { always = yes }
		}
	}
	custom_icon = { # Artifact of Enthrallment
		name = artifact_of_enthrallment_project_progress
		frame = {
			number = 100
			trigger = { exactly_magic_project_level = { project = artifact_of_enthrallment level = 3 } }
		}
		frame = {
			number = 66
			trigger = { exactly_magic_project_level = { project = artifact_of_enthrallment level = 2 } }
		}
		frame = {
			number = 33
			trigger = { exactly_magic_project_level = { project = artifact_of_enthrallment level = 1 } }
		}
		frame = {
			number = 0
			trigger = { always = yes }
		}
	}
	custom_icon = { # Battlemage Academy
		name = battlemage_academy_project_progress
		frame = {
			number = 100
			trigger = { exactly_magic_project_level = { project = battlemage_academy level = 3 } }
		}
		frame = {
			number = 66
			trigger = { exactly_magic_project_level = { project = battlemage_academy level = 2 } }
		}
		frame = {
			number = 33
			trigger = { exactly_magic_project_level = { project = battlemage_academy level = 1 } }
		}
		frame = {
			number = 0
			trigger = { always = yes }
		}
	}
	custom_icon = { # Theatre of Simulacra
		name = theatre_of_simulacra_project_progress
		frame = {
			number = 100
			trigger = { exactly_magic_project_level = { project = theatre_of_simulacra level = 3 } }
		}
		frame = {
			number = 66
			trigger = { exactly_magic_project_level = { project = theatre_of_simulacra level = 2 } }
		}
		frame = {
			number = 33
			trigger = { exactly_magic_project_level = { project = theatre_of_simulacra level = 1 } }
		}
		frame = {
			number = 0
			trigger = { always = yes }
		}
	}
	custom_icon = { # Lichdom
		name = lichdom_project_progress
		frame = {
			number = 100
			trigger = { ruler_is_lich = yes }
		}
		frame = {
			number = 66
			trigger = { has_ruler_modifier = lichdom_mod_2 }
		}
		frame = {
			number = 33
			trigger = { has_ruler_modifier = lichdom_mod_1 }
		}
		frame = {
			number = 0
			trigger = { always = yes }
		}
	}
	custom_icon = { # Homunculus
		name = homunculus_project_progress
		frame = {
			number = 100
			trigger = { exactly_magic_project_level = { project = homunculus level = 3 } }
		}
		frame = {
			number = 66
			trigger = { exactly_magic_project_level = { project = homunculus level = 2 } }
		}
		frame = {
			number = 33
			trigger = { exactly_magic_project_level = { project = homunculus level = 1 } }
		}
		frame = {
			number = 0
			trigger = { always = yes }
		}
	}
	custom_text_box = { # Magical Fortress
		name = magical_fortress_project.name
	}
	custom_text_box = { # Summon Extraplanars
		name = summon_extraplanars_project.name
	}
	custom_text_box = { # Orb Of Omniscience
		name = orb_of_omniscience_project.name
	}
	custom_text_box = { # Artifact of Enthrallment
		name = artifact_of_enthrallment_project.name
	}
	custom_text_box = { # Battlemage Academy
		name = battlemage_academy_project.name
	}
	custom_text_box = { # Theatre of Simulacra
		name = theatre_of_simulacra_project.name
	}
	custom_text_box = { # Lichdom
		name = lichdom_project.name
	}
	custom_text_box = { # Homunculus
		name = homunculus_project.name
	}
## End project elements

############################
### Choose study options ###
############################

# Buttons to choose who studies and what to study
	custom_button = {
		name = study_select_ruler
		frame = {
			number = 1
			trigger = { NOT = { has_country_flag = magic_study_setup_ruler_flag } }
		}
		frame = {
			number = 2
			trigger = { has_country_flag = magic_study_setup_ruler_flag }
		}
		trigger = {
			is_ruler_eligible_to_study = yes
		}
		effect = {
			custom_tooltip = mages_ruler_experience_mod_string
			custom_tooltip = SEPERATOR_TOOLTIP
			custom_tooltip = magic_ruler_spell_levels
			custom_tooltip = ruler_magic_levels_summary
			if = { limit = { has_country_flag = magic_study_setup_ruler_flag }
				clr_country_flag = magic_study_setup_ruler_flag
			}
			else = {
				magic_study_selection_clear_type_flags = yes
				set_country_flag = magic_study_setup_ruler_flag
			}
			hidden_effect = { study_experience_preview_effect = yes }
		}
		tooltip = magic_ruler_advancement_target
	}

	custom_button = {
		name = study_select_heir
		frame = {
			number = 1
			trigger = { NOT = { has_country_flag = magic_study_setup_heir_flag } }
		}
		frame = {
			number = 2
			trigger = { has_country_flag = magic_study_setup_heir_flag }
		}
		trigger = {
			is_heir_eligible_to_study = yes
		}
		effect = {
			custom_tooltip = mages_heir_experience_mod_string
			custom_tooltip = SEPERATOR_TOOLTIP
			custom_tooltip = magic_heir_spell_levels
			custom_tooltip = heir_magic_levels_summary
			if = { limit = { has_country_flag = magic_study_setup_heir_flag }
				clr_country_flag = magic_study_setup_heir_flag
			}
			else = {
				magic_study_selection_clear_type_flags = yes
				set_country_flag = magic_study_setup_heir_flag
			}
			hidden_effect = { study_experience_preview_effect = yes }
		}
		tooltip = magic_heir_advancement_target
	}

	custom_button = {
		name = study_select_estate
		frame = {
			number = 1
			trigger = { NOT = { has_country_flag = magic_study_setup_estate_flag } }
		}
		frame = {
			number = 2
			trigger = { has_country_flag = magic_study_setup_estate_flag }
		}
		trigger = {
			is_estate_eligible_to_study = yes
		}
		effect = {
			custom_tooltip = mages_estate_experience_mod_string
			custom_tooltip = SEPERATOR_TOOLTIP
			custom_tooltip = magic_country_spell_levels
			custom_tooltip = estate_magic_levels_summary
			if = { limit = { has_country_flag = magic_study_setup_estate_flag }
				clr_country_flag = magic_study_setup_estate_flag
			}
			else = {
				magic_study_selection_clear_type_flags = yes
				set_country_flag = magic_study_setup_estate_flag
			}
			hidden_effect = { study_experience_preview_effect = yes }
		}
		tooltip = magic_estate_advancement_target
	}

	custom_button = {
		name = study_select_abjuration
		frame = {
			number = 1
			trigger = { NOT = { has_country_flag = magic_study_setup_abjuration_flag } }
		}
		frame = {
			number = 2
			trigger = { has_country_flag = magic_study_setup_abjuration_flag }
		}
		trigger = {
			hidden_trigger = {
				can_select_school_to_study = { school = abjuration }
			}
		}
		effect = {
			custom_tooltip = abjuration_experience_mod_string
			custom_tooltip = SEPERATOR_TOOLTIP
			custom_tooltip = abjuration_magic_levels_summary
			if = { limit = { has_country_flag = magic_study_setup_abjuration_flag }
				clr_country_flag = magic_study_setup_abjuration_flag
			}
			else = {
				magic_study_selection_clear_school_flags = yes
				set_country_flag = magic_study_setup_abjuration_flag
			}
			hidden_effect = { study_experience_preview_effect = yes }
		}
		tooltip = magic_school_abjuration
	}
	custom_button = {
		name = study_select_conjuration
		frame = {
			number = 1
			trigger = { NOT = { has_country_flag = magic_study_setup_conjuration_flag } }
		}
		frame = {
			number = 2
			trigger = { has_country_flag = magic_study_setup_conjuration_flag }
		}
		trigger = {
			hidden_trigger = {
				can_select_school_to_study = { school = conjuration }
			}
		}
		effect = {
			custom_tooltip = conjuration_experience_mod_string
			custom_tooltip = SEPERATOR_TOOLTIP
			custom_tooltip = conjuration_magic_levels_summary
			if = { limit = { has_country_flag = magic_study_setup_conjuration_flag }
				clr_country_flag = magic_study_setup_conjuration_flag
			}
			else = {
				magic_study_selection_clear_school_flags = yes
				set_country_flag = magic_study_setup_conjuration_flag
			}
			hidden_effect = { study_experience_preview_effect = yes }
		}
		tooltip = magic_school_conjuration
	}
	custom_button = {
		name = study_select_divination
		frame = {
			number = 1
			trigger = { NOT = { has_country_flag = magic_study_setup_divination_flag } }
		}
		frame = {
			number = 2
			trigger = { has_country_flag = magic_study_setup_divination_flag }
		}
		trigger = {
			hidden_trigger = {
				can_select_school_to_study = { school = divination }
			}
		}
		effect = {
			custom_tooltip = divination_experience_mod_string
			custom_tooltip = SEPERATOR_TOOLTIP
			custom_tooltip = divination_magic_levels_summary
			if = { limit = { has_country_flag = magic_study_setup_divination_flag }
				clr_country_flag = magic_study_setup_divination_flag
			}
			else = {
				magic_study_selection_clear_school_flags = yes
				set_country_flag = magic_study_setup_divination_flag
			}
			hidden_effect = { study_experience_preview_effect = yes }
		}
		tooltip = magic_school_divination
	}
	custom_button = {
		name = study_select_enchantment
		frame = {
			number = 1
			trigger = { NOT = { has_country_flag = magic_study_setup_enchantment_flag } }
		}
		frame = {
			number = 2
			trigger = { has_country_flag = magic_study_setup_enchantment_flag }
		}
		trigger = {
			hidden_trigger = {
				can_select_school_to_study = { school = enchantment }
			}
		}
		effect = {
			custom_tooltip = enchantment_experience_mod_string
			custom_tooltip = SEPERATOR_TOOLTIP
			custom_tooltip = enchantment_magic_levels_summary
			if = { limit = { has_country_flag = magic_study_setup_enchantment_flag }
				clr_country_flag = magic_study_setup_enchantment_flag
			}
			else = {
				magic_study_selection_clear_school_flags = yes
				set_country_flag = magic_study_setup_enchantment_flag
			}
			hidden_effect = { study_experience_preview_effect = yes }
		}
		tooltip = magic_school_enchantment
	}
	custom_button = {
		name = study_select_evocation
		frame = {
			number = 1
			trigger = { NOT = { has_country_flag = magic_study_setup_evocation_flag } }
		}
		frame = {
			number = 2
			trigger = { has_country_flag = magic_study_setup_evocation_flag }
		}
		trigger = {
			hidden_trigger = {
				can_select_school_to_study = { school = evocation }
			}
		}
		effect = {
			custom_tooltip = evocation_experience_mod_string
			custom_tooltip = SEPERATOR_TOOLTIP
			custom_tooltip = evocation_magic_levels_summary
			if = { limit = { has_country_flag = magic_study_setup_evocation_flag }
				clr_country_flag = magic_study_setup_evocation_flag
			}
			else = {
				magic_study_selection_clear_school_flags = yes
				set_country_flag = magic_study_setup_evocation_flag
			}
			hidden_effect = { study_experience_preview_effect = yes }
		}
		tooltip = magic_school_evocation
	}
	custom_button = {
		name = study_select_illusion
		frame = {
			number = 1
			trigger = { NOT = { has_country_flag = magic_study_setup_illusion_flag } }
		}
		frame = {
			number = 2
			trigger = { has_country_flag = magic_study_setup_illusion_flag }
		}
		trigger = {
			hidden_trigger = {
				can_select_school_to_study = { school = illusion }
			}
		}
		effect = {
			custom_tooltip = illusion_experience_mod_string
			custom_tooltip = SEPERATOR_TOOLTIP
			custom_tooltip = illusion_magic_levels_summary
			if = { limit = { has_country_flag = magic_study_setup_illusion_flag }
				clr_country_flag = magic_study_setup_illusion_flag
			}
			else = {
				magic_study_selection_clear_school_flags = yes
				set_country_flag = magic_study_setup_illusion_flag
			}
			hidden_effect = { study_experience_preview_effect = yes }
		}
		tooltip = magic_school_illusion
	}
	custom_button = {
		name = study_select_necromancy
		frame = {
			number = 1
			trigger = { NOT = { has_country_flag = magic_study_setup_necromancy_flag } }
		}
		frame = {
			number = 2
			trigger = { has_country_flag = magic_study_setup_necromancy_flag }
		}
		trigger = {
			hidden_trigger = {
				can_select_school_to_study = { school = necromancy }
			}
			has_not_banned_necromancy = yes
		}
		effect = {
			custom_tooltip = necromancy_experience_mod_string
			custom_tooltip = SEPERATOR_TOOLTIP
			custom_tooltip = necromancy_magic_levels_summary
			if = { limit = { has_country_flag = magic_study_setup_necromancy_flag }
				clr_country_flag = magic_study_setup_necromancy_flag
			}
			else = {
				magic_study_selection_clear_school_flags = yes
				set_country_flag = magic_study_setup_necromancy_flag
			}
			hidden_effect = { study_experience_preview_effect = yes }
		}
		tooltip = magic_school_necromancy
	}
	custom_button = {
		name = study_select_transmutation
		frame = {
			number = 1
			trigger = { NOT = { has_country_flag = magic_study_setup_transmutation_flag } }
		}
		frame = {
			number = 2
			trigger = { has_country_flag = magic_study_setup_transmutation_flag }
		}
		trigger = {
			hidden_trigger = {
				can_select_school_to_study = { school = transmutation }
			}
		}
		effect = {
			custom_tooltip = transmutation_experience_mod_string
			custom_tooltip = SEPERATOR_TOOLTIP
			custom_tooltip = transmutation_magic_levels_summary
			if = { limit = { has_country_flag = magic_study_setup_transmutation_flag }
				clr_country_flag = magic_study_setup_transmutation_flag
			}
			else = {
				magic_study_selection_clear_school_flags = yes
				set_country_flag = magic_study_setup_transmutation_flag
			}
			hidden_effect = { study_experience_preview_effect = yes }
		}
		tooltip = magic_school_transmutation
	}


	custom_button = {
		name = study_confirm_button
		trigger = {
			hidden_trigger = {
				OR = {
					has_country_flag = magic_study_setup_abjuration_flag
					has_country_flag = magic_study_setup_conjuration_flag
					has_country_flag = magic_study_setup_divination_flag
					has_country_flag = magic_study_setup_enchantment_flag
					has_country_flag = magic_study_setup_evocation_flag
					has_country_flag = magic_study_setup_illusion_flag
					has_country_flag = magic_study_setup_necromancy_flag
					has_country_flag = magic_study_setup_transmutation_flag
				}
				OR = {
					has_country_flag = magic_study_setup_ruler_flag
					has_country_flag = magic_study_setup_heir_flag
					has_country_flag = magic_study_setup_estate_flag
				}
			}

			if = { limit = { has_country_flag = magic_study_setup_ruler_flag }
				ruler_is_powerful_mage = yes #Check not dead after selected
				magic_study_type_is_not_level_3 = { type = ruler }
			}
			if = { limit = { has_country_flag = magic_study_setup_heir_flag }
				heir_is_powerful_mage = yes #Check not dead after selected
				magic_study_type_is_not_level_3 = { type = heir }
			}
			if = { limit = { has_country_flag = magic_study_setup_estate_flag }
				magic_study_type_is_not_level_3 = { type = estate }
			}
		}
		effect = {
			start_magic_study_school_sort = yes
		
			#Clear setup flags
			clr_country_flag = magic_menu_study_flag
			magic_study_selection_clear_school_flags = yes
			magic_study_selection_clear_type_flags = yes
			magic_advancement_selection_clear_advancement_flags = yes
			update_magic_menu_effect = yes
		}
	}
	# End choose study activity buttons
	
custom_text_box = { #Magical study xp modifier total
	name = magic_study_xp_modifier
	tooltip = magic_study_xp_mod_summary
}

custom_button = {
	name = study_back_button
	effect = {
		update_magic_menu_effect = yes
		clr_country_flag = magic_menu_study_flag
		magic_study_selection_clear_school_flags = yes
		magic_study_selection_clear_type_flags = yes
	}
}

######################
### SPELLBOOK MENU ###
######################

#magic_menu_spellbook_school_icons_strip
custom_icon = {
	name = magic_menu_spellbook_school_icons_strip
	potential = { always = yes }
	frame = {
		number = 1
		trigger = {	has_country_flag = magic_menu_spellbook_divination_flag }
	}
	frame = {
		number = 2
		trigger = {	has_country_flag = magic_menu_spellbook_enchantment_flag }
	}
	frame = {
		number = 3
		trigger = {	has_country_flag = magic_menu_spellbook_abjuration_flag }
	}
	frame = {
		number = 4
		trigger = {	has_country_flag = magic_menu_spellbook_transmutation_flag }
	}
	frame = {
		number = 5
		trigger = {	has_country_flag = magic_menu_spellbook_evocation_flag }
	}
	frame = {
		number = 6
		trigger = {	has_country_flag = magic_menu_spellbook_illusion_flag }
	}
	frame = {
		number = 7
		trigger = {	has_country_flag = magic_menu_spellbook_necromancy_flag }
	}
	frame = {
		number = 8
		trigger = {	has_country_flag = magic_menu_spellbook_conjuration_flag }
	}
}

custom_button = { #Spellbook Menu Back Main Menu Button
	name = magic_menu_back_out_button_spellbook
	potential = {
		always = yes
	}
	effect = {
		update_magic_menu_effect = yes
		hidden_effect = {
			clr_country_flag = magic_menu_spellbook_flag
		}
	}
	tooltip = close_spellbook_menu_tt
}

custom_text_box = { #Spellbook Menu XP Max Text
	name = magic_menu_max_xp_spellbook
	potential = {
		always = yes
	}
}
custom_text_box = { #Spellbook Menu XP Regen Text
	name = magic_menu_regen_xp_spellbook
	potential = {
		always = yes
	}
}


# Choose spellbook buttons
	custom_button = { #Spellbook Change School Abjuration Button
		name = magic_menu_button_change_school_abjuration_spellbook
		effect = {
			update_magic_menu_effect = yes
			custom_tooltip = abjuration_magic_levels_summary
			hidden_effect = {
				clear_spellbook_flags = yes
				set_country_flag = magic_menu_spellbook_abjuration_flag
			}
		}
		tooltip = open_abjuration_spellbook_tt
	}
	custom_button = { #Spellbook Change School Conjuration Button
		name = magic_menu_button_change_school_conjuration_spellbook
		effect = {
			update_magic_menu_effect = yes
			custom_tooltip = conjuration_magic_levels_summary
			hidden_effect = {
				clear_spellbook_flags = yes
				set_country_flag = magic_menu_spellbook_conjuration_flag
			}
		}
		tooltip = open_conjuration_spellbook_tt
	}
	custom_button = { #Spellbook Change School Divination Button
		name = magic_menu_button_change_school_divination_spellbook
		effect = {
			update_magic_menu_effect = yes
			custom_tooltip = divination_magic_levels_summary
			hidden_effect = {
				clear_spellbook_flags = yes
				set_country_flag = magic_menu_spellbook_divination_flag
			}
		}
		tooltip = open_divination_spellbook_tt
	}
	custom_button = { #Spellbook Change School Enchantment Button
		name = magic_menu_button_change_school_enchantment_spellbook
		effect = {
			update_magic_menu_effect = yes
			custom_tooltip = enchantment_magic_levels_summary
			hidden_effect = {
				clear_spellbook_flags = yes
				set_country_flag = magic_menu_spellbook_enchantment_flag
			}
		}
		tooltip = open_enchantment_spellbook_tt
	}
	custom_button = { #Spellbook Change School Evocation Button
		name = magic_menu_button_change_school_evocation_spellbook
		effect = {
			update_magic_menu_effect = yes
			custom_tooltip = evocation_magic_levels_summary
			hidden_effect = {
				clear_spellbook_flags = yes
				set_country_flag = magic_menu_spellbook_evocation_flag
			}
		}
		tooltip = open_evocation_spellbook_tt
	}
	custom_button = { #Spellbook Change School Illusion Button
		name = magic_menu_button_change_school_illusion_spellbook
		effect = {
			update_magic_menu_effect = yes
			custom_tooltip = illusion_magic_levels_summary
			hidden_effect = {
				clear_spellbook_flags = yes
				set_country_flag = magic_menu_spellbook_illusion_flag
			}
		}
		tooltip = open_illusion_spellbook_tt
	}
	custom_button = { #Spellbook Change School Necromancy Button
		name = magic_menu_button_change_school_necromancy_spellbook
		effect = {
			update_magic_menu_effect = yes
			custom_tooltip = necromancy_magic_levels_summary
			hidden_effect = {
				clear_spellbook_flags = yes
				set_country_flag = magic_menu_spellbook_necromancy_flag
			}
		}
		tooltip = open_necromancy_spellbook_tt
	}
	custom_button = { #Spellbook Change School Transmutation Button
		name = magic_menu_button_change_school_transmutation_spellbook
		effect = {
			update_magic_menu_effect = yes
			custom_tooltip = transmutation_magic_levels_summary
			hidden_effect = {
				clear_spellbook_flags = yes
				set_country_flag = magic_menu_spellbook_transmutation_flag
			}
		}
		tooltip = open_transmutation_spellbook_tt
	}
# End change spellbook buttons

# Spell name loc textboxes
	custom_text_box = {
		name = magic_menu_cast_spell_slot_1
	}
	custom_text_box = {
		name = magic_menu_cast_spell_slot_2
	}
	custom_text_box = {
		name = magic_menu_cast_spell_slot_3
	}
	custom_text_box = {
		name = magic_menu_cast_spell_slot_4
	}
	custom_text_box = {
		name = magic_menu_cast_spell_slot_5
	}
	custom_text_box = {
		name = magic_menu_cast_spell_slot_6
	}
	custom_text_box = {
		name = magic_menu_cast_spell_slot_1_2
	}
	custom_text_box = {
		name = magic_menu_cast_spell_slot_2_2
	}
	custom_text_box = {
		name = magic_menu_cast_spell_slot_3_2
	}
	custom_text_box = {
		name = magic_menu_cast_spell_slot_4_2
	}
	custom_text_box = {
		name = magic_menu_cast_spell_slot_5_2
	}
	custom_text_box = {
		name = magic_menu_cast_spell_slot_6_2
	}
# End spell name loc textboxes


# TODO Jothell
# This will change if/when art comes
# The original idea was to have each strip have all spell icons of the same level
# And change the icon shown by spell school
# This requires only 6 custom icons
#Spell custom icons
	custom_icon = {
		name = magic_menu_cast_spell_slot_1_icon
		frame = {
			number = 1 # abjuration spell
			trigger = { has_country_flag = magic_menu_spellbook_abjuration_flag }
		}
		frame = {
			number = 2 # conjuration spell
			trigger = { has_country_flag = magic_menu_spellbook_conjuration_flag }
		}
		frame = {
			number = 3 # divination spell
			trigger = { has_country_flag = magic_menu_spellbook_divination_flag }
		}
		frame = {
			number = 4 # enchantment spell
			trigger = { has_country_flag = magic_menu_spellbook_enchantment_flag }
		}
		frame = {
			number = 5 # evocation spell
			trigger = { has_country_flag = magic_menu_spellbook_evocation_flag }
		}
		frame = {
			number = 6 # illusion spell
			trigger = { has_country_flag = magic_menu_spellbook_illusion_flag }
		}
		frame = {
			number = 7 # necromancy spell
			trigger = { has_country_flag = magic_menu_spellbook_necromancy_flag }
		}
		frame = {
			number = 8 # transmutation spell
			trigger = { has_country_flag = magic_menu_spellbook_transmutation_flag }
		}
	}
	custom_icon = {
		name = magic_menu_cast_spell_slot_2_icon
		frame = {
			number = 1 # abjuration spell
			trigger = { has_country_flag = magic_menu_spellbook_abjuration_flag }
		}
		frame = {
			number = 2 # conjuration spell
			trigger = { has_country_flag = magic_menu_spellbook_conjuration_flag }
		}
		frame = {
			number = 3 # divination spell
			trigger = { has_country_flag = magic_menu_spellbook_divination_flag }
		}
		frame = {
			number = 4 # enchantment spell
			trigger = { has_country_flag = magic_menu_spellbook_enchantment_flag }
		}
		frame = {
			number = 5 # evocation spell
			trigger = { has_country_flag = magic_menu_spellbook_evocation_flag }
		}
		frame = {
			number = 6 # illusion spell
			trigger = { has_country_flag = magic_menu_spellbook_illusion_flag }
		}
		frame = {
			number = 7 # necromancy spell
			trigger = { has_country_flag = magic_menu_spellbook_necromancy_flag }
		}
		frame = {
			number = 8 # transmutation spell
			trigger = { has_country_flag = magic_menu_spellbook_transmutation_flag }
		}
	}
	custom_icon = {
		name = magic_menu_cast_spell_slot_3_icon
		frame = {
			number = 1 # abjuration spell
			trigger = { has_country_flag = magic_menu_spellbook_abjuration_flag }
		}
		frame = {
			number = 2 # conjuration spell
			trigger = { has_country_flag = magic_menu_spellbook_conjuration_flag }
		}
		frame = {
			number = 3 # divination spell
			trigger = { has_country_flag = magic_menu_spellbook_divination_flag }
		}
		frame = {
			number = 4 # enchantment spell
			trigger = { has_country_flag = magic_menu_spellbook_enchantment_flag }
		}
		frame = {
			number = 5 # evocation spell
			trigger = { has_country_flag = magic_menu_spellbook_evocation_flag }
		}
		frame = {
			number = 6 # illusion spell
			trigger = { has_country_flag = magic_menu_spellbook_illusion_flag }
		}
		frame = {
			number = 7 # necromancy spell
			trigger = { has_country_flag = magic_menu_spellbook_necromancy_flag }
		}
		frame = {
			number = 8 # transmutation spell
			trigger = { has_country_flag = magic_menu_spellbook_transmutation_flag }
		}
	}
	custom_icon = {
		name = magic_menu_cast_spell_slot_4_icon
		frame = {
			number = 1 # abjuration spell
			trigger = { has_country_flag = magic_menu_spellbook_abjuration_flag }
		}
		frame = {
			number = 2 # conjuration spell
			trigger = { has_country_flag = magic_menu_spellbook_conjuration_flag }
		}
		frame = {
			number = 3 # divination spell
			trigger = { has_country_flag = magic_menu_spellbook_divination_flag }
		}
		frame = {
			number = 4 # enchantment spell
			trigger = { has_country_flag = magic_menu_spellbook_enchantment_flag }
		}
		frame = {
			number = 5 # evocation spell
			trigger = { has_country_flag = magic_menu_spellbook_evocation_flag }
		}
		frame = {
			number = 6 # illusion spell
			trigger = { has_country_flag = magic_menu_spellbook_illusion_flag }
		}
		frame = {
			number = 7 # necromancy spell
			trigger = { has_country_flag = magic_menu_spellbook_necromancy_flag }
		}
		frame = {
			number = 8 # transmutation spell
			trigger = { has_country_flag = magic_menu_spellbook_transmutation_flag }
		}
	}
	custom_icon = {
		name = magic_menu_cast_spell_slot_5_icon
		frame = {
			number = 1 # abjuration spell
			trigger = { has_country_flag = magic_menu_spellbook_abjuration_flag }
		}
		frame = {
			number = 2 # conjuration spell
			trigger = { has_country_flag = magic_menu_spellbook_conjuration_flag }
		}
		frame = {
			number = 3 # divination spell
			trigger = { has_country_flag = magic_menu_spellbook_divination_flag }
		}
		frame = {
			number = 4 # enchantment spell
			trigger = { has_country_flag = magic_menu_spellbook_enchantment_flag }
		}
		frame = {
			number = 5 # evocation spell
			trigger = { has_country_flag = magic_menu_spellbook_evocation_flag }
		}
		frame = {
			number = 6 # illusion spell
			trigger = { has_country_flag = magic_menu_spellbook_illusion_flag }
		}
		frame = {
			number = 7 # necromancy spell
			trigger = { has_country_flag = magic_menu_spellbook_necromancy_flag }
		}
		frame = {
			number = 8 # transmutation spell
			trigger = { has_country_flag = magic_menu_spellbook_transmutation_flag }
		}
	}
	custom_icon = {
		name = magic_menu_cast_spell_slot_6_icon
		frame = {
			number = 1 # abjuration spell
			trigger = { has_country_flag = magic_menu_spellbook_abjuration_flag }
		}
		frame = {
			number = 2 # conjuration spell
			trigger = { has_country_flag = magic_menu_spellbook_conjuration_flag }
		}
		frame = {
			number = 3 # divination spell
			trigger = { has_country_flag = magic_menu_spellbook_divination_flag }
		}
		frame = {
			number = 4 # enchantment spell
			trigger = { has_country_flag = magic_menu_spellbook_enchantment_flag }
		}
		frame = {
			number = 5 # evocation spell
			trigger = { has_country_flag = magic_menu_spellbook_evocation_flag }
		}
		frame = {
			number = 6 # illusion spell
			trigger = { has_country_flag = magic_menu_spellbook_illusion_flag }
		}
		frame = {
			number = 7 # necromancy spell
			trigger = { has_country_flag = magic_menu_spellbook_necromancy_flag }
		}
		frame = {
			number = 8 # transmutation spell
			trigger = { has_country_flag = magic_menu_spellbook_transmutation_flag }
		}
	}
# End spell custom icons


# Cast spell buttons

	### DIVINATION ###

	custom_button = { #Spellbook Cast Guidance Button
		name = magic_menu_divination_spell_1_button
		tooltip = divination_0_guidance_spell_desc
		trigger = {
			has_mana_to_cast_spell = { school = divination level = 0 id = guidance }
		}
		effect = {
			generic_cast_spell = { school = divination level = 0 id = guidance }
		}
	}
	custom_button = { #Spellbook Menu Cast Eye for Talent Button
		name = magic_menu_divination_spell_2_button
		tooltip = divination_1_eye_for_talent_spell_desc
		trigger = {
			divination_1_eye_for_talent_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = divination level = 1 id = eye_for_talent }
		}
	}
	custom_button = { #Spellbook Menu Cast Deposit Divination Button
		name = magic_menu_divination_spell_3_button
		tooltip = divination_1_deposit_divination_spell_desc
		trigger = {
			divination_1_deposit_divination_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = divination level = 1 id = deposit_divination }
		}
	}
	custom_button = { #Spellbook Menu Cast Scry Button
		name = magic_menu_divination_spell_4_button
		tooltip = divination_2_scry_spell_desc
		trigger = {
			divination_2_scry_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = divination level = 2 id = scry }
		}
	}
	custom_button = { #Spellbook Menu Cast Manipulated Fortune Button
		name = magic_menu_divination_spell_5_button
		tooltip = divination_2_manipulated_fortune_spell_desc
		trigger = {
			divination_2_manipulated_fortune_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = divination level = 2 id = manipulated_fortune war = yes }
		}
	}
	custom_button = { #Spellbook Menu Cast Foresight Button
		name = magic_menu_divination_spell_6_button
		tooltip = divination_3_foresight_spell_desc
		trigger = {
			divination_3_foresight_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = divination level = 3 id = foresight }
		}
	}

	### ENCHANTMENT ###

	custom_button = { #Spellbook Cast Enchanting Embassy Button
		name = magic_cast_enchantment_spell1_button
		tooltip = enchantment_0_enchanting_embassy_spell_desc
		trigger = {
			enchantment_0_enchanting_embassy_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = enchantment level = 0 id = enchanting_embassy }
		}
	}
	custom_button = { #Spellbook Menu Cast Mass Charm Button
		name = magic_cast_enchantment_spell2_button
		tooltip = enchantment_1_mass_charm_spell_desc
		trigger = {
			enchantment_1_mass_charm_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = enchantment level = 1 id = mass_charm war = yes }
		}
	}
	custom_button = { #Spellbook Menu Cast Command Animals Button
		name = magic_cast_enchantment_spell3_button
		tooltip = enchantment_1_command_animals_spell_desc
		trigger = {
			enchantment_1_command_animals_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = enchantment level = 1 id = command_animals }
		}
	}
	custom_button = { #Spellbook Menu Cast Mass Charm 2 Button
		name = magic_cast_enchantment_spell4_button
		tooltip = enchantment_2_mass_charm_2_spell_desc
		trigger = {
			enchantment_2_mass_charm_2_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = enchantment level = 2 id = mass_charm_2 war = yes }
		}
	}
	custom_button = { #Spellbook Menu Cast Enchanting Embassy 2 Button
		name = magic_cast_enchantment_spell5_button
		tooltip = enchantment_2_enchanting_embassy_2_spell_desc
		trigger = {
			enchantment_2_enchanting_embassy_2_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = enchantment level = 2 id = enchanting_embassy_2 }
		}
	}
	custom_button = { #Spellbook Menu Cast Dominate to Surrender Icon
		name = magic_cast_enchantment_spell6_button
		tooltip = enchantment_3_dominate_to_surrender_spell_desc
		trigger = {
			enchantment_3_dominate_to_surrender_trigger = { player = yes menu = yes }
		}
		effect = {
			tooltip = {
				4160 = {
					ROOT = {
						generic_cast_spell = { school = enchantment level = 3 id = dominate_to_surrender }
					}
				}
			}
		}
	}

	### ABJURATION ###

	custom_button = { #Spellbook Cast Combat Ward Button
		name = magic_cast_abjuration_spell1_button
		tooltip = abjuration_0_combat_ward_spell_desc
		trigger = {
			abjuration_0_combat_ward_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = abjuration level = 0 id = combat_ward war = yes }
		}
	}
	custom_button = { #Spellbook Cast Protective Ward Icon
		name = magic_cast_abjuration_spell2_button
		tooltip = abjuration_1_ward_spell_desc
		trigger = {
			abjuration_1_ward_trigger = { player = yes menu = yes }
		}
		effect = {
			tooltip = {
				4160 = {
					ROOT = {
						generic_cast_spell = { school = abjuration level = 1 id = ward }
					}
				}
			}
		}
	}
	custom_button = { #Spellbook Menu Cast Protected Journey Button
		name = magic_cast_abjuration_spell3_button
		tooltip = abjuration_1_protected_journey_spell_desc
		trigger = {
			abjuration_1_protected_journey_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = abjuration level = 1 id = protected_journey }
		}
	}
	custom_button = { #Spellbook Menu Cast Mass Ward Button
		name = magic_cast_abjuration_spell4_button
		tooltip = abjuration_2_mass_ward_spell_desc
		trigger = {
			abjuration_2_mass_ward_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = abjuration level = 2 id = mass_ward }
		}
	}
	custom_button = { #Spellbook Menu Cast Mage Armour Button
		name = magic_cast_abjuration_spell5_button
		tooltip = abjuration_2_mage_armor_spell_desc
		trigger = {
			abjuration_2_mage_armor_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = abjuration level = 2 id = mage_armor war = yes }
		}
	}
	custom_button = { #Spellbook Menu Cast Field of Forbiddance Button
		name = magic_cast_abjuration_spell6_button
		tooltip = abjuration_3_field_of_forbiddance_spell_desc
		trigger = {
			abjuration_3_field_of_forbiddance_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = abjuration level = 3 id = field_of_forbiddance }
		}
	}

	### TRANSMUTATION ###

	custom_button = { #Spellbook Cast Longstrider Button
		name = magic_cast_transmutation_spell1_button
		tooltip = transmutation_0_longstrider_spell_desc
		trigger = {
			transmutation_0_longstrider_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = transmutation level = 0 id = longstrider }
		}
	}
	custom_button = { #Spellbook Cast Plant Growth Icon
		name = magic_cast_transmutation_spell2_button
		tooltip = transmutation_1_plant_growth_spell_desc
		trigger = {
			transmutation_1_plant_growth_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = transmutation level = 1 id = plant_growth }
		}
	}
	custom_button = { #Spellbook Menu Cast Mass Enlarge Button
		name = magic_cast_transmutation_spell3_button
		tooltip = transmutation_1_mass_enlarge_spell_desc
		trigger = {
			transmutation_1_mass_enlarge_trigger = { player = yes menu = yes }
		}
		effect = {
			tooltip = {
				4160 = {
					ROOT = { generic_cast_spell = { school = transmutation level = 1 id = mass_enlarge } }
				}
			}
		}
	}
	custom_button = { #Spellbook Menu Cast Transmute to Gold Button
		name = magic_cast_transmutation_spell4_button
		tooltip = transmutation_2_transmute_to_gold_spell_desc
		trigger = {
			transmutation_2_transmute_to_gold_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = transmutation level = 2 id = transmute_to_gold }
		}
	}
	custom_button = { #Spellbook Menu Cast Reshape Terrain Button
		name = magic_cast_transmutation_spell5_button
		tooltip = transmutation_2_reshape_terrain_spell_desc
		trigger = {
			transmutation_2_reshape_terrain_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = transmutation level = 2 id = reshape_terrain }
		}
	}
	custom_button = { #Spellbook Menu Cast Rite of Conception Button
		name = magic_cast_transmutation_spell6_button
		tooltip = transmutation_3_rite_of_conception_spell_desc
		trigger = {
			transmutation_3_rite_of_conception_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = transmutation level = 3 id = rite_of_conception }
		}
	}

	### EVOCATION ###

	custom_button = { #Spellbook Cast Fireball Icon
		name = magic_cast_evocation_spell1_button
		tooltip = evocation_0_fireball_spell_desc
		trigger = {
			evocation_0_fireball_trigger = { player = yes menu = yes }
		}
		effect = {
			tooltip = {
				4160 = {
					ROOT = { generic_cast_spell = { school = evocation level = 0 id = fireball } }
				}
			}
		}
	}
	custom_button = { #Spellbook Menu Cast Shock and Awe Button
		name = magic_cast_evocation_spell2_button
		tooltip = evocation_1_shock_and_awe_spell_desc
		trigger = {
			evocation_1_shock_and_awe_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = evocation level = 1 id = shock_and_awe war = yes }
		}
	}
	custom_button = { #Spellbook Menu Cast Flaming Munitions Button
		name = magic_cast_evocation_spell3_button
		tooltip = evocation_1_flaming_munitions_spell_desc
		trigger = {
			evocation_1_flaming_munitions_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = evocation level = 1 id = flaming_munitions war = yes }
		}
	}
	custom_button = { #Spellbook Cast Meteor Swarm Icon
		name = magic_cast_evocation_spell4_button
		tooltip = evocation_2_meteor_swarm_spell_desc
		trigger = {
			evocation_2_meteor_swarm_trigger = { player = yes menu = yes }
		}
		effect = {
			tooltip = {
				4160 = {
					ROOT = { generic_cast_spell = { school = evocation level = 2 id = meteor_swarm } }
				}
			}
		}
	}
	custom_button = { #Spellbook Menu Cast Tearfall Button
		name = magic_cast_evocation_spell5_button
		tooltip = evocation_2_tearfall_spell_desc
		potential = {
			has_country_flag = magic_menu_spellbook_flag
			has_country_flag = magic_menu_spellbook_evocation_flag
		}
		trigger = {
			evocation_2_tearfall_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = evocation level = 2 id = tearfall }
		}
	}
	custom_button = { #Spellbook Menu Cast Elemental Fury Button
		name = magic_cast_evocation_spell6_button
		tooltip = evocation_3_elemental_fury_spell_desc
		trigger = {
			evocation_3_elemental_fury_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = evocation level = 3 id = elemental_fury war = yes }
		}
	}

	### ILLUSION ###

	custom_button = { #Spellbook Cast Invisibility Button
		name = magic_cast_illusion_spell1_button
		tooltip = illusion_0_invisibility_spell_desc
		trigger = {
			illusion_0_invisibility_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = illusion level = 0 id = invisibility }
		}
	}
	custom_button = { #Spellbook Menu Cast Fear and Loathing Button
		name = magic_cast_illusion_spell2_button
		tooltip = illusion_1_fear_and_loathing_spell_desc
		trigger = {
			illusion_1_fear_and_loathing_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = illusion level = 1 id = fear_and_loathing }
		}
	}
	custom_button = { #Spellbook Menu Cast Bread and Circuses Button
		name = magic_cast_illusion_spell3_button
		tooltip = illusion_1_bread_and_circuses_spell_desc
		trigger = {
			illusion_1_bread_and_circuses_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = illusion level = 1 id = bread_and_circuses }
		}
	}
	custom_button = { #Spellbook Menu Cast Assimilation Program Button
		name = magic_cast_illusion_spell4_button
		tooltip = illusion_2_assimilation_program_spell_desc
		trigger = {
			illusion_2_assimilation_program_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = illusion level = 2 id = assimilation_program }
		}
	}
	custom_button = { #Spellbook Menu Cast Shadows in the Night Button
		name = magic_cast_illusion_spell5_button
		tooltip = illusion_2_shadows_in_the_night_spell_desc
		trigger = {
			illusion_2_shadows_in_the_night_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = illusion level = 2 id = shadows_in_the_night }
		}
	}
	custom_button = { #Spellbook Menu Cast Lead the Crowds Button
		name = magic_cast_illusion_spell6_button
		tooltip = illusion_3_lead_the_crowds_spell_desc
		trigger = {
			illusion_3_lead_the_crowds_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = illusion level = 3 id = lead_the_crowds }
		}
	}

	### NECROMANCY ###

	custom_button = { #Spellbook Cast False Life Button
		name = magic_cast_necromancy_spell1_button
		tooltip = necromancy_0_false_life_spell_desc
		trigger = {
			necromancy_0_false_life_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = necromancy level = 0 id = false_life }
		}
	}
	custom_button = { #Spellbook Menu Cast Ghoulish Grandeur Button
		name = magic_cast_necromancy_spell2_button
		tooltip = necromancy_1_ghoulish_grandeur_spell_desc
		trigger = {
			necromancy_1_ghoulish_grandeur_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = necromancy level = 1 id = ghoulish_grandeur }
		}
	}
	custom_button = { #Spellbook Cast Contagion Icon
		name = magic_cast_necromancy_spell3_button
		tooltip = necromancy_1_contagion_spell_desc
		trigger = {
			necromancy_1_contagion_trigger = { player = yes menu = yes }
		}
		effect = {
			tooltip = {
				4160 = {
					ROOT = { generic_cast_spell = { school = necromancy level = 1 id = contagion } }
				}
			}
		}
	}
	custom_button = { #Spellbook Menu Cast Speak With Dead Button
		name = magic_cast_necromancy_spell4_button
		tooltip = necromancy_2_speak_with_dead_spell_desc
		trigger = {
			necromancy_2_speak_with_dead_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = necromancy level = 2 id = speak_with_dead }
		}
	}
	custom_button = { #Spellbook Menu Cast Steal Vitality Button
		name = magic_cast_necromancy_spell5_button
		tooltip = necromancy_2_steal_vitality_spell_desc
		trigger = {
			necromancy_2_steal_vitality_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = necromancy level = 2 id = steal_vitality }
		}
	}
	custom_button = { #Spellbook Menu Cast Undead Army Button
		name = magic_cast_necromancy_spell6_button
		tooltip = necromancy_3_undead_army_spell_desc
		trigger = {
			necromancy_3_undead_army_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = necromancy level = 3 id = undead_army }
		}
	}

	### CONJURATION ###

	custom_button = { #Spellbook Cast Summon Familiars Button
		name = magic_cast_conjuration_spell1_button
		tooltip = conjuration_0_summon_familiars_spell_desc
		trigger = {
			conjuration_0_summon_familiars_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = conjuration level = 0 id = summon_familiars }
		}
	}
	custom_button = { #Spellbook Menu Cast Summon Animals Button
		name = magic_cast_conjuration_spell2_button
		tooltip = conjuration_1_summon_animals_spell_desc
		trigger = {
			conjuration_1_summon_animals_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = conjuration level = 1 id = summon_animals }
		}
	}
	custom_button = { #Spellbook Menu Cast Conjure Supplies Button
		name = magic_cast_conjuration_spell3_button
		tooltip = conjuration_1_conjure_supplies_spell_desc
		trigger = {
			conjuration_1_conjure_supplies_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = conjuration level = 1 id = conjure_supplies }
		}
	}
	custom_button = { #Spellbook Menu Cast Summon Elementals Button
		name = magic_cast_conjuration_spell4_button
		tooltip = conjuration_2_summon_elementals_spell_desc
		trigger = {
			conjuration_2_summon_elementals_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = conjuration level = 2 id = summon_elementals }
		}
	}
	custom_button = { #Spellbook Menu Cast Aid Construction Button
		name = magic_cast_conjuration_spell5_button
		tooltip = conjuration_2_aid_construction_spell_desc
		trigger = {
			conjuration_2_aid_construction_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = conjuration level = 2 id = aid_construction }
		}
	}
	custom_button = { #Spellbook Menu Cast Extraplanar Contact Button
		name = magic_cast_conjuration_spell6_button
		tooltip = conjuration_3_extraplanar_contact_spell_desc
		trigger = {
			conjuration_3_extraplanar_contact_trigger = { player = yes }
		}
		effect = {
			generic_cast_spell = { school = conjuration level = 3 id = extraplanar_contact }
		}
	}
# End cast spell buttons
