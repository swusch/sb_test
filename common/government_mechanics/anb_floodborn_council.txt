floodborn_council_mechanic = {
	alert_icon_gfx = GFX_alerticons_government_mechanics
	alert_icon_index = 30
	available = {
		OR = {
			has_reform = floodborn_council_reform
			has_reform = floodborn_council_reform_always_mage
			has_reform = floodborn_council_reform_theocracy
			has_reform = floodborn_council_reform_republics
			has_reform = floodborn_council_reform_late_monarchy
		}
	}

	powers = {
		bloodbrand_power = {
			gui = floodborn_council_bar
			max = 100
			min = 0
			reset_on_new_ruler = no
			base_monthly_growth = 1
			is_good = yes
			
			scaled_modifier = {
				trigger = {
					has_government_power = {
                        mechanic_type = floodborn_council_mechanic
                        power_type = bloodbrand_power
                        value = 0
                    }
				}
				modifier = {
					manpower_recovery_speed = 0.20
					stability_cost_modifier = -0.20
					global_unrest = 2
				}
			}
			#Age
			range_modifier = {
				trigger = {
					ruler_age = 40
					NOT = { has_reform = floodborn_council_reform_theocracy }
				}
				modifier = {
					monthly_bloodbrand_power = -0.10
				}
			}
			range_modifier = {
				trigger = {
					ruler_age = 50
					NOT = { has_reform = floodborn_council_reform_theocracy }
				}
				modifier = {
					monthly_bloodbrand_power = -0.10
				}
			}
			range_modifier = {
				trigger = {
					ruler_age = 60
					NOT = { has_reform = floodborn_council_reform_theocracy }
				}
				modifier = {
					monthly_bloodbrand_power = -0.25
				}
			}
			range_modifier = {
				trigger = {
					ruler_age = 60
					has_reform = floodborn_council_reform_theocracy
				}
				modifier = {
					monthly_bloodbrand_power = -0.10
				}
			}
			range_modifier = {
				trigger = {
					ruler_age = 70
					NOT = { has_reform = floodborn_council_reform_theocracy }
				}
				modifier = {
					monthly_bloodbrand_power = -0.25
				}
			}
			range_modifier = {
				trigger = {
					ruler_age = 70
					has_reform = floodborn_council_reform_theocracy
				}
				modifier = {
					monthly_bloodbrand_power = -0.10
				}
			}
			range_modifier = {
				trigger = {
					ruler_age = 80
				}
				modifier = {
					monthly_bloodbrand_power = -0.25
				}
			}
			range_modifier = {
				trigger = {
					ruler_age = 90
				}
				modifier = {
					monthly_bloodbrand_power = -0.25
				}
			}
			range_modifier = {
				trigger = {
					ruler_age = 100
				}
				modifier = {
					monthly_bloodbrand_power = -0.5
				}
			}
			#Magical Infamy
			range_modifier = {
				trigger = {
					ruler_is_powerful_mage = yes
					ruler_has_infamy_paragon = yes
				}
				modifier = {
					monthly_bloodbrand_power = -0.5
				}
			}
			range_modifier = {
				trigger = {
					ruler_is_powerful_mage = yes
					type_has_infamy_respected = { type = ruler }
				}
				modifier = {
					monthly_bloodbrand_power = 0.05
				}
			}
			range_modifier = {
				trigger = {
					ruler_is_powerful_mage = yes
					type_has_infamy_suspicious = { type = ruler }
				}
				modifier = {
					monthly_bloodbrand_power = 0.10
				}
			}
			range_modifier = {
				trigger = {
					ruler_is_powerful_mage = yes
					type_has_infamy_denounced = { type = ruler }
				}
				modifier = {
					monthly_bloodbrand_power = 0.20
				}
			}
			range_modifier = {
				trigger = {
					ruler_is_powerful_mage = yes
					ruler_is_witch_king = yes
				}
				modifier = {
					monthly_bloodbrand_power = 0.50
				}
			}
			#Mage Loyalty
			range_modifier = {
				trigger = {
					NOT = {
						estate_loyalty = {
							estate = estate_mages
							loyalty = 40
						}
					}
					NOT = {
						estate_influence = {
							estate = estate_mages
							influence = 20
						}
					}
				}
				modifier = {
					monthly_bloodbrand_power = -0.05
				}
			}
			range_modifier = {
				trigger = {
					NOT = {
						estate_loyalty = {
							estate = estate_mages
							loyalty = 40
						}
					}
					NOT = {
						estate_influence = {
							estate = estate_mages
							influence = 40
						}
					}
					estate_influence = {
						estate = estate_mages
						influence = 20
					}
				}
				modifier = {
					monthly_bloodbrand_power = -0.10
				}
			}
			range_modifier = {
				trigger = {
					NOT = {
						estate_loyalty = {
							estate = estate_mages
							loyalty = 40
						}
					}
					NOT = {
						estate_influence = {
							estate = estate_mages
							influence = 60
						}
					}
					estate_influence = {
						estate = estate_mages
						influence = 40
					}
				}
				modifier = {
					monthly_bloodbrand_power = -0.20
				}
			}
			range_modifier = {
				trigger = {
					NOT = {
						estate_loyalty = {
							estate = estate_mages
							loyalty = 40
						}
					}
					estate_influence = {
						estate = estate_mages
						influence = 60
					}
				}
				modifier = {
					monthly_bloodbrand_power = -0.30
				}
			}
			range_modifier = {
				trigger = {
					estate_loyalty = {
						estate = estate_mages
						loyalty = 40
					}
					NOT = {
						estate_influence = {
							estate = estate_mages
							influence = 20
						}
					}
				}
				modifier = {
					monthly_bloodbrand_power = 0.10
				}
			}
			range_modifier = {
				trigger = {
					estate_loyalty = {
						estate = estate_mages
						loyalty = 40
					}
					NOT = {
						estate_influence = {
							estate = estate_mages
							influence = 40
						}
					}
					estate_influence = {
						estate = estate_mages
						influence = 20
					}
				}
				modifier = {
					monthly_bloodbrand_power = 0.20
				}
			}
			range_modifier = {
				trigger = {
					estate_loyalty = {
						estate = estate_mages
						loyalty = 40
					}
					NOT = {
						estate_influence = {
							estate = estate_mages
							influence = 60
						}
					}
					estate_influence = {
						estate = estate_mages
						influence = 40
					}
				}
				modifier = {
					monthly_bloodbrand_power = 0.50
				}
			}
			range_modifier = {
				trigger = {
					estate_loyalty = {
						estate = estate_mages
						loyalty = 40
					}
					estate_influence = {
						estate = estate_mages
						influence = 60
					}
				}
				modifier = {
					monthly_bloodbrand_power = 0.75
				}
			}
			#Mage Towers
			range_modifier = {
				trigger = {
					num_of_owned_provinces_with = {
						value = 1
						has_building = mage_tower
					}
				}
				modifier = {
					monthly_bloodbrand_power = 0.01
				}
			}
			range_modifier = {
				trigger = {
					num_of_owned_provinces_with = {
						value = 3
						has_building = mage_tower
					}
				}
				modifier = {
					monthly_bloodbrand_power = 0.02
				}
			}
			range_modifier = {
				trigger = {
					num_of_owned_provinces_with = {
						value = 5
						has_building = mage_tower
					}
				}
				modifier = {
					monthly_bloodbrand_power = 0.02
				}
			}
			range_modifier = {
				trigger = {
					num_of_owned_provinces_with = {
						value = 10
						has_building = mage_tower
					}
				}
				modifier = {
					monthly_bloodbrand_power = 0.05
				}
			}
			range_modifier = {
				trigger = {
					num_of_owned_provinces_with = {
						value = 20
						has_building = mage_tower
					}
				}
				modifier = {
					monthly_bloodbrand_power = 0.10
				}
			}
			range_modifier = {
				trigger = {
					num_of_owned_provinces_with = {
						value = 30
						has_building = mage_tower
					}
				}
				modifier = {
					monthly_bloodbrand_power = 0.10
				}
			}
			range_modifier = {
				trigger = {
					num_of_owned_provinces_with = {
						value = 40
						has_building = mage_tower
					}
				}
				modifier = {
					monthly_bloodbrand_power = 0.10
				}
			}
			range_modifier = {
				trigger = {
					num_of_owned_provinces_with = {
						value = 50
						has_building = mage_tower
					}
				}
				modifier = {
					monthly_bloodbrand_power = 0.10
				}
			}
			#Absolutism
			range_modifier = {
				trigger = {
					absolutism = 10
					NOT = { absolutism = 20 }
				}
				modifier = {
					monthly_bloodbrand_power = 0.10
				}
			}
			range_modifier = {
				trigger = {
					absolutism = 20
					NOT = { absolutism = 30 }
				}
				modifier = {
					monthly_bloodbrand_power = 0.20
				}
			}
			range_modifier = {
				trigger = {
					absolutism = 30
					NOT = { absolutism = 40 }
				}
				modifier = {
					monthly_bloodbrand_power = 0.30
				}
			}
			range_modifier = {
				trigger = {
					absolutism = 40
					NOT = { absolutism = 50 }
				}
				modifier = {
					monthly_bloodbrand_power = 0.40
				}
			}
			range_modifier = {
				trigger = {
					absolutism = 50
					NOT = { absolutism = 60 }
				}
				modifier = {
					monthly_bloodbrand_power = 0.50
				}
			}
			range_modifier = {
				trigger = {
					absolutism = 60
					NOT = { absolutism = 70 }
				}
				modifier = {
					monthly_bloodbrand_power = 0.60
				}
			}
			range_modifier = {
				trigger = {
					absolutism = 70
					NOT = { absolutism = 80 }
				}
				modifier = {
					monthly_bloodbrand_power = 0.70
				}
			}
			range_modifier = {
				trigger = {
					absolutism = 80
					NOT = { absolutism = 90 }
				}
				modifier = {
					monthly_bloodbrand_power = 0.80
				}
			}
			range_modifier = {
				trigger = {
					absolutism = 90
					NOT = { absolutism = 100 }
				}
				modifier = {
					monthly_bloodbrand_power = 0.90
				}
			}
			range_modifier = {
				trigger = {
					absolutism = 100
				}
				modifier = {
					monthly_bloodbrand_power = 1.00
				}
			}
			#BD
			range_modifier = {
				trigger = { tag = Z99 }
				modifier = {
					monthly_bloodbrand_power = 0.50
				}
			}
		}
	}


	interactions = {
		wyvernheart_brand_burnbloods = {
			icon = GFX_floodborn_council_brand_new_burnbloods
			gui = floodborn_council_button
			cost_type = bloodbrand_power
			cost = 30
			cooldown_years = 1
			trigger = {}
			effect = {
				random_hired_mercenary_company = { limit = { template = merc_wyvernheart_burnblood_company_1 } add_company_manpower = 0.25 }
				random_hired_mercenary_company = { limit = { template = merc_wyvernheart_burnblood_company_2_1 } add_company_manpower = 0.25 }
				random_hired_mercenary_company = { limit = { template = merc_wyvernheart_burnblood_company_2_2 } add_company_manpower = 0.25 }
				random_hired_mercenary_company = { limit = { template = merc_wyvernheart_burnblood_company_3_1 } add_company_manpower = 0.25 }
				random_hired_mercenary_company = { limit = { template = merc_wyvernheart_burnblood_company_3_2 } add_company_manpower = 0.25 }
				random_hired_mercenary_company = { limit = { template = merc_wyvernheart_burnblood_company_4_1 } add_company_manpower = 0.25 }
				random_hired_mercenary_company = { limit = { template = merc_wyvernheart_burnblood_company_4_2 } add_company_manpower = 0.25 }
				random_hired_mercenary_company = { limit = { template = merc_wyvernheart_burnblood_company_4_3 } add_company_manpower = 0.25 }
				random_hired_mercenary_company = { limit = { template = merc_wyvernheart_burnblood_company_5_1 } add_company_manpower = 0.25 }
				random_hired_mercenary_company = { limit = { template = merc_wyvernheart_burnblood_company_5_2 } add_company_manpower = 0.25 }
				random_hired_mercenary_company = { limit = { template = merc_wyvernheart_burnblood_company_5_3 } add_company_manpower = 0.25 }
				random_hired_mercenary_company = { limit = { template = merc_wyvernheart_burnblood_company_6_1 } add_company_manpower = 0.25 }
				random_hired_mercenary_company = { limit = { template = merc_wyvernheart_burnblood_company_6_2 } add_company_manpower = 0.25 }
				random_hired_mercenary_company = { limit = { template = merc_wyvernheart_burnblood_company_6_3 } add_company_manpower = 0.25 }
				random_hired_mercenary_company = { limit = { template = merc_wyvernheart_burnblood_company_6_4 } add_company_manpower = 0.25 }
				hidden_effect = {
					random_owned_province = {
						limit = { NOT = { is_core = ROOT } }
						province_event = { id = flavour_wyvernheart.114 }
					}
				}
				custom_tooltip = wyvernheart_brand_burnbloods_tt
				if = {
					limit = { ruler_has_infamy_witch_king = no }
					increase_witch_king_points_small = yes
				}
				else = {
					add_estate_loyalty = {
						estate = estate_mages
						loyalty = 5
					}
					take_estate_land_share_small = { estate = all } #1%
				}
			}
			ai_chance = {
				factor = 0
			}
		}

		wyvernheart_imbue_mage = {
			icon = GFX_floodborn_council_imbue_mage
			gui = floodborn_council_button
			cost_type = bloodbrand_power
			cost = 60
			cooldown_years = 1
			trigger = {}
			effect = {
				custom_tooltip = wyvernheart_imbue_mage_tt
				hidden_effect = {
					country_event = {
						id = flavour_wyvernheart.115
					}
				}
				tooltip = {
					if = {
						limit = { ruler_has_infamy_witch_king = yes }
						add_estate_loyalty = {
							estate = estate_mages
							loyalty = 10
						}
						take_estate_land_share_medium = { estate = all } #2%
					}
					else = { increase_ruler_witch_king_points = { size = medium } } #2 points
				}
			}
			ai_chance = {
				factor = 0.1
			}
		}

		wyvernheart_manifest_the_flood = {
			icon = GFX_floodborn_council_manifest_the_flood
			gui = floodborn_council_button
			cost_type = bloodbrand_power
			cost = 90
			cooldown_years = 0
			trigger = {
				OR = {
					heir_is_not_powerful_mage = yes
					ruler_is_powerful_mage = yes
				}
			}
			effect = {
				if = {
					limit = { has_heir = no has_government_attribute = heir }
					custom_tooltip = wyvernheart_manifest_the_flood_add_heir_tt
					define_heir = {
						dynasty = ROOT
						age = 1
						claim = 100
					}
					hidden_effect = { country_event = { id = magic_system.11 } }
				}
				else_if = {
					limit = { heir_is_not_powerful_mage = yes NOT = { has_government_attribute = always_mage } }
					custom_tooltip = wyvernheart_manifest_the_flood_add_mage_heir_tt
					hidden_effect = {
						country_event = { id = magic_system.11 }
						change_heir_adm = -1
						change_heir_dip = -1
						change_heir_mil = -1
					}
				}
				else_if = {
					limit = {
						NOT = {
							AND = { 
								is_ruler_conjuration_level_3 = yes
								is_ruler_divination_level_3 = yes
								is_ruler_enchantment_level_3 = yes
								is_ruler_evocation_level_3 = yes
								is_ruler_illusion_level_3 = yes
								is_ruler_necromancy_level_3 = yes
								is_ruler_transmutation_level_3 = yes
							}
						}
					}
					
					if = { limit = { has_ruler_flag = wyvernheart_conjuration is_ruler_conjuration_level_3 = no }
						magic_school_level_up = { type = ruler school = conjuration }
					}
					else_if = { limit = { has_ruler_flag = wyvernheart_divination is_ruler_divination_level_3 = no }
						magic_school_level_up = { type = ruler school = divination }
					}
					else_if = { limit = { has_ruler_flag = wyvernheart_enchantment is_ruler_enchantment_level_3 = no }
						magic_school_level_up = { type = ruler school = enchantment }
					}
					else_if = { limit = { has_ruler_flag = wyvernheart_evocation is_ruler_evocation_level_3 = no }
						magic_school_level_up = { type = ruler school = evocation }
					}
					else_if = { limit = { has_ruler_flag = wyvernheart_illusion is_ruler_illusion_level_3 = no }
						magic_school_level_up = { type = ruler school = illusion }
					}
					else_if = { limit = { has_ruler_flag = wyvernheart_necromancy is_ruler_necromancy_level_3 = no }
						magic_school_level_up = { type = ruler school = necromancy }
					}
					else_if = { limit = { has_ruler_flag = wyvernheart_transmutation is_ruler_transmutation_level_3 = no }
						magic_school_level_up = { type = ruler school = transmutation }
					}
					else = { country_event = { id = flavour_wyvernheart.501 } }
				}
				else = {
					random_list = {
						1 = {
							trigger = { NOT = { adm = 6 } }
							ROOT = { change_adm = 1 }
						}
						1 = {
							trigger = { NOT = { dip = 6 } }
							ROOT = { change_dip = 1 }
						}
						1 = {
							trigger = { NOT = { mil = 6 } }
							ROOT = { change_mil = 1 }
						}
					}
				}
				if = {
					limit = { ruler_has_infamy_witch_king = no }
					increase_witch_king_points_large = yes #4 points
				}
				else = {
					add_estate_loyalty = {
						estate = estate_mages
						loyalty = 15
					}
					take_estate_land_share_large = { estate = all } #3%
				}
			}
			ai_chance = {
				factor = 1
			}
		}
	}
}