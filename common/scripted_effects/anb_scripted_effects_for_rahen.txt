
######################
### Court Disaster ###
######################

rahen_calc_reform_ministry_of_agriculture = {
	if = {
		limit = { 4411 = { has_province_modifier = rahen_corrupt_ministery_of_agriculture } }
		
		set_variable = { which = reformMinistryAgricultureScore value = 0 }
		
		if = {
			limit = { NOT = { num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = { value = 1 OR = { has_province_modifier = rahen_neglected_infrastructure has_province_modifier = rahen_severely_neglected_infrastructure } } } }
			change_variable = { which = reformMinistryAgricultureScore value = 15 }
		}
		if = {
			limit = { estate_loyalty = { estate = estate_lowercastes loyalty = 60 } estate_influence = { estate = estate_lowercastes influence = 50 } }
			change_variable = { which = reformMinistryAgricultureScore value = 5 }
		}
		
		if = {
			limit = { monthly_adm = 9 }
			change_variable = { which = reformMinistryAgricultureScore value = 5 }
		}
		if = {
			limit = { monthly_adm = 10 }
			change_variable = { which = reformMinistryAgricultureScore value = 5 }
		}
		if = {
			limit = { monthly_adm = 11 }
			change_variable = { which = reformMinistryAgricultureScore value = 5 }
		}
		
		if = {
			limit = { num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = { value = 5 has_building = farm_estate } }
			change_variable = { which = reformMinistryAgricultureScore value = 10 }
		}
		if = {
			limit = { num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = { value = 10 has_terrain = farmlands development = 18 } }
			change_variable = { which = reformMinistryAgricultureScore value = 10 }
		}
		if = {
			limit = { monthly_income = 20 }
			change_variable = { which = reformMinistryAgricultureScore value = 5 }
		}
		if = {
			limit = { NOT = { num_of_loans = 1 } }
			change_variable = { which = reformMinistryAgricultureScore value = 5 }
		}
	}
}

rahen_calc_reform_ministry_of_philosophy = {
	if = {
		limit = { 4411 = { has_province_modifier = rahen_corrupt_ministery_of_philosophy } }
		
		set_variable = { which = reformMinistryPhilosophyScore value = 0 }
		
		if = {
			limit = { 4411 = { check_variable = { which = rahen_court_case_strength value = 30 } } }
			change_variable = { which = reformMinistryPhilosophyScore value = 5 }
		}
		if = {
			limit = { 4411 = { check_variable = { which = rahen_court_case_strength value = 50 } } }
			change_variable = { which = reformMinistryPhilosophyScore value = 5 }
		}
		if = {
			limit = { 4411 = { check_variable = { which = rahen_court_case_strength value = 70 } } }
			change_variable = { which = reformMinistryPhilosophyScore value = 5 }
		}
		
		if = {
			limit = { check_variable = { which = rahen_num_of_invited_scholars value = 3 } }
			change_variable = { which = reformMinistryPhilosophyScore value = 5 }
		}
		
		if = {
			limit = { NOT = { corruption = 1 } }
			change_variable = { which = reformMinistryPhilosophyScore value = 5 }
		}
		if = {
			limit = { NOT = { corruption = 5 } }
			change_variable = { which = reformMinistryPhilosophyScore value = 5 }
		}
		if = {
			limit = { NOT = { corruption = 10 } }
			change_variable = { which = reformMinistryPhilosophyScore value = 5 }
		}
		
		if = {
			limit = { num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = { value = 20 has_tax_building_trigger = yes } }
			change_variable = { which = reformMinistryPhilosophyScore value = 5 }
		}
		if = {
			limit = { NOT = { has_estate_privilege = estate_raj_ministries_ceremonial_ruler_act } }
			change_variable = { which = reformMinistryPhilosophyScore value = 10 }
		}
		if = {
			limit = { estate_loyalty = { estate = estate_uppercastes loyalty = 60 } estate_influence = { estate = estate_uppercastes influence = 50 } }
			change_variable = { which = reformMinistryPhilosophyScore value = 5 }
		}
		if = {
			limit = { NOT = { estate_territory = { estate = estate_raj_ministries territory = 20 } } }
			change_variable = { which = reformMinistryPhilosophyScore value = 10 }
		}
	}
}

rahen_calc_reform_ministry_of_internal_relations = {
	if = {
		limit = { 4411 = { has_province_modifier = rahen_corrupt_ministery_of_internal_relations } }
		
		set_variable = { which = reformMinistryInternalRelationsScore value = 0 }
		
		if = {
			limit = { all_subject_country = { is_at_war = no } }
			change_variable = { which = reformMinistryInternalRelationsScore value = 5 }
		}
		if = {
			limit = { num_of_estate_agendas_completed = { estate = estate_raj_ministries value = 5 } }
			change_variable = { which = reformMinistryInternalRelationsScore value = 10 }
		}
		
		if = {
			limit = { 4411 = { check_variable = { which = raj_var_cohesion value = 40 } } }
			change_variable = { which = reformMinistryInternalRelationsScore value = 5 }
		}
		if = {
			limit = { 4411 = { check_variable = { which = raj_var_cohesion value = 60 } } }
			change_variable = { which = reformMinistryInternalRelationsScore value = 5 }
		}
		if = {
			limit = { 4411 = { check_variable = { which = raj_var_cohesion value = 80 } } }
			change_variable = { which = reformMinistryInternalRelationsScore value = 5 }
		}
		
		if = {
			limit = { monthly_mil = 9 }
			change_variable = { which = reformMinistryInternalRelationsScore value = 5 }
		}
		if = {
			limit = { monthly_mil = 10 }
			change_variable = { which = reformMinistryInternalRelationsScore value = 5 }
		}
		if = {
			limit = { monthly_mil = 11 }
			change_variable = { which = reformMinistryInternalRelationsScore value = 5 }
		}
		
		if = {
			limit = { stability = 3 }
			change_variable = { which = reformMinistryInternalRelationsScore value = 5 }
		}
		if = {
			limit = { all_subject_country = { NOT = { num_of_rebel_armies = 1 num_of_rebel_controlled_provinces = 1 } } NOT = { num_of_rebel_armies = 1 num_of_rebel_controlled_provinces = 1 } }
			change_variable = { which = reformMinistryInternalRelationsScore value = 5 }
		}
		if = {
			limit = { all_subject_country = { NOT = { liberty_desire = 50 } } }
			change_variable = { which = reformMinistryInternalRelationsScore value = 5 }
		}
		if = {
			limit = { legitimacy = 100 }
			change_variable = { which = reformMinistryInternalRelationsScore value = 10 }
		}
	}
}

rahen_calc_reform_ministry_of_foreign_relations = {
	if = {
		limit = { 4411 = { has_province_modifier = rahen_corrupt_ministery_of_foreign_relations } }
		
		set_variable = { which = reformMinistryForeignRelationsScore value = 0 }
		
		if = {
			limit = { calc_true_if = { amount = 5 all_known_country = { NOT = { is_subject_of = ROOT  } has_opinion = { who = ROOT value = 150 } } } }
			change_variable = { which = reformMinistryForeignRelationsScore value = 5 }
		}
		if = {
			limit = { calc_true_if = { amount = 10 all_known_country = { NOT = { is_subject_of = ROOT  } has_opinion = { who = ROOT value = 150 } } } }
			change_variable = { which = reformMinistryForeignRelationsScore value = 5 }
		}
		if = {
			limit = { calc_true_if = { amount = 15 all_known_country = { NOT = { is_subject_of = ROOT  } has_opinion = { who = ROOT value = 150 } } } }
			change_variable = { which = reformMinistryForeignRelationsScore value = 5 }
		}
		
		if = {
			limit = { has_global_modifier_value = { which = diplomatic_reputation value = 3 } }
			change_variable = { which = reformMinistryForeignRelationsScore value = 10 }
		}
		
		if = {
			limit = { num_of_war_reparations = 3 }
			change_variable = { which = reformMinistryForeignRelationsScore value = 5 }
		}
		if = {
			limit = { num_of_war_reparations = 6 }
			change_variable = { which = reformMinistryForeignRelationsScore value = 5 }
		}
		if = {
			limit = { num_of_war_reparations = 9 }
			change_variable = { which = reformMinistryForeignRelationsScore value = 5 }
		}
		
		if = {
			limit = { monthly_dip = 9 }
			change_variable = { which = reformMinistryForeignRelationsScore value = 5 }
		}
		if = {
			limit = { monthly_dip = 10 }
			change_variable = { which = reformMinistryForeignRelationsScore value = 5 }
		}
		if = {
			limit = { monthly_dip = 11 }
			change_variable = { which = reformMinistryForeignRelationsScore value = 5 }
		}
		
		if = {
			limit = { prestige = 80 }
			change_variable = { which = reformMinistryForeignRelationsScore value = 5 }
		}
		
		if = {
			limit = { any_ally = { trust = { who = ROOT value = 70 } } }
			change_variable = { which = reformMinistryForeignRelationsScore value = 5 }
		}
		
		if = {
			limit = { calc_true_if = { amount = 1 all_known_country = { NOT = { is_subject_of = ROOT  } marriage_with = ROOT } } }
			change_variable = { which = reformMinistryForeignRelationsScore value = 5 }
		}
		
		if = {
			limit = { OR = { has_won_war_against = { who = R62 max_years_since = 20 } NOT = { exists = R62 } } }
			change_variable = { which = reformMinistryForeignRelationsScore value = 20 }
		}
	}
}

rahen_add_new_neglected_infrastructure = {
	random_subject_country = {
		limit = { any_owned_province = { NOT = { has_province_modifier = rahen_severely_neglected_infrastructure has_province_modifier = rahen_neglected_infrastructure } } }
		random_owned_province = {
			limit = { NOT = { has_province_modifier = rahen_severely_neglected_infrastructure has_province_modifier = rahen_neglected_infrastructure } }
			random_list = {
				1 = {
					add_permanent_province_modifier = {
						name = rahen_severely_neglected_infrastructure
						duration = -1
					}
					set_variable = { which = rahen_months_to_repair value = 6 }
				}
				7 = {
					add_permanent_province_modifier = {
						name = rahen_neglected_infrastructure
						duration = -1
					}
					set_variable = { which = rahen_months_to_repair value = 6 }
				}
			}
		}
	}
}

rahen_clear_court_disaster_province_modifiers = {
	remove_province_modifier = rahen_suspicious_ministry_estate
	remove_province_modifier = rahen_neglected_infrastructure
	remove_province_modifier = rahen_severely_neglected_infrastructure
}

rahen_ai_disaster_progress_effect = {
	if = {
		limit = { ai = yes }
		if = {
			limit = {
				NOT = {
					has_country_flag = rahen_disaster_progress_agriculture_ai
					has_country_flag = rahen_disaster_progress_philosophy_ai
					has_country_flag = rahen_disaster_progress_internal_relations_ai
					has_country_flag = rahen_disaster_progress_foreign_relations_ai
				}
			}
			random_list = {
				1 = {
					trigger = { 4411 = { has_province_modifier = rahen_corrupt_ministery_of_agriculture } }
					set_country_flag = rahen_disaster_progress_agriculture_ai
				}
				1 = {
					trigger = { 4411 = { has_province_modifier = rahen_corrupt_ministery_of_philosophy } }
					set_country_flag = rahen_disaster_progress_philosophy_ai
				}
				1 = {
					trigger = { 4411 = { has_province_modifier = rahen_corrupt_ministery_of_internal_relations } }
					set_country_flag = rahen_disaster_progress_internal_relations_ai
				}
				1 = {
					trigger = { 4411 = { has_province_modifier = rahen_corrupt_ministery_of_foreign_relations } }
					set_country_flag = rahen_disaster_progress_foreign_relations_ai
				}
			}
		}
		random_list = {
			1 = { }
			1 = {
				modifier = { factor = 0.8 NOT = { mil = 1 } }
				modifier = { factor = 0.8 NOT = { mil = 2 } }
				modifier = { factor = 0.8 NOT = { mil = 3 } }
				modifier = { factor = 1.2 mil = 4 }
				modifier = { factor = 1.2 mil = 5 }
				modifier = { factor = 1.2 mil = 6 }
				modifier = { factor = 0.8 NOT = { dip = 1 } }
				modifier = { factor = 0.8 NOT = { dip = 2 } }
				modifier = { factor = 0.8 NOT = { dip = 3 } }
				modifier = { factor = 1.2 dip = 4 }
				modifier = { factor = 1.2 dip = 5 }
				modifier = { factor = 1.2 dip = 6 }
				modifier = { factor = 0.8 NOT = { adm = 1 } }
				modifier = { factor = 0.8 NOT = { adm = 2 } }
				modifier = { factor = 0.8 NOT = { adm = 3 } }
				modifier = { factor = 1.2 adm = 4 }
				modifier = { factor = 1.2 adm = 5 }
				modifier = { factor = 1.2 adm = 6 }
				modifier = { factor = 2 has_country_modifier = great_conqueror_modifier }
				modifier = { factor = 2.5 has_country_modifier = mythical_conqueror_modifier }
				
				change_variable = {
					which = reformMinistryProgressAI
					value = 1
				}
			}
		}
	}
}

rahen_add_completed_reforms_flag = {
	if = {
		limit = {
			4411 = { 
				NOT = {
					has_province_modifier = rahen_corrupt_ministery_of_agriculture
					has_province_modifier = rahen_corrupt_ministery_of_philosophy
					has_province_modifier = rahen_corrupt_ministery_of_internal_relations
					has_province_modifier = rahen_corrupt_ministery_of_foreign_relations
				}
			}
		}
		set_country_flag = reformed_rahen_court
	}
}

clear_oracle_prophecy_flag = {
	clr_ruler_flag = prophecy_bad_outcome
	clr_ruler_flag = prophecy_grey_outcome
	clr_ruler_flag = prophecy_good_outcome
	clr_ruler_flag = prophecy_low_intensity
	clr_ruler_flag = prophecy_high_intensity
	clr_ruler_flag = oracle_prophecy_ongoing
}

######################
### Caste Fluidity ###
######################

caste_fluidity_increase_minute = {
	if = { limit = { NOT = { has_country_flag = has_caste_estates_reformed } } 
		custom_tooltip = caste_fluidity_increase_minute_tt
		hidden_effect = {
			change_variable = { which = casteFluidityVar value = 3 }
			if = { limit = { check_variable = { casteFluidityVar = 100 } }
				set_variable = { which = casteFluidityVar value = 100 }
			}
		}
	}
	else = {
		# no effect
		custom_tooltip = caste_fluidity_neutral_reformed_tt
	}
}

caste_fluidity_increase_small = {
	if = { limit = { NOT = { has_country_flag = has_caste_estates_reformed } } 
		custom_tooltip = caste_fluidity_increase_small_tt
		hidden_effect = {
			change_variable = { which = casteFluidityVar value = 5 }
			if = { limit = { check_variable = { casteFluidityVar = 100 } }
				set_variable = { which = casteFluidityVar value = 100 }
			}
		}
	}
	else = {
		# no effect
		custom_tooltip = caste_fluidity_neutral_reformed_tt
	}
}

caste_fluidity_increase_medium = {
	if = { limit = { NOT = { has_country_flag = has_caste_estates_reformed } } 
		custom_tooltip = caste_fluidity_increase_medium_tt
		hidden_effect = {
			change_variable = { which = casteFluidityVar value = 10 }
			if = { limit = { check_variable = { casteFluidityVar = 100 } }
				set_variable = { which = casteFluidityVar value = 100 }
			}
		}
	}
	else = {
		# no effect
		custom_tooltip = caste_fluidity_neutral_reformed_tt
	}
}

caste_fluidity_increase_large = {
	if = { limit = { NOT = { has_country_flag = has_caste_estates_reformed } } 
		custom_tooltip = caste_fluidity_increase_large_tt
		hidden_effect = {
			change_variable = { which = casteFluidityVar value = 15 }
			if = { limit = { check_variable = { casteFluidityVar = 100 } }
				set_variable = { which = casteFluidityVar value = 100 }
			}
		}
	}
	else = {
		# no effect
		custom_tooltip = caste_fluidity_neutral_reformed_tt
	}
}

caste_fluidity_increase_huge = {
	if = { limit = { NOT = { has_country_flag = has_caste_estates_reformed } } 
		custom_tooltip = caste_fluidity_increase_huge_tt
		hidden_effect = {
			change_variable = { which = casteFluidityVar value = 20 }
			if = { limit = { check_variable = { casteFluidityVar = 100 } }
				set_variable = { which = casteFluidityVar value = 100 }
			}
		}
	}
	else = {
		# no effect
		custom_tooltip = caste_fluidity_neutral_reformed_tt
	}
}

caste_fluidity_increase_gargantuan = {
	if = { limit = { NOT = { has_country_flag = has_caste_estates_reformed } } 
		custom_tooltip = caste_fluidity_increase_gargantuan_tt
		hidden_effect = {
			change_variable = { which = casteFluidityVar value = 25 }
			if = { limit = { check_variable = { casteFluidityVar = 100 } }
				set_variable = { which = casteFluidityVar value = 100 }
			}
		}
	}
	else = {
		# no effect
		custom_tooltip = caste_fluidity_neutral_reformed_tt
	}
}

caste_fluidity_decrease_minute = {
	if = { limit = { NOT = { has_country_flag = has_caste_estates_reformed } } 
		custom_tooltip = caste_fluidity_decrease_minute_tt
		hidden_effect = {
			subtract_variable = { which = casteFluidityVar value = 3 }
			if = { limit = { NOT = { check_variable = { casteFluidityVar = 0 } } }
				set_variable = { which = casteFluidityVar value = 0 }
			}
		}
	}
	else = {
		# no effect
		custom_tooltip = caste_fluidity_neutral_reformed_tt
	}
}

caste_fluidity_decrease_small = {
	if = { limit = { NOT = { has_country_flag = has_caste_estates_reformed } } 
		custom_tooltip = caste_fluidity_decrease_small_tt
		hidden_effect = {
			subtract_variable = { which = casteFluidityVar value = 5 }
			if = { limit = { NOT = { check_variable = { casteFluidityVar = 0 } } }
				set_variable = { which = casteFluidityVar value = 0 }
			}
		}
	}
	else = {
		# no effect
		custom_tooltip = caste_fluidity_neutral_reformed_tt
	}
}

caste_fluidity_decrease_medium = {
	if = { limit = { NOT = { has_country_flag = has_caste_estates_reformed } } 
		custom_tooltip = caste_fluidity_decrease_medium_tt
		hidden_effect = {
			subtract_variable = { which = casteFluidityVar value = 10 }
			if = { limit = { NOT = { check_variable = { casteFluidityVar = 0 } } }
				set_variable = { which = casteFluidityVar value = 0 }
			}
		}
	}
	else = {
		# no effect
		custom_tooltip = caste_fluidity_neutral_reformed_tt
	}
}

caste_fluidity_decrease_large = {
	if = { limit = { NOT = { has_country_flag = has_caste_estates_reformed } } 
		custom_tooltip = caste_fluidity_decrease_large_tt
		hidden_effect = {
			subtract_variable = { which = casteFluidityVar value = 15 }
			if = { limit = { NOT = { check_variable = { casteFluidityVar = 0 } } }
				set_variable = { which = casteFluidityVar value = 0 }
			}
		}
	}
	else = {
		# no effect
		custom_tooltip = caste_fluidity_neutral_reformed_tt
	}
}

caste_fluidity_decrease_huge = {
	if = { limit = { NOT = { has_country_flag = has_caste_estates_reformed } } 
		custom_tooltip = caste_fluidity_decrease_huge_tt
		hidden_effect = {
			subtract_variable = { which = casteFluidityVar value = 20 }
			if = { limit = { NOT = { check_variable = { casteFluidityVar = 0 } } }
				set_variable = { which = casteFluidityVar value = 0 }
			}
		}
	}
	else = {
		# no effect
		custom_tooltip = caste_fluidity_neutral_reformed_tt
	}
}

caste_fluidity_decrease_gargantuan = {
	if = { limit = { NOT = { has_country_flag = has_caste_estates_reformed } } 
		custom_tooltip = caste_fluidity_decrease_gargantuan_tt
		hidden_effect = {
			subtract_variable = { which = casteFluidityVar value = 25 }
			if = { limit = { NOT = { check_variable = { casteFluidityVar = 0 } } }
				set_variable = { which = casteFluidityVar value = 0 }
			}
		}
	}
	else = {
		# no effect
		custom_tooltip = caste_fluidity_neutral_reformed_tt
	}
}

######################
### Changing Caste ###
######################

check_if_caste_is_shared = {
	if = {
		limit = {
			calc_true_if = {
				amount = 2
				has_country_flag = centaur_in_$caste$castes
				has_country_flag = centaur_in_$caste$castes
				has_country_flag = dwarven_in_$caste$castes
				has_country_flag = elven_in_$caste$castes
				has_country_flag = gnoll_in_$caste$castes
				has_country_flag = gnomish_in_$caste$castes
				has_country_flag = goblin_in_$caste$castes
				has_country_flag = half_elven_in_$caste$castes
				has_country_flag = halfling_in_$caste$castes
				has_country_flag = half_orcish_in_$caste$castes
				has_country_flag = harimari_in_$caste$castes
				has_country_flag = harpy_in_$caste$castes
				has_country_flag = hobgoblin_in_$caste$castes
				has_country_flag = human_in_$caste$castes
				has_country_flag = kobold_in_$caste$castes
				has_country_flag = lizardfolk_in_$caste$castes
				has_country_flag = ogre_in_$caste$castes
				has_country_flag = orcish_in_$caste$castes
				has_country_flag = ruinborn_in_$caste$castes
				has_country_flag = troll_in_$caste$castes
			}
		}
		set_country_flag = $caste$castes_is_shared
	}
	else = {
		clr_country_flag = $caste$castes_is_shared
	}
}

add_race_to_caste = {
	custom_tooltip = add_$race$_to_$caste$castes_tt
	set_country_flag = $race$_in_$caste$castes
	if = {
		limit = { NOT = { has_country_flag = $caste$castes_is_shared } }
		check_if_caste_is_shared = { caste = $caste$ }
	}
}

remove_race_from_caste = {
	custom_tooltip = remove_$race$_from_$caste$castes_tt
	clr_country_flag = $race$_in_$caste$castes
	if = {
		limit = { has_country_flag = $caste$castes_is_shared }
		check_if_caste_is_shared = { caste = $caste$ }
	}
}

#------# Blood Lotus #------#
blood_lotus_hardline_stance_setup = {
	# 1-33 		==> hardline harimari
	# 34-66 	==> neutral
	# 67-100 	==> hardline human
	set_variable = { which = blHardlineVar value = 5 }
}

#HOW TO USE example: blood_lotus_hardline_stance_change = { humanhardline = 2 }
blood_lotus_hardline_stance_change = { 

    # Arguments (mandatory):
    #  - hardline direction = enum( harimarihardline / neutral / humanhardline )
	#  - an amount to move, must be 0-100
    #  - example "harimarihardline = 15"

	# small change: "harimarihardline = 3"
	# normal change: "harimarihardline = 5"
	# large change: "harimarihardline = 10"
    
    [[harimarihardline] 
        custom_tooltip = blHardlineVarHarimari_tt
        hidden_effect = { subtract_variable = { which = blHardlineVar value = $harimarihardline$ } }
    ]

    # neutral goes to 50. 
    [[neutral]
        custom_tooltip = blHardlineVarNeutral_tt
        hidden_effect = {
			if = { 
				# if above 50, "neutral" means subtract $neutral$ to bring back to middle. 
				limit = { check_variable = { blHardlineVar = 50 } }                              
				subtract_variable = { which = blHardlineVar value = $neutral$ } 
				if = {  # if we overshot the middle, correct back to middle. 
					limit = { NOT = { check_variable = { blHardlineVar = 50 } } } 
					set_variable = { which = blHardlineVar value = 50 }
				}
			}
			else = { 
				# if below 50, "neutral" means add $neutral$ to bring back to middle.                          
				change_variable = { which = blHardlineVar value = $neutral$ } 
				if = {  # if we overshot the middle, correct back to middle. 
					limit = { check_variable = { blHardlineVar = 50 } } 
					set_variable = { which = blHardlineVar value = 50 }
				}
			}
		}
    ]

    # human hardline always trends to 100
    [[humanhardline] 
        custom_tooltip = blHardlineVarHuman_tt
        hidden_effect = { change_variable = { which = blHardlineVar value = $humanhardline$ } }
    ]
}

#HOW TO USE example: blood_lotus_hardline_stance_change_small = { humanhardline = yes }
blood_lotus_hardline_stance_change_small = {
	# NOTE: normal steps are 4 for hardline directions 
	# This is was done to balance the flow of the disaster.

	[[harimarihardline] 
        custom_tooltip = blHardlineVarHarimariSmall_tt
        hidden_effect = { 
			random_list = {
				40 = { subtract_variable = { which = blHardlineVar value = 3 } }
				40 = { subtract_variable = { which = blHardlineVar value = 5 } }
				20 = { subtract_variable = { which = blHardlineVar value = 7 } }
			}
		}
    ]

    # neutral goes to 50. 
    [[neutral]
        custom_tooltip = blHardlineVarNeutralSmall_tt
        hidden_effect = {
			if = { 
				# if above 50, "neutral" means subtract $neutral$ to bring back to middle. 
				limit = { check_variable = { blHardlineVar = 50 } } 
				random_list = {
					40 = { subtract_variable = { which = blHardlineVar value = 3 } }
					40 = { subtract_variable = { which = blHardlineVar value = 5 } }
					20 = { subtract_variable = { which = blHardlineVar value = 7 } }
				}
				if = {  # if we overshot the middle, correct back to middle. 
					limit = { NOT = { check_variable = { blHardlineVar = 50 } } } 
					set_variable = { which = blHardlineVar value = 50 }
				}
			}
			else = { 
				# if below 50, "neutral" means add $neutral$ to bring back to middle.
				random_list = {
					40 = { change_variable = { which = blHardlineVar value = 3 } }
					40 = { change_variable = { which = blHardlineVar value = 5 } }
					20 = { change_variable = { which = blHardlineVar value = 7 } }
				}
				if = {  # if we overshot the middle, correct back to middle. 
					limit = { check_variable = { blHardlineVar = 50 } } 
					set_variable = { which = blHardlineVar value = 50 }
				}
			}
		}
    ]

    # human hardline always trends to 100
    [[humanhardline] 
        custom_tooltip = blHardlineVarHumanSmall_tt
        hidden_effect = { 
			random_list = {
				40 = { change_variable = { which = blHardlineVar value = 3 } }
				40 = { change_variable = { which = blHardlineVar value = 5 } }
				20 = { change_variable = { which = blHardlineVar value = 7 } }
			}
		}
    ]
}

#HOW TO USE example: blood_lotus_hardline_stance_change_medium = { humanhardline = yes }
blood_lotus_hardline_stance_change_medium = {
	[[harimarihardline] 
        custom_tooltip = blHardlineVarHarimariMedium_tt
        hidden_effect = { subtract_variable = { which = blHardlineVar value = 10 } }
    ]

    # neutral goes to 50. 
    [[neutral]
        custom_tooltip = blHardlineVarNeutralMedium_tt
        hidden_effect = {
			if = { 
				# if above 50, "neutral" means subtract $neutral$ to bring back to middle. 
				limit = { check_variable = { blHardlineVar = 50 } }                              
				subtract_variable = { which = blHardlineVar value = 10 } 
				if = {  # if we overshot the middle, correct back to middle. 
					limit = { NOT = { check_variable = { blHardlineVar = 50 } } } 
					set_variable = { which = blHardlineVar value = 50 }
				}
			}
			else = { 
				# if below 50, "neutral" means add $neutral$ to bring back to middle.                          
				change_variable = { which = blHardlineVar value = 10 } 
				if = {  # if we overshot the middle, correct back to middle. 
					limit = { check_variable = { blHardlineVar = 50 } } 
					set_variable = { which = blHardlineVar value = 50 }
				}
			}
		}
    ]

    # human hardline always trends to 100
    [[humanhardline] 
        custom_tooltip = blHardlineVarHumanMedium_tt
        hidden_effect = { change_variable = { which = blHardlineVar value = 10 } }
    ]
}

#HOW TO USE example: blood_lotus_hardline_stance_change_large = { humanhardline = yes }
blood_lotus_hardline_stance_change_large = {
	[[harimarihardline] 
        custom_tooltip = blHardlineVarHarimariLarge_tt
        hidden_effect = { subtract_variable = { which = blHardlineVar value = 15 } }
    ]

    # neutral goes to 50. 
    [[neutral]
        custom_tooltip = blHardlineVarNeutralLarge_tt
        hidden_effect = {
			if = { 
				# if above 50, "neutral" means subtract $neutral$ to bring back to middle. 
				limit = { check_variable = { blHardlineVar = 50 } }                              
				subtract_variable = { which = blHardlineVar value = 15 } 
				if = {  # if we overshot the middle, correct back to middle. 
					limit = { NOT = { check_variable = { blHardlineVar = 50 } } } 
					set_variable = { which = blHardlineVar value = 50 }
				}
			}
			else = { 
				# if below 50, "neutral" means add $neutral$ to bring back to middle.                          
				change_variable = { which = blHardlineVar value = 15 } 
				if = {  # if we overshot the middle, correct back to middle. 
					limit = { check_variable = { blHardlineVar = 50 } } 
					set_variable = { which = blHardlineVar value = 50 }
				}
			}
		}
    ]

    # human hardline always trends to 100
    [[humanhardline] 
        custom_tooltip = blHardlineVarHumanLarge_tt
        hidden_effect = { change_variable = { which = blHardlineVar value = 15 } }
    ]
}

blood_lotus_rebellion_spawns_headquarters = {
	hidden_effect = {
		random_owned_province = {
			limit = {
				OR = {
					culture_group = upper_raheni
					culture_group = middle_raheni
					culture_group = south_raheni
					has_human_minority_trigger = yes
				}
				NOT = {
					has_province_modifier = blood_lotus_guerrillas
					has_province_modifier = blood_lotus_guerrillas_hidden
					has_province_modifier = blood_lotus_sympathizers
				}
				superregion = rahen_superregion
				NOT = {
					calc_true_if = {
						region_for_scope_province = { has_province_modifier = blood_lotus_headquarter }
						amount = 2
					}
				}
			}
			add_province_modifier = {
				name = blood_lotus_headquarter
				duration = -1
			}
			spawn_rebels = {
				type = blood_lotus_rebel
				size = 2
				win = yes
			}
		}
	}
}

blood_lotus_rebellion_spawns_headquarters_on_guerrillas = {
	random_owned_province = {
		limit = {
			OR = {
				culture_group = upper_raheni
				culture_group = middle_raheni
				culture_group = south_raheni
				has_human_minority_trigger = yes
			}
			OR = {
				has_province_modifier = blood_lotus_guerrillas
				has_province_modifier = blood_lotus_guerrillas_hidden
			}
			superregion = rahen_superregion
			NOT = {
				# If there are more than 5 rebels there may be 2 HQ. 
				AND = {
					calc_true_if = {
						region_for_scope_province = { has_province_modifier = blood_lotus_headquarter }
						amount = 1
					}
					calc_true_if = {
						region_for_scope_province = { 
							OR = {
								has_province_modifier = blood_lotus_guerrillas 
								has_province_modifier = blood_lotus_guerrillas_hidden 
							}
						}
						amount = 5
					}
				}
				# If there are more than 5 rebels there may be 2 HQ. 
				calc_true_if = {
					region_for_scope_province = { has_province_modifier = blood_lotus_headquarter }
					amount = 2
				}
			}
		}
		add_province_modifier = {
			name = blood_lotus_headquarter
			duration = -1
		}
		spawn_rebels = {
			type = blood_lotus_rebel
			size = 2
			win = yes
		}
	}
}

blood_lotus_rebellion_spawns = {
	hidden_effect = {
		random_owned_province = {
			limit = {
				OR = {
					culture_group = upper_raheni
					culture_group = middle_raheni
					culture_group = south_raheni
					has_human_minority_trigger = yes
				}
				NOT = {
					has_province_modifier = blood_lotus_guerrillas
					has_province_modifier = blood_lotus_guerrillas_hidden
					has_province_modifier = blood_lotus_headquarter
				}
				superregion = rahen_superregion
			}
			add_province_modifier = {
				name = blood_lotus_guerrillas
				duration = -1
			}
		}
	}
}

blood_lotus_rebellion_spawns_hidden = {
	hidden_effect = {
		random_owned_province = {
			limit = {
				OR = {
					culture_group = upper_raheni
					culture_group = middle_raheni
					culture_group = south_raheni
					has_human_minority_trigger = yes
				}
				NOT = {
					has_province_modifier = blood_lotus_guerrillas
					has_province_modifier = blood_lotus_guerrillas_hidden
					has_province_modifier = blood_lotus_headquarter
				}
				superregion = rahen_superregion
				has_province_modifier = blood_lotus_sympathizers
			}
			add_province_modifier = {
				name = blood_lotus_guerrillas_hidden
				duration = -1
				hidden = yes
			}
		}
	}
}

blood_lotus_rebellion_spreads = {
	hidden_effect = {
		random_owned_province = {
			limit = {
				OR = {
					has_province_modifier = blood_lotus_guerrillas
					has_province_modifier = blood_lotus_headquarter
				}
				any_neighbor_province = { #To ensure that it can spread to a neighbouring province
					NOT = {
						has_province_modifier = blood_lotus_guerrillas
						has_province_modifier = blood_lotus_guerrillas_hidden
						has_province_modifier = blood_lotus_headquarter
					}
					superregion = rahen_superregion
					owned_by = ROOT
				}
				superregion = rahen_superregion
			}
			random_neighbor_province = {
				limit = {
					NOT = {
						has_province_modifier = blood_lotus_guerrillas
						has_province_modifier = blood_lotus_guerrillas_hidden
						has_province_modifier = blood_lotus_headquarter
					}
					superregion = rahen_superregion
					owned_by = ROOT
				}
				add_province_modifier = {
					name = blood_lotus_guerrillas
					duration = -1
				}
			}
		}
	}
}

blood_lotus_rebellion_spreads_hidden = {
	hidden_effect = {
		random_owned_province = {
			limit = {
				OR = {
					has_province_modifier = blood_lotus_guerrillas_hidden
					has_province_modifier = blood_lotus_guerrillas
					has_province_modifier = blood_lotus_headquarter
				}
				any_neighbor_province = { #To ensure that it can spread to a neighbouring province
					NOT = {
						has_province_modifier = blood_lotus_guerrillas
						has_province_modifier = blood_lotus_guerrillas_hidden
						has_province_modifier = blood_lotus_headquarter
					}
					superregion = rahen_superregion
					owned_by = ROOT
					has_province_modifier = blood_lotus_sympathizers
				}
				superregion = rahen_superregion
			}
			random_neighbor_province = {
				limit = {
					NOT = {
						has_province_modifier = blood_lotus_guerrillas
						has_province_modifier = blood_lotus_guerrillas_hidden
						has_province_modifier = blood_lotus_headquarter
					}
					superregion = rahen_superregion
					owned_by = ROOT
					has_province_modifier = blood_lotus_sympathizers
				}
				add_province_modifier = {
					name = blood_lotus_guerrillas_hidden
					duration = -1
					hidden = yes
				}
			}
		}
	}
}

blood_lotus_rebellion_moves = {
	hidden_effect = {
		random_owned_province = {
			limit = {
				has_province_modifier = blood_lotus_guerrillas
				any_neighbor_province = { #To ensure that it can spread to a neighbouring province
					NOT = {
						has_province_modifier = blood_lotus_guerrillas
						has_province_modifier = blood_lotus_guerrillas_hidden
						has_province_modifier = blood_lotus_headquarter
					}
					superregion = rahen_superregion
					owned_by = ROOT
				}
				superregion = rahen_superregion
			}
			random_neighbor_province = {
				limit = {
					NOT = {
						has_province_modifier = blood_lotus_guerrillas
						has_province_modifier = blood_lotus_guerrillas_hidden
						has_province_modifier = blood_lotus_headquarter
					}
					superregion = rahen_superregion
					owned_by = ROOT
				}
				add_province_modifier = {
					name = blood_lotus_guerrillas
					duration = -1
				}
				PREV = { remove_province_modifier = blood_lotus_guerrillas }
			}
		}
	}
}

blood_lotus_rebellion_moves_hidden = {
	hidden_effect = {
		random_owned_province = {
			limit = {
				OR = {
					has_province_modifier = blood_lotus_guerrillas
					has_province_modifier = blood_lotus_guerrillas_hidden
				}
				any_neighbor_province = { #To ensure that it can spread to a neighbouring province
					NOT = {
						has_province_modifier = blood_lotus_guerrillas
						has_province_modifier = blood_lotus_guerrillas_hidden
						has_province_modifier = blood_lotus_headquarter
					}
					superregion = rahen_superregion
					owned_by = ROOT
					has_province_modifier = blood_lotus_sympathizers
				}
				superregion = rahen_superregion
			}
			random_neighbor_province = {
				limit = {
					NOT = {
						has_province_modifier = blood_lotus_guerrillas
						has_province_modifier = blood_lotus_guerrillas_hidden
						has_province_modifier = blood_lotus_headquarter
					}
					superregion = rahen_superregion
					owned_by = ROOT
					has_province_modifier = blood_lotus_sympathizers
				}
				add_province_modifier = {
					name = blood_lotus_guerrillas_hidden
					duration = -1
					hidden = yes
				}
				PREV = { remove_province_modifier = blood_lotus_guerrillas }
				PREV = { remove_province_modifier = blood_lotus_guerrillas_hidden }
			}
		}
	}
}

blood_lotus_rebellion_hides = {
	hidden_effect = {
		random_owned_province = {
			limit = {
				has_province_modifier = blood_lotus_guerrillas
				any_neighbor_province = { #To ensure that it can spread to a neighbouring province
					NOT = {
						has_province_modifier = blood_lotus_guerrillas
						has_province_modifier = blood_lotus_guerrillas_hidden
						has_province_modifier = blood_lotus_headquarter
					}
					superregion = rahen_superregion
					owned_by = ROOT
					has_province_modifier = blood_lotus_sympathizers
				}
				
				superregion = rahen_superregion
			}
			random_neighbor_province = {
				limit = {
					NOT = {
						has_province_modifier = blood_lotus_guerrillas
						has_province_modifier = blood_lotus_guerrillas_hidden
						has_province_modifier = blood_lotus_headquarter
					}
					superregion = rahen_superregion
					owned_by = ROOT
					has_province_modifier = blood_lotus_sympathizers
				}
				add_province_modifier = {
					name = blood_lotus_guerrillas_hidden
					duration = -1
					hidden = yes
				}
				PREV = { remove_province_modifier = blood_lotus_guerrillas }
			}
		}
	}
}

blood_lotus_new_sympathizers = {
	hidden_effect = {
		random_owned_province = {
			limit = {
				superregion = rahen_superregion
				OR = {
					culture_group = upper_raheni
					culture_group = middle_raheni
					culture_group = south_raheni
					has_human_minority_trigger = yes
				}
				NOT = {
					has_province_modifier = blood_lotus_sympathizers
					has_province_modifier = blood_lotus_headquarter
					has_province_modifier = blood_lotus_dissuaded_sympathizers
				}
			}
			area = {
				limit = {
					OR = {
						culture_group = upper_raheni
						culture_group = middle_raheni
						culture_group = south_raheni
						has_human_minority_trigger = yes
					}
					NOT = {
						has_province_modifier = blood_lotus_sympathizers
						has_province_modifier = blood_lotus_headquarter
						has_province_modifier = blood_lotus_dissuaded_sympathizers
					}
					superregion = rahen_superregion
					owned_by = ROOT
				}
				add_province_modifier = {
					name = blood_lotus_sympathizers
					duration = -1
				}
			}
		}
	}
}

blood_lotus_sympathizers_spreads = {
	hidden_effect = {
		random_owned_province = {
			limit = {
				has_province_modifier = blood_lotus_sympathizers
				superregion = rahen_superregion
				any_neighbor_province = { #To ensure that it can spread to a neighbouring province
					OR = {
						culture_group = upper_raheni
						culture_group = middle_raheni
						culture_group = south_raheni
						has_human_minority_trigger = yes
					}
					NOT = {
						has_province_modifier = blood_lotus_sympathizers
						has_province_modifier = blood_lotus_headquarter
						has_province_modifier = blood_lotus_dissuaded_sympathizers
					}
				}
				superregion = rahen_superregion
			}
			random_neighbor_province = {
				limit = {
					OR = {
						culture_group = upper_raheni
						culture_group = middle_raheni
						culture_group = south_raheni
						has_human_minority_trigger = yes
					}
					NOT = {
						has_province_modifier = blood_lotus_sympathizers
						has_province_modifier = blood_lotus_headquarter
						has_province_modifier = blood_lotus_dissuaded_sympathizers
					}
					superregion = rahen_superregion
					owned_by = ROOT
				}
				area = {
					limit = {
						OR = {
							culture_group = upper_raheni
							culture_group = middle_raheni
							culture_group = south_raheni
							has_human_minority_trigger = yes
						}
						NOT = {
							has_province_modifier = blood_lotus_sympathizers
							has_province_modifier = blood_lotus_headquarter
							has_province_modifier = blood_lotus_dissuaded_sympathizers
						}
						superregion = rahen_superregion
						owned_by = ROOT
					}
					add_province_modifier = {
						name = blood_lotus_sympathizers
						duration = -1
					}
				}
			}
		}
	}
}

#------# The Command #------#

command_take_strongest_sir_revolt_effect = {
	custom_tooltip = R62_strongest_sir_revolt_tt
	hidden_effect = { R62 = { set_country_flag = take_strongest_sir_revolt } }
}
command_new_ruler_effect = {
	add_ruler_modifier = {
		name = command_rule_of_the_$command$
		duration = -1
	}
	
	if = {
		limit = {
			is_lesser_in_union = no
		}
		change_primary_culture = $command$_command
		set_ruler_culture = $command$_command
	}
	
	# if = {
		# limit = { mission_completed = R62_a_good_marshal }
		# #no unproven leadership
	# }
	# else = {
		# add_ruler_modifier = {
			# name = command_unproven_leadership
			# duration = 1825
		# }
	# }
	
	hidden_effect = {
		if = {
			limit = { mission_completed = R62_a_good_marshal }
			add_legitimacy = 100
			add_legitimacy = -25
		}
		else = {
			add_legitimacy = 100
			add_legitimacy = -50
		}
	}
}

command_set_new_campaign_effect = {
	#first clear all flags
	clr_country_flag = command_shamakhad_campaign_activated_flag
	clr_country_flag = command_dhujat_campaign_activated_flag
	clr_country_flag = command_ghavaanaj_campaign_activated_flag
	clr_country_flag = command_bhuvauri_campaign_activated_flag
	clr_country_flag = command_dhenbasana_campaign_activated_flag
	clr_country_flag = command_rakhadesh_campaign_activated_flag
	clr_country_flag = command_rahen_coast_campaign_activated_flag
	
	clr_country_flag = command_xiadao_campaign_activated_flag
	clr_country_flag = command_xianjie_campaign_activated_flag
	
	clr_country_flag = command_telebei_campaign_activated_flag
	clr_country_flag = command_hukai_campaign_activated_flag
	clr_country_flag = command_sikai_campaign_activated_flag
	clr_country_flag = command_baihon_xinh_campaign_activated_flag
	clr_country_flag = command_thidinkai_campaign_activated_flag
	clr_country_flag = command_lupulan_campaign_activated_flag
	clr_country_flag = command_arawkelin_campaign_activated_flag
	
	clr_country_flag = command_bianfang_campaign_activated_flag
	clr_country_flag = command_yanszin_campaign_activated_flag
	clr_country_flag = command_zyujyut_campaign_activated_flag
	clr_country_flag = command_tianlou_campaign_activated_flag
	clr_country_flag = command_jiantsiang_campaign_activated_flag
	
	clr_country_flag = command_tree_of_stone_campaign_activated_flag
	clr_country_flag = command_azjakuma_campaign_activated_flag

	clr_country_flag = command_current_campaign_completed_flag
	
	#set new flags
	set_country_flag = command_$campaign$_campaign_activated_flag
	set_country_flag = command_has_active_campaign_flag
	
	#swap missions
	swap_non_generic_missions = yes
}

command_complete_campaign_effect = {
	set_country_flag = command_$campaign$_campaign_completed_flag
	set_country_flag = command_current_campaign_completed_flag
	clr_country_flag = command_has_active_campaign_flag
	
	if = {
		limit = { has_country_modifier = command_exemplary_leadership }
		custom_tooltip = command_upgrade_to_respected_tt
		hidden_effect = {
			remove_country_modifier = command_exemplary_leadership
			add_ruler_modifier = {
				name = command_respected_leadership
				duration = -1
			}
		}
	}
	else_if = {
		limit = { has_country_modifier = command_respected_leadership }
		custom_tooltip = command_upgrade_to_legendary_tt
		hidden_effect = {
			remove_country_modifier = command_respected_leadership
			add_ruler_modifier = {
				name = command_legendary_leadership
				duration = -1
			}
		}
	}
	else_if = {
		limit = { NOT = { has_country_modifier = command_legendary_leadership } }
		add_ruler_modifier = {
			name = command_exemplary_leadership
			duration = -1
		}
	}
	else = {
		add_mil_power = 50
	}
	
	hidden_effect = {
		change_variable = {
			which = command_completed_campaigns
			value = 1
		}
		set_country_flag = auto_complete_estate_agenda_all
	}
	add_legitimacy_or_monarch_power = { VAL = 5 }

	custom_tooltip = command_complete_agenda_tt
}

#Forces Command to declare war instead of sitting on its a-- all game
command_force_progress_campaign_effect = {
	$province$ = {
		owner = {
			if = {
				limit = {
					R62 = {
						is_at_war = no
						is_subject = no
					}
					NOT = {
						truce_with = R62
						is_subject_of = R62
						alliance_with = R62
						army_strength = {
							who = R62
							value = 1
						}
						AND = {
							is_subject = yes
							overlord = {
								OR = {
									truce_with = R62
									alliance_with = R62
									army_strength = {
										who = R62
										value = 1
									}
								}
							}
						}
					}
					OR = {
						any_neighbor_country = {
							OR = {
								tag = R62
								is_subject_of = R62
							}
						}
						any_subject_country = {
							any_neighbor_country = {
								OR = {
									tag = R62
									is_subject_of = R62
								}
							}
						}
						overlord = {
							any_neighbor_country = {
								OR = {
									tag = R62
									is_subject_of = R62
								}
							}
						}
					}
				}
				R62 = {
					declare_war_with_cb = {
						who = PREV
						casus_belli = cb_great_campaign
						war_goal_province = $province$
					}
				}
			}
		}
	}
}
command_force_progress_campaign_multiple_effect = {
	trigger_switch = { #Forces Command to progress its campaigns
		on_trigger = has_country_flag
		command_shamakhad_campaign_activated_flag = { #YES THIS IS NECESSARY
			command_force_progress_campaign_effect = { province = 4509 }
			command_force_progress_campaign_effect = { province = 4510 }
			command_force_progress_campaign_effect = { province = 4465 }
			command_force_progress_campaign_effect = { province = 4460 }
			command_force_progress_campaign_effect = { province = 4397 }
		}
		command_xiadao_campaign_activated_flag = {
			command_force_progress_campaign_effect = { province = 4625 }
			command_force_progress_campaign_effect = { province = 4559 }
		}
		command_bianfang_campaign_activated_flag = {
			command_force_progress_campaign_effect = { province = 4826 }
			command_force_progress_campaign_effect = { province = 4842 }
			command_force_progress_campaign_effect = { province = 4846 }
			command_force_progress_campaign_effect = { province = 4951 }
		}
		command_ghavaanaj_campaign_activated_flag = {
			command_force_progress_campaign_effect = { province = 4485 }
			command_force_progress_campaign_effect = { province = 4506 }
			command_force_progress_campaign_effect = { province = 4466 }
			command_force_progress_campaign_effect = { province = 4488 }
			command_force_progress_campaign_effect = { province = 4469 }
			command_force_progress_campaign_effect = { province = 4472 }
			command_force_progress_campaign_effect = { province = 4482 }
		}
		command_dhujat_campaign_activated_flag = {
			command_force_progress_campaign_effect = { province = 4504 }
			command_force_progress_campaign_effect = { province = 4500 }
			command_force_progress_campaign_effect = { province = 4499 }
			command_force_progress_campaign_effect = { province = 4493 }
			command_force_progress_campaign_effect = { province = 4492 }
			command_force_progress_campaign_effect = { province = 4409 }
		}
		command_bhuvauri_campaign_activated_flag = {
			command_force_progress_campaign_effect = { province = 4561 }
			command_force_progress_campaign_effect = { province = 4420 }
			command_force_progress_campaign_effect = { province = 4395 }
			command_force_progress_campaign_effect = { province = 4558 }
		}
		command_dhenbasana_campaign_activated_flag = {
			command_force_progress_campaign_effect = { province = 4411 }
			command_force_progress_campaign_effect = { province = 4391 }
			command_force_progress_campaign_effect = { province = 4405 }
			command_force_progress_campaign_effect = { province = 4392 }
			command_force_progress_campaign_effect = { province = 4417 }
			command_force_progress_campaign_effect = { province = 4412 }
			command_force_progress_campaign_effect = { province = 4401 }
		}
		command_rakhadesh_campaign_activated_flag = {
			command_force_progress_campaign_effect = { province = 4450 }
			command_force_progress_campaign_effect = { province = 4435 }
			command_force_progress_campaign_effect = { province = 4438 }
			command_force_progress_campaign_effect = { province = 4446 }
		}
		command_rahen_coast_campaign_activated_flag = {
			command_force_progress_campaign_effect = { province = 4362 }
			command_force_progress_campaign_effect = { province = 4380 }
			command_force_progress_campaign_effect = { province = 4367 }
			command_force_progress_campaign_effect = { province = 4383 }
			command_force_progress_campaign_effect = { province = 4368 }
		}
		command_telebei_campaign_activated_flag = {
			command_force_progress_campaign_effect = { province = 4600 }
			command_force_progress_campaign_effect = { province = 4396 }
			command_force_progress_campaign_effect = { province = 4565 }
			command_force_progress_campaign_effect = { province = 4941 }
			command_force_progress_campaign_effect = { province = 4560 }
		}
		command_hukai_campaign_activated_flag = {
			command_force_progress_campaign_effect = { province = 4570 }
			command_force_progress_campaign_effect = { province = 4580 }
			command_force_progress_campaign_effect = { province = 4575 }
			command_force_progress_campaign_effect = { province = 4803 }
		}
		command_sikai_campaign_activated_flag = {
			command_force_progress_campaign_effect = { province = 4789 }
			command_force_progress_campaign_effect = { province = 4788 }
			command_force_progress_campaign_effect = { province = 4777 }
			command_force_progress_campaign_effect = { province = 5424 }
			command_force_progress_campaign_effect = { province = 4778 }
			command_force_progress_campaign_effect = { province = 4945 }
		}
		command_baihon_xinh_campaign_activated_flag = {
			command_force_progress_campaign_effect = { province = 4703 }
			command_force_progress_campaign_effect = { province = 4764 }
			command_force_progress_campaign_effect = { province = 5429 }
			command_force_progress_campaign_effect = { province = 4701 }
			command_force_progress_campaign_effect = { province = 4697 }
		}
		command_thidinkai_campaign_activated_flag = {
			command_force_progress_campaign_effect = { province = 4751 }
			command_force_progress_campaign_effect = { province = 6301 }
			command_force_progress_campaign_effect = { province = 4752 }
			command_force_progress_campaign_effect = { province = 4746 }
		}
		command_lupulan_campaign_activated_flag = {
			command_force_progress_campaign_effect = { province = 4740 }
			command_force_progress_campaign_effect = { province = 4960 }
			command_force_progress_campaign_effect = { province = 4770 }
			command_force_progress_campaign_effect = { province = 4710 }
			command_force_progress_campaign_effect = { province = 4962 }
			command_force_progress_campaign_effect = { province = 4709 }
			command_force_progress_campaign_effect = { province = 4765 }
			command_force_progress_campaign_effect = { province = 4957 }
			command_force_progress_campaign_effect = { province = 4964 }
			command_force_progress_campaign_effect = { province = 4730 }
		}
		command_arawkelin_campaign_activated_flag = {
			command_force_progress_campaign_effect = { province = 4963 }
			command_force_progress_campaign_effect = { province = 4716 }
		}
		command_yanszin_campaign_activated_flag = {
			command_force_progress_campaign_effect = { province = 4859 }
			command_force_progress_campaign_effect = { province = 4853 }
			command_force_progress_campaign_effect = { province = 4861 }
			command_force_progress_campaign_effect = { province = 4867 }
			command_force_progress_campaign_effect = { province = 4930 }
		}
		command_xianjie_campaign_activated_flag = {
			command_force_progress_campaign_effect = { province = 4559 }
			command_force_progress_campaign_effect = { province = 4614 }
			command_force_progress_campaign_effect = { province = 4783 }
			command_force_progress_campaign_effect = { province = 4936 }
			command_force_progress_campaign_effect = { province = 4811 }
			command_force_progress_campaign_effect = { province = 4808 }
		}
		command_zyujyut_campaign_activated_flag = {
			command_force_progress_campaign_effect = { province = 4839 }
			command_force_progress_campaign_effect = { province = 4884 }
			command_force_progress_campaign_effect = { province = 4879 }
			command_force_progress_campaign_effect = { province = 4893 }
			command_force_progress_campaign_effect = { province = 4949 }
		}
		command_tianlou_campaign_activated_flag = {
			command_force_progress_campaign_effect = { province = 4868 }
			command_force_progress_campaign_effect = { province = 4871 }
			command_force_progress_campaign_effect = { province = 4912 }
			command_force_progress_campaign_effect = { province = 4909 }
		}
		command_jiantsiang_campaign_activated_flag = {
			command_force_progress_campaign_effect = { province = 4914 }
			command_force_progress_campaign_effect = { province = 4919 }
			command_force_progress_campaign_effect = { province = 4925 }
			command_force_progress_campaign_effect = { province = 4923 }
		}
		command_tree_of_stone_campaign_activated_flag = {
			command_force_progress_campaign_effect = { province = 4266 }
			command_force_progress_campaign_effect = { province = 4284 }
			command_force_progress_campaign_effect = { province = 4265 }
			command_force_progress_campaign_effect = { province = 4247 }
			command_force_progress_campaign_effect = { province = 4242 }
			command_force_progress_campaign_effect = { province = 4272 }
		}
		command_azjakuma_campaign_activated_flag = {
			command_force_progress_campaign_effect = { province = 5430 }
			command_force_progress_campaign_effect = { province = 4831 }
			command_force_progress_campaign_effect = { province = 4829 }
			command_force_progress_campaign_effect = { province = 4828 }
		}
	}
}

command_new_command_effect = {
	if = {
		limit = {
			check_variable = {
				which = command_act_of_division_count
				value = 5
			}
		}
		command_new_command_sub_effect = { AMOUNT = -2 }
	}
	else_if = {
		limit = {
			check_variable = {
				which = command_act_of_division_count
				value = 4
			}
		}
		command_new_command_sub_effect = { AMOUNT = -2.5 }
	}
	else_if = {
		limit = {
			check_variable = {
				which = command_act_of_division_count
				value = 3
			}
		}
		command_new_command_sub_effect = { AMOUNT = -3.33 }
	}
	else_if = {
		limit = {
			check_variable = {
				which = command_act_of_division_count
				value = 2
			}
		}
		command_new_command_sub_effect = { AMOUNT = -5 }
	}
	else = {
		command_new_command_sub_effect = { AMOUNT = -10 }
	}
	
	if = {
		limit = {
			mission_completed = R62_the_dragon_command
			mission_completed = R62_the_elephant_command
			mission_completed = R62_the_tiger_command
		}
		clr_country_flag = command_act_of_division_unlocked_flag
	}
}

command_new_command_sub_effect = {
	if = {
		limit = {
			has_estate_privilege = estate_wolf_command_act_of_division
		}
		# add_estate_loyalty = {
			# estate = estate_wolf_command
			# loyalty = $AMOUNT$
		# }
		change_estate_land_share = {
			estate = estate_wolf_command
			share = $AMOUNT$
		}
        add_estate_influence_modifier = {
            estate = estate_wolf_command
			desc = EST_VAL_COMMAND_DIVIDED
			influence = $AMOUNT$
			duration = 3650
        }
		remove_estate_privilege = estate_wolf_command_act_of_division
	}
	if = {
		limit = {
			has_estate_privilege = estate_boar_command_act_of_division
		}
		# add_estate_loyalty = {
			# estate = estate_boar_command
			# loyalty = $AMOUNT$
		# }
		change_estate_land_share = {
			estate = estate_boar_command
			share = $AMOUNT$
		}
        add_estate_influence_modifier = {
            estate = estate_boar_command
			desc = EST_VAL_COMMAND_DIVIDED
			influence = $AMOUNT$
			duration = 3650
        }
		remove_estate_privilege = estate_boar_command_act_of_division
	}
	if = {
		limit = {
			has_estate_privilege = estate_lion_command_act_of_division
		}
		# add_estate_loyalty = {
			# estate = estate_lion_command
			# loyalty = $AMOUNT$
		# }
		change_estate_land_share = {
			estate = estate_lion_command
			share = $AMOUNT$
		}
        add_estate_influence_modifier = {
            estate = estate_lion_command
			desc = EST_VAL_COMMAND_DIVIDED
			influence = $AMOUNT$
			duration = 3650
        }
		remove_estate_privilege = estate_lion_command_act_of_division
	}
	if = {
		limit = {
			has_estate_privilege = estate_dragon_command_act_of_division
		}
		# add_estate_loyalty = {
			# estate = estate_dragon_command
			# loyalty = $AMOUNT$
		# }
		change_estate_land_share = {
			estate = estate_dragon_command
			share = $AMOUNT$
		}
        add_estate_influence_modifier = {
            estate = estate_dragon_command
			desc = EST_VAL_COMMAND_DIVIDED
			influence = $AMOUNT$
			duration = 3650
        }
		remove_estate_privilege = estate_dragon_command_act_of_division
	}
	if = {
		limit = {
			has_estate_privilege = estate_elephant_command_act_of_division
		}
		# add_estate_loyalty = {
			# estate = estate_elephant_command
			# loyalty = $AMOUNT$
		# }
		change_estate_land_share = {
			estate = estate_elephant_command
			share = $AMOUNT$
		}
        add_estate_influence_modifier = {
            estate = estate_elephant_command
			desc = EST_VAL_COMMAND_DIVIDED
			influence = $AMOUNT$
			duration = 3650
        }
		remove_estate_privilege = estate_elephant_command_act_of_division
	}
	if = {
		limit = {
			has_estate_privilege = estate_tiger_command_act_of_division
		}
		# add_estate_loyalty = {
			# estate = estate_tiger_command
			# loyalty = $AMOUNT$
		# }
		change_estate_land_share = {
			estate = estate_tiger_command
			share = $AMOUNT$
		}
        add_estate_influence_modifier = {
            estate = estate_tiger_command
			desc = EST_VAL_COMMAND_DIVIDED
			influence = $AMOUNT$
			duration = 3650
        }
		remove_estate_privilege = estate_tiger_command_act_of_division
	}
}

command_generate_move_target_canditates = {
	if = {
		limit = { ai = yes }
		random_owned_province = {
			limit = {
				continent = asia
				area_for_scope_province = {
					type = all
					NOT = { is_capital_of = R62 }
				}
				any_neighbor_province = {
					owner = {
						NOT = {
							tag = R62
							is_subject_of = R62
							alliance_with = R62
						}
					}
				}
				NOT = { is_core = R62 }
			}
			area = {
				limit = { owned_by = R62 }
				save_event_target_as = command_move_target_candidate_1
				set_province_flag = command_move_target_candidate_1
			}
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				continent = asia
				area_for_scope_province = {
					type = all
					owned_by = ROOT
					is_capital = no
				}
				area_for_scope_province = {
					NOT = { culture_group = hobgoblin }
				}
				any_neighbor_province = {
					owner = {
						NOT = {
							tag = R62
							is_subject_of = R62
							alliance_with = R62
						}
					}
				}
				NOT = { is_core = ROOT }
			}
		}
		random_owned_area = {
			limit = {
				continent = asia
				area_for_scope_province = {
					type = all
					owned_by = ROOT
					is_capital = no
				}
				area_for_scope_province = {
					NOT = { culture_group = hobgoblin }
				}
				any_neighbor_province = {
					owner = {
						NOT = {
							tag = R62
							is_subject_of = R62
							alliance_with = R62
						}
					}
				}
				NOT = { is_core = ROOT }
			}
			save_event_target_as = command_move_target_candidate_1
			set_province_flag = command_move_target_candidate_1
		}
	}
	else = {
		random_owned_area = {
			limit = {
				continent = asia
				area_for_scope_province = {
					type = all
					owned_by = ROOT
					is_capital = no
				}
				area_for_scope_province = {
					NOT = { culture_group = hobgoblin }
				}
				any_neighbor_province = {
					owner = {
						NOT = {
							tag = R62
							is_subject_of = R62
							alliance_with = R62
						}
					}
				}
			}
			save_event_target_as = command_move_target_candidate_1
			set_province_flag = command_move_target_candidate_1
		}
	}
	if = {
		limit = {
			any_owned_province = {
				continent = asia
				area_for_scope_province = {
					type = all
					owned_by = ROOT
					is_capital = no
				}
				area_for_scope_province = {
					NOT = { culture_group = hobgoblin }
				}
				NOT = {
					has_province_flag = command_move_target_candidate_1
				}
				any_neighbor_province = {
					owner = {
						NOT = {
							tag = R62
							is_subject_of = R62
							alliance_with = R62
						}
					}
				}
				NOT = { is_core = ROOT }
			}
		}
		random_owned_area = {
			limit = {
				continent = asia
				area_for_scope_province = {
					type = all
					owned_by = ROOT
					is_capital = no
				}
				area_for_scope_province = {
					NOT = { culture_group = hobgoblin }
				}
				NOT = {
					has_province_flag = command_move_target_candidate_1
				}
				any_neighbor_province = {
					owner = {
						NOT = {
							tag = R62
							is_subject_of = R62
							alliance_with = R62
						}
					}
				}
				NOT = { is_core = ROOT }
			}
			save_event_target_as = command_move_target_candidate_2
			set_province_flag = command_move_target_candidate_2
		}
	}
	else = {
		random_owned_area = {
			limit = {
				continent = asia
				area_for_scope_province = {
					type = all
					owned_by = ROOT
					is_capital = no
				}
				area_for_scope_province = {
					NOT = { culture_group = hobgoblin }
				}
				NOT = {
					has_province_flag = command_move_target_candidate_1
				}
				any_neighbor_province = {
					owner = {
						NOT = {
							tag = R62
							is_subject_of = R62
							alliance_with = R62
						}
					}
				}
			}
			save_event_target_as = command_move_target_candidate_2
			set_province_flag = command_move_target_candidate_2
		}
	}
	if = {
		limit = {
			any_owned_province = {
				continent = asia
				area_for_scope_province = {
					type = all
					owned_by = ROOT
					is_capital = no
				}
				area_for_scope_province = {
					NOT = { culture_group = hobgoblin }
				}
				NOT = {
					has_province_flag = command_move_target_candidate_1
					has_province_flag = command_move_target_candidate_2
				}
				any_neighbor_province = {
					owner = {
						NOT = {
							tag = R62
							is_subject_of = R62
							alliance_with = R62
						}
					}
				}
				NOT = { is_core = ROOT }
			}
		}
		random_owned_area = {
			limit = {
				continent = asia
				area_for_scope_province = {
					type = all
					owned_by = ROOT
					is_capital = no
				}
				area_for_scope_province = {
					NOT = { culture_group = hobgoblin }
				}
				NOT = {
					has_province_flag = command_move_target_candidate_1
					has_province_flag = command_move_target_candidate_2
				}
				any_neighbor_province = {
					owner = {
						NOT = {
							tag = R62
							is_subject_of = R62
							alliance_with = R62
						}
					}
				}
				NOT = { is_core = ROOT }
			}
			save_event_target_as = command_move_target_candidate_3
			set_province_flag = command_move_target_candidate_3
		}
	}
	else = {
		random_owned_area = {
			limit = {
				continent = asia
				area_for_scope_province = {
					type = all
					owned_by = ROOT
					is_capital = no
				}
				area_for_scope_province = {
					NOT = { culture_group = hobgoblin }
				}
				NOT = {
					has_province_flag = command_move_target_candidate_1
					has_province_flag = command_move_target_candidate_2
				}
				any_neighbor_province = {
					owner = {
						NOT = {
							tag = R62
							is_subject_of = R62
							alliance_with = R62
						}
					}
				}
			}
			save_event_target_as = command_move_target_candidate_3
			set_province_flag = command_move_target_candidate_3
		}
	}
}

command_move_orc_slave_state = { #tag = R63 OR R64   target = command_move_target_candidate_NUMBER
	if = {
		limit = { ai = no }
		custom_tooltip = command_moving_slave_states_costs_dip_tt
		hidden_effect = {
			export_to_variable = {
				which = moveTargetDevelopment
				value = total_development
				who = $tag$
			}
			while = {
				limit = {
					check_variable = {
						which = moveTargetDevelopment
						value = 1
					}
				}
				add_dip_power = -4
				subtract_variable = {
					which = moveTargetDevelopment
					value = 1
				}
			}
		}
	}
	
	if = {
		limit = { R63 = { tag = $tag$ } }
		add_country_modifier = {
			name = hobgoblin_thunderfist_enforcers
			duration = 3650
		}
	}
	if = {
		limit = { R64 = { tag = $tag$ } }
		add_country_modifier = {
			name = hobgoblin_bloodsong_advance_guard
			duration = 3650
		}
	}
	
	event_target:$target$ = {
		area = {
			limit = { owned_by = R62 }
			cede_province = $tag$
			if = {
				limit = { is_core = R62 }
				remove_core = R62
				add_core = $tag$
			}
		}
	}
	hidden_effect = {
		$tag$ = {
			every_owned_province = {
				limit = {
					NOT = { has_province_flag = $target$ }
				}
				if = {
					limit = { has_province_flag = command_converted_province_flag }
					add_base_manpower = -2
					change_culture = variable:previousCulture
					change_religion = variable:previousReligion
					if = {
						limit = { $tag$ = { primary_culture = wuhyun_half_orc } culture_is_human = yes }
						if = {
							limit = {
								continent = asia
								NOT = { culture_group = wuhyun }
							}
							export_to_variable = {
								which = original_wuhyun_culture
								value = culture
								who = THIS
							}
						}
						random_list = {
							1 = {
								if = {
									limit = { superregion = rahen_superregion }
									change_culture = azepyanunin
								}
								else_if = {
									limit = { superregion = yanshen_superregion }
									change_culture = ikaniwagain
								}
								else_if = {
									limit = { superregion = vimdatrong_superregion }
									change_culture = kintonan
								}
							}
							1 = {
								change_culture = wuhyun_half_orc
							}
						}
					}
					clr_province_flag = command_converted_province_flag
				}
				cede_province = R62
				if = {
					limit = { is_core = $tag$ }
					remove_core = $tag$
					add_core = R62
				}
			}
			random_owned_province = {
				hidden_effect = {
					export_to_variable = {
						variable_name = previousCulture
						value = culture
					}
					export_to_variable = {
						variable_name = previousReligion
						value = religion
					}
				}
				add_core = PREV
				change_culture = PREV
				change_religion = PREV
				add_base_manpower = 2
				$tag$ = {
					set_capital = PREV
				}
				
				set_province_flag = command_converted_province_flag
			}
			every_owned_province = {
				clr_province_flag = command_move_target_candidate_1
				clr_province_flag = command_move_target_candidate_2
				clr_province_flag = command_move_target_candidate_3
			}
			
			change_variable = {
				which = number_of_times_moved
				value = 1
			}
			
			if = {
				limit = { ai = yes }
				add_country_modifier = {
					name = command_slave_state_ai_accepted_culture_removal
					hidden = yes
					duration = 260
				}
			}
			add_country_modifier = {
				name = command_slave_state_adjusting_to_surroundings
				duration = 730
			}
		}
	}
	
	if = {
		limit = { has_country_flag = command_obedient_zanyu_kikunin_flag }
		$tag$ = {
			add_country_modifier = {
				name = hobgoblin_zanyu_kikun
				duration = 3650
			}
		}
	}
}

command_slave_state_cede_surrounding = {
	$tag$ = {
		every_neighbor_province = {
			limit = {
				owned_by = R62
				NOT = { is_core = R62 }
			}
			set_province_flag = command_$tag$_move_flag
		}
	}
	every_owned_province = {
		limit = { has_province_flag = command_$tag$_move_flag }
		clr_province_flag = command_$tag$_move_flag
		cede_province = $tag$
	}
	#NOTE: this is done like this because ceding the province directly in every_neighbor_province can cause a crash
	#perhaps because e.g. the list of border provinces is decreased in size by adding a new province to the tag
}

command_migration_randomization_effect = {
	random_list = {
		7 = {
			random_owned_province = {
				limit = { region = shamakhad_region NOT = { culture = wolf_command culture = boar_command } }
				save_event_target_as = command_destination_province
			}
		}
		2 = {
			random_owned_province = {
				limit = { OR = { area = khasardul_area area = pharata_area area = nadida_area } }
				save_event_target_as = command_destination_province
			}
		}
		1 = {
			4635 = { save_event_target_as = command_destination_province }
		}
	}
}

command_army_resupply = {
	if = {
		limit = {
			NOT = {
				any_hired_mercenary_company = {
					template = merc_command_$command$_army
				}
			}
		}
		custom_tooltip = command_army_not_hired_tt
	}
	if = {
		limit = { has_country_modifier = command_$command$_merc_ab1_cooldown }
		custom_tooltip = command_army_resupply_instructions_tt
		custom_tooltip = command_army_ability_is_on_cooldown_tt
	}
	else_if = {
		limit = {
			mil_power = 25
			manpower = 10
			any_hired_mercenary_company = {
				template = merc_command_$command$_army
				location = {
					has_province_modifier = command_$command$_warcamp
					controlled_by = ROOT
				}
			}
		}
		custom_tooltip = command_army_resupply_instructions_tt
		
		random_hired_mercenary_company = {
			limit = {
				template = merc_command_$command$_army
			}
			add_company_manpower = 1
		}
		add_manpower = -10
		clr_country_flag = command_armies_$command$_menu_open
	}
	else_if = {
		limit = {
			mil_power = 25
			manpower = 10
			any_hired_mercenary_company = {
				template = merc_command_$command$_army
				location = {
					has_supply_depot = ROOT
					controlled_by = ROOT
				}
			}
		}
		custom_tooltip = command_army_resupply_instructions_tt
		
		random_hired_mercenary_company = {
			limit = {
				template = merc_command_$command$_army
			}
			add_company_manpower = 0.5
		}
		add_manpower = -10
		add_mil_power = -10
		clr_country_flag = command_armies_$command$_menu_open
	}
	else = {
		custom_tooltip = command_army_resupply_instructions_tt
	}
}

command_army_settle_down = {
	if = {
		limit = {
			NOT = {
				any_hired_mercenary_company = {
					template = merc_command_$command$_army
				}
			}
		}
		custom_tooltip = command_army_not_hired_tt
	}
	if = {
		limit = { has_country_modifier = command_$command$_merc_ab2_cooldown }
		custom_tooltip = command_army_settle_down_instructions_tt
		custom_tooltip = command_army_ability_is_on_cooldown_tt
	}
	else_if = {
		limit = {
			any_hired_mercenary_company = {
				template = merc_command_$command$_army
				has_company_manpower = 0.5
				location = {
					owned_by = ROOT
					is_core = ROOT
					OR = {
						has_supply_depot = ROOT
						fort_level = 1
					}
				}
			}
		}
		custom_tooltip = command_army_settle_down_instructions_tt
		
		random_hired_mercenary_company = {
			limit = {
				template = merc_command_$command$_army
			}
			hidden_effect = {
				add_company_manpower = 1
				add_company_manpower = -0.5
			}
			location = {
				if = {
					limit = {
						has_large_hobgoblin_minority_trigger = yes
						NOT = { development = 12 }
					}
					change_culture = $command$_command
					change_religion = godlost
				}
				else = {
					add_hobgoblin_minority_size_effect = yes
				}
				add_base_manpower = 1
			}
			disband_mercenary_company = THIS
		}
		add_manpower = -1
		random_owned_province = {
			limit = { has_province_modifier = command_$command$_warcamp }
			add_base_manpower = -1
		}
		hidden_effect = {
			add_country_modifier = {
				name = command_$command$_merc_ab2_cooldown
				duration = 1825
				hidden = yes
			}
			clr_country_flag = command_armies_$command$_menu_open
			country_event = { id = the_command.310 }
		}
	}
	else = {
		custom_tooltip = command_army_settle_down_instructions_tt
	}
}

command_army_special_ability_wolf = {
	if = {
		limit = {
			NOT = {
				any_hired_mercenary_company = {
					template = merc_command_wolf_army
				}
			}
		}
		custom_tooltip = command_army_not_hired_tt
	}
	if = {
		limit = { has_country_modifier = command_wolf_merc_ab3_cooldown }
		custom_tooltip = command_wolf_army_ability_3_trigger_tt
		custom_tooltip = command_army_ability_is_on_cooldown_tt
	}
	else_if = {
		limit = {
			mil_power = 25
			any_hired_mercenary_company = {
				template = merc_command_wolf_army
				location = {
					owned_by = ROOT
					is_core = ROOT
				}
			}
		}
		custom_tooltip = command_wolf_army_ability_3_trigger_tt
		
		random_hired_mercenary_company = {
			limit = {
				template = merc_command_wolf_army
			}
			location = {
				area = {
					limit = { owned_by = ROOT }
					add_local_autonomy = -100
				}
			}
		}
		add_mil_power = -25
		hidden_effect = {
			add_country_modifier = {
				name = command_wolf_merc_ab3_cooldown
				duration = 1825
				hidden = yes
			}
			clr_country_flag = command_armies_wolf_menu_open
		}
	}
	else = {
		custom_tooltip = command_wolf_army_ability_3_trigger_tt
	}
}
command_army_special_ability_boar = {
	if = {
		limit = {
			NOT = {
				any_hired_mercenary_company = {
					template = merc_command_boar_army
				}
			}
		}
		custom_tooltip = command_army_not_hired_tt
	}
	if = {
		limit = { has_country_modifier = command_boar_merc_ab3_cooldown }
		custom_tooltip = command_boar_army_ability_3_trigger_tt
		custom_tooltip = command_army_ability_is_on_cooldown_tt
	}
	else_if = {
		limit = {
			mil_power = 25
			any_hired_mercenary_company = {
				template = merc_command_boar_army
				location = {
					OR = {
						unit_in_battle = yes
						unit_in_siege = yes
					}
				}
			}
		}
		custom_tooltip = command_boar_army_ability_3_trigger_tt
		
		add_country_modifier = {
			name = command_the_march_of_the_boar
			duration = 66
		}
		add_mil_power = -25
		hidden_effect = {
			add_country_modifier = {
				name = command_boar_merc_ab3_cooldown
				duration = 1825
				hidden = yes
			}
			clr_country_flag = command_armies_boar_menu_open
		}
	}
	else = {
		custom_tooltip = command_boar_army_ability_3_trigger_tt
	}
}
command_army_special_ability_lion = {
	if = {
		limit = {
			NOT = {
				any_hired_mercenary_company = {
					template = merc_command_lion_army
				}
			}
		}
		custom_tooltip = command_army_not_hired_tt
	}
	if = {
		limit = { has_country_modifier = command_lion_merc_ab3_cooldown }
		custom_tooltip = command_lion_army_ability_3_trigger_tt
		custom_tooltip = command_army_ability_is_on_cooldown_tt
	}
	else_if = {
		limit = {
			mil_power = 25
			any_hired_mercenary_company = {
				template = merc_command_lion_army
				location = {
					owned_by = ROOT
				}
			}
		}
		custom_tooltip = command_lion_army_ability_3_trigger_tt
		
		random_hired_mercenary_company = {
			limit = {
				template = merc_command_lion_army
			}
			location = {
				area = {
					limit = { owned_by = ROOT }
					add_province_modifier = {
						name = command_display_of_the_lion
						duration = 1825
					}
				}
			}
		}
		add_mil_power = -25
		hidden_effect = {
			add_country_modifier = {
				name = command_lion_merc_ab3_cooldown
				duration = 1825
				hidden = yes
			}
			clr_country_flag = command_armies_lion_menu_open
		}
	}
	else = {
		custom_tooltip = command_lion_army_ability_3_trigger_tt
	}
}
command_army_special_ability_dragon = {
	if = {
		limit = {
			NOT = {
				any_hired_mercenary_company = {
					template = merc_command_dragon_army
				}
			}
		}
		custom_tooltip = command_army_not_hired_tt
	}
	if = {
		limit = { has_country_modifier = command_dragon_merc_ab3_cooldown }
		custom_tooltip = command_dragon_army_ability_3_trigger_tt
		custom_tooltip = command_army_ability_is_on_cooldown_tt
	}
	else_if = {
		limit = {
			mil_power = 25
			any_hired_mercenary_company = {
				template = merc_command_dragon_army
				location = {
					has_siege = yes
				}
			}
		}
		custom_tooltip = command_dragon_army_ability_3_trigger_tt
		
		random_hired_mercenary_company = {
			limit = {
				template = merc_command_dragon_army
				location = {
					has_siege = yes
				}
			}
			location = {
				change_siege = 5
			}
		}
		add_mil_power = -25
		hidden_effect = {
			add_country_modifier = {
				name = command_dragon_merc_ab3_cooldown
				duration = 1825
				hidden = yes
			}
			clr_country_flag = command_armies_dragon_menu_open
		}
	}
	else = {
		custom_tooltip = command_dragon_army_ability_3_trigger_tt
	}
}
command_army_special_ability_elephant = {
	if = {
		limit = {
			NOT = {
				any_hired_mercenary_company = {
					template = merc_command_elephant_army
				}
			}
		}
		custom_tooltip = command_army_not_hired_tt
	}
	if = {
		limit = { has_country_modifier = command_elephant_merc_ab3_cooldown }
		custom_tooltip = command_elephant_army_ability_3_trigger_tt
		custom_tooltip = command_army_ability_is_on_cooldown_tt
	}
	else_if = {
		limit = {
			mil_power = 25
			any_hired_mercenary_company = {
				template = merc_command_elephant_army
				location = {
					owned_by = ROOT
					is_core = ROOT
				}
			}
		}
		custom_tooltip = command_elephant_army_ability_3_trigger_tt
		
		random_hired_mercenary_company = {
			limit = {
				template = merc_command_elephant_army
			}
			location = {
				area = {
					limit = { owned_by = ROOT }
					add_province_modifier = {
						name = command_hammers_of_the_elephant
						duration = 1825
					}
				}
			}
		}
		add_mil_power = -25
		hidden_effect = {
			add_country_modifier = {
				name = command_elephant_merc_ab3_cooldown
				duration = 1825
				hidden = yes
			}
			clr_country_flag = command_armies_elephant_menu_open
		}
	}
	else = {
		custom_tooltip = command_elephant_army_ability_3_trigger_tt
	}
}
command_army_special_ability_tiger = {
	if = {
		limit = {
			NOT = {
				any_hired_mercenary_company = {
					template = merc_command_tiger_army
				}
			}
		}
		custom_tooltip = command_army_not_hired_tt
	}
	if = {
		limit = { has_country_modifier = command_tiger_merc_ab3_cooldown }
		custom_tooltip = command_tiger_army_ability_3_trigger_tt
		custom_tooltip = command_army_ability_is_on_cooldown_tt
	}
	else_if = {
		limit = {
			mil_power = 25
			any_hired_mercenary_company = {
				template = merc_command_tiger_army
				location = {
					owned_by = ROOT
					is_core = ROOT
				}
			}
		}
		custom_tooltip = command_tiger_army_ability_3_trigger_tt
		
		random_hired_mercenary_company = {
			limit = {
				template = merc_command_tiger_army
			}
			location = {
				if = {
					limit = {
						OR = {
							religion = godlost
							religion = high_philosophy
						}
					}
					add_scaled_local_adm_power = 3
					add_scaled_local_dip_power = 3
					add_scaled_local_mil_power = 3
				}
				else = {
					add_scaled_local_adm_power = 2
					add_scaled_local_dip_power = 2
					add_scaled_local_mil_power = 2
				}
			}
		}
		add_mil_power = -25
		hidden_effect = {
			add_country_modifier = {
				name = command_tiger_merc_ab3_cooldown
				duration = 1825
				hidden = yes
			}
			clr_country_flag = command_armies_tiger_menu_open
		}
	}
	else = {
		custom_tooltip = command_tiger_army_ability_3_trigger_tt
	}
}

command_weaken_capital = {
	if = {
		limit = { capital_scope = { has_province_modifier = command_capital_stronghold_t1 } }
		capital_scope = {
			remove_province_modifier = command_capital_stronghold_t1
			add_province_modifier = {
				name = command_capital_stronghold_t2
				duration = -1
			}
		}
	}
	else_if = {
		limit = { capital_scope = { has_province_modifier = command_capital_stronghold_t2 } }
		capital_scope = {
			remove_province_modifier = command_capital_stronghold_t2
			add_province_modifier = {
				name = command_capital_stronghold_t3
				duration = -1
			}
		}
	}
	else_if = {
		limit = { capital_scope = { has_province_modifier = command_capital_stronghold_t3 } }
		capital_scope = {
			remove_province_modifier = command_capital_stronghold_t3
			add_province_modifier = {
				name = command_capital_stronghold_t4
				duration = -1
			}
		}
	}
}

command_strengthen_capital = {
	if = {
		limit = { capital_scope = { has_province_modifier = command_capital_stronghold_t4 } }
		capital_scope = {
			remove_province_modifier = command_capital_stronghold_t4
			add_province_modifier = {
				name = command_capital_stronghold_t3
				duration = -1
			}
		}
	}
	else_if = {
		limit = { capital_scope = { has_province_modifier = command_capital_stronghold_t3 } }
		capital_scope = {
			remove_province_modifier = command_capital_stronghold_t3
			add_province_modifier = {
				name = command_capital_stronghold_t2
				duration = -1
			}
		}
	}
	else_if = {
		limit = { capital_scope = { has_province_modifier = command_capital_stronghold_t2 } }
		capital_scope = {
			remove_province_modifier = command_capital_stronghold_t2
			add_province_modifier = {
				name = command_capital_stronghold_t1
				duration = -1
			}
		}
	}
}

estate_action_SPECIAL_COMMISSIONS_COMMAND = {
	if = {
		limit = { has_estate_privilege = estate_wolf_command_special_commissions }
		add_estate_loyalty = {
			estate = estate_wolf_command
			loyalty = 10
		}
	}
	if = {
		limit = { has_estate_privilege = estate_boar_command_special_commissions }
		add_estate_loyalty = {
			estate = estate_boar_command
			loyalty = 10
		}
	}
	if = {
		limit = { has_estate_privilege = estate_lion_command_special_commissions }
		add_estate_loyalty = {
			estate = estate_lion_command
			loyalty = 10
		}
	}
	if = {
		limit = { has_estate_privilege = estate_dragon_command_special_commissions }
		add_estate_loyalty = {
			estate = estate_dragon_command
			loyalty = 10
		}
	}
	if = {
		limit = { has_estate_privilege = estate_elephant_command_special_commissions }
		add_estate_loyalty = {
			estate = estate_elephant_command
			loyalty = 10
		}
	}
	if = {
		limit = { has_estate_privilege = estate_tiger_command_special_commissions }
		add_estate_loyalty = {
			estate = estate_tiger_command
			loyalty = 10
		}
	}
}

estate_action_RECRUIT_MINISTER_WOLF_COMMAND = {
    define_advisor = {
        culture = wolf_command
        religion = godlost
        type = quartermaster
        skill = 2
        discount = yes
    }
}

estate_action_GRANT_GENERALSHIP_LION_COMMAND = {
	create_general = { tradition = 60 }
}

estate_action_REASSESS_TEACHINGS_TIGER_COMMAND = {
	country_event = { #event to change teachings
		id = the_command.301
	}
}

estate_action_INVITE_WUHYUN_TIGER_COMMAND = {
	country_event = { # event to invite hp dudes
		id = the_command.302
	}
}

command_recruit_second_general_effect = {
	if = {
		limit = {
			army_tradition = 80
		}
		create_general = {
			tradition = 100
			culture = tiger_command #any lesser Command will do, they all contain each other
		}
	}
	else_if = {
		limit = {
			army_tradition = 70
		}
		create_general = {
			tradition = 90
			culture = tiger_command
		}
	}
	else_if = {
		limit = {
			army_tradition = 60
		}
		create_general = {
			tradition = 80
			culture = tiger_command
		}
	}
	else_if = {
		limit = {
			army_tradition = 50
		}
		create_general = {
			tradition = 70
			culture = tiger_command
		}
	}
	else = {
		create_general = {
			tradition = 60
			culture = tiger_command
		}
	}
}

command_siege_won_effect = {
	if = {
		limit = { #Calm Down Sir
			R62 = {
				has_country_flag = command_sir_revolt_started
				all_war_enemy_countries = {
					OR = {
						NOT = { is_in_war = { casus_belli = cb_revolt_of_the_north } }
						is_subject = yes
						capital_scope = { controller = { is_in_war = { casus_belli = cb_revolt_of_the_north defenders = THIS } } }
					}
				}
			}
		}
		R62 = { country_event = { id = the_command.126 } }
	}
	if = {
		limit = { R62 = { has_country_flag = insubordination_active_flag } }
		if = {
			limit = { R62 = { NOT = { has_country_flag = R62_tiger_subdued } } R67 = { capital_scope = { controller = { is_in_war = { participants = R62 } NOT = { defensive_war_with = R62 offensive_war_with = R62 } } } } }
			R62 = { country_event = { id = the_command.1994 } }
		}
		if = {
			limit = { R62 = { NOT = { has_country_flag = R62_elephant_subdued } } R68 = { capital_scope = { controller = { is_in_war = { participants = R62 } NOT = { defensive_war_with = R62 offensive_war_with = R62 } } } } }
			R62 = { country_event = { id = the_command.1995 } }
		}
		if = {
			limit = { R62 = { NOT = { has_country_flag = R62_dragon_subdued } } R69 = { capital_scope = { controller = { is_in_war = { participants = R62 } NOT = { defensive_war_with = R62 offensive_war_with = R62 } } } } }
			R62 = { country_event = { id = the_command.1996 } }
		}
	}
	if = {
		limit = {
			R62 ={
				OR = {
					has_country_flag = insubordination_active_flag
					has_country_flag = insubordination_complete
				}
				is_in_war = {
					attacker_leader = Y01
					casus_belli = cb_insubordination
				}
			}
			4831 = { OR = { controller = { is_in_war = { participants = R62 } NOT = { defensive_war_with = R62 offensive_war_with = R62 } } owner = { NOT = { tag = Y01 } } } }
			5430 = { OR = { controller = { is_in_war = { participants = R62 } NOT = { defensive_war_with = R62 offensive_war_with = R62 } } owner = { NOT = { tag = Y01 } } } }
			4829 = { OR = { controller = { is_in_war = { participants = R62 } NOT = { defensive_war_with = R62 offensive_war_with = R62 } } owner = { NOT = { tag = Y01 } } } }
			4828 = { OR = { controller = { is_in_war = { participants = R62 } NOT = { defensive_war_with = R62 offensive_war_with = R62 } } owner = { NOT = { tag = Y01 } } } }
		}
		R62 = { country_event = { id = the_command.1983 } }
	}
	if = {
		limit = { #Command artillery mission req
			R62 = { NOT = { mission_completed = R62_the_evolution_of_warfare } }
			FROM = {
				is_capital = yes
				artillery_in_province = R62
			}
		}
		R62 = { set_country_flag = R62_the_evolution_of_warfare_flag }
	}
	if = {
		limit = { #Command is winning a war against a great power
			mission_completed = R62_one_great_command
			FROM = {
				owner = {
					is_great_power = yes
					ROOT = { NOT = { has_country_flag = command_leadership_flag_@PREV } }
				}
			}
			FROM = {
				owner = {
					ROOT = {
						is_in_war = {
							attacker_leader = ROOT
							defender_leader = PREV
							war_score = 80
						}
					}
				}
			}
		}
		FROM = {
			owner = {
				ROOT = {
					set_country_flag = command_leadership_flag_@PREV
				}
			}
		}
	}
	if = {
		limit = { FROM = { owned_by = V98 province_group = temple_province_group } }
		R62 = { country_event = { id = the_command.83 } }
	}
}
command_spawn_troops_for_shamans_effect = {
	capital_scope = {
		spawn_units_for = { amount = 16 type = infantry who = V98 }
		spawn_units_for = { amount = 4 type = cavalry who = V98 }
		if = {
			limit = { ROOT = { mil_tech = 13 } }
			spawn_units_for = { amount = 8 type = artillery who = V98 }
		}
	}
	export_to_variable = {
		which = troop_amount
		value = trigger_value:total_own_and_non_tributary_subject_development
		who = R62
	}
	if = {
		limit = { V98 = { has_cast_undead_army = yes } }
		divide_variable = {
			which = troop_amount
			value = 400
		}
	}
	else = {
		divide_variable = {
			which = troop_amount
			value = 800
		}
	}
	if = {
		limit = {
			check_variable = {
				which = troop_amount
				value = 1
			}
		}
		for_variable_amount = {
			variable = troop_amount
			effect = "
				random_owned_province = {
					spawn_units_for = { amount = 16 type = infantry who = V98 }
					spawn_units_for = { amount = 4 type = cavalry who = V98 }
					if = {
						limit = { ROOT = { mil_tech = 13 } }
						spawn_units_for = { amount = 8 type = artillery who = V98 }
					}
				}
			"
		}
	}
	set_variable = { which = troop_amount value = 0 }
}
temple_area_joins_shaman_revolt = {
	if = {
		limit = { owned_by = R63 }
		R62 = {
			random_owned_area = {
				limit = {
					area_for_scope_province = {
						type = all
						owned_by = R62
						is_capital = no
						NOT = { province_group = temple_province_group }
					}
				}
				save_event_target_as = command_move_target_candidate_1
				set_province_flag = command_move_target_candidate_1
			}
		}
		command_move_orc_slave_state = {
			tag = R63
			target = command_move_target_candidate_1
		}
	}
	if = {
		limit = { owned_by = R64 }
		R62 = {
			random_owned_area = {
				limit = {
					area_for_scope_province = {
						type = all
						owned_by = R62
						is_capital = no
						NOT = { province_group = temple_province_group }
					}
				}
				save_event_target_as = command_move_target_candidate_1
				set_province_flag = command_move_target_candidate_1
			}
		}
		command_move_orc_slave_state = {
			tag = R64
			target = command_move_target_candidate_1
		}
	}
	area = {
		limit = { owner = { OR = { tag = R62 is_subject_of = R62 ai = yes } } }
		if = {
			limit = { is_capital_of = R62 }
			set_province_flag = command_previous_capital
		}
		cede_province = V98
		add_core = V98
	}
	add_latest_building = { fort = yes builder = V98 }
	add_province_modifier = { name = mage_rebel_temple_mod duration = -1 }
	add_province_modifier = { name = command_temporary_garrison_growth duration = 31 }
	set_province_flag = command_has_had_shaman_uprising_flag
	spawn_units_for = {
		amount = 16
		type = infantry
		who = V98
	}
	spawn_units_for = {
		amount = 4
		type = cavalry
		who = V98
	}
	if = {
		limit = { R62 = { mil_tech = 13 } }
		spawn_units_for = {
			amount = 8
			type = artillery
			who = V98
		}
	}
}

command_siege_lost_effect = {
	if = {
		limit = {
			has_country_flag = command_sir_revolt_started
			4630 = { NOT = { controlled_by = R62 } }
			4538 = { NOT = { controlled_by = R62 } }
			4311 = { NOT = { controlled_by = R62 } }
		}
		country_event = { id = the_command.123 }
	}
	if = {
		limit = {
			has_country_flag = insubordination_active_flag
			OR = {
				AND = {
					event_target:tiger_command_capital = {
						has_province_flag = command_encircled_flag
						any_neighbor_province = { province_id = FROM }
					}
					NOT = { has_country_flag = R62_tiger_subdued }
				}
				AND = {
					event_target:elephant_command_capital = {
						has_province_flag = command_encircled_flag
						any_neighbor_province = { province_id = FROM }
					}
					NOT = { has_country_flag = R62_elephant_subdued }
				}
				AND = {
					event_target:dragon_command_capital = {
						has_province_flag = command_encircled_flag
						any_neighbor_province = { province_id = FROM }
					}
					NOT = { has_country_flag = R62_dragon_subdued }
				}
			}
		}
		country_event = { id = the_command.2001 }
	}
	if = {
		limit = { has_country_flag = insubordination_active_flag }
		if = {
			limit = { FROM = { province_id = 4633 } }
			country_event = { id = the_command.2003 } #Fall of Sir
		}
		if = {
			limit = { FROM = { province_id = 4630 } }
			country_event = { id = the_command.2004 } #Fall of Sarilavhan
		}
	}
	if = {
		limit = {
			FROM = {
				has_province_modifier = command_chain_workshop
				owned_by = R62
				NOT = { has_province_modifier = command_broken_chains }
			}
		}
		FROM = { province_event = { id = the_command.158 } }
	}
	if = {
		limit = {
			FROM = {
				has_province_modifier = command_rpu_hq
				owned_by = R62
				NOT = { has_province_modifier = command_broken_chains }
			}
		}
		FROM = { province_event = { id = the_command.159 } }
	}
}
command_dewuhyunization_effect = {
	if = {
		limit = {
			OR = {
				check_variable = {
					which = original_wuhyun_culture
					value = 1
				}
				check_variable = {
					which = original_wuhyun_religion
					value = 1
				}
			}
			owner = {
				NOT = {
					culture_group = hobgoblin
					culture_is_wuhyun = yes
					is_subject_of = R62
					tag = V98 #Shaman-Home
				}
			}
		}
		
		if = {
			limit = { owner = { NOT = { has_country_flag = decided_wuhyunization_policy } } }
			owner = { country_event = { id = the_command.5 } }
		}
		else_if = {
			limit = { owner = { has_country_flag = reverse_wuhyunization } }
			command_dewuhyunization_subeffect = yes
		}
	}
}
command_dewuhyunization_subeffect = {
	if = {
		limit = {
			owner = {
				NOT = {
					tag = Y86 #Azkare
					tag = Y00 #Sunrise Empire
				}
			}
		}
		remove_random_development = yes
	}

	if = {
		limit = {
			check_variable = {
				which = original_wuhyun_religion
				value = 1
			} #uninitialised = 0 = no religion	
		}
		change_religion = variable:original_wuhyun_religion
		set_variable = { which = original_wuhyun_religion value = 0 }
	} # only do this if religion changed - doing it blindly = no religion

	if = {
		limit = {
			check_variable = {
				which = original_wuhyun_culture
				value = 1
			} #uninitialised = 0 = no culture
		}
		change_culture = variable:original_wuhyun_culture
		set_variable = { which = original_wuhyun_culture value = 0 }
	} # only do this if culture changed
}

#############################
### SUHAN GOES SICKO MODE ###
#############################
end_suhans_reformation = {
	custom_tooltip = suhan_reformation_end_tt
	hidden_effect = {
		every_province = {
			limit = {
				is_reformation_center = yes
				religion = suhans_praxis
			}
			remove_reform_center = suhans_praxis
		}
		clr_global_flag = suhan_1
		clr_global_flag = suhan_2
		clr_global_flag = suhan_3
		clr_global_flag = suhan_4
		clr_global_flag = suhan_goes_sicko_mode
		#clr_global_flag = suhan_secondary_sicko_mode
		clear_global_event_target = suhan_center
		set_global_flag = suhan_reformation_over
	}
}

###############
### Raj 3.0 ###
###############
rahen_raj_calc_cohesion = {	# Note: Use only inside Raja country scope!
	4411 = {

		# Cohesion - Initialize/Reset Variables
		set_variable = 			{ which = raj_var_cohesion value = 0 } # Total cohesion value
		set_variable = 			{ which = raj_var_cohesion_impact_num_senaptia value = 0 } # Senaptia impact on cohesion
		set_variable = 			{ which = raj_var_vizier_ld value = 0 } # Vizier liberty desire
		set_variable = 			{ which = raj_var_vizier_influence value = 0 } # Vizier influence
		set_variable = 			{ which = raj_var_subject_weighed_ld value = 0 } # Weighted average of subject liberty desire
		set_variable = 			{ which = raj_var_subject_development_total value = 0 } # Total subject development
		set_variable = 			{ which = raj_overall_cohesion_change_bonus value = 0 } # Temporary modifiers to cohesion
		set_variable = 			{ which = raj_var_cohesion_bonus_raja value = 0 } # Temporary modifiers to cohesion at raja scope
		
		# Cohesion - Legitimacy
		export_to_variable = 	{ variable_name = raj_var_cohesion_impact_legitimacy value = trigger_value:legitimacy who = PREV }
		change_variable = 		{ which = raj_var_cohesion_impact_legitimacy value = -50 }
		divide_variable = 		{ which = raj_var_cohesion_impact_legitimacy value = 3.5 }
		change_variable = 		{ which = raj_var_cohesion which = raj_var_cohesion_impact_legitimacy }
		round_variable = 		{ which = raj_var_cohesion_impact_legitimacy value = 0 }

		# Cohesion - Prestige
		export_to_variable = 	{ variable_name = raj_var_cohesion_impact_prestige value = trigger_value:prestige who = PREV }
		divide_variable = 		{ which = raj_var_cohesion_impact_prestige value = 10 }
		change_variable = 		{ which = raj_var_cohesion which = raj_var_cohesion_impact_prestige }
		round_variable = 		{ which = raj_var_cohesion_impact_prestige value = 0 }

		# Cohesion - War Exhaustion
		export_to_variable = 	{ variable_name = raj_var_cohesion_impact_war_exhaustion value = trigger_value:war_exhaustion who = PREV }
		multiply_variable = 	{ which = raj_var_cohesion_impact_war_exhaustion value = 1.8 }
		subtract_variable = 	{ which = raj_var_cohesion which = raj_var_cohesion_impact_war_exhaustion }
		round_variable = 		{ which = raj_var_cohesion_impact_war_exhaustion value = 0 }

		# Cohesion - Stability
		export_to_variable = 	{ variable_name = raj_var_cohesion_impact_stability value = trigger_value:stability who = PREV }
		if = { limit = { PREV = { NOT = { stability = 0 } } }
			subtract_variable = { which = raj_var_cohesion_impact_stability value = 1 } # Compensating for trigger value being +1 than expected at negative stab
		}
		multiply_variable = 	{ which = raj_var_cohesion_impact_stability value = 4 }
		change_variable = 		{ which = raj_var_cohesion which = raj_var_cohesion_impact_stability }

		# Cohesion - Power Projection
		export_to_variable = 	{ variable_name = raj_var_cohesion_impact_power_projection value = trigger_value:power_projection who = PREV }
		divide_variable = 		{ which = raj_var_cohesion_impact_power_projection value = 10 }
		change_variable = 		{ which = raj_var_cohesion which = raj_var_cohesion_impact_power_projection }

		# Cohesion - Vizier Liberty Desire
		if = {
			limit = { 
				has_saved_global_event_target = raj_vizier_global_target # If no vizier is present, it stays at 0
				NOT = { has_province_flag = pause_vizier_influence_calc } 
			}
			export_to_variable = 	{ which = raj_var_vizier_ld value = trigger_value:liberty_desire who = event_target:raj_vizier_global_target}

			subtract_variable = 	{ which = raj_var_vizier_ld value = 25 } # - Only values above 25% modify cohesion
			if = { limit = { NOT = { check_variable = { raj_var_vizier_ld = 0 } } } 
				set_variable =  	{ which = raj_var_vizier_ld value = 0 }
			} 
			
			else = {
				divide_variable = 	{ which = raj_var_vizier_ld value = 5 }
				subtract_variable = { which = raj_var_cohesion which = raj_var_vizier_ld }
				round_variable = 	{ which = raj_var_vizier_ld value = 0 }
			}
		}

		# Cohesion - Subject Loyalty
		PREV = {
            every_subject_country = {
				4411 = {
					export_to_variable = 	{ which = raj_var_subject_ld_individual 	value = trigger_value:liberty_desire who = PREV }
					export_to_variable = 	{ which = raj_var_subject_dev_individual 	value = trigger_value:total_development who = PREV }
					set_variable = 			{ which = raj_var_subject_ld_balancing 		which = raj_var_subject_ld_individual }
					change_variable = 		{ raj_var_subject_ld_balancing = -50 }
					multiply_variable = 	{ which = raj_var_subject_ld_balancing 		value = 0.2 } # Increases impact of very high/low cohesion
					change_variable = 		{ which = raj_var_subject_ld_individual 	which = raj_var_subject_ld_balancing }
					change_variable = 		{ which = raj_var_subject_development_total which = raj_var_subject_dev_individual }
					multiply_variable = 	{ which = raj_var_subject_ld_individual     which = raj_var_subject_dev_individual }
					change_variable = 		{ which = raj_var_subject_weighed_ld        which = raj_var_subject_ld_individual }
				}
            }
        }
		divide_variable = 	{ which = raj_var_subject_weighed_ld 	which = raj_var_subject_development_total }
		set_variable = 		{ which = raj_var_cohesion_impact_subject_loyalty value = 100 }
		subtract_variable = { which = raj_var_cohesion_impact_subject_loyalty which = raj_var_subject_weighed_ld }
		multiply_variable = { which = raj_var_cohesion_impact_subject_loyalty value = 0.4 }
		change_variable = 	{ which = raj_var_cohesion which = raj_var_cohesion_impact_subject_loyalty }
		round_variable = 	{ which = raj_var_cohesion_impact_subject_loyalty value = 0 }

		# Cohesion - Senapti Below Maximum
		if = { 
			limit = { raj_below_allowed_senaptia = yes }
			change_variable = {	which = raj_var_cohesion_impact_num_senaptia value = -5 }
			change_variable = { which = raj_var_cohesion value = -5 }
		}

		# Cohesion - Ministries Loyalty
		PREV = {
			if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 50 } } # 50-100
				if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 77 } } # 77-100
					if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 90 } } # 90-100
						if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 97 } } # 97-100
							if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 100 } }
								set_variable = { which = raj_var_cohesion_impact_ministries value = 30 } # 100
							}
							else = {
								set_variable = { which = raj_var_cohesion_impact_ministries value = 29 } # 97-99
							}
						}
						else = { # 90-96
							if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 94 } }
								set_variable = { which = raj_var_cohesion_impact_ministries value = 28 } # 94-96
							}
							else = {
								set_variable = { which = raj_var_cohesion_impact_ministries value = 27 } # 90-93
							}
						}
					}
					else = { # 77-89
						if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 84 } } # 84-89
							if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 87 } }
								set_variable = { which = raj_var_cohesion_impact_ministries value = 26 } # 87-89
							}
							else = {
								set_variable = { which = raj_var_cohesion_impact_ministries value = 25 } # 84-86
							}
						}
						else = {
							if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 80 } }
								set_variable = { which = raj_var_cohesion_impact_ministries value = 24 } # 80-83
							}
							else = {
								set_variable = { which = raj_var_cohesion_impact_ministries value = 23 } # 77-79
							}
						}
					}
				}

				else = { # 50-76
					if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 64 } } # 64-76
						if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 70 } } # 70-76
							if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 74 } }
								set_variable = { which = raj_var_cohesion_impact_ministries value = 22 } # 74-76
							}
							else = {
								set_variable = { which = raj_var_cohesion_impact_ministries value = 21 } # 70-73
							}
						}
						else = { # 64-69
							if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 67 } }
								set_variable = { which = raj_var_cohesion_impact_ministries value = 20 } # 67-69
							}
							else = {
								set_variable = { which = raj_var_cohesion_impact_ministries value = 19 } # 64-66
							}
						}
					}
					else = { # 50-63
						if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 57 } } # 57-63
							if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 60 } }
								set_variable = { which = raj_var_cohesion_impact_ministries value = 18 } # 60-63
							}
							else = {
								set_variable = { which = raj_var_cohesion_impact_ministries value = 17 } # 57-59
							}
						}
						else = { # 50-56
							if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 54 } }
								set_variable = { which = raj_var_cohesion_impact_ministries value = 16 } # 54-56
							}
							else = {
								set_variable = { which = raj_var_cohesion_impact_ministries value = 15 } # 50-53
							}
						}
					}
				}
			}
			else = { # Below 50
				if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 24 } } # 24-49
					if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 37 } }  # 37-49
						if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 44 } }  # 44-49
							if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 47 } }
								set_variable = { which = raj_var_cohesion_impact_ministries value = 14 } # 47-49
							}
							else = {
								set_variable = { which = raj_var_cohesion_impact_ministries value = 13 } # 44-46
							}
						}
						else = { # 37-43
							if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 40 } }
								set_variable = { which = raj_var_cohesion_impact_ministries value = 12 } # 40-43
							}
							else = {
								set_variable = { which = raj_var_cohesion_impact_ministries value = 11 } # 37-39
							}
						}
					}
					else = { # 24-36
						if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 30 } } # 30-34
							if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 34 } }
								set_variable = { which = raj_var_cohesion_impact_ministries value = 10 } # 34-36
							}
							else = {
								set_variable = { which = raj_var_cohesion_impact_ministries value = 9 } # 30-33
							}
						}
						else = {
							if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 27 } }
								set_variable = { which = raj_var_cohesion_impact_ministries value = 8 } # 27-29
							}
							else = {
								set_variable = { which = raj_var_cohesion_impact_ministries value = 7 } # 24-26
							}
						}
					}
				}
				else = { # 0-23
					if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 14 } } # 14-23
						if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 20 } } 
							set_variable = { which = raj_var_cohesion_impact_ministries value = 6 } # 20-23
						}
						else_if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 17 } } 
							set_variable = { which = raj_var_cohesion_impact_ministries value = 5 } # 17-19
						}
						else = {
							set_variable = { which = raj_var_cohesion_impact_ministries value = 4 } # 14-16
						}
					}
					else = {
						if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 10 } } 
							set_variable = { which = raj_var_cohesion_impact_ministries value = 3 } # 10-13
						}
						else_if = { limit = { estate_loyalty = { estate = estate_raj_ministries loyalty = 7 } } 
							set_variable = { which = raj_var_cohesion_impact_ministries value = 2 } # 7-9
						}
						else = {
							set_variable = { which = raj_var_cohesion_impact_ministries value = 1 } # 4-6
						}
					}
				}
			}
		}
		set_variable = 		{ which = raj_var_cohesion_impact_ministries which = PREV }
		change_variable = 	{ which = raj_var_cohesion which = raj_var_cohesion_impact_ministries }
		round_variable = 	{ which = raj_var_cohesion_impact_ministries value = 0 }
		
		# Cohesion - Temporary Bonuses & Maluses
		export_to_variable = { # Permanent modifiers to cohesion belong to 4411, temporary modifiers belong to raja
			which = raj_var_cohesion_bonus_raja
			value = modifier:raj_cohesion_bonus
			who = PREV
		}
		# - Combine all temp modifiers into one variable for tt and update cohesion
		change_variable = 	{ which = raj_overall_cohesion_change_bonus which = raj_var_cohesion_impact_bonus } 
		change_variable = 	{ which = raj_overall_cohesion_change_bonus which = raj_var_cohesion_bonus_raja } 
		change_variable = 	{ which = raj_var_cohesion which = raj_overall_cohesion_change_bonus }

		# Other - Trim Cohesion To 2 Decimal Places
		divide_variable = 	{ which = raj_var_cohesion value = 100 }
		multiply_variable = { which = raj_var_cohesion value = 100 }

		# Other - Prevent Cohesion Overflow
		if = {
			limit = { check_variable = { which = raj_var_cohesion value = 100 } }
			set_variable = 	{ which = raj_var_cohesion value = 100 }
		}
	
		# Vizier - If Not Paused, Calculate Vizier Influence
		if = {
			limit = { 
				has_saved_global_event_target = raj_vizier_global_target # If no vizier is present, it stays at 0
				NOT = { has_province_flag = pause_vizier_influence_calc }
			}

			event_target:raj_vizier_global_target = {
				4411 = {
					# - Turn Vizier dev fraction into Influence
					export_to_variable = { 
						which = raj_var_vizier_influence 
						value = trigger_value:development_of_overlord_fraction
						who = PREV
					}

					# - Turn Influence into a percentage
					set_variable = 		{ which = raj_var_vizier_influence_percentage which = raj_var_vizier_influence }
					multiply_variable = { which = raj_var_vizier_influence_percentage value = 100 }
					if = {
						limit = { check_variable = { which = raj_var_vizier_influence_percentage value = 100 } } # Cap influence to 100%
						set_variable = 	{ which = raj_var_vizier_influence_percentage value = 100 }
					}

					# - Update Influence tooltip variables
					export_to_variable = { which = raj_var_tt_viz_dev value = trigger_value:total_development who = PREV }
					export_to_variable = { which = raj_var_tt_raja_dev value = trigger_value:total_development who = owner }

					# - Turn the Vizier Influence into a frame value that the influence bar can display
					# - Value must be multiple of 4% to split the bar into x25 4% chunks. Since the bar is 300px, thats x25 12px chunks that the indicator can be displayed in
					set_variable = 		{ which = raj_vizier_influence_frame_var which = raj_var_vizier_influence_percentage }
					divide_variable = 	{ which = raj_vizier_influence_frame_var value = 4 } # \
					round_variable = 	{ which = raj_vizier_influence_frame_var value = 0 } #  | Round value to the nearest multiple of 4 for the indicator
					multiply_variable = { which = raj_vizier_influence_frame_var value = 4 } # /
				}
			}

			# - Propagate the frame value to the raja and all player raj subjects so all players in the raj can see the UI
			PREV = {
				set_variable = { which = raj_vizier_influence_frame_var which = PREV }
				every_subject_country = {
					limit = { ai = no }
					4411 = {
						PREV = {
							set_variable = { which = raj_vizier_influence_frame_var which = PREV }
						}
					}
				}
			}
		}
	}
}

# Use this to immediately update Cohesion's "Other Boni & Mali" with a player-facing effect
# Modify 'raj_var_cohesion_impact_bonus' directly for backend calculations
# For temporary modifiers to cohesion, or modifiers that don't persist between rajas, use the raj_cohesion_bonus modifier instead
raj_permanent_cohesion_change_bonus = {
	if = {
		limit = {
			NOT = { has_global_flag = destroyed_raj }
		}
		hidden_effect = {
			4411 = { change_variable = { which = raj_var_cohesion_impact_bonus value = $amount$ } }
			event_target:raj_raja_global_target = { rahen_raj_calc_cohesion = yes }
		}
		tooltip = { change_variable = { which = raj_var_cohesion value = $amount$ } }
	}
}

# Assigns a cohesion malus based on previous vizier influence
raj_vizier_influence_malus = {
	# - High Influence: > 66%
	if = { 
		limit = { 
			OR = {
				4411 = { check_variable = { which = raj_var_vizier_influence value = 0.66 } }
				has_country_modifier = raj_vizier_cohesion_impact_high
			}
		}
		remove_country_modifier = raj_vizier_cohesion_impact_high
		remove_country_modifier = raj_vizier_cohesion_impact_med
		remove_country_modifier = raj_vizier_cohesion_impact_low
		add_country_modifier = {
			name = raj_vizier_cohesion_impact_high
			duration = 3650
		}
	}
	# - Medium Influence: 33% - 66%
	else_if = { 
		limit = { 
			OR = {
				AND = {
					4411 = { 
						NOT = { check_variable = { which = raj_var_vizier_influence value = 0.66 } }
						check_variable = { which = raj_var_vizier_influence value = 0.33 } 
					}
				}
				has_country_modifier = raj_vizier_cohesion_impact_med
			}
		}
		remove_country_modifier = raj_vizier_cohesion_impact_high
		remove_country_modifier = raj_vizier_cohesion_impact_med
		remove_country_modifier = raj_vizier_cohesion_impact_low
		add_country_modifier = {
			name = raj_vizier_cohesion_impact_med
			duration = 3650
		}
	}
	# - Low Influence: < 33%
	else = { 
		remove_country_modifier = raj_vizier_cohesion_impact_high
		remove_country_modifier = raj_vizier_cohesion_impact_med
		remove_country_modifier = raj_vizier_cohesion_impact_low
		add_country_modifier = {
			name = raj_vizier_cohesion_impact_low
			duration = 3650
		}
	}
}

rahen_raj_variables_startup = {
	every_subject_country = {
		if = { limit = { is_subject_of_type = great_daimyo_vassal }
			set_country_flag = senapti_flag
			set_variable = { which = senapti_battles_won value = 0 }
			set_variable = { which = senapti_external_expansion value = 0 }
			4411 = { change_variable = { rajNbSenapti = 1 } }
		}
		else_if = { limit = { is_subject_of_type = vizier_vassal }
			set_variable = { which = vizier_scholars_invited value = 0 }
		}
	}
	save_global_event_target_as = raj_raja_global_target
	R52 = { save_global_event_target_as = raj_vizier_global_target }
	4411 = { set_variable = { which = raj_var_cohesion_impact_bonus value = 0 } }
	rahen_raj_calc_cohesion = yes
	check_if_at_senaptia_cap_pick_best_if_not = yes
	country_event = {
		id = rahenraj.0
	}
}

# Mandates
rahen_raj_mandate_apply_modifier_raja = {
	custom_tooltip = $raj_mandate_tooltip$
	event_target:raj_raja_global_target = {
		add_country_modifier = { name = $modifier$ duration = $mod_duration$ }
	}			
}
rahen_raj_mandate_apply_modifier_vizier = {
	custom_tooltip = $raj_mandate_tooltip$
	event_target:raj_vizier_global_target = {
		add_country_modifier = { name = $modifier$ duration = $mod_duration$ }
	}	
}
rahen_raj_mandate_apply_modifier_senapti = {
	custom_tooltip = $raj_mandate_tooltip$
	tooltip = {
		event_target:raj_raja_global_target = {
			random_subject_country = {
				limit = { is_subject_of_type = great_daimyo_vassal }
				add_country_modifier = { name = $modifier$ duration = $mod_duration$ }
			}
		}
	}
	hidden_effect = {
		event_target:raj_raja_global_target = {
			every_subject_country = { limit = { is_subject_of_type = great_daimyo_vassal }
				add_country_modifier = { name = $modifier$ duration = $mod_duration$ }
			}
		}		
	}
}
rahen_raj_mandate_apply_modifier_prabhi = {
	custom_tooltip = $raj_mandate_tooltip$
	tooltip = {
		event_target:raj_raja_global_target = {
			random_subject_country = {
				limit = { is_subject_of_type = daimyo_vassal }
				add_country_modifier = { name = $modifier$ duration = $mod_duration$ }
			}
		}
	}
	hidden_effect = {
		event_target:raj_raja_global_target = {
			every_subject_country = { limit = { is_subject_of_type = daimyo_vassal }
				add_country_modifier = { name = $modifier$ duration = $mod_duration$ }
			}
		}		
	}
}

rahen_raj_mandate_vizier_logistical_focus = {
	rahen_raj_mandate_apply_modifier_raja 		= { raj_mandate_tooltip = rahen_raj_mandate_raja_tt 	modifier = rahen_raj_mandate_vizier_3_raja_mod 		mod_duration = 3650 }
	rahen_raj_mandate_apply_modifier_vizier 	= { raj_mandate_tooltip = rahen_raj_mandate_vizier_tt 	modifier = rahen_raj_mandate_vizier_3_vizier_mod 	mod_duration = 3650 }
	rahen_raj_mandate_apply_modifier_senapti 	= { raj_mandate_tooltip = rahen_raj_mandate_senapti_tt 	modifier = rahen_raj_mandate_vizier_3_senaptia_mod 	mod_duration = 3650 }
	rahen_raj_mandate_apply_modifier_prabhi 	= { raj_mandate_tooltip = rahen_raj_mandate_prabhi_tt 	modifier = rahen_raj_mandate_vizier_3_prabhia_mod 	mod_duration = 3650 }
	hidden_effect = {
		overlord = {
			every_subject_country = {
				limit = { NOT = { has_reform = oracular_order_reform is_subject_of_type = vizier_vassal } }
				country_event = { id = rahenraj.5005 }
			}
			country_event = { id = rahenraj.5005 }
		}
	}
}
rahen_raj_mandate_vizier_prabhi_recruitment = {
	rahen_raj_mandate_apply_modifier_raja 		= { raj_mandate_tooltip = rahen_raj_mandate_raja_tt 	modifier = rahen_raj_mandate_vizier_1_raja_mod 				mod_duration = 3650 }
	rahen_raj_mandate_apply_modifier_vizier 	= { raj_mandate_tooltip = rahen_raj_mandate_vizier_senapti_tt 	modifier = rahen_raj_mandate_vizier_1_vizier_senaptia_mod 	mod_duration = 3650 }
	hidden_effect = {	#because the vizier modifier is the same. unhid if they diverge
		rahen_raj_mandate_apply_modifier_senapti 	= { raj_mandate_tooltip = rahen_raj_mandate_vizier_senapti_tt 	modifier = rahen_raj_mandate_vizier_1_vizier_senaptia_mod 	mod_duration = 3650 }
	}	
	rahen_raj_mandate_apply_modifier_prabhi 	= { raj_mandate_tooltip = rahen_raj_mandate_prabhi_tt 	modifier = rahen_raj_mandate_vizier_1_prabhia_mod 			mod_duration = 3650 }
	hidden_effect = {
		overlord = {
			every_subject_country = {
				limit = { NOT = { has_reform = oracular_order_reform is_subject_of_type = vizier_vassal } }
				country_event = { id = rahenraj.5006 }
			}
			country_event = { id = rahenraj.5006 }
		}
	}
	custom_tooltip = rahen_raj_mandate_extra_tt
	event_target:raj_vizier_global_target = { create_general = { tradition = 60 } }
}
rahen_raj_mandate_vizier_imperial_drills = {
	rahen_raj_mandate_apply_modifier_raja 		= { raj_mandate_tooltip = rahen_raj_mandate_raja_tt 	modifier = rahen_raj_mandate_vizier_2_raja_mod 		mod_duration = 3650 }
	rahen_raj_mandate_apply_modifier_vizier 	= { raj_mandate_tooltip = rahen_raj_mandate_vizier_tt 	modifier = rahen_raj_mandate_vizier_2_vizier_mod 	mod_duration = 3650 }
	rahen_raj_mandate_apply_modifier_senapti 	= { raj_mandate_tooltip = rahen_raj_mandate_senapti_tt 	modifier = rahen_raj_mandate_vizier_2_senaptia_mod 	mod_duration = 3650 }
	rahen_raj_mandate_apply_modifier_prabhi 	= { raj_mandate_tooltip = rahen_raj_mandate_prabhi_tt 	modifier = rahen_raj_mandate_vizier_2_prabhia_mod 	mod_duration = 3650 }

	# All "peace_mod" modifiers will be removed if a country declares war or has war declared on them.
	rahen_raj_mandate_apply_modifier_vizier 	= { raj_mandate_tooltip = raj_mandate_peacetime_mod_vizier_senapti 	modifier = rahen_raj_mandate_vizier_2_vizier_senaptia_peace_mod 	mod_duration = 3650 }
	hidden_effect = {
		rahen_raj_mandate_apply_modifier_senapti 	= { raj_mandate_tooltip = raj_mandate_peacetime_mod_vizier_senapti modifier = rahen_raj_mandate_vizier_2_vizier_senaptia_peace_mod 	mod_duration = 3650 }
		overlord = {
			every_subject_country = {
				limit = { NOT = { has_reform = oracular_order_reform is_subject_of_type = vizier_vassal } }
				country_event = { id = rahenraj.5007 }
			}
			country_event = { id = rahenraj.5007 }
		}
	}
}
# Raja mandates, scope is assumed to be the Raja.
rahen_raj_mandate_raja_imperial_tribute = {
	rahen_raj_mandate_apply_modifier_raja 		= { raj_mandate_tooltip = rahen_raj_mandate_raja_tt 	modifier = rahen_raj_mandate_raja_2_raja_mod 		mod_duration = 3650 }
	rahen_raj_mandate_apply_modifier_vizier 	= { raj_mandate_tooltip = rahen_raj_mandate_vizier_tt 	modifier = rahen_raj_mandate_raja_2_vizier_mod 		mod_duration = 3650 }
	rahen_raj_mandate_apply_modifier_senapti 	= { raj_mandate_tooltip = rahen_raj_mandate_senapti_tt 	modifier = rahen_raj_mandate_raja_2_senaptia_mod 	mod_duration = 3650 }
	rahen_raj_mandate_apply_modifier_prabhi 	= { raj_mandate_tooltip = rahen_raj_mandate_prabhi_tt 	modifier = rahen_raj_mandate_raja_2_prabhia_mod 	mod_duration = 3650 }
	hidden_effect = {
		every_subject_country = {
			limit = { NOT = { has_reform = oracular_order_reform } }
			country_event = { id = rahenraj.5008 }
		}
	}
}
rahen_raj_mandate_raja_declaration_of_harmony = {
	custom_tooltip = rahen_raj_mandate_raja_declaration_of_harmony_tt
	rahen_raj_mandate_apply_modifier_raja 		= { raj_mandate_tooltip = rahen_raj_mandate_raja_tt 	modifier = rahen_raj_mandate_raja_3_raja_mod 			mod_duration = 3650 }
	rahen_raj_mandate_apply_modifier_vizier 	= { raj_mandate_tooltip = rahen_raj_mandate_vizier_tt 	modifier = rahen_raj_mandate_raja_3_vizier_peace_mod 	mod_duration = 3650 }
	rahen_raj_mandate_apply_modifier_senapti 	= { raj_mandate_tooltip = rahen_raj_mandate_senapti_tt 	modifier = rahen_raj_mandate_raja_3_senaptia_peace_mod 	mod_duration = 3650 }
	rahen_raj_mandate_apply_modifier_prabhi 	= { raj_mandate_tooltip = rahen_raj_mandate_prabhi_tt 	modifier = rahen_raj_mandate_raja_3_prabhia_peace_mod 	mod_duration = 3650 }
	hidden_effect = {
		every_subject_country = {
			limit = { NOT = { has_reform = oracular_order_reform } }
			country_event = { id = rahenraj.5009 }
		}
	}
}

rahen_raj_mandate_raja_land_redistribution = {
	# TODO LATER RAJ, this will be replaced with something else, because fuck coding the originally intended mandate. (+1)
}

rahen_raj_vizier_scholar_count_effect = {
	hidden_effect = {
		if = { limit = { is_subject_of_type = vizier_vassal }
			change_variable = { which = vizier_scholars_invited value = 1 }
		}
	}
}

rahen_raj_remove_mandates = {
	remove_country_modifier = rahen_raj_mandate_vizier_1_raja_mod
	remove_country_modifier = rahen_raj_mandate_vizier_1_vizier_senaptia_mod
	remove_country_modifier = rahen_raj_mandate_vizier_1_prabhia_mod
	remove_country_modifier = rahen_raj_mandate_vizier_2_raja_mod
	remove_country_modifier = rahen_raj_mandate_vizier_2_vizier_mod
	remove_country_modifier = rahen_raj_mandate_vizier_2_senaptia_mod
	remove_country_modifier = rahen_raj_mandate_vizier_2_prabhia_mod
	remove_country_modifier = rahen_raj_mandate_vizier_2_vizier_senaptia_peace_mod
	remove_country_modifier = rahen_raj_mandate_vizier_3_raja_mod
	remove_country_modifier = rahen_raj_mandate_vizier_3_vizier_mod
	remove_country_modifier = rahen_raj_mandate_vizier_3_senaptia_mod
	remove_country_modifier = rahen_raj_mandate_vizier_3_prabhia_mod
	remove_country_modifier = rahen_raj_mandate_raja_2_raja_mod
	remove_country_modifier = rahen_raj_mandate_raja_2_vizier_mod
	remove_country_modifier = rahen_raj_mandate_raja_2_senaptia_mod
	remove_country_modifier = rahen_raj_mandate_raja_2_prabhia_mod
	remove_country_modifier = rahen_raj_mandate_raja_3_raja_mod
	remove_country_modifier = rahen_raj_mandate_raja_3_vizier_peace_mod
	remove_country_modifier = rahen_raj_mandate_raja_3_senaptia_peace_mod
	remove_country_modifier = rahen_raj_mandate_raja_3_prabhia_peace_mod
}

check_if_at_senaptia_cap_pick_best_if_not = {
	4411 = {
		#Based on your number of subjects divided by 5.5
		export_to_variable = {
			which = raj_max_allowed_senaptia
			value = trigger_value:num_of_subjects
			who = PREV
		}
		divide_variable = {
			which = raj_max_allowed_senaptia
			value = 5.5
		}
		if = {
			limit = { owner = { num_of_subjects = 100 } }
			multiply_variable = {
				which = raj_max_allowed_senaptia
				value = 0.8
			}
		}
		if = {
			limit = {
				NOT = {
					check_variable = {
						which = raj_max_allowed_senaptia
						value = 7
					}
				}
			}
			set_variable = {
				which = raj_max_allowed_senaptia
				value = 7
			}
		}
			
		if = {
			limit = { owner = { has_estate_privilege = estate_raj_ministries_expanded_senaptia_ranks } }
			multiply_variable = {
				which = raj_max_allowed_senaptia
				value = 1.2
			}
		}
		if = {
			limit = { owner = { has_estate_privilege = estate_raj_ministries_reduced_senaptia_ranks } }
			divide_variable = {
				which = raj_max_allowed_senaptia
				value = 1.2
			}
		}

		round_variable = {
			which = raj_max_allowed_senaptia
			value = 0
		}

		change_variable = {
			which = raj_max_allowed_senaptia
			which = raj_bonus_allowed_senaptia
		}
				
		# #Checking if you have too many Senaptia	hopefully I'm accounting for everything and this is not needed
		# set_variable = { which = rajNbSenapti value = 0 }
		# owner = {
		# 	every_subject_country = {
		# 		limit = { is_subject_of_type = great_daimyo_vassal }
		# 		4411 = { change_variable = { rajNbSenapti = 1 } }
		# 	}
		# }
			
			#If a senapti rank is available
		if = {
			limit = {
				raj_below_allowed_senaptia = yes
				owner = {
					ai = yes
					any_subject_country = { is_subject_of_type = daimyo_vassal }
				}
			}
			owner = {
				every_subject_country = {
					limit = { is_subject_of_type = daimyo_vassal }
					if = {
						limit = {
							OR = {
								NOT = { has_saved_event_target = strongest_prabhi }
								army_size = event_target:strongest_prabhi
							}
						}
						save_event_target_as = strongest_prabhi
					}
				}
			}
			event_target:strongest_prabhi = { raj_become_senapti = yes }	#prabhi with the biggest army, player escluded. make them fight cool war
		}
	}
}

raj_become_senapti = {
	add_government_reform = senapti_reform
	hidden_effect = {
		set_country_flag = senapti_flag
		set_variable = { which = senapti_battles_won 		value = 0 }
		set_variable = { which = senapti_external_expansion value = 0 }
		event_target:raj_raja_global_target = {
			create_subject = {
				subject_type = great_daimyo_vassal
				subject = PREV
			}			
		}
		4411 = { change_variable = { rajNbSenapti = 1 } }
		if = {
			limit = {
				event_target:raj_raja_global_target = { has_country_modifier = R51_senaptia_banners_raja }
			}
			add_country_modifier = {
				name = R51_senaptia_banners_senaptia
				duration = -1
			}
		}
	}
	if = {
		limit = { tag = event_target:raj_vizier_global_target }
		country_event = { id = rahenraj.2103 }
	}
}

raj_become_prabhi = {
	if = {
		limit = { NOT = { government = monarchy } }
		change_government = monarchy
	}
	add_government_reform = prabhi_reform	
	hidden_effect = {
		if = {
			limit = { is_subject_of_type = great_daimyo_vassal }
			4411 = { change_variable = { rajNbSenapti = -1 } }
		}
		clr_country_flag = senapti_flag
		event_target:raj_raja_global_target = {
			create_subject = {
				subject_type = daimyo_vassal
				subject = PREV
			}
		}
    }
}

raj_become_vizier = {
	hidden_effect = {
		if = {
			limit = {
				event_target:raj_vizier_global_target = {
					exists = yes
					is_subject = yes
				}
			}
			event_target:raj_vizier_global_target = { raj_become_senapti = yes }
		}
	}
	if = {
		limit = { is_subject_of_type = great_daimyo_vassal }
		hidden_effect = {
			4411 = { change_variable = { rajNbSenapti = -1 } }
			clr_country_flag = senapti_flag
		}
	}
	event_target:raj_raja_global_target = {
		create_subject = {
			subject_type = vizier_vassal
			subject = PREV
		}
	}
	hidden_effect = {
		save_global_event_target_as = raj_vizier_global_target
		country_event = { id = rahenraj.2102 }
		set_variable = { which = vizier_scholars_invited value = 0 }
	}
}

allowed_to_restore_raj = {
	set_country_flag = may_restore_raj
	custom_tooltip = may_restore_raj_tt
}

raja_completed_ministries_agenda = {
	if = {
		limit = { has_government_attribute = is_raja }
		hidden_effect = { 
			add_or_extend_country_modifier = {
				name = raj_agenda_cohesion
				duration = 3650
				hidden = no
			}
			
			rahen_raj_calc_cohesion = yes
		}
		custom_tooltip = raj_agenda_cohesion_tt
	}
}

raja_failed_ministries_agenda = {
	if = {
		limit = { has_government_attribute = is_raja }
		hidden_effect = {
			add_or_extend_country_modifier = {
				name = raj_agenda_cohesion_bad
				duration = 3650
				hidden = no
			}
			
			rahen_raj_calc_cohesion = yes
		}
		custom_tooltip = raj_agenda_cohesion_bad_tt
	}
}

raja_add_bonus_max_senaptia = {	#you probably will have to add the tt to the loc if you add more than 1 max senapti
	custom_tooltip = add_$value$_max_senapti_tt
	hidden_effect = {
		4411 = {
			change_variable = {
				which = raj_bonus_allowed_senaptia
				value = $value$
			}
		}
	}
}

raj_dismantling_effect = {
	event_target:raj_raja_global_target = {
		every_subject_country = {
			limit = {
				OR = {
					is_subject_of_type = daimyo_vassal
					is_subject_of_type = great_daimyo_vassal
					is_subject_of_type = vizier_vassal
				}
			}
			#Grant freedom from old raja
			[[releaseSubjects]
				hidden_effect = { PREV = { create_subject = { subject_type = daimyo_vassal subject = PREV } }	} #prevent insta-annexation, pdx bug
				grant_independence = yes
				if = {
					limit = { has_government_attribute = is_raja_subject }
					add_government_reform = indep_prabhi_reform
				}
			]
			[[makeSubjectsVassals]
				PREV = { create_subject = {	subject_type = vassal subject = PREV } }
			]
			hidden_effect = { rahen_raj_remove_mandates = yes } # Mandates no longer relevant.
		}
		#Downgrade rank and force indep_prabhi reform onto old raja
		add_government_reform = indep_prabhi_reform
		set_government_rank = 1
		remove_country_modifier = raj_opened_senapti_ranks
		remove_country_modifier = raj_closed_senapti_ranks
		set_global_flag = destroyed_raj
		4411 = {
			remove_province_modifier = raj_royal_barracks
			remove_province_modifier = rahen_corrupt_ministery_of_agriculture
			remove_province_modifier = rahen_corrupt_ministery_of_philosophy
			remove_province_modifier = rahen_corrupt_ministery_of_internal_relations
			remove_province_modifier = rahen_corrupt_ministery_of_foreign_relations
		}
		hidden_effect = {
			rahen_superregion = { rahen_clear_court_disaster_province_modifiers = yes }
			rahen_raj_remove_mandates = yes
		}
	}
	hidden_effect = {
		clear_global_event_target = raj_raja_global_target
		clear_global_event_target = raj_vizier_global_target
	}
}

ruby_gardens_wedding_effect = {
	$owner$ = { add_country_modifier = { name = ruby_gardens_tier_$tier$_marriage duration = 9125 } }
	$target$ = {
		add_opinion = { who = $owner$ modifier = ruby_gardens_tier_$tier$_marriage }
		custom_tooltip = ruby_gardens_decrease_ae_$tier$
		hidden_effect = {
			capital_scope = {
				region = {
					limit = {
						is_capital = yes
						owner = {
							NOT = {
								tag = $owner$
								is_rival = $owner$
								is_enemy = $owner$
								has_country_modifier = monstrous_nation
							}
						}
					}
					owner = { add_aggressive_expansion = { who = $owner$ value = $ae$ apply_calc = no } }
				}
			}
		}
	}
}