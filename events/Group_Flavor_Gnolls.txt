namespace = gnoll_flavor

# Enforcing loyalty
country_event = {
	id = gnoll_flavor.1
	title = gnoll_flavor.1.title
	desc = gnoll_flavor.1.desc
	picture = BORDER_TENSION_eventPicture
	
	is_triggered_only = yes

	trigger = {
		OR = {
			has_estate_privilege = gnoll_the_weak_serve_the_strong
			has_estate_privilege = gnoll_the_weak_serve_the_strong_burghers
		}
		any_subject_country = {
			OR = {
				liberty_desire = 40
				NOT = { 
					has_opinion = {
						who = ROOT
						value = 0
					}
				}
			}
		}
	}
	
	immediate = {
		hidden_effect = {
			random_subject_country = {
				limit = {
					OR = {
						liberty_desire = 40
						NOT = { 
							has_opinion = {
								who = ROOT
								value = 0
							}
						}
					}
				}

				save_event_target_as = disloyal_subject
			}
		}
	}
	
	# We must put them in their place.
	option = {
		name = gnoll_flavor.1.a

		trigger = {
			not_has_granted_organized_sacrifices_privilege = yes
		}

		ai_chance = {
			factor = 100

			modifier = {
				factor = 0.5
				NOT = { monthly_mil = 7 }
			}

			modifier = {
				factor = 0.5
				NOT = { mil_power = 50 } 
			}

			# More likely if the subject is disloyal but would be made loyal
			modifier = {
				factor = 2

				event_target:disloyal_subject = {
					liberty_desire = 50
					NOT = { liberty_desire = 60 }
				}
			}
		}
		
		add_mil_power = -50

		event_target:disloyal_subject = {
			add_liberty_desire = -10

			hidden_effect = {
				random_owned_province = {
					remove_loot = {
						who = ROOT
						amount = 100 # Will this just produce gold out of nowhere?
					}
				}
				if = {
					limit = { total_development = 100 }
					
					random_owned_province = {
						limit = {
							is_looted = no
						}
						remove_loot = {
							who = ROOT
							amount = 100 # Will this just produce gold out of nowhere?
						}
					}				
				}
				if = {
					limit = { total_development = 200 }
					
					random_owned_province = {
						limit = {
							is_looted = no
						}
						remove_loot = {
							who = ROOT
							amount = 100 # Will this just produce gold out of nowhere?
						}
					}				
				}
				if = {
					limit = { total_development = 300 }
					
					random_owned_province = {
						limit = {
							is_looted = no
						}
						remove_loot = {
							who = ROOT
							amount = 100 # Will this just produce gold out of nowhere?
						}
					}				
				}
				if = {
					limit = { total_development = 400 }
					
					random_owned_province = {
						limit = {
							is_looted = no
						}
						remove_loot = {
							who = ROOT
							amount = 100 # Will this just produce gold out of nowhere?
						}
					}				
				}

				country_event = { id = gnoll_flavor.2 }
			}
		}

		custom_tooltip = gnoll_flavor.1.a.tooltip
	}
	
	# Light the pyres! Today these dissidents burn.
	option = {
		name = gnoll_flavor.1.b

		trigger = {
			has_granted_organized_sacrifices_privilege = yes
		}

		ai_chance = {
			factor = 150

			modifier = {
				factor = 0.5
				NOT = { monthly_mil = 7 }
			}

			modifier = {
				factor = 0.5
				NOT = { mil_power = 50 } 
			}

			# More likely if the subject is disloyal but would be made loyal
			modifier = {
				factor = 2

				event_target:disloyal_subject = {
					liberty_desire = 50
					NOT = { liberty_desire = 70 }
				}
			}

			# They need all the demonic power they can get
			modifier = {
				factor = 2

				has_ruler_flag = undergoing_xhazob_ritual
			}
		}
		
		add_mil_power = -50
		add_patriarch_authority = 0.05

		event_target:disloyal_subject = {
			add_liberty_desire = -20

			hidden_effect = {
				random_owned_province = {
					limit = {
						is_looted = no
					}
					remove_loot = {
						who = ROOT
						amount = 100 # Will this just produce gold out of nowhere?
					}
				}
				if = {
					limit = { total_development = 50 }
					
					random_owned_province = {
						limit = {
							is_looted = no
						}
						remove_loot = {
							who = ROOT
							amount = 100 # Will this just produce gold out of nowhere?
						}
					}				
				}
				if = {
					limit = { total_development = 100 }
					
					random_owned_province = {
						limit = {
							is_looted = no
						}
						remove_loot = {
							who = ROOT
							amount = 100 # Will this just produce gold out of nowhere?
						}
					}				
				}
				if = {
					limit = { total_development = 150 }
					
					random_owned_province = {
						limit = {
							is_looted = no
						}
						remove_loot = {
							who = ROOT
							amount = 100 # Will this just produce gold out of nowhere?
						}
					}				
				}
				if = {
					limit = { total_development = 200 }
					
					random_owned_province = {
						limit = {
							is_looted = no
						}
						remove_loot = {
							who = ROOT
							amount = 100 # Will this just produce gold out of nowhere?
						}
					}				
				}
				if = {
					limit = { total_development = 250 }
					
					random_owned_province = {
						limit = {
							is_looted = no
						}
						remove_loot = {
							who = ROOT
							amount = 100 # Will this just produce gold out of nowhere?
						}
					}				
				}
				if = {
					limit = { total_development = 300 }
					
					random_owned_province = {
						limit = {
							is_looted = no
						}
						remove_loot = {
							who = ROOT
							amount = 100 # Will this just produce gold out of nowhere?
						}
					}				
				}
				if = {
					limit = { total_development = 350 }
					
					random_owned_province = {
						limit = {
							is_looted = no
						}
						remove_loot = {
							who = ROOT
							amount = 100 # Will this just produce gold out of nowhere?
						}
					}				
				}
				if = {
					limit = { total_development = 400 }
					
					random_owned_province = {
						limit = {
							is_looted = no
						}
						remove_loot = {
							who = ROOT
							amount = 100 # Will this just produce gold out of nowhere?
						}
					}				
				}
				if = {
					limit = { total_development = 450 }
					
					random_owned_province = {
						limit = {
							is_looted = no
						}
						remove_loot = {
							who = ROOT
							amount = 100 # Will this just produce gold out of nowhere?
						}
					}				
				}

				country_event = { id = gnoll_flavor.2 }
			}
		}

		custom_tooltip = gnoll_flavor.1.b.tooltip
	}

	# They haven't done anything wrong! Why would we punish them?
	option = {
		name = gnoll_flavor.1.c

		trigger = {
			not_has_granted_ritualized_cleansing_privilege = yes
		}

		ai_chance = {
			factor = 100

			modifier = {
				factor = 0.5
				NOT = { legitimacy_equivalent = 50 }
			}

			modifier = {
				factor = 0.5
				NOT = { prestige = 10 }
			}

			# More likely if the subject is not actually disloyal
			modifier = {
				factor = 1.5

				event_target:disloyal_subject = {
					NOT = { liberty_desire = 50 }
				}
			}
		}

		add_prestige = -10
		add_legitimacy_equivalent = {
			amount = -10
			republican_tradition = -5
		}

		every_subject_country = {
			add_liberty_desire = -5
		}
	}

	# What they need is guidance, not punishment.
	option = {
		name = gnoll_flavor.1.d

		trigger = {
			has_granted_ritualized_cleansing_privilege = yes
		}

		ai_chance = {
			factor = 100

			modifier = {
				factor = 0.5
				NOT = { monthly_dip = 7 }
			}
			
			modifier = {
				factor = 0.5
				NOT = { dip_power = 50 }
			}

			# More likely if the subject is not actually disloyal
			modifier = {
				factor = 1.5

				event_target:disloyal_subject = {
					NOT = { liberty_desire = 50 }
				}
			}
		}

		add_dip_power = -50

		every_subject_country = {
			add_liberty_desire = -10
		}
	}
}

# Province was looted by "Enforcing Loyalty"
country_event = {
	id = gnoll_flavor.2
	title = gnoll_flavor.2.title
	desc = gnoll_flavor.2.desc
	picture = HORDE_ON_HORSEBACK_eventPicture

	is_triggered_only = yes

	# But we didn't do anything!
	option = {
		name = gnoll_flavor.2.a

		custom_tooltip = gnoll_flavor.2.a.tooltip # Some of our provinces were looted.
	}
}

# From Chains to Court
country_event = {
	id = gnoll_flavor.3
	title = gnoll_flavor.3.title
	desc = gnoll_flavor.3.desc
	picture = BORDER_TENSION_eventPicture

	is_triggered_only = yes

	trigger = {
		OR = {
			has_estate_privilege = gnoll_the_weak_serve_the_strong
			has_estate_privilege = gnoll_the_weak_serve_the_strong_burghers
		}
		slaves = 1
		NOT = { religion = kvangahga }
	}

	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = { trade_goods = slaves }
				save_event_target_as = event_province
			}

			# Pick a random country, preferably a neighbor, that is not gnollish culture for the slave's culture.
			if = {
				limit = {
					any_neighbor_country = {
						NOT = {
							culture_is_gnollish = yes
						}
					}
				}

				random_neighbor_country = {
					limit = {
						NOT = { culture_is_gnollish = yes }
					}

					save_event_target_as = slave_culture_source
				}
			}
			else = {
				random_known_country = {
					limit = {
						NOT = {
							culture_is_gnollish = yes
						}
					}
					save_event_target_as = slave_culture_source
				}
			}

			set_saved_name = {
				key = slave_name
				type = advisor
				scope = event_target:slave_culture_source
			}

			export_to_variable = {
				variable_name = slave_culture
				value = primary_culture
				who = event_target:slave_culture_source
			}
		}
	}

	goto = event_province

	option = {
		name = gnoll_flavor.3.a

		ai_chance = {
			factor = 75

			modifier = {
				factor = 0.5
				NOT = { legitimacy_equivalent = 50 }
			}

			modifier = {
				factor = 0.5
				NOT = { prestige = 10 }
			}

			modifier = {
				factor = 1.25
				ruler_has_personality = benevolent_personality
			}

			modifier = {
				factor = 1.25
				ruler_has_personality = kind_hearted_personality
			}

			modifier = {
				factor = 1.25
				ruler_has_personality = just_personality
			}
		}

		add_legitimacy_equivalent = {
			amount = -10
			republican_tradition = -5
		}

		add_prestige = -10

		trigger_switch = {
			on_trigger = government_rank
			1 = {
				random_list = {
					1 = {
						custom_tooltip = gnoll_flavor.3.a.tooltip_duchy_adm

						hidden_effect = {
							define_random_adm_advisor_effect = {
								name = slave_name
								skill = 1
								culture = variable:slave_culture
								religion = ROOT
								cost_multiplier = 0.5
							}
						}
					}
					1 = {
						custom_tooltip = gnoll_flavor.3.a.tooltip_duchy_dip

						hidden_effect = {
							define_random_dip_advisor_effect = {
								name = slave_name
								skill = 1
								culture = variable:slave_culture
								religion = ROOT
								cost_multiplier = 0.5
							}
						}
					}
					1 = {
						custom_tooltip = gnoll_flavor.3.a.tooltip_duchy_mil

						hidden_effect = {
							define_random_mil_advisor_effect = {
								name = slave_name
								skill = 1
								culture = variable:slave_culture
								religion = ROOT
								cost_multiplier = 0.5
							}
						}
					}
				}
			}
			2 = {
				random_list = {
					1 = {
						custom_tooltip = gnoll_flavor.3.a.tooltip_kingdom_adm

						hidden_effect = {
							define_random_adm_advisor_effect = {
								name = slave_name
								skill = 2
								culture = variable:slave_culture
								religion = ROOT
								cost_multiplier = 0.5
							}
						}
					}
					1 = {
						custom_tooltip = gnoll_flavor.3.a.tooltip_kingdom_dip

						hidden_effect = {
							define_random_dip_advisor_effect = {
								name = slave_name
								skill = 2
								culture = variable:slave_culture
								religion = ROOT
								cost_multiplier = 0.5
							}
						}
					}
					1 = {
						custom_tooltip = gnoll_flavor.3.a.tooltip_kingdom_mil

						hidden_effect = {
							define_random_mil_advisor_effect = {
								name = slave_name
								skill = 2
								culture = variable:slave_culture
								religion = ROOT
								cost_multiplier = 0.5
							}
						}
					}
				}
			}
			3 = {
				random_list = {
					1 = {
						custom_tooltip = gnoll_flavor.3.a.tooltip_empire_adm

						hidden_effect = {
							define_random_adm_advisor_effect = {
								name = slave_name
								skill = 3
								culture = variable:slave_culture
								religion = ROOT
								cost_multiplier = 0.5
							}
						}
					}
					1 = {
						custom_tooltip = gnoll_flavor.3.a.tooltip_empire_dip

						hidden_effect = {
							define_random_dip_advisor_effect = {
								name = slave_name
								skill = 3
								culture = variable:slave_culture
								religion = ROOT
								cost_multiplier = 0.5
							}
						}
					}
					1 = {
						custom_tooltip = gnoll_flavor.3.a.tooltip_empire_mil

						hidden_effect = {
							define_random_mil_advisor_effect = {
								name = slave_name
								skill = 3
								culture = variable:slave_culture
								religion = ROOT
								cost_multiplier = 0.5
							}
						}
					}
				}
			}
		}
	}

	option = {
		name = gnoll_flavor.3.b

		ai_chance = {
			factor = 100

			modifier = {
				factor = 0.5
				legitimacy_equivalent = 90
			}

			modifier = {
				factor = 0.5
				prestige = 90
			}

			modifier = {
				factor = 1.25
				ruler_has_personality = cruel_personality
			}

			modifier = {
				factor = 1.25
				ruler_has_personality = malevolent_personality
			}

			modifier = {
				factor = 1.25
				ruler_has_personality = lawgiver_personality
			}
		}

		add_legitimacy_equivalent = {
			amount = 10
			republican_tradition = 5
		}
		add_prestige = 10

		event_target:event_province = {
			area = {
				limit = { owned_by = ROOT }

				add_province_modifier = {
					name = gnoll_local_slave_leader
					duration = 3650 # 10 years
				}
			}
		}
	}

	after = {
		hidden_effect = { clear_saved_name = slave_name }
	}
}