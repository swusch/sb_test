namespace = shuvuush

# 0 : religion
# 1 - 9 : carryover from past, regional events
# 10 - 99 : Horse Races and related
# 100+ : MT events

country_event = { #Saanorgegh swap personal deity
	id = shuvuush.0
	title = shuvuush.0.t
	desc = shuvuush.0.d
	picture = ARTWORK_eventPicture

	is_triggered_only = yes
	
	immediate = { set_country_flag = saanorgegh_menu_open }
	after = {
		clr_country_flag = saanorgegh_menu_open
		add_country_modifier = { name = saanorgegh_swap_cooldown duration = 1825 hidden = yes }
		change_variable = { shuvuush_mask_swap_count = 1 }
	}

	option = { #Altan
		name = altan_full
		trigger = { owns = 5406 }
		highlight = yes
		
		change_personal_deity = altan

		if = {
			limit = { mission_completed = shuvuush_return_white }
			add_country_modifier = { name = shuvuush_ancestral_guidance duration = 1825 }
		}
	}

	option = { #Tsagaan
		name = tsagaan_full
		trigger = { owns = 5341 }
		highlight = yes

		change_personal_deity = tsagaan

		if = {
			limit = { mission_completed = shuvuush_return_white }
			add_country_modifier = { name = shuvuush_ancestral_guidance duration = 1825 }
		}
	}

	option = { #Ulaan
		name = ulaan_full
		trigger = { owns = 5414 }
		highlight = yes

		change_personal_deity = ulaan

		if = {
			limit = { mission_completed = shuvuush_return_white }
			add_country_modifier = { name = shuvuush_ancestral_guidance duration = 1825 }
		}
	}

	option = { #Bhengudak
		name = bhengudak_full
		trigger = { owns = 5414 }
		highlight = yes

		change_personal_deity = bhengudak

		if = {
			limit = { mission_completed = shuvuush_return_white }
			add_country_modifier = { name = shuvuush_ancestral_guidance duration = 1825 }
		}
	}

	option = { #Nurgai
		name = nurgai_full
		trigger = { owns = 5415 hidden_trigger = { 5415 = { has_province_modifier = saanorgegh_nurgai_mod } } }
		highlight = yes

		change_personal_deity = nurgai

		if = {
			limit = { mission_completed = shuvuush_return_white }
			add_country_modifier = { name = shuvuush_ancestral_guidance duration = 1825 }
		}
	}

	option = { #Personal Mask
		name = personal_mask_full

		change_personal_deity = personal_mask

		if = {
			limit = { mission_completed = shuvuush_return_white }
			add_country_modifier = { name = shuvuush_ancestral_guidance duration = 1825 }
		}
	}
	
	option = { #Shepherd of Souls
		name = death_mask_full

		change_personal_deity = death_mask

		if = {
			limit = { mission_completed = shuvuush_return_white }
			add_army_tradition = 15
		}
	}
}

country_event = { #The Faceless Queen
	id = shuvuush.1
	title = shuvuush.1.t
	picture = HORDE_ON_HORSEBACK_eventPicture
	desc = shuvuush.1.d
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = { tag = Y91 }
	
	option = { #Long may she Reign
		name = shuvuush.1.a
		add_prestige = 10
		add_ruler_modifier = { 
			name = faceless_queen_modifier
			duration = -1
		}
		custom_tooltip = nuugdan_raze_hint

		if = { #AI has to handle stuff by itself
			limit = { ai = yes }
			4919 = {
				remove_building = fort_15th
				add_core_construction = { speed = 1 cost = 1 }
			}
			4921 = {
				add_base_tax = -1
				remove_loot = { who = ROOT amount = 10 }
				add_core_construction = { speed = 1 cost = 1 }
			}
			add_adm_power = 25
		}
	}
}

country_event = { #The Faceless Queen dies and become deity
	id = shuvuush.2
	title = shuvuush.2.t
	picture = DEATH_OF_HEIR_eventPicture
	desc = shuvuush.2.d
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = { tag = Y91 }
	
	option = { #A New God For All Shuvuush
		name = shuvuush.2.a
		ai_chance = { factor = 100 }
		add_prestige = 10

		5415 = { add_permanent_province_modifier = { name = saanorgegh_nurgai_mod duration = -1 } }
	}
}

country_event = { #Remove the spirit-farm settlements
	id = shuvuush.3
	title = shuvuush.3.t
	desc = shuvuush.3.d
	picture = INDUSTRIALIZATION_eventPicture

	is_triggered_only = yes
	major = yes

	option = {
		name = shuvuush.3.a

		choogiaza_area = { remove_province_modifier = spirit_farm_settlements }
		yunghuun_area = { remove_province_modifier = spirit_farm_settlements }
		5373 = { remove_province_modifier = spirit_farm_settlements }
		5417 = { if = { limit = { trade_goods = wool } change_trade_goods = grain } }
		5408 = { if = { limit = { trade_goods = wool } change_trade_goods = grain } }
		5412 = { if = { limit = { trade_goods = wool } change_trade_goods = grain } }
	}
}
country_event = { #Selling Noble titles to tribals
	id = shuvuush.4
	title = shuvuush.4.t
	picture = DECLARATION_INDEPENDENCE_eventPicture
	desc = shuvuush.4.d

	is_triggered_only = yes
	trigger = { has_estate = estate_nobles }
	
	option = { #Sell no titles
		name = shuvuush.4.a
		ai_chance = { factor = 0 }
		add_prestige = 5
		add_estate_loyalty = {
			estate = estate_nobles
			loyalty = 5
		}
		every_owned_province = {
			limit = {
				OR = {
					culture = shuvuush
					culture = guwaadun
					culture = daxug
				}
			}
			add_unrest = 2
		}
	}

	option = { #Sell a few titles
		name = shuvuush.4.b
		ai_chance = { factor = 0 }
		add_years_of_income = 0.2
		add_estate_loyalty = {
			estate = estate_nobles
			loyalty = -5
		}
		add_prestige = -5
		add_legitimacy = -5
	}
	
	option = { #Sell a bunch of titles
		name = shuvuush.4.c
		ai_chance = { factor = 0 }
		add_years_of_income = 0.5
		add_estate_loyalty = {
			estate = estate_nobles
			loyalty = -10
		}
		add_prestige = -10
		add_legitimacy = -10
	}
	
	option = { #Sell a ridiculous amount of titles
		name = shuvuush.4.e
		ai_chance = { factor = 100 }
		add_years_of_income = 1
		add_estate_loyalty = {
			estate = estate_nobles
			loyalty = -15
		}
		add_prestige = -20
		add_legitimacy = -20
	}
}

country_event = { #fear of yanshen
	id = shuvuush.5
	title = shuvuush.5.t
	picture = GIFTS_TO_EMPEROR_eventPicture
	desc = shuvuush.5.d
	
	fire_only_once = yes
	is_triggered_only = yes
	major = yes
	
	trigger = {
		technology_group = tech_shuvuush
		owns_or_subject_of = 4859 #Yanzhong
		owns_or_subject_of = 4868 #Jiangdu
		owns_or_subject_of = 4842 #Jincheng
	}
	
	option = { #cower before us!
		name = shuvuush.5.a
		ai_chance = { factor = 100 }

		add_splendor = 800
		add_power_projection = {
			type = mission_rewards_power_projection
			amount = 20
		}
		add_country_modifier = {
			name = shuvuush_fear_of_yanshen
			duration = 7300
		}
	}
}

###################
### Race Events ###
###################

country_event = { #Shuvuush Festival Duel Invites
	id = shuvuush.10
	title = shuvuush.10.t
	picture = HORDE_ON_HORSEBACK_eventPicture
	desc = shuvuush.10.d

	is_triggered_only = yes
	trigger = {
		OR = {
			primary_culture = shuvuush
			primary_culture = kuuldaar
			primary_culture = guwaadun
			primary_culture = daxug
		}
		NOT = { has_country_flag = shuvuush_participating_in_festival }
	}
	
	immediate = { set_country_flag = shuvuush_participating_in_festival }
	
	option = { #Ruler
		name = shuvuush.10.b
		trigger = { has_regency = no }
		ai_chance = { factor = 100 }
		add_years_of_income = -0.15
		set_country_flag = shuvuush_ruler_participating
		set_country_flag = shuvuush_picked_tournament_participants
	}
	
	option = { #Heir
		name = shuvuush.10.c
		trigger = {
			has_heir = yes
			heir_age = 15
		}
		ai_chance = { factor = 100 }
		add_years_of_income = -0.15
		set_country_flag = shuvuush_heir_participating
		set_country_flag = shuvuush_picked_tournament_participants
	}
	
	option = { #Observe
		name = shuvuush.10.e
		ai_chance = { factor = 1 }
		set_country_flag = shuvuush_picked_tournament_participants
	}
	
	after = { country_event = { id = shuvuush.11 } }
}

country_event = { #Shuvuush festival calculation - replace with North Haless Rework when horse races are in
	id = shuvuush.11
	title = shuvuush.11.t
	picture = HORDE_ON_HORSEBACK_eventPicture
	desc = shuvuush.11.d
	
	hidden = yes
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_global_flag = shuvuush_do_not_start_a_festival }
		all_known_country = {
			OR = {
				NOT = {
					primary_culture = shuvuush
					primary_culture = kuuldaar
					primary_culture = guwaadun
					primary_culture = daxug
				}
				has_country_flag = shuvuush_picked_tournament_participants
			}
		}
	}
	
	immediate = { set_global_flag = shuvuush_do_not_start_a_festival } #Avoids firing the event multiple times
	
	option = {
		name = shuvuush.11.a

		every_known_country = {
			limit = { has_country_flag = shuvuush_picked_tournament_participants }
			
			set_variable = { shuvuush_win_chance = 100 } #Base used for RNG, lowest ultimate variable wins

			if = { #ruler modifiers
				limit = { has_country_flag = shuvuush_ruler_participating }

				trigger_switch = { #ruler mil matters
					on_trigger = MIL

					6 = { multiply_variable = { shuvuush_win_chance = 0.7 } }
					5 = { multiply_variable = { shuvuush_win_chance = 0.75 } }
					4 = { multiply_variable = { shuvuush_win_chance = 0.8 } }
					3 = { multiply_variable = { shuvuush_win_chance = 0.85 } }
					2 = { multiply_variable = { shuvuush_win_chance = 0.9 } }
					1 = { multiply_variable = { shuvuush_win_chance = 0.95 } }
				}

				if = { limit = { ruler_has_personality = malevolent_personality } #ruler personality matters
					multiply_variable = { shuvuush_win_chance = 0.9 } }
				if = { limit = { ruler_has_personality = conqueror_personality }
					multiply_variable = { shuvuush_win_chance = 0.9 } }
				if = { limit = { ruler_has_personality = bold_fighter_personality }
					multiply_variable = { shuvuush_win_chance = 0.9 } }
				if = { limit = { ruler_has_personality = martial_educator_personality }
					multiply_variable = { shuvuush_win_chance = 0.9 } }
				if = { limit = { ruler_has_personality = great_conqueror_personality }
					multiply_variable = { shuvuush_win_chance = 0.75 } }
			}
			else_if = { #heir modifiers
				limit = { has_country_flag = shuvuush_heir_participating }

				trigger_switch = { #heir mil matters
					on_trigger = heir_mil

					6 = { multiply_variable = { shuvuush_win_chance = 0.7 } }
					5 = { multiply_variable = { shuvuush_win_chance = 0.75 } }
					4 = { multiply_variable = { shuvuush_win_chance = 0.8 } }
					3 = { multiply_variable = { shuvuush_win_chance = 0.85 } }
					2 = { multiply_variable = { shuvuush_win_chance = 0.9 } }
					1 = { multiply_variable = { shuvuush_win_chance = 0.95 } }
				}

				trigger_switch = { #heirs can only have one personality
					on_trigger = heir_has_personality

					malevolent_personality = { multiply_variable = { shuvuush_win_chance = 0.9 } }
					bold_fighter_personality = { multiply_variable = { shuvuush_win_chance = 0.9 } }
					martial_educator_personality = { multiply_variable = { shuvuush_win_chance = 0.9 } }
					great_conqueror_personality = { multiply_variable = { shuvuush_win_chance = 0.75 } }
				}
			}

			if = { limit = { has_country_modifier = Y98_propaganda_reform_modifier } #MT content
				multiply_variable = { shuvuush_win_chance = 0.9 } }

			REB = {
				set_variable = { shuvuush_current_winner = 100 }
				random_variable = { which = shuvuush_win_chance which = PREV }
				
				if = { #lowest wins
					limit = { check_variable = { which = shuvuush_current_winner which = shuvuush_win_chance } }
					set_variable = { which = shuvuush_current_winner which = shuvuush_win_chance }
					PREV = { save_event_target_as = shuvuush_tournament_winner }
				}
			}
		}

		every_known_country = {
			limit = { has_country_flag = shuvuush_picked_tournament_participants }
			country_event = { id = shuvuush.12 }
		}
	}
}

country_event = { #Tournament outcome
	id = shuvuush.12
	title = shuvuush.12.t
	picture = HORDE_ON_HORSEBACK_eventPicture
	desc = shuvuush.12.d
	
	is_triggered_only = yes
	
	after = { clr_country_flag = shuvuush_participating_in_festival }
	
	
	option = { #Ruler won
		trigger = { event_target:shuvuush_tournament_winner = { has_country_flag = shuvuush_ruler_participating } }
		name = shuvuush.12.a
		ai_chance = { factor = 100 }
		if = {
			limit = { tag = event_target:shuvuush_tournament_winner }
			add_prestige = 20
			add_legitimacy = 20
			add_years_of_income = 0.5
			add_army_tradition = 5
			add_yearly_manpower = 0.5
			if = {
				limit = { NOT = { mil = 6 } }
				change_mil = 1
			}
			else = {
				add_mil_power = 50
			}
		}
		if = {
			limit = { 
				event_target:shuvuush_tournament_winner = {
					tag = ROOT
					has_country_modifier = Y98_propaganda_reform_modifier 
				} 
			}
			event_target:shuvuush_tournament_winner = { 
				country_event = { id = daxugo.50 }
			}
		}
		if = {
			limit = {
				has_country_flag = shuvuush_ruler_participating
				NOT = { event_target:shuvuush_tournament_winner = { tag = ROOT } }
			}
			random = {
				chance = 5
				kill_ruler = yes
			}
		}
		if = {
			limit = {
				has_country_flag = shuvuush_heir_participating
				NOT = { event_target:shuvuush_tournament_winner = { tag = ROOT } }
			}
			random = {
				chance = 5
				kill_heir = { }
			}
		}
	}
	
	option = { #Heir won
		trigger = { event_target:shuvuush_tournament_winner = { has_country_flag = shuvuush_heir_participating } }
		name = shuvuush.12.b
		ai_chance = { factor = 100 }
		if = {
			limit = { event_target:shuvuush_tournament_winner = { tag = ROOT } }
			add_prestige = 10
			add_legitimacy = 5
			add_heir_claim = 50
			add_years_of_income = 0.25
			add_army_tradition = 2.5
			add_manpower = 1
			if = {
				limit = { NOT = { heir_mil = 6 } }
				change_heir_mil = 1
			}
			else = {
				add_mil_power = 50
			}
		}
		if = {
			limit = { 
				event_target:shuvuush_tournament_winner = {
					tag = ROOT
					has_country_modifier = Y98_propaganda_reform_modifier 
				} 
			}
			event_target:shuvuush_tournament_winner = { 
				country_event = { id = daxugo.51 }
			}
		}
		if = {
			limit = {
				has_country_flag = shuvuush_ruler_participating
				NOT = { event_target:shuvuush_tournament_winner = { tag = ROOT } }
			}
			random = {
				chance = 5
				kill_ruler = yes
			}
		}
		if = {
			limit = {
				has_country_flag = shuvuush_heir_participating
				NOT = { event_target:shuvuush_tournament_winner = { tag = ROOT } }
			}
			random = {
				chance = 5
				kill_heir = { }
			}
		}
	}
	
	after = {
		hidden_effect = {
			clr_country_flag = shuvuush_ruler_participating
			clr_country_flag = shuvuush_heir_participating
			clr_global_flag = shuvuush_do_not_start_a_festival
			clr_country_flag = shuvuush_picked_tournament_participants

			country_event = { id = shuvuush.13 } #Nuugdan Tsarai gets an event from Tsuista Khul
		}
	}
}

country_event = { #Tsuista Khul Deal
	id = shuvuush.13
	title = shuvuush.13.t
	picture = GIFTS_TO_EMPEROR_eventPicture
	desc = shuvuush.13.d
	
	fire_only_once = yes
	is_triggered_only = yes
	trigger = { tag = Y91 }
	
	option = {
		name = shuvuush.13.a
		ai_chance = { factor = 100 }
		add_years_of_income = -0.2
		reverse_add_opinion = {
			who = Y90
			modifier = wesdam_high_marriage
		}
		if = {
			limit = { has_consort = yes }
			remove_consort_effect = yes
		}
		define_consort = {
			name = "Jaales Hookhoi"
			adm = 1
			dip = 1
			mil = 3
			age = 21
		}
		create_marriage = Y90
	}
	
	option = {
		name = shuvuush.13.b
		ai_chance = { factor = 100 }
	}
}

#################
### MT EVENTS ###
#################

country_event = { #Life in the Steppes
	id = shuvuush.100
	title = shuvuush.100.t
	desc = shuvuush.100.d
	picture = COSSACK_ESTATE_RAIDERS_eventPicture

	is_triggered_only = yes

	option = { #Conqueror
		name = shuvuush.100.a

		add_ruler_personality = conqueror_personality
		clear_heir_personalities = yes
		add_heir_personality = conqueror_personality
	}

	option = { #Kind-Hearted
		name = shuvuush.100.b

		add_ruler_personality = kind_hearted_personality
		clear_heir_personalities = yes
		add_heir_personality = kind_hearted_personality
	}
	
	option = { #Lawgiver
		name = shuvuush.100.c

		add_ruler_personality = lawgiver_personality
		clear_heir_personalities = yes
		add_heir_personality = lawgiver_personality
	}
	
	option = { #Bold Fighter
		name = shuvuush.100.d

		add_ruler_personality = bold_fighter_personality
		clear_heir_personalities = yes
		add_heir_personality = bold_fighter_personality
	}
	
	option = { #Inspiring Leader
		name = shuvuush.100.e

		add_ruler_personality = inspiring_leader_personality
		clear_heir_personalities = yes
		add_heir_personality = inspiring_leader_personality
	}
	
	option = { #Martial Educator
		name = shuvuush.100.f

		add_ruler_personality = martial_educator_personality
		clear_heir_personalities = yes
		add_heir_personality = martial_educator_personality
	}
}

country_event = { #The Host of Hate
	id = shuvuush.101
	title = shuvuush.101.t
	desc = shuvuush.101.d
	picture = ANGRY_MOB_eventPicture

	is_triggered_only = yes

	option = {
		name = shuvuush.101.a

		hidden_effect = { add_country_modifier = { name = wyvernheart_war_wizard_rebels_mod duration = 1 } }
		capital_scope = {
			spawn_rebels = {
				size = 3
				leader = "The Host of Facestealers"
				type = face_stealers_rebels
			}
		}
		hidden_effect = { remove_country_modifier = wyvernheart_war_wizard_rebels_mod }
	}
}

country_event = { #To Live On
	id = shuvuush.102
	title = shuvuush.102.t
	desc = shuvuush.102.d
	picture = FAT_WARRIORS_eventPicture

	is_triggered_only = yes

	option = {
		name = shuvuush.102.a

		if = {
			limit = { adm = 6 }
			add_adm_power = 50
		}
		else = { change_adm = 1 }
		if = {
			limit = { mil = 6 }
			add_mil_power = 50
		}
		else = { change_mil = 1 }

		if = {
			limit = {
				any_owned_province = {
					province_has_facestealer_trigger = yes
					NOT = { has_province_modifier = facestealer_3 }
				}
			}
			random_owned_province = {
				limit = {
					province_has_facestealer_trigger = yes
					NOT = { has_province_modifier = facestealer_3 }
				}
				subtract_facestealer_effect = yes
			}
		}
		else = { add_prestige = 25 }
	}
}

province_event = { #The Advice of the Present
	id = shuvuush.103
	title = shuvuush.103.t
	desc = shuvuush.103.d
	picture = FAT_WARRIORS_eventPicture

	is_triggered_only = yes
	trigger = {
		owner = {
			has_country_flag = shuvuush_break_realms_early
			NOT = { has_country_flag = generated_advisor_from_@ROOT }
		}
		OR = {
			province_id = 4925 #Jiantsiang
			province_id = 5353 #Gunseong
			province_id = 6811 #Saigahundhalan
		}
	}

	option = {
		name = shuvuush.103.a

		trigger_switch = {
			on_trigger = province_id

			4925 = { owner = { generate_very_specific_scaling_advisor_effect = { type = treasurer location = 4925 cost_multiplier = 0.25 culture = serene_harimari religion = high_philosophy } } }
			5353 = { owner = { generate_very_specific_scaling_advisor_effect = { type = diplomat location = 5353 cost_multiplier = 0.25 culture = wonju religion = neokttareum } } }
			6811 = { owner = { generate_very_specific_scaling_advisor_effect = { type = recruitmaster location = 6811 cost_multiplier = 0.25 culture = oinukhudi religion = un_khudai } } }
		}

		owner = { set_country_flag = generated_advisor_from_@ROOT }
	}
}


country_event = { #Facestealer rebels are lowering down!!
	id = shuvuush.997
	title = shuvuush.997.t
	desc = shuvuush.997.d
	picture = 20_Monsoon_eventPicture

	is_triggered_only = yes

	option = {
		name = shuvuush.997.a

		custom_tooltip = every_rebel_province_tt
		tooltip = { capital_scope = { add_permanent_province_modifier = { name = facestealer_aftermath duration = 1095 } } }
		
		hidden_effect = {
			every_owned_province = {
				limit = { units_in_province = REB }
				add_permanent_province_modifier = {
					name = facestealer_aftermath
					duration = 1095
				}
			}
		}
		disband_rebels = face_stealers_rebels
	}
}

province_event = { #Facestealer rebels are rising up!
	id = shuvuush.998
	title = shuvuush.998.t
	desc = shuvuush.998.d
	picture = ANGRY_MOB_eventPicture

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			subtract_facestealer_effect = yes
			face_stealers_rebels = 1

			if = { #AI needs a bit of help
				limit = { owner = { ai = yes } }
				kill_units = { who = REB amount = 3 }
			}
		}
	}

	option = {
		name = shuvuush.998.a
		tooltip = {
			subtract_facestealer_effect = yes
			face_stealers_rebels = 1
		}
		owner = { country_event = { id = shuvuush.997 days = 730 } }
	}
}

country_event = { #Facestealer rebels rise up in random provinces!
	id = shuvuush.999
	title = shuvuush.999.t
	desc = shuvuush.999.d
	picture = ANGRY_MOB_eventPicture

	is_triggered_only = yes
	hidden = yes
	
	trigger = { owns = 5214 5214 = { province_has_facestealer_trigger = yes } }

	option = {
		name = shuvuush.999.a
		
		asia = {
			limit = { province_has_facestealer_trigger = yes }
			random = { #About 1/12 of provinces
				chance = 8
				province_event = { id = shuvuush.998 }
				random_neighbor_province = { province_event = { id = shuvuush.998 } }
			}
		}

		5214 = { random_neighbor_province = { province_event = { id = shuvuush.998 } } }
	}
}

country_event = { #Hidden event to add the privilege to shuuvush
	id = shuvuush.1000
	title = shuvuush.1000.t
	desc = shuvuush.1000.d
	picture = COURT_eventPicture

	is_triggered_only = yes
	hidden = yes

	option = {
		name = shuvuush.1000.a
		set_estate_privilege = estate_nomadic_tribes_leadership_of_yomod_rush 
	}
}