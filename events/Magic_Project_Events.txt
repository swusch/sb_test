namespace = magic_project

###### This is the place for events that are related to magical projects specifically
###### Most of what's here are events fired by projects completing
###### There are also events that happen as a project is progressing
###### As well as all related handlers, of course
###### Events that happen as a direct result of having a magical project also go here


### SO YOU WANT TO ADD A MAGICAL PROJECT
# All magical projects are fundamentally three things:
### A button in the menu
### A variable
### An event chain

# Preface: the project key
### The "project key" is a fancy-sounding phrase that just means "what your project is called in code"
### For example, Magical Infrastructure has project key [infrastructure] (minus the brackets)
### And Theatre of Simulacra has project key [theatre_of_simulacra] (again, minus the brackets)
### This project key must be unique, and you will want to name everything related to the project using this project key
### And maintaining the formats set forth as precedent--it will be easier.
### Going forward, all instances of <project_key> you can mentally substitute with whatever you've named your project.

# The button in the menu:
### First, define the physical button in topbar.gui (look at template_region_projects_window)
### Most likely, if you're reading this, you're adding a single tag-specific project
### In this case, look at template_tag_project_1 and template_tag_project_1_progress
### Copy and paste each of them just below in the topbar.gui file, renamed to your liking (i.e. <project_key>_project_button)
### Then, you'll have to define what they do in custom_gui/magic_unique_projects.txt
### Likewise, you can look at the examples given here for ideas on how they work
### Look at the Lorent project if you get confused
### You can give your projects names, school icons, etc. -- remember to define these UI elements
### Finally, you might want to localise it. The important loc keys are the button for the project, and maybe the textbox for the project name if you used one
### Check the bottom of anb_magic_projects_l_english.yml if you get confused
###### Summary: make a button and define how it works, two files. Localise wherever you like

# The variable:
### There's no getting away from the fact that all projects are, behind the code, a variable named <project_key>_level
### Remember to localise this variable!
### This variable is what ticks up whenever your project "finishes" (using the magic_project_level_up effect)
### It will be the best way for you to distinguish between the levels of your project
### You can do something special: Lichdom is special, for example. But Lichdom was also a pain in the ass to code.
### (Offhand: remember that the variable is ticked up first, and then the finishing event is fired)

# The event chain:
### Every project, delivered to the player, is fundamentally an event chain
### In this sense, it is flexible--it could have any number of intermediary events, it could or could not have a starting event
### The base projects give a good sense of what sort of varied ideas can be expressed through the magic projects
### However, the backend is less flexible: each project must have a namespace, magic_project_<project_key>
### Furthermore, each project should have a handler event magic_project_<project_key>.0 which sorts players into the right event
### There are also a number of conventions you should follow:
###### Since the variable is ticked up before an event is completed, and you cannot count on most flags to stay around, use the presence of magic_project_completed_flag in the handler to tell you when a project has been completed
###### Add and clear in_magic_progress_event flag with your events (this prevents cheesing via abort button)
###### All your event titles should be prefaced with the name of the project, so that players know why they're receiving the event
### Remember to modify magic_system.100 so that players actually receive advancement events
### If you want your project to count for magical infrastructure requirements, change calc_completed_magic_projects
### Remember to clear your progress flags/modifiers in magic_advancement_abort_all_effect


country_event = { #clears the completion flag so that you can use it in the event handler
	id = magic_project.1
	title = magic_project.1.t
	desc = magic_project.1.d
	picture = ANGRY_MOB_eventPicture

	is_triggered_only = yes
	hidden = yes

	option = {
		name = magic_project.1.a
		ai_chance = { factor = 1 }

		clr_country_flag = magic_project_completed_flag
	}
}

country_event = { #Error code 404: project upgrade not found
	id = magic_project.404
	title = magic_project.404.t
	desc = magic_project.404.d
	picture = OVEREXTENSION_eventPicture

	is_triggered_only = yes

	option = {
		name = magic_project.404.a
		ai_chance = { factor = 1 }

		add_splendor = -1
	}
}

##############################
### MAGICAL INFRASTRUCTURE ###
##############################
# A special project - random event similar to study

namespace = magic_project_infrastructure

country_event = { #Magical Infrastructure
	id = magic_project_infrastructure.0
	title = magic_project_infrastructure.0.t
	desc = magic_project_infrastructure.0.d
	picture = MAGE_MOON_eventPicture

	is_triggered_only = yes
	hidden = yes

	trigger = { NOT = { has_country_modifier = magic_progress_pulse_cd } }
	immediate = { set_country_flag = in_magic_progress_event }

	after = {
		random_list = {
			1 = { add_country_modifier = { name = magic_progress_pulse_cd duration = 180 hidden = yes } }
			1 = { add_country_modifier = { name = magic_progress_pulse_cd duration = 211 hidden = yes } }
			1 = { add_country_modifier = { name = magic_progress_pulse_cd duration = 239 hidden = yes } }
			1 = { add_country_modifier = { name = magic_progress_pulse_cd duration = 270 hidden = yes } }
			1 = { add_country_modifier = { name = magic_progress_pulse_cd duration = 300 hidden = yes } }
			1 = { add_country_modifier = { name = magic_progress_pulse_cd duration = 331 hidden = yes } }
			1 = { add_country_modifier = { name = magic_progress_pulse_cd duration = 361 hidden = yes } }
			1 = { add_country_modifier = { name = magic_progress_pulse_cd duration = 392 hidden = yes } }
			1 = { add_country_modifier = { name = magic_progress_pulse_cd duration = 423 hidden = yes } }
			1 = { add_country_modifier = { name = magic_progress_pulse_cd duration = 453 hidden = yes } }
			1 = { add_country_modifier = { name = magic_progress_pulse_cd duration = 484 hidden = yes } }
			1 = { add_country_modifier = { name = magic_progress_pulse_cd duration = 514 hidden = yes } }
			1 = { add_country_modifier = { name = magic_progress_pulse_cd duration = 545 hidden = yes } }
		}
	}

	option = { #do nothing, denominator of 20 years (ai chance of 1 = MTTH of 20 years)
		name = magic_project_infrastructure.0.a
		ai_chance = { factor = 24 }

		clr_country_flag = in_magic_progress_event
	}

	option = { #Cracks in the Tower
		name = magic_project_infrastructure.100.t
		trigger = {
			mage_tower = 1
			NOT = { has_country_flag = magical_infrastructure_hurt_tower }
			NOT = { has_country_modifier = magical_infrastructure_mana_leak }
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0.75
				has_estate_privilege = estate_mages_development_of_mage_towers
			}
			modifier = {
				factor = 0.75
				ruler_has_personality = obsessive_perfectionist_personality
			}
		}
		country_event = { id = magic_project_infrastructure.100 }
	}

	option = { #Overflowing Ley Line
		name = magic_project_infrastructure.101.t
		trigger = {
			mage_tower = 1
			NOT = { has_country_flag = magical_infrastructure_help_tower }
			NOT = { has_country_modifier = magical_infrastructure_mana_flood }
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 1.25
				has_estate_privilege = estate_mages_development_of_mage_towers
			}
			modifier = {
				factor = 0.75
				NOT = { mage_tower = 10 }
			}
		}
		country_event = { id = magic_project_infrastructure.101 }
	}

	option = { #Failing Magical Wards
		name = magic_project_infrastructure.102.t
		trigger = {
			is_overall_abjuration_level_1_minimum = yes
			NOT = { has_country_flag = magical_infrastructure_help_ward }
			NOT = { has_country_modifier = magical_infrastructure_wards_failing }
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 1.5
				is_overall_abjuration_level_2_minimum = yes
			}
		}
		country_event = { id = magic_project_infrastructure.102 }
	}

	option = { #The Debate of the Schools
		name = magic_project_infrastructure.103.t
		trigger = {
			check_variable = { country_spell_schools = 2 }
			calc_true_if = {
				amount = 2
				is_estate_abjuration_level_1_minimum = yes
				is_estate_conjuration_level_1_minimum = yes
				is_estate_divination_level_1_minimum = yes
				is_estate_enchantment_level_1_minimum = yes
				is_estate_evocation_level_1_minimum = yes
				is_estate_illusion_level_1_minimum = yes
				is_estate_necromancy_level_1_minimum = yes
				is_estate_transmutation_level_1_minimum = yes
			}
			NOT = { has_country_flag = magical_infrastructure_help_school }
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 1.5
				ruler_has_personality = scholar_personality
			}
		}
		country_event = { id = magic_project_infrastructure.103 }
	}

	option = { #Mages and the State
		name = magic_project_infrastructure.104.t
		trigger = {
			court_mage = 2
			NOT = {
				has_government_attribute = is_magocracy
				has_country_flag = magical_infrastructure_help_court_mage
			}
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 1.5
				court_mage = 4
			}
		}
		country_event = { id = magic_project_infrastructure.104 }
	}

	option = { #Magical Trade
		name = magic_project_infrastructure.105.t
		trigger = {
			trade_income_percentage = 0.3
			NOT = {
				has_country_modifier = magical_infrastructure_regulated_magic
				has_country_modifier = magical_infrastructure_regulated_trade
				has_country_modifier = magical_infrastructure_free_trade
				has_country_flag = magical_infrastructure_help_trade
			}
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 1.5
				inflation = 2
			}
		}
		country_event = { id = magic_project_infrastructure.105 }
	}

	option = { #War Magic
		name = magic_project_infrastructure.106.t
		trigger = {
			army_size_percentage = 0.8
			NOT = {
				has_country_modifier = magical_infrastructure_no_war_magic
				has_country_modifier = magical_infrastructure_war_magic
				has_country_flag = magical_infrastructure_help_war
			}
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 1.5
				is_at_war = yes
			}
		}
		country_event = { id = magic_project_infrastructure.106 }
	}

	option = { #The Search for Magic Artifacts
		name = magic_project_infrastructure.107.t
		trigger = {
			precursor_relics = 1
			NOT = {
				has_country_modifier = magical_infrastructure_trade_goods_cooldown
				has_country_flag = magical_infrastructure_help_relics
			}
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 1.5
				precursor_relics = 3
			}
			modifier = {
				factor = 1.5
				trading_bonus = { trade_goods = precursor_relics value = yes }
			}
		}
		country_event = { id = magic_project_infrastructure.107 }
	}

	option = { #Outlaw Mages
		name = magic_project_infrastructure.108.t
		trigger = {
			mage_tower = 1
			NOT = { has_country_flag = magical_infrastructure_help_outlaw }
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 1.5
				mage_tower = 10
			}
		}
		country_event = { id = magic_project_infrastructure.108 }
	}

	option = { #Damestear Drought
		name = magic_project_infrastructure.109.t
		trigger = {
			damestear = 1
			NOT = {
				has_country_modifier = magical_infrastructure_magical_consequences
				has_country_modifier = magical_infrastructure_trade_goods_cooldown
				has_country_flag = magical_infrastructure_help_damestear
			}
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 1.5
				damestear = 3
			}
			modifier = {
				factor = 1.5
				trading_bonus = { trade_goods = damestear value = yes }
			}
		}
		country_event = { id = magic_project_infrastructure.109 }
	}

	option = { #Mages and the Clergy
		name = magic_project_infrastructure.110.t
		trigger = {
			has_estate = estate_mages
			has_estate = estate_clergy
			estate_influence = { estate = estate_mages influence = 40 }
			NOT = { has_estate_privilege = estate_mages_organization_religious }
			NOT = { has_country_flag = magical_infrastructure_help_clergy }
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 1.5
				estate_influence = { estate = estate_mages influence = 80 }
			}
		}
		country_event = { id = magic_project_infrastructure.110 }
	}

	option = { #Magical Roads and Bridges
		name = magic_project_infrastructure.111.t
		trigger = {
			years_of_income = 0.5
			NOT = { has_country_flag = magical_infrastructure_help_roads }
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 1.5
				has_idea_group = infrastructure_ideas
			}
		}
		country_event = { id = magic_project_infrastructure.111 }
	}

	option = { #Magical Scandal
		name = magic_project_infrastructure.112.t
		trigger = {
			court_mage = 2
			NOT = { has_country_flag = magical_infrastructure_help_corruption }
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 1.5
				corruption = 1
			}
		}
		country_event = { id = magic_project_infrastructure.112 }
	}

	option = { #Citizen Outcry
		name = magic_project_infrastructure.113.t
		trigger = {
			NOT = { has_country_flag = vacyntassi_jaherian_statute_flag }
			NOT = { has_country_flag = magical_infrastructure_hurt_outcry }
		}
		ai_chance = {
			factor = 0.8
			modifier = {
				factor = 1.5
				average_home_autonomy = 20
			}
		}
		country_event = { id = magic_project_infrastructure.113 }
	}

	option = { #Magical Negligence
		name = magic_project_infrastructure.114.t
		trigger = {
			NOT = { has_country_flag = vacyntassi_jaherian_statute_flag }
			NOT = { has_country_flag = magical_infrastructure_hurt_negligence }
		}
		ai_chance = {
			factor = 0.8
			modifier = {
				factor = 1.5
				average_unrest = 1
			}
		}
		country_event = { id = magic_project_infrastructure.114 }
	}

	option = { #Administrative Issues
		name = magic_project_infrastructure.115.t
		trigger = {
			NOT = { has_country_flag = vacyntassi_jaherian_statute_flag }
			NOT = { has_country_flag = magical_infrastructure_hurt_administrative }
		}
		ai_chance = {
			factor = 0.8
			modifier = {
				factor = 1.5
				overextension_percentage = 0.75
			}
		}
		country_event = { id = magic_project_infrastructure.115 }
	}
}

country_event = { #Magical Infrastructure finishing event
	id = magic_project_infrastructure.1
	title = magic_project_infrastructure.1.t
	desc = magic_project_infrastructure.1.d
	picture = MAGE_MOON_eventPicture

	is_triggered_only = yes

	option = {
		name = magic_project_infrastructure.1.a
		ai_chance = { factor = 1 }

		magical_infrastructure_level_up = yes
	}
}

country_event = { #Cracks in the Tower
	id = magic_project_infrastructure.100
	title = magic_project_infrastructure.100.t
	desc = magic_project_infrastructure.100.d
	picture = CHURCH_ESTATE_UPSET_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = magical_infrastructure_hurt_tower }
	after = { clr_country_flag = in_magic_progress_event }

	option = { #Fix the Cracks
		name = magic_project_infrastructure.100.a

		increase_magic_experience = { unmodified_amount = -25 }
		add_years_of_income = -0.1
	}

	option = { #Continue As Scheduled
		name = magic_project_infrastructure.100.b

		add_country_modifier = { name = magical_infrastructure_mana_leak duration = 3650 }
	}
}

country_event = { #Overflowing Ley Line
	id = magic_project_infrastructure.101
	title = magic_project_infrastructure.101.t
	desc = magic_project_infrastructure.101.d
	picture = MAGE_MOON_ALTER_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = magical_infrastructure_help_tower }
	after = { clr_country_flag = in_magic_progress_event }

	option = { #Empower Spells
		name = magic_project_infrastructure.101.a

		add_country_modifier = { name = magical_infrastructure_mana_flood duration = 7300 }
	}

	option = { #Continue Building
		name = magic_project_infrastructure.101.b

		increase_magic_experience = { amount = 25 }
	}
}

country_event = { #Shoring Up the Wards
	id = magic_project_infrastructure.102
	title = magic_project_infrastructure.102.t
	desc = magic_project_infrastructure.102.d
	picture = indiangfx_SIEGE_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = magical_infrastructure_help_ward }
	after = { clr_country_flag = in_magic_progress_event }

	option = { #Keep Renewing Wards
		name = magic_project_infrastructure.102.a
	}

	option = { #Continue Building
		name = magic_project_infrastructure.102.b

		increase_magic_experience = { amount = 25 }
		add_country_modifier = { name = magical_infrastructure_wards_failing duration = 7300 }
		custom_tooltip = magical_infrastructure_wards_failing_desc
	}
}

country_event = { #The Debate of the Schools
	id = magic_project_infrastructure.103
	title = magic_project_infrastructure.103.t
	desc = magic_project_infrastructure.103.desc
	picture = MAGES_ESTATE_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = magical_infrastructure_help_school }
	after = { clr_country_flag = in_magic_progress_event }

	option = { #Abjuration
		name = magic_project_infrastructure.103.a
		trigger = { is_estate_abjuration_level_1_minimum = yes }
		highlight = yes

		make_spell_school_half_off = { school = abjuration next_cast = yes }
	}

	option = { #Conjuration
		name = magic_project_infrastructure.103.b
		trigger = { is_estate_conjuration_level_1_minimum = yes }
		highlight = yes

		make_spell_school_half_off = { school = conjuration next_cast = yes }
	}

	option = { #Divination
		name = magic_project_infrastructure.103.c
		trigger = { is_estate_divination_level_1_minimum = yes }
		highlight = yes

		make_spell_school_half_off = { school = divination next_cast = yes }
	}

	option = { #Enchantment
		name = magic_project_infrastructure.103.d
		trigger = { is_estate_enchantment_level_1_minimum = yes }
		highlight = yes

		make_spell_school_half_off = { school = enchantment next_cast = yes }
	}

	option = { #Evocation
		name = magic_project_infrastructure.103.e
		trigger = { is_estate_evocation_level_1_minimum = yes }
		highlight = yes

		make_spell_school_half_off = { school = evocation next_cast = yes }
	}

	option = { #Illusion
		name = magic_project_infrastructure.103.f
		trigger = { is_estate_illusion_level_1_minimum = yes }
		highlight = yes

		make_spell_school_half_off = { school = illusion next_cast = yes }
	}

	option = { #Necromancy
		name = magic_project_infrastructure.103.g
		trigger = { is_estate_necromancy_level_1_minimum = yes }
		highlight = yes

		make_spell_school_half_off = { school = necromancy next_cast = yes }
	}

	option = { #Transmutation
		name = magic_project_infrastructure.103.h
		trigger = { is_estate_transmutation_level_1_minimum = yes }
		highlight = yes

		make_spell_school_half_off = { school = transmutation next_cast = yes }
	}
}

country_event = { #Mages and the State
	id = magic_project_infrastructure.104
	title = magic_project_infrastructure.104.t
	desc = magic_project_infrastructure.104.d
	picture = PROTESTANT_CATHOLIC_DEBATE_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = magical_infrastructure_help_court_mage }
	after = { clr_country_flag = in_magic_progress_event }

	option = { #Keep Mages Out
		name = magic_project_infrastructure.104.a

		kill_advisor = court_mage
	}

	option = { #Give Mages Power
		name = magic_project_infrastructure.104.b

		increase_magic_experience = { amount = 25 }
		add_corruption = 1
	}

	option = { #Refuse to do anything
		name = magic_project_infrastructure.104.c

		add_prestige = -5
		add_legitimacy_equivalent = { amount = 5 republican_tradition = 2 }
	}
}

country_event = { #Magical Trade
	id = magic_project_infrastructure.105
	title = magic_project_infrastructure.105.t
	desc = magic_project_infrastructure.105.d
	picture = TRADEGOODS_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = magical_infrastructure_help_trade }
	after = { clr_country_flag = in_magic_progress_event }

	option = { #Regulate Magic, Boost Trade
		name = magic_project_infrastructure.105.a

		add_dip_power = -20
		add_country_modifier = { name = magical_infrastructure_regulated_magic duration = 7300 }
	}

	option = { #Regulate Trade, Boost Magic
		name = magic_project_infrastructure.105.b

		add_adm_power = -20
		add_country_modifier = { name = magical_infrastructure_regulated_trade duration = 7300 }
	}

	option = { #I don't care
		name = magic_project_infrastructure.105.c

		add_inflation = 1
		add_country_modifier = { name = magical_infrastructure_free_trade duration = 7300 }
	}
}

country_event = { #Magic in Warfare
	id = magic_project_infrastructure.106
	title = magic_project_infrastructure.106.t
	desc = magic_project_infrastructure.106.d
	picture = FIREBALL_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = magical_infrastructure_help_war }
	after = { clr_country_flag = in_magic_progress_event }

	option = { #Witch-King (bad)
		name = magic_project_infrastructure.106.a

		add_country_modifier = { name = magical_infrastructure_no_war_magic duration = 7300 }
		custom_tooltip = magical_infrastructure_no_war_magic_desc
	}

	option = { #We can spare some time...
		name = magic_project_infrastructure.106.b

		add_mil_power = -20
		add_country_modifier = { name = magical_infrastructure_war_magic duration = 7300 }
	}

	option = { #Witch-King (good)
		name = magic_project_infrastructure.106.c
		trigger = { ruler_is_witch_king = yes }
		highlight = yes

		add_country_modifier = { name = magical_infrastructure_war_magic duration = 7300 }
	}
}

country_event = { #The Search for Magic Artifacts
	id = magic_project_infrastructure.107
	title = magic_project_infrastructure.107.t
	desc = magic_project_infrastructure.107.d
	picture = GENIE_RUINS_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = magical_infrastructure_help_relics }
	after = { clr_country_flag = in_magic_progress_event }

	option = { #Can't spare it
		name = magic_project_infrastructure.107.a

		increase_magic_experience = { unmodified_amount = -25 }
	}

	option = { #We can spare some relics
		name = magic_project_infrastructure.107.b

		every_owned_province = {
			limit = { trade_goods = precursor_relics }
			add_province_modifier = { name = magical_infrastructure_lost_trade_goods_small duration = 7300 }
		}
		add_country_modifier = { name = magical_infrastructure_trade_goods_cooldown duration = 7300 hidden = yes }
	}

	option = { #We can spare a lot of relics
		name = magic_project_infrastructure.107.c

		increase_magic_experience = { amount = 25 }
		every_owned_province = {
			limit = { trade_goods = precursor_relics }
			add_province_modifier = { name = magical_infrastructure_lost_trade_goods_big duration = 7300 }
		}
		add_country_modifier = { name = magical_infrastructure_trade_goods_cooldown duration = 7300 hidden = yes }
	}
}

country_event = { #Outlaw Mages
	id = magic_project_infrastructure.108
	title = magic_project_infrastructure.108.t
	desc = magic_project_infrastructure.108.d
	picture = GUARDED_TREASURE_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = magical_infrastructure_help_outlaw }
	after = { clr_country_flag = in_magic_progress_event }

	option = { #Secure the mages
		name = magic_project_infrastructure.108.a

		add_stability_or_adm_power = yes
		increase_magic_experience = { unmodified_amount = -25 }
	}

	option = { #We can spare some trade goods
		name = magic_project_infrastructure.108.b

		increase_magic_experience = { amount = 25 }
		custom_tooltip = every_mage_tower_tt
		tooltip = { capital_scope = { add_unrest = 5 } }
		hidden_effect = {
			every_owned_province = {
				limit = { has_building = mage_tower }
				add_unrest = 5
			}
		}
	}
}

country_event = { #Damestear Drought
	id = magic_project_infrastructure.109
	title = magic_project_infrastructure.109.t
	desc = magic_project_infrastructure.109.d
	picture = BANKRUPTCY_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = magical_infrastructure_help_damestear }
	after = { clr_country_flag = in_magic_progress_event }

	option = { #Can't spare it
		name = magic_project_infrastructure.107.a

		add_country_modifier = { name = magical_infrastructure_magical_consequences duration = 3650 }
	}

	option = { #We can spare some damestear
		name = magic_project_infrastructure.107.b

		every_owned_province = {
			limit = { trade_goods = damestear }
			add_province_modifier = { name = magical_infrastructure_lost_trade_goods_small duration = 7300 }
		}
		add_country_modifier = { name = magical_infrastructure_trade_goods_cooldown duration = 7300 hidden = yes }
	}

	option = { #We can spare a lot of damestear
		name = magic_project_infrastructure.107.c

		increase_magic_experience = { amount = 25 }
		every_owned_province = {
			limit = { trade_goods = damestear }
			add_province_modifier = { name = magical_infrastructure_lost_trade_goods_big duration = 7300 }
		}
		add_country_modifier = { name = magical_infrastructure_trade_goods_cooldown duration = 7300 hidden = yes }
	}
}

country_event = { #Mages and the Clergy
	id = magic_project_infrastructure.110
	title = magic_project_infrastructure.110.t
	desc = magic_project_infrastructure.110.d
	picture = PIETY_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = magical_infrastructure_help_clergy }
	after = { clr_country_flag = in_magic_progress_event }

	option = { #Empower the Clergy
		name = magic_project_infrastructure.110.a

		add_estate_loyalty = { estate = estate_mages loyalty = -20 }
		set_estate_privilege = estate_mages_organization_religious
	}

	option = { #Empower the Mages
		name = magic_project_infrastructure.110.b

		add_estate_loyalty = { estate = estate_clergy loyalty = -20 }
		increase_magic_experience = { amount = 25 }
	}
}

country_event = { #Magical Roads and Bridges
	id = magic_project_infrastructure.111
	title = magic_project_infrastructure.111.t
	desc = magic_project_infrastructure.111.d
	picture = CITY_DEVELOPMENT_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = magical_infrastructure_help_roads }
	after = { clr_country_flag = in_magic_progress_event }

	option = { #Better Not
		name = magic_project_infrastructure.111.a
		add_estate_loyalty = { estate = estate_mages loyalty = -5 }
	}

	option = { #Let's Do It!
		name = magic_project_infrastructure.111.b

		add_years_of_income = -0.33
		increase_magic_experience = { amount = 25 }
	}
}

country_event = { #Magical Scandal
	id = magic_project_infrastructure.112
	title = magic_project_infrastructure.112.t
	desc = magic_project_infrastructure.112.d
	picture = CORRUPTION_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = magical_infrastructure_help_corruption }
	after = { clr_country_flag = in_magic_progress_event }

	option = { #Bury the Report
		name = magic_project_infrastructure.112.a
		add_corruption = 0.5
	}

	option = { #Seize Their Assets
		name = magic_project_infrastructure.112.b

		kill_advisor = court_mage
		capital_scope = { add_unrest = 10 }
		increase_magic_experience = { amount = 25 }
	}
}

country_event = { #Citizen Outcry
	id = magic_project_infrastructure.113
	title = magic_project_infrastructure.113.t
	desc = magic_project_infrastructure.113.d
	picture = ANGRY_MOB_eventPicture

	is_triggered_only = yes
	after = { clr_country_flag = in_magic_progress_event }

	option = { #Who Cares
		name = magic_project_infrastructure.113.a
		trigger = { has_estate_privilege = estate_mages_reduced_research_regulations }
		highlight = yes

		increase_estate_witch_king_points = { size = small }
		capital_scope = { add_devastation = 10 }
		set_country_flag = magical_infrastructure_hurt_outcry
	}

	option = { #I Care
		name = magic_project_infrastructure.113.b

		decrease_estate_witch_king_points = { size = small }
		increase_magic_experience = { unmodified_amount = -25 }
		if = {
			limit = { NOT = { has_estate_privilege = estate_mages_reduced_research_regulations } }
			custom_tooltip = unregulated_research_tt
		}
	}
}

country_event = { #Magical Negligence (Whistleblower)
	id = magic_project_infrastructure.114
	title = magic_project_infrastructure.114.t
	desc = magic_project_infrastructure.114.d
	picture = BONFIRE_OF_THE_VANITIES_eventPicture

	is_triggered_only = yes
	after = { clr_country_flag = in_magic_progress_event }

	option = { #Kill them
		name = magic_project_infrastructure.114.a
		trigger = { has_estate_privilege = estate_mages_reduced_research_regulations }
		highlight = yes

		increase_estate_witch_king_points = { size = medium }
		add_manpower = -0.001
		set_country_flag = magical_infrastructure_hurt_negligence
	}

	option = { #Let it ride
		name = magic_project_infrastructure.114.b

		decrease_estate_witch_king_points = { size = small }
		increase_magic_experience = { unmodified_amount = -25 }
		if = {
			limit = { NOT = { has_estate_privilege = estate_mages_reduced_research_regulations } }
			custom_tooltip = unregulated_research_tt
		}
	}
}

country_event = { #Administrative Issues
	id = magic_project_infrastructure.115
	title = magic_project_infrastructure.115.t
	desc = magic_project_infrastructure.115.d
	picture = RIOTING_workers_eventPicture

	is_triggered_only = yes
	after = { clr_country_flag = in_magic_progress_event }

	option = { #Let the riots continue
		name = magic_project_infrastructure.115.a
		trigger = { has_estate_privilege = estate_mages_reduced_research_regulations }
		highlight = yes

		increase_estate_witch_king_points = { size = small }
		capital_scope = { add_unrest = 10 }
		set_country_flag = magical_infrastructure_hurt_administrative
	}

	option = { #Try to appease the luddites
		name = magic_project_infrastructure.115.b

		decrease_estate_witch_king_points = { size = small }
		increase_magic_experience = { unmodified_amount = -25 }
		if = {
			limit = { NOT = { has_estate_privilege = estate_mages_reduced_research_regulations } }
			custom_tooltip = unregulated_research_tt
		}
	}
}

########################
### MAGICAL FORTRESS ###
########################
# 1 - Survey the Land
# 2 - Gather Supplies
# 3 - Make a Decision
# 4 - Complete Foundation
# 5 - Plan the Palace
# 6 - Losing Sleep
# 7 - Make a Decision
# 8 - Complete Castle
# 9 - Gather Casters
# 10 - Palace Close to Completion
# 11 - Make a Decision
# 12 - Complete Palace

namespace = magic_project_magical_fortress

country_event = { #Magical Fortress event handler
	id = magic_project_magical_fortress.0
	title = magic_project_magical_fortress.0.t
	desc = magic_project_magical_fortress.0.d
	picture = ANGRY_MOB_eventPicture

	is_triggered_only = yes
	hidden = yes

	option = {
		name = magic_project_magical_fortress.0.a
		ai_chance = { factor = 1 }

		if = {
			limit = { has_country_flag = magic_project_completed_flag }
			if = {
				limit = { at_least_magic_project_level = { project = magical_fortress level = 3 } }
				country_event = { id = magic_project_magical_fortress.12 }
			}
			else_if = {
				limit = { at_least_magic_project_level = { project = magical_fortress level = 2 } }
				country_event = { id = magic_project_magical_fortress.8 }
			}
			else = {
				country_event = { id = magic_project_magical_fortress.4 }
			}
		}
		else_if = {
			limit = {
				check_variable = { current_experience_percent = 33 }
				NOT = { has_country_flag = magic_project_first_event_happened }
			}
			set_country_flag = magic_project_first_event_happened
			if = {
				limit = { at_least_magic_project_level = { project = magical_fortress level = 2 } }
				country_event = { id = magic_project_magical_fortress.10 }
			}
			else_if = {
				limit = { at_least_magic_project_level = { project = magical_fortress level = 1 } }
				country_event = { id = magic_project_magical_fortress.6 }
			}
			else = {
				country_event = { id = magic_project_magical_fortress.2 }
			}
		}
		else_if = {
			limit = {
				check_variable = { current_experience_percent = 67 }
				NOT = { has_country_flag = magic_project_second_event_happened }
			}
			set_country_flag = magic_project_second_event_happened
			if = {
				limit = { at_least_magic_project_level = { project = magical_fortress level = 2 } }
				country_event = { id = magic_project_magical_fortress.11 }
			}
			else_if = {
				limit = { at_least_magic_project_level = { project = magical_fortress level = 1 } }
				country_event = { id = magic_project_magical_fortress.7 }
			}
			else = {
				country_event = { id = magic_project_magical_fortress.3 }
			}
		}
	}
}

country_event = { #Magical Fortress 1 - Survey the Land
	id = magic_project_magical_fortress.1
	title = magic_project_magical_fortress.1.t
	desc = magic_project_magical_fortress.1.d
	picture = USA_EXPLORERS_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = in_magic_progress_event }
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_magical_fortress.1.a
		ai_chance = { factor = 1 }

		add_country_modifier = { name = studying_magical_fortress_mod duration = -1 desc = until_advancement_concludes }
	}
}

country_event = { #Magical Fortress 2 - Gather Supplies
	id = magic_project_magical_fortress.2
	title = magic_project_magical_fortress.2.t
	desc = magic_project_magical_fortress.2.d
	picture = CITY_DEVELOPMENT_eventPicture

	is_triggered_only = yes
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_magical_fortress.2.a
		ai_chance = { factor = 1 }

		magical_fortress_suffer_setback = { amount = -25 effect = "add_prestige = 10" }
	}
}

country_event = { #Magical Fortress 3 - Make a Decision
	id = magic_project_magical_fortress.3
	title = magic_project_magical_fortress.3.t
	desc = magic_project_magical_fortress.3.d
	picture = MAGES_ESTATE_MAD_eventPicture

	is_triggered_only = yes
	immediate = { clr_country_flag = magic_project_picked_setback_option }
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_magical_fortress.3.a
		ai_chance = { factor = 1 }

	}

	option = {
		name = magic_project_magical_fortress.3.b
		ai_chance = { factor = 1 }

		magical_fortress_suffer_setback = { amount = -25 mod = prestige }
	}
}

country_event = { #Magical Fortress 4 - Complete Foundation
	id = magic_project_magical_fortress.4
	title = magic_project_magical_fortress.4.t
	desc = magic_project_magical_fortress.4.d
	picture = indiangfx_SIEGE_eventPicture

	is_triggered_only = yes

	option = {
		name = magic_project_magical_fortress.4.a
		ai_chance = { factor = 1 }

		custom_tooltip = magical_fortress_project_effect_1
		capital_scope = {
			add_province_modifier = { name = magical_fortress_mod_1 duration = -1 }
			add_province_modifier = { name = abjuration_1_ward_mod_1 duration = -1 }
		}
		magical_fortress_grant_bonus = { mod = prestige }
		add_prestige = 10
		custom_tooltip = tooltip_magic_project_advance
	}
}

country_event = { #Magical Fortress 5 - Plan the Palace
	id = magic_project_magical_fortress.5
	title = magic_project_magical_fortress.5.t
	desc = magic_project_magical_fortress.5.d
	picture = BYZ_COURT_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = in_magic_progress_event }
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_magical_fortress.5.a
		ai_chance = { factor = 1 }

		add_country_modifier = { name = studying_magical_fortress_mod duration = -1 desc = until_advancement_concludes }
	}
}

country_event = { #Magical Fortress 6 - Losing Sleep
	id = magic_project_magical_fortress.6
	title = magic_project_magical_fortress.6.t
	desc = magic_project_magical_fortress.6.d
	picture = KING_SICK_IN_BED_eventPicture

	is_triggered_only = yes
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_magical_fortress.6.a
		ai_chance = { factor = 1 }

		magical_fortress_suffer_setback = { amount = -50 effect = "add_splendor = 50" }
	}
}

country_event = { #Magical Fortress 7 - Make a Decision
	id = magic_project_magical_fortress.7
	title = magic_project_magical_fortress.7.t
	desc = magic_project_magical_fortress.7.d
	picture = MAGES_ESTATE_MAD_eventPicture

	is_triggered_only = yes
	immediate = { clr_country_flag = magic_project_picked_setback_option }
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_magical_fortress.7.a
		ai_chance = { factor = 1 }

	}

	option = {
		name = magic_project_magical_fortress.7.b
		ai_chance = { factor = 1 }

		magical_fortress_suffer_setback = { amount = -50 mod = splendor }
	}
}

country_event = { #Magical Fortress 8 - Complete Castle
	id = magic_project_magical_fortress.8
	title = magic_project_magical_fortress.8.t
	desc = magic_project_magical_fortress.8.d
	picture = indiangfx_CITY_VIEW_eventPicture

	is_triggered_only = yes

	option = {
		name = magic_project_magical_fortress.8.a
		ai_chance = { factor = 1 }

		custom_tooltip = magical_fortress_project_effect_2
		capital_scope = {
			remove_province_modifier = magical_fortress_mod_1
			remove_province_modifier = abjuration_1_ward_mod_1
			add_province_modifier = { name = magical_fortress_mod_2 duration = -1 }
			add_province_modifier = { name = abjuration_1_ward_mod_2 duration = -1 }
			hidden_effect = { province_event = { id = kheionai.2 } }
		}
		
		magical_fortress_grant_bonus = { mod = splendor }
		add_splendor = 50
		custom_tooltip = tooltip_magic_project_advance
	}
}


country_event = { #Magical Fortress 9 - Gather Casters
	id = magic_project_magical_fortress.9
	title = magic_project_magical_fortress.9.t
	desc = magic_project_magical_fortress.9.d
	picture = muslimgfx_PILGRIMAGE_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = in_magic_progress_event }
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_magical_fortress.9.a
		ai_chance = { factor = 1 }

		add_country_modifier = { name = studying_magical_fortress_mod duration = -1 desc = until_advancement_concludes }
	}
}

country_event = { #Magical Fortress 10 - Palace Close to Completion
	id = magic_project_magical_fortress.10
	title = magic_project_magical_fortress.10.t
	desc = magic_project_magical_fortress.10.d
	picture = MAGIC_STUDY_AND_RELAX_eventPicture

	is_triggered_only = yes
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_magical_fortress.10.a
		ai_chance = { factor = 1 }

		magical_fortress_suffer_setback = { amount = -75 effect = "change_variable = { currentMana = 50 }" }
	}
}

country_event = { #Magical Fortress 11 - Make a Decision
	id = magic_project_magical_fortress.11
	title = magic_project_magical_fortress.11.t
	desc = magic_project_magical_fortress.11.d
	picture = MAGES_ESTATE_MAD_eventPicture

	is_triggered_only = yes
	immediate = { clr_country_flag = magic_project_picked_setback_option }
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_magical_fortress.11.a
		ai_chance = { factor = 1 }

	}

	option = {
		name = magic_project_magical_fortress.7.b
		ai_chance = { factor = 1 }

		magical_fortress_suffer_setback = { amount = -75 mod = mana_regen }
	}
}

country_event = { #Magical Fortress 12 - Complete Palace
	id = magic_project_magical_fortress.12
	title = magic_project_magical_fortress.12.t
	desc = magic_project_magical_fortress.12.d
	picture = KREMLIN_eventPicture

	is_triggered_only = yes

	option = {
		name = magic_project_magical_fortress.12.a
		ai_chance = { factor = 1 }

		custom_tooltip = magical_fortress_project_effect_3
		capital_scope = {
			remove_province_modifier = magical_fortress_mod_2
			remove_province_modifier = abjuration_1_ward_mod_2
			add_province_modifier = { name = magical_fortress_mod_3 duration = -1 }
			add_province_modifier = { name = abjuration_1_ward_mod_3 duration = -1 }
		}
		magical_fortress_grant_bonus = { mod = mana_regen }
		change_mana = { amount = 50 }
		custom_tooltip = tooltip_magic_project_complete
	}
}

###########################
### SUMMON EXTRAPLANARS ###
###########################
# Summon Extraplanars 1 - Academic 1 (Letter arrives)
# Summon Extraplanars 2 - Academic 2 (Occult meeting)
# Summon Extraplanars 3 - Academic 3 (Description of blind-writing)
# Summon Extraplanars 4 - Academic 4 (The Beckoning)
# Summon Extraplanars 5 - Mercenary 1 (Letter arrives)
# Summon Extraplanars 6 - Mercenary 2 (Uncovering what happened)
# Summon Extraplanars 7 - Mercenary 3 (Preparing for the expedition)
# Summon Extraplanars 8 - Mercenary 4 (The Corruption)
# Summon Extraplanars 9 - Prodigy 1 (Letter arrives)
# Summon Extraplanars 10 - Prodigy 2 (The Bridge)
# Summon Extraplanars 11 - Prodigy 3 (The Tower)
# Summon Extraplanars 12 - Prodigy 4 (The One-Many)

namespace = magic_project_summon_extraplanars

country_event = { # Summon Extraplanars Event Handler
	id = magic_project_summon_extraplanars.0
	title = magic_project_summon_extraplanars.0.t
	desc = magic_project_summon_extraplanars.0.d
	picture = ANGRY_MOB_eventPicture

	is_triggered_only = yes
	hidden = yes

	option = {
		name = magic_project_summon_extraplanars.0.a
		ai_chance = { factor = 1 }

		if = {
			limit = { has_country_flag = magic_project_completed_flag }
			if = {
				limit = { at_least_magic_project_level = { project = summon_extraplanars level = 3 } }
				country_event = { id = magic_project_summon_extraplanars.12 }
			}
			else_if = {
				limit = { at_least_magic_project_level = { project = summon_extraplanars level = 2 } }
				country_event = { id = magic_project_summon_extraplanars.8 }
			}
			else = {
				country_event = { id = magic_project_summon_extraplanars.4 }
			}
		}
		else_if = {
			limit = {
				check_variable = { current_experience_percent = 33 }
				NOT = { has_country_flag = magic_project_first_event_happened }
			}
			set_country_flag = magic_project_first_event_happened
			if = {
				limit = { at_least_magic_project_level = { project = summon_extraplanars level = 2 } }
				country_event = { id = magic_project_summon_extraplanars.10 }
			}
			else_if = {
				limit = { at_least_magic_project_level = { project = summon_extraplanars level = 1 } }
				country_event = { id = magic_project_summon_extraplanars.6 }
			}
			else = {
				country_event = { id = magic_project_summon_extraplanars.2 }
			}
		}
		else_if = {
			limit = {
				check_variable = { current_experience_percent = 67 }
				NOT = { has_country_flag = magic_project_second_event_happened }
			}
			set_country_flag = magic_project_second_event_happened
			if = {
				limit = { at_least_magic_project_level = { project = summon_extraplanars level = 2 } }
				country_event = { id = magic_project_summon_extraplanars.11 }
			}
			else_if = {
				limit = { at_least_magic_project_level = { project = summon_extraplanars level = 1 } }
				country_event = { id = magic_project_summon_extraplanars.7 }
			}
			else = {
				country_event = { id = magic_project_summon_extraplanars.3 }
			}
		}
	}
}

country_event = { # Summon Extraplanars 1 - Academic 1 (Letter arrives)
	id = magic_project_summon_extraplanars.1
	title = magic_project_summon_extraplanars.1.t
	desc = magic_project_summon_extraplanars.1.d
	picture = ECONOMY_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = in_magic_progress_event hidden_effect = { set_variable = { summon_extraplanars_astral_gloam = 0 } } }
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_summon_extraplanars.1.a
		ai_chance = { factor = 1 }

		increase_magic_experience = { amount = 20 }
		custom_tooltip = magic_effect_separator_tt
		change_variable = { summon_extraplanars_astral_gloam = 1 }
		custom_tooltip = astral_gloam_mechanic_hint
	}
}

country_event = { # Summon Extraplanars 2 - Academic 2 (Occult meeting)
	id = magic_project_summon_extraplanars.2
	title = magic_project_summon_extraplanars.2.t
	desc = magic_project_summon_extraplanars.2.d
	picture = SCIENTISTS_eventPicture

	is_triggered_only = yes
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_summon_extraplanars.2.a
		ai_chance = { factor = 1 }

		summon_extraplanars_school_check = { xp = 20 school = enchantment }
	}
}

country_event = { # Summon Extraplanars 3 - Academic 3 (Description of blind-writing)
	id = magic_project_summon_extraplanars.3
	title = magic_project_summon_extraplanars.3.t
	desc = magic_project_summon_extraplanars.3.d
	picture = ROYAL_SOCIETY_eventPicture

	is_triggered_only = yes
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_summon_extraplanars.3.a
		ai_chance = { factor = 1 }

		summon_extraplanars_school_check = { xp = 20 school = divination }
	}
}

country_event = { # Summon Extraplanars 4 - Academic 4 (The Beckoning)
	id = magic_project_summon_extraplanars.4
	title = magic_project_summon_extraplanars.4.t
	desc = magic_project_summon_extraplanars.4.d
	picture = INVASION_ALLIES_eventPicture

	is_triggered_only = yes

	option = {
		name = magic_project_summon_extraplanars.4.a
		ai_chance = { factor = 1 }
		custom_tooltip = summon_extraplanars_project_angels
		set_country_flag = summon_extraplanars_angels_base
		summon_extraplanars_summon_rebels = yes
		custom_tooltip = tooltip_magic_project_advance
	}
	option = {
		name = magic_project_summon_extraplanars.4.b
		ai_chance = { factor = 1 }
		custom_tooltip = summon_extraplanars_project_eldritch
		set_country_flag = summon_extraplanars_eldritch_base
		summon_extraplanars_summon_rebels = yes
		custom_tooltip = tooltip_magic_project_advance
	}
	option = {
		name = magic_project_summon_extraplanars.4.c
		ai_chance = { factor = 1 }
		custom_tooltip = summon_extraplanars_project_devils
		set_country_flag = summon_extraplanars_devils_base
		summon_extraplanars_summon_rebels = yes
		custom_tooltip = tooltip_magic_project_advance
	}
}

country_event = { # Summon Extraplanars 5 - Mercenary 1 (Letter arrives)
	id = magic_project_summon_extraplanars.5
	title = magic_project_summon_extraplanars.5.t
	desc = magic_project_summon_extraplanars.5.d
	picture = indiangfx_CORRUPTION_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = in_magic_progress_event hidden_effect = { set_variable = { summon_extraplanars_astral_gloam = 0 } } }
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_summon_extraplanars.5.a
		ai_chance = { factor = 1 }

		summon_extraplanars_school_check = { xp = 40 school = necromancy }
	}
}

country_event = { # Summon Extraplanars 6 - Mercenary 2 (Uncovering what happened)
	id = magic_project_summon_extraplanars.6
	title = magic_project_summon_extraplanars.6.t
	desc = magic_project_summon_extraplanars.6.d
	picture = OVEREXTENSION_eventPicture

	is_triggered_only = yes
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_summon_extraplanars.6.a
		ai_chance = { factor = 1 }

		summon_extraplanars_school_check = { xp = 40 school = illusion }
	}
}

country_event = { # Summon Extraplanars 7 - Mercenary 3 (Preparing for the expedition)
	id = magic_project_summon_extraplanars.7
	title = magic_project_summon_extraplanars.7.t
	desc = magic_project_summon_extraplanars.7.d
	picture = LAND_MILITARY_eventPicture

	is_triggered_only = yes
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_summon_extraplanars.7.a
		ai_chance = { factor = 1 }

		summon_extraplanars_school_check = { xp = 40 school = abjuration }
	}
}

country_event = { # Summon Extraplanars 8 - Mercenary 4 (The Corruption)
	id = magic_project_summon_extraplanars.8
	title = magic_project_summon_extraplanars.8.t
	desc = magic_project_summon_extraplanars.8.desc
	picture = END_OF_TIME_eventPicture

	is_triggered_only = yes
	after = { hidden_effect = { country_event = { id = magic_project_summon_extraplanars.70 days = 31 } } }

	option = {
		name = magic_project_summon_extraplanars.8.a
		ai_chance = { factor = 1 }
		trigger = { has_country_flag = summon_extraplanars_angels_base }
		custom_tooltip = summon_extraplanars_project_angels_defense
		set_country_flag = summon_extraplanars_angels_defense
		clr_country_flag = summon_extraplanars_angels_base
		if = {
			limit = { any_hired_mercenary_company = { template = merc_angels_base } }
			random_hired_mercenary_company = {
				limit = { template = merc_angels_base }
				disband_mercenary_company = THIS
			}
		}
		summon_extraplanars_summon_rebels = yes
		custom_tooltip = tooltip_magic_project_advance
	}
	option = {
		name = magic_project_summon_extraplanars.8.b
		ai_chance = { factor = 1 }
		trigger = { has_country_flag = summon_extraplanars_angels_base }
		custom_tooltip = summon_extraplanars_project_angels_offense
		set_country_flag = summon_extraplanars_angels_offense
		clr_country_flag = summon_extraplanars_angels_base
		if = {
			limit = { any_hired_mercenary_company = { template = merc_angels_base } }
			random_hired_mercenary_company = {
				limit = { template = merc_angels_base }
				disband_mercenary_company = THIS
			}
		}
		summon_extraplanars_summon_rebels = yes
		custom_tooltip = tooltip_magic_project_advance
	}
	option = {
		name = magic_project_summon_extraplanars.8.c
		ai_chance = { factor = 1 }
		trigger = { has_country_flag = summon_extraplanars_eldritch_base }
		custom_tooltip = summon_extraplanars_project_eldritch_fast
		set_country_flag = summon_extraplanars_eldritch_fast
		clr_country_flag = summon_extraplanars_eldritch_base
		if = {
			limit = { any_hired_mercenary_company = { template = merc_eldritch_base } }
			random_hired_mercenary_company = {
				limit = { template = merc_eldritch_base }
				disband_mercenary_company = THIS
			}
		}
		summon_extraplanars_summon_rebels = yes
		custom_tooltip = tooltip_magic_project_advance
	}
	option = {
		name = magic_project_summon_extraplanars.8.d
		ai_chance = { factor = 1 }
		trigger = { has_country_flag = summon_extraplanars_eldritch_base }
		custom_tooltip = summon_extraplanars_project_eldritch_mass
		set_country_flag = summon_extraplanars_eldritch_mass
		clr_country_flag = summon_extraplanars_eldritch_base
		if = {
			limit = { any_hired_mercenary_company = { template = merc_eldritch_base } }
			random_hired_mercenary_company = {
				limit = { template = merc_eldritch_base }
				disband_mercenary_company = THIS
			}
		}
		summon_extraplanars_summon_rebels = yes
		custom_tooltip = tooltip_magic_project_advance
	}
	option = {
		name = magic_project_summon_extraplanars.8.e
		ai_chance = { factor = 1 }
		trigger = { has_country_flag = summon_extraplanars_devils_base }
		custom_tooltip = summon_extraplanars_project_devils_frontline
		set_country_flag = summon_extraplanars_devils_frontline
		clr_country_flag = summon_extraplanars_devils_base
		if = {
			limit = { any_hired_mercenary_company = { template = merc_devils_base } }
			random_hired_mercenary_company = {
				limit = { template = merc_devils_base }
				disband_mercenary_company = THIS
			}
		}
		summon_extraplanars_summon_rebels = yes
		custom_tooltip = tooltip_magic_project_advance
	}
	option = {
		name = magic_project_summon_extraplanars.8.f
		ai_chance = { factor = 1 }
		trigger = { has_country_flag = summon_extraplanars_devils_base }
		custom_tooltip = summon_extraplanars_project_devils_backline
		set_country_flag = summon_extraplanars_devils_backline
		clr_country_flag = summon_extraplanars_devils_base
		if = {
			limit = { any_hired_mercenary_company = { template = merc_devils_base } }
			random_hired_mercenary_company = {
				limit = { template = merc_devils_base }
				disband_mercenary_company = THIS
			}
		}
		summon_extraplanars_summon_rebels = yes
		custom_tooltip = tooltip_magic_project_advance
	}
}

country_event = { # Summon Extraplanars 9 - Prodigy 1 (Letter arrives)
	id = magic_project_summon_extraplanars.9
	title = magic_project_summon_extraplanars.9.t
	desc = magic_project_summon_extraplanars.9.d
	picture = BABBLING_BAFFOON_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = in_magic_progress_event hidden_effect = { set_variable = { summon_extraplanars_astral_gloam = 0 } } }
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_summon_extraplanars.9.a
		ai_chance = { factor = 1 }

		summon_extraplanars_school_check = { xp = 60 school = transmutation }
	}
}

country_event = { # Summon Extraplanars 10 - Prodigy 2 (The Bridge)
	id = magic_project_summon_extraplanars.10
	title = magic_project_summon_extraplanars.10.t
	desc = magic_project_summon_extraplanars.10.d
	picture = northamericagfx_COMET_SIGHTED_eventPicture

	is_triggered_only = yes
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_summon_extraplanars.10.a
		ai_chance = { factor = 1 }

		summon_extraplanars_school_check = { xp = 60 school = evocation }
	}
}

country_event = { # Summon Extraplanars 11 - Prodigy 3 (The Tower)
	id = magic_project_summon_extraplanars.11
	title = magic_project_summon_extraplanars.11.t
	desc = magic_project_summon_extraplanars.11.d
	picture = indiangfx_BATTLE_eventPicture

	is_triggered_only = yes
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_summon_extraplanars.11.a
		ai_chance = { factor = 1 }

		increase_magic_experience = { amount = 60 }
		custom_tooltip = magic_effect_separator_tt
		custom_tooltip = summon_extraplanars_impossible_conjuration
		custom_tooltip = BONUS_REWARD_NO
		tooltip = { change_variable = { summon_extraplanars_astral_gloam = 1 } }
		custom_tooltip = mission_alternatively_tt
		custom_tooltip = BONUS_REWARD_YES
		change_variable = { summon_extraplanars_astral_gloam = 2 }
	}
}

country_event = { # Summon Extraplanars 12 - Prodigy 4 (The One-Many)
	id = magic_project_summon_extraplanars.12
	title = magic_project_summon_extraplanars.12.t
	desc = magic_project_summon_extraplanars.12.d
	picture = COMBINED_HAGS_eventPicture

	is_triggered_only = yes
	immediate = { set_saved_name = { key = the_tripartite type = simple name = "The Tripartite" } }
	after = { hidden_effect = { country_event = { id = magic_project_summon_extraplanars.71 days = 31 } } }

	option = {
		name = magic_project_summon_extraplanars.12.a
		ai_chance = { factor = 1 }
		trigger = { has_country_flag = summon_extraplanars_angels_defense }
		custom_tooltip = summon_extraplanars_project_angels_defense_2
		set_country_flag = summon_extraplanars_angels_defense_2
		clr_country_flag = summon_extraplanars_angels_defense
		if = {
			limit = { any_hired_mercenary_company = { template = merc_angels_defense } }
			random_hired_mercenary_company = {
				limit = { template = merc_angels_defense }
				disband_mercenary_company = THIS
			}
		}
		hidden_effect = { add_country_modifier = { name = wyvernheart_war_wizard_rebels_mod duration = -1 } }
		capital_scope = { spawn_rebels = { type = magical_abomination size = 3 leader = the_tripartite leader_dynasty = "" } }
		hidden_effect = { remove_country_modifier = wyvernheart_war_wizard_rebels_mod }
		summon_extraplanars_summon_rebels = yes
		custom_tooltip = tooltip_magic_project_complete
	}
	option = {
		name = magic_project_summon_extraplanars.12.a
		ai_chance = { factor = 1 }
		trigger = { has_country_flag = summon_extraplanars_angels_offense }
		custom_tooltip = summon_extraplanars_project_angels_offense_2
		set_country_flag = summon_extraplanars_angels_offense_2
		clr_country_flag = summon_extraplanars_angels_offense
		if = {
			limit = { any_hired_mercenary_company = { template = merc_angels_offense } }
			random_hired_mercenary_company = {
				limit = { template = merc_angels_offense }
				disband_mercenary_company = THIS
			}
		}
		hidden_effect = { add_country_modifier = { name = wyvernheart_war_wizard_rebels_mod duration = -1 } }
		capital_scope = { spawn_rebels = { type = magical_abomination size = 3 leader = the_tripartite leader_dynasty = "" } }
		hidden_effect = { remove_country_modifier = wyvernheart_war_wizard_rebels_mod }
		summon_extraplanars_summon_rebels = yes
		custom_tooltip = tooltip_magic_project_complete
	}
	option = {
		name = magic_project_summon_extraplanars.12.b
		ai_chance = { factor = 1 }
		trigger = { has_country_flag = summon_extraplanars_eldritch_fast }
		custom_tooltip = summon_extraplanars_project_eldritch_fast_2
		set_country_flag = summon_extraplanars_eldritch_fast_2
		clr_country_flag = summon_extraplanars_eldritch_fast
		if = {
			limit = { any_hired_mercenary_company = { template = merc_eldritch_fast } }
			random_hired_mercenary_company = {
				limit = { template = merc_eldritch_fast }
				disband_mercenary_company = THIS
			}
		}
		hidden_effect = { add_country_modifier = { name = wyvernheart_war_wizard_rebels_mod duration = -1 } }
		capital_scope = { spawn_rebels = { type = magical_abomination size = 3 leader = the_tripartite leader_dynasty = "" } }
		hidden_effect = { remove_country_modifier = wyvernheart_war_wizard_rebels_mod }
		summon_extraplanars_summon_rebels = yes
		custom_tooltip = tooltip_magic_project_complete
	}
	option = {
		name = magic_project_summon_extraplanars.12.b
		ai_chance = { factor = 1 }
		trigger = { has_country_flag = summon_extraplanars_eldritch_mass }
		custom_tooltip = summon_extraplanars_project_eldritch_mass_2
		set_country_flag = summon_extraplanars_eldritch_mass_2
		clr_country_flag = summon_extraplanars_eldritch_mass
		if = {
			limit = { any_hired_mercenary_company = { template = merc_eldritch_mass } }
			random_hired_mercenary_company = {
				limit = { template = merc_eldritch_mass }
				disband_mercenary_company = THIS
			}
		}
		hidden_effect = { add_country_modifier = { name = wyvernheart_war_wizard_rebels_mod duration = -1 } }
		capital_scope = { spawn_rebels = { type = magical_abomination size = 3 leader = the_tripartite leader_dynasty = "" } }
		hidden_effect = { remove_country_modifier = wyvernheart_war_wizard_rebels_mod }
		summon_extraplanars_summon_rebels = yes
		custom_tooltip = tooltip_magic_project_complete
	}
	option = {
		name = magic_project_summon_extraplanars.12.c
		ai_chance = { factor = 1 }
		trigger = { has_country_flag = summon_extraplanars_devils_frontline }
		custom_tooltip = summon_extraplanars_project_devils_frontline_2
		set_country_flag = summon_extraplanars_devils_frontline_2
		clr_country_flag = summon_extraplanars_devils_frontline
		if = {
			limit = { any_hired_mercenary_company = { template = merc_devils_frontline } }
			random_hired_mercenary_company = {
				limit = { template = merc_devils_frontline }
				disband_mercenary_company = THIS
			}
		}
		hidden_effect = { add_country_modifier = { name = wyvernheart_war_wizard_rebels_mod duration = -1 } }
		capital_scope = { spawn_rebels = { type = magical_abomination size = 3 leader = the_tripartite leader_dynasty = "" } }
		hidden_effect = { remove_country_modifier = wyvernheart_war_wizard_rebels_mod }
		summon_extraplanars_summon_rebels = yes
		custom_tooltip = tooltip_magic_project_complete
	}
	option = {
		name = magic_project_summon_extraplanars.12.c
		ai_chance = { factor = 1 }
		trigger = { has_country_flag = summon_extraplanars_devils_backline }
		custom_tooltip = summon_extraplanars_project_devils_backline_2
		set_country_flag = summon_extraplanars_devils_backline_2
		clr_country_flag = summon_extraplanars_devils_backline
		if = {
			limit = { any_hired_mercenary_company = { template = merc_devils_backline } }
			random_hired_mercenary_company = {
				limit = { template = merc_devils_backline }
				disband_mercenary_company = THIS
			}
		}
		hidden_effect = { add_country_modifier = { name = wyvernheart_war_wizard_rebels_mod duration = -1 } }
		capital_scope = { spawn_rebels = { type = magical_abomination size = 3 leader = the_tripartite leader_dynasty = "" } }
		hidden_effect = { remove_country_modifier = wyvernheart_war_wizard_rebels_mod }
		summon_extraplanars_summon_rebels = yes
		custom_tooltip = tooltip_magic_project_complete
	}
}

country_event = { #Hidden disband T1 event to prevent cheesing
	id = magic_project_summon_extraplanars.70
	title = magic_project_summon_extraplanars.70.t
	desc = magic_project_summon_extraplanars.70.desc
	picture = ANGRY_MOB_eventPicture

	is_triggered_only = yes
	hidden = yes

	option = {
		name = magic_project_summon_extraplanars.70.c
		ai_chance = { factor = 1 }

		if = {
			limit = { any_hired_mercenary_company = { template = merc_angels_base } }
			random_hired_mercenary_company = {
				limit = { template = merc_angels_base }
				disband_mercenary_company = THIS
			}
		}
		if = {
			limit = { any_hired_mercenary_company = { template = merc_eldritch_base } }
			random_hired_mercenary_company = {
				limit = { template = merc_eldritch_base }
				disband_mercenary_company = THIS
			}
		}
		if = {
			limit = { any_hired_mercenary_company = { template = merc_devils_base } }
			random_hired_mercenary_company = {
				limit = { template = merc_devils_base }
				disband_mercenary_company = THIS
			}
		}
	}
}

country_event = { #Hidden disband T2 event to prevent cheesing
	id = magic_project_summon_extraplanars.71
	title = magic_project_summon_extraplanars.71.t
	desc = magic_project_summon_extraplanars.71.desc
	picture = ANGRY_MOB_eventPicture

	is_triggered_only = yes
	hidden = yes

	option = {
		name = magic_project_summon_extraplanars.71.c
		ai_chance = { factor = 1 }

		if = {
			limit = { any_hired_mercenary_company = { template = merc_angels_offense } }
			random_hired_mercenary_company = {
				limit = { template = merc_angels_offense }
				disband_mercenary_company = THIS
			}
		}
		if = {
			limit = { any_hired_mercenary_company = { template = merc_angels_defense } }
			random_hired_mercenary_company = {
				limit = { template = merc_angels_defense }
				disband_mercenary_company = THIS
			}
		}
		if = {
			limit = { any_hired_mercenary_company = { template = merc_eldritch_fast } }
			random_hired_mercenary_company = {
				limit = { template = merc_eldritch_fast }
				disband_mercenary_company = THIS
			}
		}
		if = {
			limit = { any_hired_mercenary_company = { template = merc_eldritch_mass } }
			random_hired_mercenary_company = {
				limit = { template = merc_eldritch_mass }
				disband_mercenary_company = THIS
			}
		}
		if = {
			limit = { any_hired_mercenary_company = { template = merc_devils_frontline } }
			random_hired_mercenary_company = {
				limit = { template = merc_devils_frontline }
				disband_mercenary_company = THIS
			}
		}
		if = {
			limit = { any_hired_mercenary_company = { template = merc_devils_backline } }
			random_hired_mercenary_company = {
				limit = { template = merc_devils_backline }
				disband_mercenary_company = THIS
			}
		}
	}
}

##########################
### ORB OF OMNISCIENCE ###
##########################
# Orb of Omniscience 1 - Make a promise
# Orb of Omniscience 2 - Fulfill that promise, make a second promise
# Orb of Omniscience 3 - Fulfill that promise
# Orb of Omniscience 4 - Ending event

namespace = magic_project_orb_of_omniscience

country_event = { #Orb of Omniscience event handler
	id = magic_project_orb_of_omniscience.0
	title = magic_project_orb_of_omniscience.0.t
	desc = magic_project_orb_of_omniscience.0.d
	picture = ANGRY_MOB_eventPicture

	is_triggered_only = yes
	hidden = yes

	option = {
		name = magic_project_orb_of_omniscience.0.a
		ai_chance = { factor = 1 }

		if = {
			limit = { has_country_flag = magic_project_completed_flag }
			if = {
				limit = { at_least_magic_project_level = { project = orb_of_omniscience level = 3 } }
				country_event = { id = magic_project_orb_of_omniscience.6 }
			}
			else_if = {
				limit = { at_least_magic_project_level = { project = orb_of_omniscience level = 2 } }
				country_event = { id = magic_project_orb_of_omniscience.5 }
			}
			else = {
				country_event = { id = magic_project_orb_of_omniscience.4 }
			}
		}
		else_if = {
			limit = {
				check_variable = { current_experience_percent = 33 }
				NOT = { has_country_flag = magic_project_first_event_happened }
			}
			set_country_flag = magic_project_first_event_happened
			set_country_flag = in_magic_progress_event
			if = {
				limit = { check_variable = { which = orb_of_omniscience_progress_tracker which = orb_of_omniscience_progress_req } }
				country_event = { id = magic_project_orb_of_omniscience.3 }
			}
			else = { country_event = { id = magic_project_orb_of_omniscience.2 } }
		}
		else_if = {
			limit = {
				check_variable = { current_experience_percent = 67 }
				NOT = { has_country_flag = magic_project_second_event_happened }
			}
			set_country_flag = magic_project_second_event_happened
			set_country_flag = in_magic_progress_event
			if = {
				limit = { check_variable = { which = orb_of_omniscience_progress_tracker which = orb_of_omniscience_progress_req } }
				country_event = { id = magic_project_orb_of_omniscience.3 }
			}
			else = { country_event = { id = magic_project_orb_of_omniscience.2 } }
		}
	}
}

country_event = { # Orb of Omniscience 1 - Make a promise
	id = magic_project_orb_of_omniscience.1
	title = magic_project_orb_of_omniscience.1.t
	desc = magic_project_orb_of_omniscience.1.desc
	picture = COMET_SIGHTED_eventPicture

	is_triggered_only = yes
	immediate = {
		hidden_effect = {
			set_variable = { orb_of_omniscience_progress_tracker = 0 }
			randnum_effect = {
				max = 6
				case6 = "set_country_flag = ooo_line1_6"
				case5 = "set_country_flag = ooo_line1_5"
				case4 = "set_country_flag = ooo_line1_4"
				case3 = "set_country_flag = ooo_line1_3"
				case2 = "set_country_flag = ooo_line1_2"
				case1 = "set_country_flag = ooo_line1_1"
			}
			randnum_effect = {
				max = 6
				case6 = "set_country_flag = ooo_line2_6"
				case5 = "set_country_flag = ooo_line2_5"
				case4 = "set_country_flag = ooo_line2_4"
				case3 = "set_country_flag = ooo_line2_3"
				case2 = "set_country_flag = ooo_line2_2"
				case1 = "set_country_flag = ooo_line2_1"
			}
			randnum_effect = {
				max = 6
				case6 = "set_country_flag = ooo_line3_6"
				case5 = "set_country_flag = ooo_line3_5"
				case4 = "set_country_flag = ooo_line3_4"
				case3 = "set_country_flag = ooo_line3_3"
				case2 = "set_country_flag = ooo_line3_2"
				case1 = "set_country_flag = ooo_line3_1"
			}
			randnum_effect = {
				max = 6
				case6 = "set_country_flag = ooo_line4_6"
				case5 = "set_country_flag = ooo_line4_5"
				case4 = "set_country_flag = ooo_line4_4"
				case3 = "set_country_flag = ooo_line4_3"
				case2 = "set_country_flag = ooo_line4_2"
				case1 = "set_country_flag = ooo_line4_1"
			}
		}
	}
	after = {
		clr_country_flag = ooo_line1_6
		clr_country_flag = ooo_line1_5
		clr_country_flag = ooo_line1_4
		clr_country_flag = ooo_line1_3
		clr_country_flag = ooo_line1_2
		clr_country_flag = ooo_line1_1

		clr_country_flag = ooo_line2_6
		clr_country_flag = ooo_line2_5
		clr_country_flag = ooo_line2_4
		clr_country_flag = ooo_line2_3
		clr_country_flag = ooo_line2_2
		clr_country_flag = ooo_line2_1

		clr_country_flag = ooo_line3_6
		clr_country_flag = ooo_line3_5
		clr_country_flag = ooo_line3_4
		clr_country_flag = ooo_line3_3
		clr_country_flag = ooo_line3_2
		clr_country_flag = ooo_line3_1

		clr_country_flag = ooo_line4_6
		clr_country_flag = ooo_line4_5
		clr_country_flag = ooo_line4_4
		clr_country_flag = ooo_line4_3
		clr_country_flag = ooo_line4_2
		clr_country_flag = ooo_line4_1

		clr_country_flag = in_magic_progress_event
	}

	option = { #Dev
		name = magic_project_orb_of_omniscience.1.a
		ai_chance = { factor = 1 }

		custom_tooltip = orb_of_omnisience_dev_capital_req
		custom_tooltip = orb_of_omniscience_req_tt
		add_country_modifier = { name = orb_of_omniscience_dev_tracker duration = -1 desc = until_advancement_concludes }
		hidden_effect = {
			if = {
				limit = { exactly_magic_project_level = { project = orb_of_omniscience level = 2 } }
				set_variable = { orb_of_omniscience_progress_req = 12 }
			}
			else_if = {
				limit = { exactly_magic_project_level = { project = orb_of_omniscience level = 1 } }
				set_variable = { orb_of_omniscience_progress_req = 9 }
			}
			else = { set_variable = { orb_of_omniscience_progress_req = 6 } }
		}
	}

	option = { #Core
		name = magic_project_orb_of_omniscience.1.b
		ai_chance = { factor = 1 }

		custom_tooltip = orb_of_omnisience_core_req
		custom_tooltip = orb_of_omniscience_req_tt
		add_country_modifier = { name = orb_of_omniscience_core_tracker duration = -1 desc = until_advancement_concludes }
		hidden_effect = {
			if = {
				limit = { exactly_magic_project_level = { project = orb_of_omniscience level = 2 } }
				set_variable = { orb_of_omniscience_progress_req = 12 }
			}
			else_if = {
				limit = { exactly_magic_project_level = { project = orb_of_omniscience level = 1 } }
				set_variable = { orb_of_omniscience_progress_req = 9 }
			}
			else = { set_variable = { orb_of_omniscience_progress_req = 6 } }
		}
	}

	option = { #Tech
		name = magic_project_orb_of_omniscience.1.c
		ai_chance = { factor = 1 }

		custom_tooltip = orb_of_omnisience_tech_req
		custom_tooltip = orb_of_omniscience_req_tt
		add_country_modifier = { name = orb_of_omniscience_tech_tracker duration = -1 desc = until_advancement_concludes }
		hidden_effect = {
			if = {
				limit = { exactly_magic_project_level = { project = orb_of_omniscience level = 2 } }
				set_variable = { orb_of_omniscience_progress_req = 3 }
			}
			else_if = {
				limit = { exactly_magic_project_level = { project = orb_of_omniscience level = 1 } }
				set_variable = { orb_of_omniscience_progress_req = 2 }
			}
			else = { set_variable = { orb_of_omniscience_progress_req = 1 } }
		}
	}

	option = { #Leader
		name = magic_project_orb_of_omniscience.1.d
		ai_chance = { factor = 1 }

		custom_tooltip = orb_of_omnisience_leader_req
		custom_tooltip = orb_of_omniscience_req_tt
		add_country_modifier = { name = orb_of_omniscience_leader_tracker duration = -1 desc = until_advancement_concludes }
		hidden_effect = {
			if = {
				limit = { exactly_magic_project_level = { project = orb_of_omniscience level = 2 } }
				set_variable = { orb_of_omniscience_progress_req = 12 }
			}
			else_if = {
				limit = { exactly_magic_project_level = { project = orb_of_omniscience level = 1 } }
				set_variable = { orb_of_omniscience_progress_req = 9 }
			}
			else = { set_variable = { orb_of_omniscience_progress_req = 6 } }
		}
	}

	option = { #Kill 
		name = magic_project_orb_of_omniscience.1.e
		ai_chance = { factor = 1 }

		custom_tooltip = orb_of_omniscience_kill_req
		custom_tooltip = orb_of_omniscience_req_tt
		add_country_modifier = { name = orb_of_omniscience_kill_tracker duration = -1 desc = until_advancement_concludes }
		hidden_effect = {
			if = {
				limit = { exactly_magic_project_level = { project = orb_of_omniscience level = 2 } }
				set_variable = { orb_of_omniscience_progress_req = 100000 }
			}
			else_if = {
				limit = { exactly_magic_project_level = { project = orb_of_omniscience level = 1 } }
				set_variable = { orb_of_omniscience_progress_req = 75000 }
			}
			else = { set_variable = { orb_of_omniscience_progress_req = 50000 } }
		}
	}

	option = { #Div
		name = magic_project_orb_of_omniscience.1.f
		ai_chance = { factor = 1 }

		custom_tooltip = orb_of_omniscience_div_req
		custom_tooltip = orb_of_omniscience_req_tt
		add_country_modifier = { name = orb_of_omniscience_div_tracker duration = -1 desc = until_advancement_concludes }
		hidden_effect = {
			if = {
				limit = { exactly_magic_project_level = { project = orb_of_omniscience level = 2 } }
				set_variable = { orb_of_omniscience_progress_req = 200 }
			}
			else_if = {
				limit = { exactly_magic_project_level = { project = orb_of_omniscience level = 1 } }
				set_variable = { orb_of_omniscience_progress_req = 150 }
			}
			else = { set_variable = { orb_of_omniscience_progress_req = 100 } }
		}
	}
}

country_event = { # Orb of Omniscience 2 - Covenant Shattered
	id = magic_project_orb_of_omniscience.2
	title = magic_project_orb_of_omniscience.2.t
	desc = magic_project_orb_of_omniscience.2.d
	picture = BAD_WITH_MONARCH_eventPicture

	is_triggered_only = yes
	after = { clr_country_flag = in_magic_progress_event }

	option = { #Keep trying
		name = magic_project_orb_of_omniscience.2.a
		ai_chance = { factor = 1 }
		trigger = {
			hidden_trigger = { NOT = { has_country_flag = magic_project_second_event_happened } }
			NOT = { check_variable = { which = orb_of_omniscience_progress_tracker which = orb_of_omniscience_progress_req } }
		}
		highlight = yes
		add_splendor = -2
	}

	option = { #Too late
		name = magic_project_orb_of_omniscience.2.b
		ai_chance = { factor = 1 }
		trigger = {
			hidden_trigger = { has_country_flag = magic_project_second_event_happened }
			NOT = { check_variable = { which = orb_of_omniscience_progress_tracker which = orb_of_omniscience_progress_req } }
		}
		highlight = yes
		add_splendor = -2
	}
}

country_event = { # Orb of Omniscience 3 - Covenant Met
	id = magic_project_orb_of_omniscience.3
	title = magic_project_orb_of_omniscience.3.t
	desc = magic_project_orb_of_omniscience.3.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes
	after = { clr_country_flag = in_magic_progress_event }

	option = { #Keep going
		name = magic_project_orb_of_omniscience.3.a
		ai_chance = { factor = 1 }
		trigger = {
			hidden_trigger = { NOT = { has_country_flag = magic_project_second_event_happened } }
			check_variable = { which = orb_of_omniscience_progress_tracker which = orb_of_omniscience_progress_req }
		}
		highlight = yes

		if = {
			limit = { exactly_magic_project_level = { project = orb_of_omniscience level = 0 } }
			increase_magic_experience = { amount = 40 }
		}
		else_if = {
			limit = { exactly_magic_project_level = { project = orb_of_omniscience level = 1 } }
			increase_magic_experience = { amount = 60 }
		}
		else = {
			increase_magic_experience = { amount = 80 }
		}
		set_variable = { orb_of_omniscience_progress_tracker = 0 }
	}

	option = { #Good job!
		name = magic_project_orb_of_omniscience.3.b
		ai_chance = { factor = 1 }
		trigger = {
			hidden_trigger = { has_country_flag = magic_project_second_event_happened }
			check_variable = { which = orb_of_omniscience_progress_tracker which = orb_of_omniscience_progress_req }
		}
		highlight = yes

		if = {
			limit = { exactly_magic_project_level = { project = orb_of_omniscience level = 0 } }
			increase_magic_experience = { amount = 40 }
		}
		else_if = {
			limit = { exactly_magic_project_level = { project = orb_of_omniscience level = 1 } }
			increase_magic_experience = { amount = 60 }
		}
		else = {
			increase_magic_experience = { amount = 80 }
		}
	}
}

country_event = { # 4 - Ending event (Level 1)
	id = magic_project_orb_of_omniscience.4
	title = magic_project_orb_of_omniscience.4.t
	desc = magic_project_orb_of_omniscience.4.d
	picture = HIGH_TEMPLE_IN_DISTANCE_eventPicture

	is_triggered_only = yes

	option = {
		name = magic_project_orb_of_omniscience.4.a
		ai_chance = { factor = 1 }
		custom_tooltip = orb_of_omniscience_project_effect_1
		custom_tooltip = tooltip_magic_project_advance
	}
}
country_event = { # 4 - Ending event (Level 2)
	id = magic_project_orb_of_omniscience.5
	title = magic_project_orb_of_omniscience.5.t
	desc = magic_project_orb_of_omniscience.5.d
	picture = EFFELAI_TEMPLE_ANIMATED_eventPicture

	is_triggered_only = yes

	option = {
		name = magic_project_orb_of_omniscience.5.a
		ai_chance = { factor = 1 }
		custom_tooltip = orb_of_omniscience_project_effect_2
		custom_tooltip = tooltip_magic_project_advance
	}
}
country_event = { # 4 - Ending event (Level 3)
	id = magic_project_orb_of_omniscience.6
	title = magic_project_orb_of_omniscience.6.t
	desc = magic_project_orb_of_omniscience.6.d
	picture = MAGE_MOON_ALTER_eventPicture

	is_triggered_only = yes

	option = {
		name = magic_project_orb_of_omniscience.6.a
		ai_chance = { factor = 1 }
		custom_tooltip = orb_of_omniscience_project_effect_3
		tooltip = { divination_2_manipulated_fortune_effect = yes }
		custom_tooltip = orb_of_omniscience_project_effect_3_2
		tooltip = { divination_3_foresight_effect = yes }
		custom_tooltip = tooltip_magic_project_complete
	}
}

###################################
### ENCHANT LEGENDARY ARTEFACT  ###
###################################
# 0 - Prologue
# 1 - Deciding to Create an Artifact (Beowulf)
# 2 - Finding the Way (Journey to the West)
# 3 - Visiting the Smith (Romance of the Three Kingdoms)
# 4 - The Smith is Found (The Hobbit)
# 5 - Acquiring Materials (The Annals of the Grand Historian)
# 6 - Taxing the Villagers (The Song of Roland)
# 7 - Putting Down Revolts (The History of the Franks)
# 8 - Fashioning the Artifact (Fanfiction)
# 9-12 - Mental Battle with the Artifact (Remember what you did...)

namespace = magic_project_artifact_of_enthrallment

country_event = { #Artifact of Enthrallment event handler
	id = magic_project_artifact_of_enthrallment.0
	title = magic_project_artifact_of_enthrallment.0.t
	desc = magic_project_artifact_of_enthrallment.0.d
	picture = ANGRY_MOB_eventPicture

	is_triggered_only = yes
	hidden = yes

	option = {
		name = magic_project_artifact_of_enthrallment.0.a
		ai_chance = { factor = 1 }

		if = {
			limit = { has_country_flag = magic_project_completed_flag }
			if = {
				limit = { at_least_magic_project_level = { project = artifact_of_enthrallment level = 3 } }
				country_event = { id = magic_project_artifact_of_enthrallment.12 }
			}
			else_if = {
				limit = { at_least_magic_project_level = { project = artifact_of_enthrallment level = 2 } }
				country_event = { id = magic_project_artifact_of_enthrallment.9 }
			}
			else = {
				country_event = { id = magic_project_artifact_of_enthrallment.5 }
			}
		}
		else_if = {
			limit = {
				check_variable = { current_experience_percent = 33 }
				NOT = { has_country_flag = magic_project_first_event_happened }
			}
			set_country_flag = magic_project_first_event_happened
			set_country_flag = in_magic_progress_event
			if = {
				limit = { at_least_magic_project_level = { project = artifact_of_enthrallment level = 2 } }
				country_event = { id = magic_project_artifact_of_enthrallment.1 }
			}
			else_if = {
				limit = { at_least_magic_project_level = { project = artifact_of_enthrallment level = 1 } }
				country_event = { id = magic_project_artifact_of_enthrallment.7 }
			}
			else = {
				country_event = { id = magic_project_artifact_of_enthrallment.3 }
			}
		}
		else_if = {
			limit = {
				check_variable = { current_experience_percent = 67 }
				NOT = { has_country_flag = magic_project_second_event_happened }
			}
			set_country_flag = magic_project_second_event_happened
			set_country_flag = in_magic_progress_event
			if = {
				limit = { at_least_magic_project_level = { project = artifact_of_enthrallment level = 2 } }
				country_event = { id = magic_project_artifact_of_enthrallment.1 }
			}
			else_if = {
				limit = { at_least_magic_project_level = { project = artifact_of_enthrallment level = 1 } }
				country_event = { id = magic_project_artifact_of_enthrallment.8 }
			}
			else = {
				country_event = { id = magic_project_artifact_of_enthrallment.4 }
			}
		}
	}
}

country_event = { #Artifact of Enthrallment 0 - Prologue
	id = magic_project_artifact_of_enthrallment.1
	title = magic_project_artifact_of_enthrallment.1.t
	desc = magic_project_artifact_of_enthrallment.1.d
	picture = BIG_BOOK_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = in_magic_progress_event }

	option = { # "Hwt!"
		name = magic_project_artifact_of_enthrallment.1.a
		trigger = {
			OR = {
				AND = {
					exactly_magic_project_level = { project = artifact_of_enthrallment level = 2 }
					has_country_flag = magic_project_first_event_happened
					NOT = { has_country_flag = magic_project_second_event_happened }
				}
				exactly_magic_project_level = { project = artifact_of_enthrallment level = 0 }
			}
		}
		ai_chance = { factor = 1 }

		country_event = { id = magic_project_artifact_of_enthrallment.2 }
	}

	option = { # "The Lesser Historian says:"
		name = magic_project_artifact_of_enthrallment.1.b
		trigger = {
			OR = {
				AND = {
					exactly_magic_project_level = { project = artifact_of_enthrallment level = 2 }
					has_country_flag = magic_project_second_event_happened
				}
				exactly_magic_project_level = { project = artifact_of_enthrallment level = 1 }
			}
		}
		ai_chance = { factor = 1 }

		country_event = { id = magic_project_artifact_of_enthrallment.6 }
	}

	option = { # (Placeholder)
		name = magic_project_artifact_of_enthrallment.1.c
		trigger = {
			exactly_magic_project_level = { project = artifact_of_enthrallment level = 2 }
			NOT = { has_country_flag = magic_project_first_event_happened }
		}
		ai_chance = { factor = 1 }

		country_event = { id = magic_project_artifact_of_enthrallment.11 }
	}
}

country_event = { #Artifact of Enthrallment 1 - Deciding to Create an Artifact (Beowulf)
	id = magic_project_artifact_of_enthrallment.2
	title = magic_project_artifact_of_enthrallment.2.t
	desc = magic_project_artifact_of_enthrallment.2.d
	picture = COSSACK_ESTATE_RAIDERS_eventPicture

	is_triggered_only = yes
	after = { clr_country_flag = in_magic_progress_event }

	option = { # Find a Smith
		name = magic_project_artifact_of_enthrallment.2.a
		ai_chance = { factor = 1 }

		if = {
			limit = { exactly_magic_project_level = { project = artifact_of_enthrallment level = 2 } }
			country_event = { id = magic_project_artifact_of_enthrallment.3 }
		}
		else = {
			add_country_modifier = { name = studying_artifact_of_enthrallment_1 duration = -1 desc = until_advancement_concludes }
			add_country_modifier = { name = studying_artifact_of_enthrallment_mod_1 duration = -1 desc = until_advancement_concludes }
		}
	}
}

country_event = { #Artifact of Enthrallment 2 - Finding the Way (Journey to the West)
	id = magic_project_artifact_of_enthrallment.3
	title = magic_project_artifact_of_enthrallment.3.t
	desc = magic_project_artifact_of_enthrallment.3.d
	picture = MIRACLE_MONK_eventPicture

	is_triggered_only = yes
	immediate = { artifact_of_enthrallment_clr_id_flags = { id1 = 3a id2 = 3b } }
	after = { clr_country_flag = in_magic_progress_event }

	option = { # Continue Story
		name = magic_project_artifact_of_enthrallment.3.a
		ai_chance = { factor = 1 }

		artifact_of_enthrallment_tell_the_story = { id = 3a next = 4 }
	}

	option = { # Take a Detour
		name = magic_project_artifact_of_enthrallment.3.b
		ai_chance = { factor = 1 }

		artifact_of_enthrallment_tell_the_story = {
			id = 3b
			next = 4
			else = "
				add_adm_power = -50
				add_dip_power = -50
				add_mil_power = -50
				add_random_ruler_skill = yes
				artifact_of_enthrallment_story_unravels = yes
			"
		}

	}
}

country_event = { #Artifact of Enthrallment 3 - Visiting the Smith (Romance of the Three Kingdoms)
	id = magic_project_artifact_of_enthrallment.4
	title = magic_project_artifact_of_enthrallment.4.t
	desc = magic_project_artifact_of_enthrallment.4.d
	picture = southamericagfx_CITY_VIEW_eventPicture

	is_triggered_only = yes
	immediate = { artifact_of_enthrallment_clr_id_flags = { id1 = 4a id2 = 4b } }
	after = { clr_country_flag = in_magic_progress_event }

	option = { # Continue Story
		name = magic_project_artifact_of_enthrallment.4.a
		ai_chance = { factor = 1 }

		artifact_of_enthrallment_tell_the_story = { id = 4a next = 5 else = "add_adm_power = -25" }
	}

	option = { # Take a Detour
		name = magic_project_artifact_of_enthrallment.4.b
		ai_chance = { factor = 1 }

		artifact_of_enthrallment_tell_the_story = { id = 4b next = 5 else = "artifact_of_enthrallment_story_unravels = yes" }
	}
}

country_event = { #Artifact of Enthrallment 4 - The Smith is Found (The Hobbit)
	id = magic_project_artifact_of_enthrallment.5
	title = magic_project_artifact_of_enthrallment.5.t
	desc = magic_project_artifact_of_enthrallment.5.d
	picture = CAVE_eventPicture

	is_triggered_only = yes

	option = {
		name = magic_project_artifact_of_enthrallment.5.a
		ai_chance = { factor = 1 }

		artifact_of_enthrallment_tell_the_story = {
			id = 5a
			else = "add_country_modifier = { name = artifact_of_enthrallment_crown duration = -1 }"
		}
		custom_tooltip = tooltip_magic_project_advance
	}
	option = {
		name = magic_project_artifact_of_enthrallment.5.b
		ai_chance = { factor = 1 }

		artifact_of_enthrallment_tell_the_story = {
			id = 5b
			else = "add_country_modifier = { name = artifact_of_enthrallment_scepter duration = -1 }"
		}
		custom_tooltip = tooltip_magic_project_advance
	}
	option = {
		name = magic_project_artifact_of_enthrallment.5.c
		ai_chance = { factor = 1 }

		artifact_of_enthrallment_tell_the_story = {
			id = 5c
			else = "add_country_modifier = { name = artifact_of_enthrallment_ring duration = -1 }"
		}
		custom_tooltip = tooltip_magic_project_advance
	}
}

country_event = { #Artifact of Enthrallment 5 - Acquiring Materials (The Annals of the Grand Historian)
	id = magic_project_artifact_of_enthrallment.6
	title = magic_project_artifact_of_enthrallment.6.t
	desc = magic_project_artifact_of_enthrallment.6.d
	picture = DECLARATION_INDEPENDENCE_eventPicture

	is_triggered_only = yes
	after = { clr_country_flag = in_magic_progress_event }

	option = { # Acquire Materials
		name = magic_project_artifact_of_enthrallment.6.a
		ai_chance = { factor = 1 }

		if = {
			limit = { exactly_magic_project_level = { project = artifact_of_enthrallment level = 2 } }
			country_event = { id = magic_project_artifact_of_enthrallment.7 }
		}
		else = {
			add_country_modifier = { name = studying_artifact_of_enthrallment_2 duration = -1 desc = until_advancement_concludes }
			add_country_modifier = { name = studying_artifact_of_enthrallment_mod_1 duration = -1 desc = until_advancement_concludes }
		}
	}
}

country_event = { #Artifact of Enthrallment 6 - Taxing the Villagers (The Song of Roland)
	id = magic_project_artifact_of_enthrallment.7
	title = magic_project_artifact_of_enthrallment.7.t
	desc = magic_project_artifact_of_enthrallment.7.d
	picture = MARCHING_PEASANTS_eventPicture

	is_triggered_only = yes
	immediate = {
		artifact_of_enthrallment_clr_id_flags = { id1 = 7a id2 = 7b }
		hidden_effect = { random_owned_province = { save_event_target_as = rebels_province } }
	}
	after = { clr_country_flag = in_magic_progress_event }

	option = { # Continue Story
		name = magic_project_artifact_of_enthrallment.7.a
		ai_chance = { factor = 1 }
		goto = rebels_province

		artifact_of_enthrallment_tell_the_story = {
			id = 7a
			next = 8
			else = "event_target:rebels_province = { anti_tax_rebels = 3 }"
		}
	}

	option = { # Take a Detour
		name = magic_project_artifact_of_enthrallment.7.b
		ai_chance = { factor = 1 }

		artifact_of_enthrallment_tell_the_story = {
			id = 7b
			next = 8
			else = "artifact_of_enthrallment_story_unravels = yes"
		}
	}
}

country_event = { #Artifact of Enthrallment 7 - Putting Down Revolts (The History of the Franks)
	id = magic_project_artifact_of_enthrallment.8
	title = magic_project_artifact_of_enthrallment.8.t
	desc = magic_project_artifact_of_enthrallment.8.d
	picture = OVEREXTENSION_eventPicture

	is_triggered_only = yes
	immediate = { artifact_of_enthrallment_clr_id_flags = { id1 = 8a id2 = 8b } }
	after = { clr_country_flag = in_magic_progress_event }

	option = { # Continue Story
		name = magic_project_artifact_of_enthrallment.8.a
		ai_chance = { factor = 1 }

		artifact_of_enthrallment_tell_the_story = { id = 8a next = 9 }
	}

	option = { # Take a Detour
		name = magic_project_artifact_of_enthrallment.8.b
		ai_chance = { factor = 1 }

		artifact_of_enthrallment_tell_the_story = {
			id = 8b
			next = 9
			else = "
				add_rebel_progress = { value = -30 }
				artifact_of_enthrallment_story_unravels = yes
			"
		}
	}
}

country_event = { #Artifact of Enthrallment 8 - Fashioning the Artifact (Fanfiction)
	id = magic_project_artifact_of_enthrallment.9
	title = magic_project_artifact_of_enthrallment.9.t
	desc = magic_project_artifact_of_enthrallment.9.d
	picture = 8_Vaisya_Estate_eventPicture

	is_triggered_only = yes

	option = { # Practical
		name = magic_project_artifact_of_enthrallment.9.a
		ai_chance = { factor = 1 }

		if = {
			limit = {
				OR = {
					has_country_flag = artifact_of_enthrallment_chose_9a
					has_country_flag = artifact_of_enthrallment_chose_9b
				}
			}
			custom_tooltip = artifact_of_enthrallment_tell_the_story
			hidden_effect = {
				if = {
					limit = { NOT = { has_country_flag = artifact_of_enthrallment_chose_9a } }
					country_event = { id = magic_project_artifact_of_enthrallment.10 }
				}
			}
		}
		else = {
			if = {
				limit = { has_country_modifier = artifact_of_enthrallment_crown }
				remove_country_modifier = artifact_of_enthrallment_crown
				add_country_modifier = { name = artifact_of_enthrallment_crown_a duration = -1 }
			}
			else_if = {
				limit = { has_country_modifier = artifact_of_enthrallment_scepter }
				remove_country_modifier = artifact_of_enthrallment_scepter
				add_country_modifier = { name = artifact_of_enthrallment_scepter_a duration = -1 }
			}
			else = {
				remove_country_modifier = artifact_of_enthrallment_ring
				add_country_modifier = { name = artifact_of_enthrallment_ring_a duration = -1 }
			}
			set_country_flag = artifact_of_enthrallment_chose_9a
		}
		custom_tooltip = tooltip_magic_project_advance
	}

	option = { # Fancy
		name = magic_project_artifact_of_enthrallment.9.b
		ai_chance = { factor = 1 }
		
		if = {
			limit = {
				OR = {
					has_country_flag = artifact_of_enthrallment_chose_9a
					has_country_flag = artifact_of_enthrallment_chose_9b
				}
			}
			custom_tooltip = artifact_of_enthrallment_tell_the_story
			hidden_effect = {
				if = {
					limit = { NOT = { has_country_flag = artifact_of_enthrallment_chose_9b } }
					country_event = { id = magic_project_artifact_of_enthrallment.10 }
				}
			}
		}
		else = {
			if = {
				limit = { has_country_modifier = artifact_of_enthrallment_crown }
				remove_country_modifier = artifact_of_enthrallment_crown
				add_country_modifier = { name = artifact_of_enthrallment_crown_b duration = -1 }
			}
			else_if = {
				limit = { has_country_modifier = artifact_of_enthrallment_scepter }
				remove_country_modifier = artifact_of_enthrallment_scepter
				add_country_modifier = { name = artifact_of_enthrallment_scepter_b duration = -1 }
			}
			else = {
				remove_country_modifier = artifact_of_enthrallment_ring
				add_country_modifier = { name = artifact_of_enthrallment_ring_b duration = -1 }
			}
			set_country_flag = artifact_of_enthrallment_chose_9b
		}
		custom_tooltip = tooltip_magic_project_advance
	}
}

country_event = { # WRONG ANSWER
	id = magic_project_artifact_of_enthrallment.10
	title = magic_project_artifact_of_enthrallment.10.t
	desc = magic_project_artifact_of_enthrallment.10.d
	picture = THE_COVENANT_eventPicture

	is_triggered_only = yes

	option = { # Continue Story
		name = magic_project_artifact_of_enthrallment.10.a
		ai_chance = { factor = 1 }

		if = {
			limit = { has_country_flag = magic_project_first_event_happened }
			artifact_of_enthrallment_story_unravels = yes
		}
		else = { custom_tooltip = artifact_of_enthrallment_story_hint }
	}
}

country_event = { #Artifact of Enthrallment 9 - The Implantation of Self I
	id = magic_project_artifact_of_enthrallment.11
	title = magic_project_artifact_of_enthrallment.11.t
	desc = magic_project_artifact_of_enthrallment.11.d
	picture = THE_COVENANT_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = in_magic_progress_event }
	after = { clr_country_flag = in_magic_progress_event }

	option = { # Do Battle
		name = magic_project_artifact_of_enthrallment.11.a
		ai_chance = { factor = 1 }

		add_country_modifier = { name = studying_artifact_of_enthrallment_3 duration = -1 desc = until_advancement_concludes }
		add_country_modifier = { name = studying_artifact_of_enthrallment_mod_1 duration = -1 desc = until_advancement_concludes }
	}

	option = { # Do Battle B
		name = magic_project_artifact_of_enthrallment.11.b
		ai_chance = { factor = 1 }

		add_country_modifier = { name = studying_artifact_of_enthrallment_3 duration = -1 desc = until_advancement_concludes }
		add_country_modifier = { name = studying_artifact_of_enthrallment_mod_1 duration = -1 desc = until_advancement_concludes }
	}
}

country_event = { #Artifact of Enthrallment 12 - Finishing Event
	id = magic_project_artifact_of_enthrallment.12
	title = magic_project_artifact_of_enthrallment.12.t
	desc = magic_project_artifact_of_enthrallment.12.d
	picture = THE_HEROINE_eventPicture

	is_triggered_only = yes
	immediate = {
		clr_country_flag = artifact_of_enthrallment_chose_3a
		clr_country_flag = artifact_of_enthrallment_chose_3b
		clr_country_flag = artifact_of_enthrallment_chose_4a
		clr_country_flag = artifact_of_enthrallment_chose_4b
		clr_country_flag = artifact_of_enthrallment_chose_5a
		clr_country_flag = artifact_of_enthrallment_chose_5b
		clr_country_flag = artifact_of_enthrallment_chose_5c
		clr_country_flag = artifact_of_enthrallment_chose_7a
		clr_country_flag = artifact_of_enthrallment_chose_7b
		clr_country_flag = artifact_of_enthrallment_chose_8a
		clr_country_flag = artifact_of_enthrallment_chose_8b
		clr_country_flag = artifact_of_enthrallment_chose_9a
		clr_country_flag = artifact_of_enthrallment_chose_9b
	}

	option = { # Look to the Past
		name = magic_project_artifact_of_enthrallment.12.a

		if = {
			limit = { has_country_modifier = artifact_of_enthrallment_crown_a }
			remove_country_modifier = artifact_of_enthrallment_crown_a
			add_country_modifier = { name = artifact_of_enthrallment_crown_a_1 duration = -1 }
		}
		else_if = {
			limit = { has_country_modifier = artifact_of_enthrallment_crown_b }
			remove_country_modifier = artifact_of_enthrallment_crown_b
			add_country_modifier = { name = artifact_of_enthrallment_crown_b_1 duration = -1 }
		}
		else_if = {
			limit = { has_country_modifier = artifact_of_enthrallment_scepter_a }
			remove_country_modifier = artifact_of_enthrallment_scepter_a
			add_country_modifier = { name = artifact_of_enthrallment_scepter_a_1 duration = -1 }
		}
		else_if = {
			limit = { has_country_modifier = artifact_of_enthrallment_scepter_b }
			remove_country_modifier = artifact_of_enthrallment_scepter_b
			add_country_modifier = { name = artifact_of_enthrallment_scepter_b_1 duration = -1 }
		}
		else_if = {
			limit = { has_country_modifier = artifact_of_enthrallment_ring_a }
			remove_country_modifier = artifact_of_enthrallment_ring_a
			add_country_modifier = { name = artifact_of_enthrallment_ring_a_1 duration = -1 }
		}
		else = {
			remove_country_modifier = artifact_of_enthrallment_ring_b
			add_country_modifier = { name = artifact_of_enthrallment_ring_b_1 duration = -1 }
		}
		custom_tooltip = tooltip_magic_project_complete
	}
	option = { # Look to the Future
		name = magic_project_artifact_of_enthrallment.12.b
		ai_chance = { factor = 1 }

		if = {
			limit = { has_country_modifier = artifact_of_enthrallment_crown_a }
			remove_country_modifier = artifact_of_enthrallment_crown_a
			add_country_modifier = { name = artifact_of_enthrallment_crown_a_2 duration = -1 }
		}
		else_if = {
			limit = { has_country_modifier = artifact_of_enthrallment_crown_b }
			remove_country_modifier = artifact_of_enthrallment_crown_b
			add_country_modifier = { name = artifact_of_enthrallment_crown_b_2 duration = -1 }
		}
		else_if = {
			limit = { has_country_modifier = artifact_of_enthrallment_scepter_a }
			remove_country_modifier = artifact_of_enthrallment_scepter_a
			add_country_modifier = { name = artifact_of_enthrallment_scepter_a_2 duration = -1 }
		}
		else_if = {
			limit = { has_country_modifier = artifact_of_enthrallment_scepter_b }
			remove_country_modifier = artifact_of_enthrallment_scepter_b
			add_country_modifier = { name = artifact_of_enthrallment_scepter_b_2 duration = -1 }
		}
		else_if = {
			limit = { has_country_modifier = artifact_of_enthrallment_ring_a }
			remove_country_modifier = artifact_of_enthrallment_ring_a
			add_country_modifier = { name = artifact_of_enthrallment_ring_a_2 duration = -1 }
		}
		else = {
			remove_country_modifier = artifact_of_enthrallment_ring_b
			add_country_modifier = { name = artifact_of_enthrallment_ring_b_2 duration = -1 }
		}
		custom_tooltip = tooltip_magic_project_complete
	}
}

##########################
### BATTLEMAGE ACADEMY ###
##########################
# 1 - Introducing the freshman class
# 2 - Picking a prank
# 3 - Executing the prank
# 4 - Graduating

namespace = magic_project_battlemage_academy

country_event = { #Battlemage Academy event handler
	id = magic_project_battlemage_academy.0
	title = magic_project_battlemage_academy.0.t
	desc = magic_project_battlemage_academy.0.d
	picture = ANGRY_MOB_eventPicture

	is_triggered_only = yes
	hidden = yes

	option = {
		name = magic_project_battlemage_academy.0.a
		ai_chance = { factor = 1 }

		if = {
			limit = { has_country_flag = magic_project_completed_flag }
			country_event = { id = magic_project_battlemage_academy.5 }
		}
		else_if = {
			limit = {
				check_variable = { current_experience_percent = 33 }
				NOT = { has_country_flag = magic_project_first_event_happened }
			}
			set_country_flag = magic_project_first_event_happened
			set_country_flag = in_magic_progress_event
			country_event = { id = magic_project_battlemage_academy.2 }
		}
		else_if = {
			limit = {
				check_variable = { current_experience_percent = 67 }
				NOT = { has_country_modifier = studying_battlemage_academy_mod_2 }
			}
			set_country_flag = in_magic_progress_event
			country_event = { id = magic_project_battlemage_academy.4 }
		}
	}
}

country_event = { #Battlemage Academy 1 - Introducing the new class
	id = magic_project_battlemage_academy.1
	title = magic_project_battlemage_academy.1.t
	desc = magic_project_battlemage_academy.1.d
	picture = REFORM_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = in_magic_progress_event }
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_battlemage_academy.1.a
		ai_chance = { factor = 1 }

		add_country_modifier = { name = studying_battlemage_academy_mod_1 duration = -1 desc = until_advancement_concludes }
	}
}
country_event = { #Battlemage Academy 2 - Picking a Prank
	id = magic_project_battlemage_academy.2
	title = magic_project_battlemage_academy.2.t
	desc = magic_project_battlemage_academy.2.d
	picture = COASTLINE_MAP_eventPicture

	is_triggered_only = yes

	immediate = { #edge case for abort
		clr_country_flag = battlemage_academy_outhouse_flag
		clr_country_flag = battlemage_academy_graffiti_flag
		clr_country_flag = battlemage_academy_underwear_flag
	}

	option = { #Outhouse
		name = magic_project_battlemage_academy.2.a
		ai_chance = { factor = 1 }

		if = {
			limit = {
				OR = {
					has_country_modifier = battlemage_academy_outhouse_1
					has_country_modifier = battlemage_academy_outhouse_2
				}
			}
			custom_tooltip = battlemage_academy_already_done
			hidden_effect = { country_event = { id = magic_project_battlemage_academy.3 } }
		}
		else = {
			custom_tooltip = tooltip_gain_on_complete_project
			if = {
				limit = { at_least_magic_project_level = { project = battlemage_academy level = 2 } }
				tooltip = { add_country_modifier = { name = battlemage_academy_outhouse_3 duration = -1 } }
			}
			else_if = {
				limit = { at_least_magic_project_level = { project = battlemage_academy level = 1 } }
				tooltip = { add_country_modifier = { name = battlemage_academy_outhouse_2 duration = -1 } }
				custom_tooltip = battlemage_academy_save_the_best
			}
			else = {
				tooltip = { add_country_modifier = { name = battlemage_academy_outhouse_1 duration = -1 } }
				custom_tooltip = battlemage_academy_save_the_best
			}
			set_country_flag = battlemage_academy_outhouse_flag
			clr_country_flag = in_magic_progress_event
		}
	}

	option = { #Graffiti
		name = magic_project_battlemage_academy.2.b
		ai_chance = { factor = 1 }

		if = {
			limit = {
				OR = {
					has_country_modifier = battlemage_academy_graffiti_1
					has_country_modifier = battlemage_academy_graffiti_2
				}
			}
			custom_tooltip = battlemage_academy_already_done
			hidden_effect = { country_event = { id = magic_project_battlemage_academy.3 } }
		}
		else = {
			custom_tooltip = tooltip_gain_on_complete_project
			if = {
				limit = { at_least_magic_project_level = { project = battlemage_academy level = 2 } }
				tooltip = { add_country_modifier = { name = battlemage_academy_graffiti_3 duration = -1 } }
			}
			else_if = {
				limit = { at_least_magic_project_level = { project = battlemage_academy level = 1 } }
				tooltip = { add_country_modifier = { name = battlemage_academy_graffiti_2 duration = -1 } }
				custom_tooltip = battlemage_academy_save_the_best
			}
			else = {
				tooltip = { add_country_modifier = { name = battlemage_academy_graffiti_1 duration = -1 } }
				custom_tooltip = battlemage_academy_save_the_best
			}
			set_country_flag = battlemage_academy_graffiti_flag
			clr_country_flag = in_magic_progress_event
		}
	}

	option = { #Underwear
		name = magic_project_battlemage_academy.2.c
		ai_chance = { factor = 1 }

		if = {
			limit = {
				OR = {
					has_country_modifier = battlemage_academy_underwear_1
					has_country_modifier = battlemage_academy_underwear_2
				}
			}
			custom_tooltip = battlemage_academy_already_done
			hidden_effect = { country_event = { id = magic_project_battlemage_academy.3 } }
		}
		else = {
			custom_tooltip = tooltip_gain_on_complete_project
			if = {
				limit = { at_least_magic_project_level = { project = battlemage_academy level = 2 } }
				tooltip = { add_country_modifier = { name = battlemage_academy_underwear_3 duration = -1 } }
			}
			else_if = {
				limit = { at_least_magic_project_level = { project = battlemage_academy level = 1 } }
				tooltip = { add_country_modifier = { name = battlemage_academy_underwear_2 duration = -1 } }
				custom_tooltip = battlemage_academy_save_the_best
			}
			else = {
				tooltip = { add_country_modifier = { name = battlemage_academy_underwear_1 duration = -1 } }
				custom_tooltip = battlemage_academy_save_the_best
			}
			set_country_flag = battlemage_academy_underwear_flag
			clr_country_flag = in_magic_progress_event
		}
	}
}
country_event = { #Battlemage Academy 2 Bounceback
	id = magic_project_battlemage_academy.3
	title = magic_project_battlemage_academy.3.t
	desc = magic_project_battlemage_academy.3.d
	picture = ANGRY_MOB_eventPicture

	is_triggered_only = yes
	hidden = yes

	option = {
		name = magic_project_battlemage_academy.3.a
		ai_chance = { factor = 1 }
		
		country_event = { id = magic_project_battlemage_academy.2 }
	}
}
country_event = { #Battlemage Academy 3 - The Incident
	id = magic_project_battlemage_academy.4
	title = magic_project_battlemage_academy.4.t
	desc = {
		desc = magic_project_battlemage_academy.4.outhouse
		trigger = { has_country_flag = battlemage_academy_outhouse_flag }
	}
	desc = {
		desc = magic_project_battlemage_academy.4.graffiti
		trigger = { has_country_flag = battlemage_academy_graffiti_flag }
	}
	desc = {
		desc = magic_project_battlemage_academy.4.underwear
		trigger = { has_country_flag = battlemage_academy_underwear_flag }
	}
	picture = {
		picture = SIEGE_eventPicture
		trigger = { has_country_flag = battlemage_academy_outhouse_flag }
	}
	picture = {
		picture = SYNTHETICS_eventPicture
		trigger = { has_country_flag = battlemage_academy_graffiti_flag }
	}
	picture = {
		picture = southamericagfx_ANGRY_MOB_eventPicture
		trigger = { has_country_flag = battlemage_academy_underwear_flag }
	}

	is_triggered_only = yes
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_battlemage_academy.4.a
		ai_chance = { factor = 1 }
		
		add_country_modifier = { name = studying_battlemage_academy_mod_2 duration = -1 desc = until_advancement_concludes }
	}
}
country_event = { #Battlemage Academy 4 - Graduation
	id = magic_project_battlemage_academy.5
	title = magic_project_battlemage_academy.5.t
	desc = magic_project_battlemage_academy.5.d
	picture = UNIVERSITY_eventPicture

	is_triggered_only = yes
	immediate = {
		if = {
			limit = { ai = yes } #AI handling for missing progress events, note RNG works normally
			random_list = {
				1 = {
					trigger = { NOT = { has_country_modifier = battlemage_academy_outhouse_1 has_country_modifier = battlemage_academy_outhouse_2 } }
					set_country_flag = battlemage_academy_outhouse_flag
				}
				1 = {
					trigger = { NOT = { has_country_modifier = battlemage_academy_underwear_1 has_country_modifier = battlemage_academy_underwear_2 } }
					set_country_flag = battlemage_academy_underwear_flag
				}
				1 = {
					trigger = { NOT = { has_country_modifier = battlemage_academy_graffiti_1 has_country_modifier = battlemage_academy_graffiti_2 } }
					set_country_flag = battlemage_academy_graffiti_flag
				}
			}
		}
	}

	after = {
		hidden_effect = {
			if = {
				limit = { has_country_modifier = battlemage_academy_outhouse_3 }
				if = {
					limit = { has_country_modifier = battlemage_academy_graffiti_2 }
					remove_country_modifier = battlemage_academy_outhouse_3
					remove_country_modifier = battlemage_academy_graffiti_2
					remove_country_modifier = battlemage_academy_underwear_1
					add_country_modifier = { name = battlemage_academy_combined_un_graf_out duration = -1 }
				}
				else = {
					remove_country_modifier = battlemage_academy_outhouse_3
					remove_country_modifier = battlemage_academy_underwear_2
					remove_country_modifier = battlemage_academy_graffiti_1
					add_country_modifier = { name = battlemage_academy_combined_graf_un_out duration = -1 }
				}
			}
			else_if = {
				limit = { has_country_modifier = battlemage_academy_graffiti_3 }
				if = {
					limit = { has_country_modifier = battlemage_academy_underwear_2 }
					remove_country_modifier = battlemage_academy_graffiti_3
					remove_country_modifier = battlemage_academy_underwear_2
					remove_country_modifier = battlemage_academy_outhouse_1
					add_country_modifier = { name = battlemage_academy_combined_out_un_graf duration = -1 }
				}
				else = {
					remove_country_modifier = battlemage_academy_graffiti_3
					remove_country_modifier = battlemage_academy_outhouse_2
					remove_country_modifier = battlemage_academy_underwear_1
					add_country_modifier = { name = battlemage_academy_combined_un_out_graf duration = -1 }
				}
			}
			else_if = {
				limit = { has_country_modifier = battlemage_academy_underwear_3 }
				if = {
					limit = { has_country_modifier = battlemage_academy_outhouse_2 }
					remove_country_modifier = battlemage_academy_underwear_3
					remove_country_modifier = battlemage_academy_outhouse_2
					remove_country_modifier = battlemage_academy_graffiti_1
					add_country_modifier = { name = battlemage_academy_combined_graf_out_un duration = -1 }
				}
				else = {
					remove_country_modifier = battlemage_academy_underwear_3
					remove_country_modifier = battlemage_academy_graffiti_2
					remove_country_modifier = battlemage_academy_outhouse_1
					add_country_modifier = { name = battlemage_academy_combined_out_graf_un duration = -1 }
				}
			}
		}
	}

	option = {
		name = magic_project_battlemage_academy.5.a
		ai_chance = { factor = 1 }

		if = {
			limit = { at_least_magic_project_level = { project = battlemage_academy level = 3 } }
			custom_tooltip = battlemage_academy_project_effect_3
			set_country_flag = may_grant_battlemage_academies

			if = {
				limit = { has_country_flag = battlemage_academy_outhouse_flag }
				clr_country_flag = battlemage_academy_outhouse_flag
				add_country_modifier = { name = battlemage_academy_outhouse_3 duration = -1 }
			}
			else_if = {
				limit = { has_country_flag = battlemage_academy_graffiti_flag }
				clr_country_flag = battlemage_academy_graffiti_flag
				add_country_modifier = { name = battlemage_academy_graffiti_3 duration = -1 }
			}
			else_if = {
				limit = { has_country_flag = battlemage_academy_underwear_flag }
				clr_country_flag = battlemage_academy_underwear_flag
				add_country_modifier = { name = battlemage_academy_underwear_3 duration = -1 }
			}
		}
		else_if = {
			limit = { at_least_magic_project_level = { project = battlemage_academy level = 2 } }
			custom_tooltip = battlemage_academy_project_effect_2

			if = {
				limit = { has_country_flag = battlemage_academy_outhouse_flag }
				clr_country_flag = battlemage_academy_outhouse_flag
				add_country_modifier = { name = battlemage_academy_outhouse_2 duration = -1 }
			}
			else_if = {
				limit = { has_country_flag = battlemage_academy_graffiti_flag }
				clr_country_flag = battlemage_academy_graffiti_flag
				add_country_modifier = { name = battlemage_academy_graffiti_2 duration = -1 }
			}
			else_if = {
				limit = { has_country_flag = battlemage_academy_underwear_flag }
				clr_country_flag = battlemage_academy_underwear_flag
				add_country_modifier = { name = battlemage_academy_underwear_2 duration = -1 }
			}
		}
		else = {
			custom_tooltip = battlemage_academy_project_effect_1

			if = {
				limit = { has_country_flag = battlemage_academy_outhouse_flag }
				clr_country_flag = battlemage_academy_outhouse_flag
				add_country_modifier = { name = battlemage_academy_outhouse_1 duration = -1 }
			}
			else_if = {
				limit = { has_country_flag = battlemage_academy_graffiti_flag }
				clr_country_flag = battlemage_academy_graffiti_flag
				add_country_modifier = { name = battlemage_academy_graffiti_1 duration = -1 }
			}
			else_if = {
				limit = { has_country_flag = battlemage_academy_underwear_flag }
				clr_country_flag = battlemage_academy_underwear_flag
				add_country_modifier = { name = battlemage_academy_underwear_1 duration = -1 }
			}
		}

		create_war_wizard = yes
		if = {
			limit = { at_least_magic_project_level = { project = battlemage_academy level = 3 } }
			define_advisor = { skill = 4 type = army_organiser cost_multiplier = 0.25 }
			custom_tooltip = tooltip_magic_project_complete
		}
		else_if = {
			limit = { at_least_magic_project_level = { project = battlemage_academy level = 2 } }
			define_advisor = { skill = 3 type = artist cost_multiplier = 0.25 }
			custom_tooltip = tooltip_magic_project_advance
		}
		else = {
			define_advisor = { skill = 2 type = spymaster cost_multiplier = 0.25 }
			custom_tooltip = tooltip_magic_project_advance
		}
	}
}

############################
### THEATRE OF SIMULACRA ###
############################
#1 - Choosing unreality
#2 - Participating in the play
#3 - Awareness of the double
#4 - Part 1 over, meeting the double
#5 - Confusion, meeting the triple
#6 - Conferring with the double, seeking aid
#7 - Awareness of the triple, a plan comes together
#8 - Part 2 over, meeting the triple
#9 - Descent into madness, pre-performance Black Swan
#10 - Climax, Whiplash/Black Swan performance
#11 - Falling action as we continue to believe it all went to play
#12 - Conclusion, revelation that it was all a play

namespace = magic_project_theatre_of_simulacra

country_event = { #Theatre of Simulacra event handler
	id = magic_project_theatre_of_simulacra.0
	title = magic_project_theatre_of_simulacra.0.t
	desc = magic_project_theatre_of_simulacra.0.d
	picture = ANGRY_MOB_eventPicture

	is_triggered_only = yes
	hidden = yes

	option = {
		name = magic_project_theatre_of_simulacra.0.a
		ai_chance = { factor = 1 }

		if = {
			limit = { has_country_flag = magic_project_completed_flag }
			if = {
				limit = { at_least_magic_project_level = { project = theatre_of_simulacra level = 3 } }
				country_event = { id = magic_project_theatre_of_simulacra.12 }
			}
			else_if = {
				limit = { at_least_magic_project_level = { project = theatre_of_simulacra level = 2 } }
				country_event = { id = magic_project_theatre_of_simulacra.8 }
			}
			else = { country_event = { id = magic_project_theatre_of_simulacra.4 } }
		}
		else_if = {
			limit = {
				check_variable = { current_experience_percent = 33 }
				NOT = { has_country_flag = magic_project_first_event_happened }
			}
			set_country_flag = magic_project_first_event_happened
			set_country_flag = in_magic_progress_event
			if = {
				limit = { at_least_magic_project_level = { project = theatre_of_simulacra level = 2 } }
				country_event = { id = magic_project_theatre_of_simulacra.10 }
			}
			else_if = {
				limit = { at_least_magic_project_level = { project = theatre_of_simulacra level = 1 } }
				country_event = { id = magic_project_theatre_of_simulacra.6 }
			}
			else = { country_event = { id = magic_project_theatre_of_simulacra.2 } }
		}
		else_if = {
			limit = {
				check_variable = { current_experience_percent = 67 }
				NOT = { has_country_flag = magic_project_second_event_happened }
			}
			set_country_flag = magic_project_second_event_happened
			set_country_flag = in_magic_progress_event
			if = {
				limit = { at_least_magic_project_level = { project = theatre_of_simulacra level = 2 } }
				country_event = { id = magic_project_theatre_of_simulacra.11 }
			}
			else_if = {
				limit = { at_least_magic_project_level = { project = theatre_of_simulacra level = 1 } }
				country_event = { id = magic_project_theatre_of_simulacra.7 }
			}
			else = { country_event = { id = magic_project_theatre_of_simulacra.3 } }
		}
	}
}
country_event = { #Theatre 1 - Setting
	id = magic_project_theatre_of_simulacra.1
	title = magic_project_theatre_of_simulacra.1.t
	desc = magic_project_theatre_of_simulacra.1.d
	picture = PRINCELY_PALACE_TRANSYLVANIA_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = in_magic_progress_event }
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_theatre_of_simulacra.1.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}

	option = {
		name = magic_project_theatre_of_simulacra.1.truth
		ai_chance = { factor = 1 }

		add_adm_power = -20
		set_country_flag = theatre_picked_small_room
	}
}
country_event = { #Theatre 2 - Character
	id = magic_project_theatre_of_simulacra.2
	title = magic_project_theatre_of_simulacra.2.t
	desc = magic_project_theatre_of_simulacra.2.d
	picture = DIET_eventPicture

	is_triggered_only = yes
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_theatre_of_simulacra.2.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}

	option = {
		name = magic_project_theatre_of_simulacra.2.truth
		ai_chance = { factor = 1 }

		add_dip_power = -20
		set_country_flag = theatre_picked_group_of_mages
	}
}
country_event = { #Theatre 3 - Plot
	id = magic_project_theatre_of_simulacra.3
	title = magic_project_theatre_of_simulacra.3.t
	desc = magic_project_theatre_of_simulacra.3.d
	picture = JURAJ_JANOSIK_eventPicture

	is_triggered_only = yes
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_theatre_of_simulacra.3.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}

	option = {
		name = magic_project_theatre_of_simulacra.3.truth
		ai_chance = { factor = 1 }

		add_mil_power = -20
	}
}
country_event = { #Theatre 4 - Overture
	id = magic_project_theatre_of_simulacra.4
	title = magic_project_theatre_of_simulacra.4.t
	desc = magic_project_theatre_of_simulacra.4.d
	picture = CONQUISTADORS_eventPicture

	is_triggered_only = yes

	immediate = { hidden_effect = { set_variable = { which = theatre_of_simulacra_bonuses value = 0 } } }

	option = {
		name = magic_project_theatre_of_simulacra.4.a
		ai_chance = { factor = 1 }

		custom_tooltip = theatre_of_simulacra_project_effect_1
		custom_tooltip = tooltip_magic_project_advance
	}

	option = {
		name = magic_project_theatre_of_simulacra.4.a
		ai_chance = { factor = 1 }

		custom_tooltip = theatre_of_simulacra_project_effect_1
		custom_tooltip = tooltip_magic_project_advance
	}
}
country_event = { #Theatre 5 - Act 1
	id = magic_project_theatre_of_simulacra.5
	title = magic_project_theatre_of_simulacra.5.t
	desc = magic_project_theatre_of_simulacra.5.d
	picture = CARDINAL_RICHELIEU_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = in_magic_progress_event }
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_theatre_of_simulacra.5.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}

	option = {
		name = magic_project_theatre_of_simulacra.5.truth
		ai_chance = { factor = 1 }
		capital_scope = { add_unrest = 10 }
	}

	option = {
		name = magic_project_theatre_of_simulacra.5.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}

	option = {
		name = magic_project_theatre_of_simulacra.5.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}
}
country_event = { #Theatre 6 - Backstage
	id = magic_project_theatre_of_simulacra.6
	title = magic_project_theatre_of_simulacra.6.t
	desc = magic_project_theatre_of_simulacra.6.d
	picture = 12_Maratha_Estate_eventPicture

	is_triggered_only = yes
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_theatre_of_simulacra.6.truth
		ai_chance = { factor = 1 }
		kill_advisor = random
	}

	option = {
		name = magic_project_theatre_of_simulacra.6.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}

	option = {
		name = magic_project_theatre_of_simulacra.6.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}

	option = {
		name = magic_project_theatre_of_simulacra.6.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}
}
country_event = { #Theatre 7 - Act 2
	id = magic_project_theatre_of_simulacra.7
	title = magic_project_theatre_of_simulacra.7.t
	desc = magic_project_theatre_of_simulacra.7.d
	picture = CHAMBER_OF_CURIOSITIES_eventPicture

	is_triggered_only = yes
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_theatre_of_simulacra.7.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}

	option = {
		name = magic_project_theatre_of_simulacra.7.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}

	option = {
		name = magic_project_theatre_of_simulacra.7.truth
		ai_chance = { factor = 1 }
		add_war_exhaustion = 1
	}

	option = {
		name = magic_project_theatre_of_simulacra.7.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}
}
country_event = { #Theatre 8 - Intermission
	id = magic_project_theatre_of_simulacra.8
	title = magic_project_theatre_of_simulacra.8.t
	desc = magic_project_theatre_of_simulacra.8.d
	picture = southamericagfx_ADVISOR_eventPicture

	is_triggered_only = yes
	after = { hidden_effect = { remove_country_modifier = theatre_cooldown_mod } }

	option = {
		name = magic_project_theatre_of_simulacra.8.a
		ai_chance = { factor = 1 }

		custom_tooltip = theatre_of_simulacra_project_effect_2
		custom_tooltip = tooltip_magic_project_advance
	}

	option = {
		name = magic_project_theatre_of_simulacra.8.a
		ai_chance = { factor = 1 }

		custom_tooltip = theatre_of_simulacra_project_effect_2
		custom_tooltip = tooltip_magic_project_advance
	}

	option = {
		name = magic_project_theatre_of_simulacra.8.a
		ai_chance = { factor = 1 }

		custom_tooltip = theatre_of_simulacra_project_effect_2
		custom_tooltip = tooltip_magic_project_advance
	}

	option = {
		name = magic_project_theatre_of_simulacra.8.a
		ai_chance = { factor = 1 }

		custom_tooltip = theatre_of_simulacra_project_effect_2
		custom_tooltip = tooltip_magic_project_advance
	}
}
country_event = { #Theatre 9 - Act 3
	id = magic_project_theatre_of_simulacra.9
	title = magic_project_theatre_of_simulacra.9.t
	desc = magic_project_theatre_of_simulacra.9.d
	picture = PROTESTANT_GREAT_REFORMER_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = in_magic_progress_event }
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_theatre_of_simulacra.9.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}

	option = {
		name = magic_project_theatre_of_simulacra.9.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}

	option = {
		name = magic_project_theatre_of_simulacra.9.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}

	option = {
		name = magic_project_theatre_of_simulacra.9.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}

	option = {
		name = magic_project_theatre_of_simulacra.9.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}

	option = {
		name = magic_project_theatre_of_simulacra.9.truth
		ai_chance = { factor = 1 }
		add_army_tradition = -10
	}
}
country_event = { #Theatre 10 - Act 4
	id = magic_project_theatre_of_simulacra.10
	title = magic_project_theatre_of_simulacra.10.t
	desc = magic_project_theatre_of_simulacra.10.d
	picture = TEMPORAL_RIFT_eventPicture

	is_triggered_only = yes
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_theatre_of_simulacra.10.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}

	option = {
		name = magic_project_theatre_of_simulacra.10.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}

	option = {
		name = magic_project_theatre_of_simulacra.10.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}

	option = {
		name = magic_project_theatre_of_simulacra.10.truth
		ai_chance = { factor = 1 }
		add_splendor = -40
	}

	option = {
		name = magic_project_theatre_of_simulacra.10.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}

	option = {
		name = magic_project_theatre_of_simulacra.10.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}
}
country_event = { #Theatre 11 - Act 5
	id = magic_project_theatre_of_simulacra.11
	title = magic_project_theatre_of_simulacra.11.t
	desc = magic_project_theatre_of_simulacra.11.d
	picture = ROYAL_COUPLE_FUTURE_eventPicture

	is_triggered_only = yes
	after = { clr_country_flag = in_magic_progress_event }

	option = {
		name = magic_project_theatre_of_simulacra.11.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}

	option = {
		name = magic_project_theatre_of_simulacra.11.truth
		ai_chance = { factor = 1 }
		add_prestige = -10
	}

	option = {
		name = magic_project_theatre_of_simulacra.11.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}

	option = {
		name = magic_project_theatre_of_simulacra.11.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}

	option = {
		name = magic_project_theatre_of_simulacra.11.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}

	option = {
		name = magic_project_theatre_of_simulacra.11.lie
		ai_chance = { factor = 1 }
		theatre_of_simulacra_lose_sanity = yes
	}
}
country_event = { #Theatre 12 - Denouement
	id = magic_project_theatre_of_simulacra.12
	title = magic_project_theatre_of_simulacra.12.t
	desc = magic_project_theatre_of_simulacra.12.d
	picture = FOUNTAIN_OF_YOUTH_eventPicture

	is_triggered_only = yes
	after = { hidden_effect = { remove_country_modifier = theatre_cooldown_mod } }

	option = {
		name = magic_project_theatre_of_simulacra.12.a
		ai_chance = { factor = 1 }

		custom_tooltip = theatre_of_simulacra_project_effect_3
		custom_tooltip = tooltip_magic_project_complete
	}

	option = {
		name = magic_project_theatre_of_simulacra.12.a
		ai_chance = { factor = 1 }

		custom_tooltip = theatre_of_simulacra_project_effect_3
		custom_tooltip = tooltip_magic_project_complete
	}

	option = {
		name = magic_project_theatre_of_simulacra.12.a
		ai_chance = { factor = 1 }

		custom_tooltip = theatre_of_simulacra_project_effect_3
		custom_tooltip = tooltip_magic_project_complete
	}

	option = {
		name = magic_project_theatre_of_simulacra.12.a
		ai_chance = { factor = 1 }

		custom_tooltip = theatre_of_simulacra_project_effect_3
		custom_tooltip = tooltip_magic_project_complete
	}

	option = {
		name = magic_project_theatre_of_simulacra.12.a
		ai_chance = { factor = 1 }

		custom_tooltip = theatre_of_simulacra_project_effect_3
		custom_tooltip = tooltip_magic_project_complete
	}

	option = {
		name = magic_project_theatre_of_simulacra.12.a
		ai_chance = { factor = 1 }

		custom_tooltip = theatre_of_simulacra_project_effect_3
		custom_tooltip = tooltip_magic_project_complete
	}
}
country_event = { #Theatre of Simulacra menu
	id = magic_project_theatre_of_simulacra.13
	title = magic_project_theatre_of_simulacra.13.t
	desc = magic_project_theatre_of_simulacra.13.d
	picture = THEATRE_eventPicture

	is_triggered_only = yes

	option = {
		name = magic_project_theatre_of_simulacra.13.go_back
		ai_chance = { factor = 1 }

		clr_country_flag = in_theatre_of_simulacra

		if = { #You can do multiple at a time
			limit = { OR = { has_country_flag = new_theatre_bonus ai = yes } }
			clr_country_flag = new_theatre_bonus
			if = {
				limit = { exactly_magic_project_level = { project = theatre_of_simulacra level = 3 } }
				add_country_modifier = { name = theatre_cooldown_mod duration = 1825 hidden = yes }
			}
			else_if = {
				limit = { exactly_magic_project_level = { project = theatre_of_simulacra level = 2 } }
				add_country_modifier = { name = theatre_cooldown_mod duration = 3650 hidden = yes }
			}
			else = { add_country_modifier = { name = theatre_cooldown_mod duration = 5475 hidden = yes } }
		}
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.a
		ai_chance = { factor = 1 }
		highlight = yes

		set_country_flag = in_powerful_mage_theatre
		hidden_effect = { country_event = { id = magic_project_theatre_of_simulacra.15 } }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.just
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = just } }

		theatre_of_simulacra_add_bonus = { bonus = just }
	}
	
	option = {
		name = magic_project_theatre_of_simulacra.13.just_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = just } }

		theatre_of_simulacra_remove_bonus = { bonus = just }
	}
	
	option = {
		name = magic_project_theatre_of_simulacra.13.righteous
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = righteous } }

		theatre_of_simulacra_add_bonus = { bonus = righteous }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.righteous_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = righteous } }

		theatre_of_simulacra_remove_bonus = { bonus = righteous }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.tolerant
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = tolerant } }

		theatre_of_simulacra_add_bonus = { bonus = tolerant }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.tolerant_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = tolerant } }

		theatre_of_simulacra_remove_bonus = { bonus = tolerant }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.kind_hearted
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = kind_hearted } }

		theatre_of_simulacra_add_bonus = { bonus = kind_hearted }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.kind_hearted_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = kind_hearted } }

		theatre_of_simulacra_remove_bonus = { bonus = kind_hearted }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.free_thinker
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = free_thinker } }

		theatre_of_simulacra_add_bonus = { bonus = free_thinker }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.free_thinker_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = free_thinker } }

		theatre_of_simulacra_remove_bonus = { bonus = free_thinker }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.well_connected
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = well_connected } }

		theatre_of_simulacra_add_bonus = { bonus = well_connected }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.well_connected_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = well_connected } }

		theatre_of_simulacra_remove_bonus = { bonus = well_connected }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.calm
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = calm } }

		theatre_of_simulacra_add_bonus = { bonus = calm }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.calm_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = calm } }

		theatre_of_simulacra_remove_bonus = { bonus = calm }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.careful
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = careful } }

		theatre_of_simulacra_add_bonus = { bonus = careful }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.careful_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = careful } }

		theatre_of_simulacra_remove_bonus = { bonus = careful }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.secretive
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = secretive } }

		theatre_of_simulacra_add_bonus = { bonus = secretive }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.secretive_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = secretive } }

		theatre_of_simulacra_remove_bonus = { bonus = secretive }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.intricate_web_weaver
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = intricate_web_weaver } }

		theatre_of_simulacra_add_bonus = { bonus = intricate_web_weaver }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.intricate_web_weaver_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = intricate_web_weaver } }

		theatre_of_simulacra_remove_bonus = { bonus = intricate_web_weaver }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.benevolent
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = benevolent } }

		theatre_of_simulacra_add_bonus = { bonus = benevolent }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.benevolent_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = benevolent } }

		theatre_of_simulacra_remove_bonus = { bonus = benevolent }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.zealot
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = zealot } }

		theatre_of_simulacra_add_bonus = { bonus = zealot }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.zealot_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = zealot } }

		theatre_of_simulacra_remove_bonus = { bonus = zealot }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.pious
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = pious } }

		theatre_of_simulacra_add_bonus = { bonus = pious }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.pious_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = pious } }

		theatre_of_simulacra_remove_bonus = { bonus = pious }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.lawgiver
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = lawgiver } }

		theatre_of_simulacra_add_bonus = { bonus = lawgiver }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.lawgiver_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = lawgiver } }

		theatre_of_simulacra_remove_bonus = { bonus = lawgiver }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.midas_touched
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = midas_touched } }

		theatre_of_simulacra_add_bonus = { bonus = midas_touched }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.midas_touched_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = midas_touched } }

		theatre_of_simulacra_remove_bonus = { bonus = midas_touched }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.incorruptible
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = incorruptible } }

		theatre_of_simulacra_add_bonus = { bonus = incorruptible }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.incorruptible_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = incorruptible } }

		theatre_of_simulacra_remove_bonus = { bonus = incorruptible }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.architectural_visionary
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = architectural_visionary } }

		theatre_of_simulacra_add_bonus = { bonus = architectural_visionary }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.architectural_visionary_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = architectural_visionary } }

		theatre_of_simulacra_remove_bonus = { bonus = architectural_visionary }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.scholar
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = scholar } }

		theatre_of_simulacra_add_bonus = { bonus = scholar }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.scholar_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = scholar } }

		theatre_of_simulacra_remove_bonus = { bonus = scholar }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.entrepreneur
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = entrepreneur } }

		theatre_of_simulacra_add_bonus = { bonus = entrepreneur }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.entrepreneur_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = entrepreneur } }

		theatre_of_simulacra_remove_bonus = { bonus = entrepreneur }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.industrious
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = industrious } }

		theatre_of_simulacra_add_bonus = { bonus = industrious }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.industrious_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = industrious } }

		theatre_of_simulacra_remove_bonus = { bonus = industrious }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.expansionist
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = expansionist } }

		theatre_of_simulacra_add_bonus = { bonus = expansionist }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.expansionist_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = expansionist } }

		theatre_of_simulacra_remove_bonus = { bonus = expansionist }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.charismatic_negotiator
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = charismatic_negotiator } }

		theatre_of_simulacra_add_bonus = { bonus = charismatic_negotiator }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.charismatic_negotiator_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = charismatic_negotiator } }

		theatre_of_simulacra_remove_bonus = { bonus = charismatic_negotiator }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.silver_tongue
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = silver_tongue } }

		theatre_of_simulacra_add_bonus = { bonus = silver_tongue }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.silver_tongue_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = silver_tongue } }

		theatre_of_simulacra_remove_bonus = { bonus = silver_tongue }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.conqueror
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = conqueror } }

		theatre_of_simulacra_add_bonus = { bonus = conqueror }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.conqueror_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = conqueror } }

		theatre_of_simulacra_remove_bonus = { bonus = conqueror }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.tactical_genius
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = tactical_genius } }

		theatre_of_simulacra_add_bonus = { bonus = tactical_genius }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.tactical_genius_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = tactical_genius } }

		theatre_of_simulacra_remove_bonus = { bonus = tactical_genius }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.bold_fighter
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = bold_fighter } }

		theatre_of_simulacra_add_bonus = { bonus = bold_fighter }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.bold_fighter_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = bold_fighter } }

		theatre_of_simulacra_remove_bonus = { bonus = bold_fighter }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.strict
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = strict } }

		theatre_of_simulacra_add_bonus = { bonus = strict }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.strict_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = strict } }

		theatre_of_simulacra_remove_bonus = { bonus = strict }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.inspiring_leader
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = inspiring_leader } }

		theatre_of_simulacra_add_bonus = { bonus = inspiring_leader }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.inspiring_leader_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = inspiring_leader } }

		theatre_of_simulacra_remove_bonus = { bonus = inspiring_leader }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.martial_educator
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = martial_educator } }

		theatre_of_simulacra_add_bonus = { bonus = martial_educator }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.martial_educator_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = martial_educator } }

		theatre_of_simulacra_remove_bonus = { bonus = martial_educator }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.navigator
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = navigator } }

		theatre_of_simulacra_add_bonus = { bonus = navigator }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.navigator_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = navigator } }

		theatre_of_simulacra_remove_bonus = { bonus = navigator }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.fierce_negotiator
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = fierce_negotiator } }

		theatre_of_simulacra_add_bonus = { bonus = fierce_negotiator }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.fierce_negotiator_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = fierce_negotiator } }

		theatre_of_simulacra_remove_bonus = { bonus = fierce_negotiator }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.reformist
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = reformist } }

		theatre_of_simulacra_add_bonus = { bonus = reformist }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.reformist_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = reformist } }

		theatre_of_simulacra_remove_bonus = { bonus = reformist }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.legendary_pirate
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = legendary_pirate } }

		theatre_of_simulacra_add_bonus = { bonus = legendary_pirate }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.legendary_pirate_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = legendary_pirate } }

		theatre_of_simulacra_remove_bonus = { bonus = legendary_pirate }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.humane
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = humane } }

		theatre_of_simulacra_add_bonus = { bonus = humane }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.humane_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = humane } }

		theatre_of_simulacra_remove_bonus = { bonus = humane }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.legendary_conqueror
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = legendary_conqueror } }

		theatre_of_simulacra_add_bonus = { bonus = legendary_conqueror }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.legendary_conqueror_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = legendary_conqueror } }

		theatre_of_simulacra_remove_bonus = { bonus = legendary_conqueror }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.great_engineer
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = great_engineer } }

		theatre_of_simulacra_add_bonus = { bonus = great_engineer }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.great_engineer_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = great_engineer } }

		theatre_of_simulacra_remove_bonus = { bonus = great_engineer }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.patron_of_arts
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = patron_of_arts } }

		theatre_of_simulacra_add_bonus = { bonus = patron_of_arts }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.patron_of_arts_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = patron_of_arts } }

		theatre_of_simulacra_remove_bonus = { bonus = patron_of_arts }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.fu_papal_puppetmaster
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = fu_papal_puppetmaster } }

		theatre_of_simulacra_add_bonus = { bonus = fu_papal_puppetmaster }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.fu_papal_puppetmaster_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = fu_papal_puppetmaster } }

		theatre_of_simulacra_remove_bonus = { bonus = fu_papal_puppetmaster }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.iron_crowned
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = iron_crowned } }

		theatre_of_simulacra_add_bonus = { bonus = iron_crowned }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.iron_crowned_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = iron_crowned } }

		theatre_of_simulacra_remove_bonus = { bonus = iron_crowned }
	}

	option = {
		name = magic_project_theatre_of_simulacra.13.peasant_revolt_leader
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_personality_available_trigger = { personality = peasant_revolt_leader } }

		theatre_of_simulacra_add_bonus = { bonus = peasant_revolt_leader }
	}
	option = {
		name = magic_project_theatre_of_simulacra.13.peasant_revolt_leader_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = peasant_revolt_leader } }

		theatre_of_simulacra_remove_bonus = { bonus = peasant_revolt_leader }
	}

	after = {
		hidden_effect = {
			if = {
				limit = {
					has_country_flag = in_theatre_of_simulacra
					NOT = { has_country_flag = in_powerful_mage_theatre }
				}
				country_event = { id = magic_project_theatre_of_simulacra.14 }
			}
		}
	}
}
country_event = { #Theatre of Simulacra Bounceback
	id = magic_project_theatre_of_simulacra.14
	title = magic_project_theatre_of_simulacra.14.t
	desc = magic_project_theatre_of_simulacra.14.d
	picture = ANGRY_MOB_eventPicture

	is_triggered_only = yes
	hidden = yes

	option = {
		name = magic_project_theatre_of_simulacra.5.a
		ai_chance = { factor = 1 }

		if = {
			limit = {
				OR = {
					ai = yes #AI shouldn't be hitting this case
					had_country_flag = { flag = in_theatre_of_simulacra days = 31 }
				}
			}

			clr_country_flag = in_theatre_of_simulacra

			if = { #You can do multiple at a time
				limit = { OR = { has_country_flag = new_theatre_bonus ai = yes } }
				clr_country_flag = new_theatre_bonus
				if = {
					limit = { exactly_magic_project_level = { project = theatre_of_simulacra level = 3 } }
					add_country_modifier = { name = theatre_cooldown_mod duration = 1825 hidden = yes }
				}
				else_if = {
					limit = { exactly_magic_project_level = { project = theatre_of_simulacra level = 2 } }
					add_country_modifier = { name = theatre_cooldown_mod duration = 3650 hidden = yes }
				}
				else = { add_country_modifier = { name = theatre_cooldown_mod duration = 5475 hidden = yes } }
			}
		}
		else = { country_event = { id = magic_project_theatre_of_simulacra.13 } }
	}
}
country_event = { #Theatre of Simulacra sub-menu
	id = magic_project_theatre_of_simulacra.15
	title = magic_project_theatre_of_simulacra.15.t
	desc = magic_project_theatre_of_simulacra.15.d
	picture = THEATRE_eventPicture

	is_triggered_only = yes

	option = {
		name = magic_project_theatre_of_simulacra.15.go_back
		ai_chance = { factor = 1 }
		clr_country_flag = in_powerful_mage_theatre
		country_event = { id = magic_project_theatre_of_simulacra.13 }
	}

	option = {
		name = magic_project_theatre_of_simulacra.15.abjuration
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_school_available_trigger = { school = abjuration } }

		theatre_of_simulacra_add_bonus = { bonus = abjuration }
	}
	option = {
		name = magic_project_theatre_of_simulacra.15.abjuration_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = abjuration } }

		theatre_of_simulacra_remove_bonus = { bonus = abjuration }
	}

	option = {
		name = magic_project_theatre_of_simulacra.15.conjuration
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_school_available_trigger = { school = conjuration } }

		theatre_of_simulacra_add_bonus = { bonus = conjuration }
	}
	option = {
		name = magic_project_theatre_of_simulacra.15.conjuration_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = conjuration } }

		theatre_of_simulacra_remove_bonus = { bonus = conjuration }
	}

	option = {
		name = magic_project_theatre_of_simulacra.15.divination
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_school_available_trigger = { school = divination } }

		theatre_of_simulacra_add_bonus = { bonus = divination }
	}
	option = {
		name = magic_project_theatre_of_simulacra.15.divination_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = divination } }

		theatre_of_simulacra_remove_bonus = { bonus = divination }
	}

	option = {
		name = magic_project_theatre_of_simulacra.15.enchantment
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_school_available_trigger = { school = enchantment } }

		theatre_of_simulacra_add_bonus = { bonus = enchantment }
	}
	option = {
		name = magic_project_theatre_of_simulacra.15.enchantment_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = enchantment } }

		theatre_of_simulacra_remove_bonus = { bonus = enchantment }
	}

	option = {
		name = magic_project_theatre_of_simulacra.15.evocation
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_school_available_trigger = { school = evocation } }

		theatre_of_simulacra_add_bonus = { bonus = evocation }
	}
	option = {
		name = magic_project_theatre_of_simulacra.15.evocation_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = evocation } }

		theatre_of_simulacra_remove_bonus = { bonus = evocation }
	}

	option = {
		name = magic_project_theatre_of_simulacra.15.illusion
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_school_available_trigger = { school = illusion } }

		theatre_of_simulacra_add_bonus = { bonus = illusion }
	}
	option = {
		name = magic_project_theatre_of_simulacra.15.illusion_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = illusion } }

		theatre_of_simulacra_remove_bonus = { bonus = illusion }
	}

	option = {
		name = magic_project_theatre_of_simulacra.15.necromancy
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_school_available_trigger = { school = necromancy } }

		theatre_of_simulacra_add_bonus = { bonus = necromancy }
	}
	option = {
		name = magic_project_theatre_of_simulacra.15.necromancy_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = necromancy } }

		theatre_of_simulacra_remove_bonus = { bonus = necromancy }
	}

	option = {
		name = magic_project_theatre_of_simulacra.15.transmutation
		ai_chance = { factor = 1 }
		trigger = { theatre_of_simulacra_school_available_trigger = { school = transmutation } }

		theatre_of_simulacra_add_bonus = { bonus = transmutation }
	}
	option = {
		name = magic_project_theatre_of_simulacra.15.transmutation_remove
		ai_chance = { factor = 0 }
		highlight = yes
		trigger = { theatre_of_simulacra_can_remove_bonus_trigger = { bonus = transmutation } }

		theatre_of_simulacra_remove_bonus = { bonus = transmutation }
	}

	after = {
		hidden_effect = {
			if = {
				limit = { has_country_flag = in_powerful_mage_theatre }
				country_event = { id = magic_project_theatre_of_simulacra.16 }
			}
		}
	}
}
country_event = { #Theatre of Simulacra sub-menu bounceback
	id = magic_project_theatre_of_simulacra.16
	title = magic_project_theatre_of_simulacra.16.t
	desc = magic_project_theatre_of_simulacra.16.d
	picture = ANGRY_MOB_eventPicture

	is_triggered_only = yes
	hidden = yes

	option = {
		name = magic_project_theatre_of_simulacra.16.a
		ai_chance = { factor = 1 }


		if = {
			limit = {
				OR = {
					ai = yes #AI shouldn't be hitting this case
					had_country_flag = { flag = in_theatre_of_simulacra days = 31 }
				}
			}

			clr_country_flag = in_theatre_of_simulacra
			clr_country_flag = in_powerful_mage_theatre

			if = { #You can do multiple at a time
				limit = { OR = { has_country_flag = new_theatre_bonus ai = yes } }
				clr_country_flag = new_theatre_bonus
				if = {
					limit = { exactly_magic_project_level = { project = theatre_of_simulacra level = 3 } }
					add_country_modifier = { name = theatre_cooldown_mod duration = 1825 hidden = yes }
				}
				else_if = {
					limit = { exactly_magic_project_level = { project = theatre_of_simulacra level = 2 } }
					add_country_modifier = { name = theatre_cooldown_mod duration = 3650 hidden = yes }
				}
				else = { add_country_modifier = { name = theatre_cooldown_mod duration = 5475 hidden = yes } }
			}
		}
		else = { country_event = { id = magic_project_theatre_of_simulacra.15 } }
	}
}

###############
### LICHDOM ###
###############
#1 - Find tome how to do it
#2 - Phylactery 1 - Constructing the Container
#3 - Phylactery 2 - Carving the Interiors Walls
#4 - Phylactery 3 - Enchanting the Phylactery
#5 - Potion 1 - Collecting Reagents 1
#6 - Potion 2 - Collecting Reagents 2 (this should have like abcde variants for sending quests)
#7 - Potion 3 - Getting the vessel (aka heart of a loved one/innocent, heart of a unicorn) quest time!
#8 - Dark Ritual 1 - Preparing everything, getting all sorts of dark wards and shit
#9 - Dark Ritual 2 - Cleansing and putting yourself to near death
#10 - Dark Ritual 3 - drinking it (success rate determined by how much money you spent before)
#11 - Lichdom

namespace = magic_project_lichdom

country_event = { #Lichdom event handler
	id = magic_project_lichdom.0
	title = magic_project_lichdom.0.t
	desc = magic_project_lichdom.0.d
	picture = END_OF_TIME_eventPicture

	is_triggered_only = yes
	hidden = yes

	option = { #It has to be this complex on account of people stopping and starting research
		name = magic_project_lichdom.0.a
		ai_chance = { factor = 1 }


		if = { limit = { has_ruler_modifier = lichdom_mod_2 }
			if = {
				limit = { at_least_magic_project_level = { project = lichdom level = 3 } }
				country_event = { id = magic_project_lichdom.10 }
			}
			else_if = {
				limit = {
					check_variable = { current_experience_percent = 33 }
					NOT = { has_ruler_modifier = studying_lichdom_prep has_ruler_modifier = studying_lichdom_circle }
				}
				country_event = { id = magic_project_lichdom.8 }
			}
			else_if = {
				limit = {
					check_variable = { current_experience_percent = 67 }
					NOT = { has_ruler_modifier = studying_lichdom_cleansing has_ruler_modifier = studying_lichdom_cleansinger }
				}
				country_event = { id = magic_project_lichdom.9 }
			}
		}
		else_if = { limit = { has_ruler_modifier = lichdom_mod_1 }
			if = {
				limit = { at_least_magic_project_level = { project = lichdom level = 2 } }
				country_event = { id = magic_project_lichdom.7 }
			}
			else_if = {
				limit = {
					check_variable = { current_experience_percent = 33 }
					NOT = { has_ruler_modifier = studying_lichdom_roots has_ruler_modifier = studying_lichdom_bowls has_ruler_modifier = studying_lichdom_blooms }
				}
				country_event = { id = magic_project_lichdom.5 }
			}
			else_if = {
				limit = {
					check_variable = { current_experience_percent = 67 }
					NOT = { has_ruler_modifier = studying_lichdom_korashi has_ruler_modifier = studying_lichdom_venom has_ruler_modifier = studying_lichdom_wyvern }
				}
				country_event = { id = magic_project_lichdom.6 }
			}
		}
		else = {
			if = {
				limit = { at_least_magic_project_level = { project = lichdom level = 1 } }
				country_event = { id = magic_project_lichdom.4 }
			}
			else_if = {
				limit = {
					check_variable = { current_experience_percent = 33 }
					NOT = { has_ruler_modifier = studying_lichdom_amulet has_ruler_modifier = studying_lichdom_box }
				}
				country_event = { id = magic_project_lichdom.2 }
			}
			else_if = {
				limit = {
					check_variable = { current_experience_percent = 67 }
					NOT = { has_ruler_modifier = studying_lichdom_parchment has_ruler_modifier = studying_lichdom_runes has_ruler_modifier = studying_lichdom_blood }
				}
				country_event = { id = magic_project_lichdom.3 }
			}
		}
	}
}

country_event = { #Lichdom 1 - Finding out how to do it
	id = magic_project_lichdom.1
	title = magic_project_lichdom.1.t
	desc = magic_project_lichdom.1.d
	picture = muslimgfx_BIG_BOOK_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = in_magic_progress_event }
	after = { clr_country_flag = in_magic_progress_event }
	
	immediate = {
		hidden_effect = {
			if = {
				limit = { wyvernheart_is_floodborn_council = yes }
				capital_scope = {
					spawn_rebels = {
						size = 2
						type = mage_rebels
					}
				}
			}
		}
	}

	option = { #Send Mages to find a lost tome
		name = magic_project_lichdom.1.a
		ai_chance = { factor = 1 }
		add_treasury = -100
		increase_estate_witch_king_points = { size = small }
		start_magic_project = { project = lichdom school = necromancy }
	}

	option = { #I'll find it myself!
		name = magic_project_lichdom.1.b
		ai_chance = { factor = 1 }
		add_adm_power = -50
		add_dip_power = -50

		increase_ruler_witch_king_points = { size = small }
		set_ruler_flag = magic_advancement
		set_ruler_flag = necromancy_advancement
		set_country_flag = magic_project
		set_country_flag = lichdom_project
		hidden_effect = { set_variable = { ruler_magic_experience = 0 } }

		add_ruler_modifier = { name = ruler_studying_lichdom duration = -1 desc = until_advancement_concludes }
		
		hidden_effect = {
			if = {
				limit = { has_ruler_modifier = lichdom_mod_2 }
				set_magic_experience_target = { type = ruler xptarget = 850 }
			}
			else_if = {
				limit = { has_ruler_modifier = lichdom_mod_1 }
				set_magic_experience_target = { type = ruler xptarget = 600 }
			}
			else = { set_magic_experience_target = { type = ruler xptarget = 350 } }
		}
	}
}
country_event = { #Lichdom 2 - Phylactery 1 - Constructing the Container
	id = magic_project_lichdom.2
	title = magic_project_lichdom.2.t
	desc = magic_project_lichdom.2.d
	picture = DEATH_OF_HEIR_eventPicture

	is_triggered_only = yes
	immediate = { set_country_flag = in_magic_progress_event }
	after = { clr_country_flag = in_magic_progress_event }
	
	immediate = {
		hidden_effect = {
			if = {
				limit = { wyvernheart_is_floodborn_council = yes }
				capital_scope = {
					spawn_rebels = {
						size = 2
						type = mage_rebels
					}
				}
			}
		}
	}


	option = {	#An amulet capable of containing a small object
		name = magic_project_lichdom.2.a
		ai_chance = { factor = 50 }
		
		add_treasury = -100
		add_ruler_modifier = { name = studying_lichdom_amulet duration = -1 }
	}
	
	option = {	#An ornate, jewel-encrusted box
		name = magic_project_lichdom.2.b
		ai_chance = { factor = 50 }
		
		add_treasury = -200
		add_ruler_modifier = { name = studying_lichdom_box duration = -1 }
	}
}

country_event = { #Lichdom 3 - Phylactery 2 - Carving the Interiors Walls
	id = magic_project_lichdom.3
	title = magic_project_lichdom.3.t
	desc = magic_project_lichdom.3.d
	picture = PAINTER_ARTIST_eventPicture
	
	is_triggered_only = yes
	immediate = { set_country_flag = in_magic_progress_event }
	after = { clr_country_flag = in_magic_progress_event }

	option = {	#Scribe dark spells on tiny magical parchments to put inside
		name = magic_project_lichdom.3.a
		ai_chance = { factor = 50 }
		
		add_adm_power = -100
		add_ruler_modifier = { name = studying_lichdom_parchment duration = -1 }
	}
	
	option = {	#Carve unholy runes on the interior walls and fill them with liquified Damestear
		name = magic_project_lichdom.3.b
		ai_chance = { factor = 50 }
		
		add_dip_power = -100
		add_ruler_modifier = { name = studying_lichdom_runes duration = -1 }
	}
	
	option = {	#Coat the insides with enchanted blood of a magical beast
		name = magic_project_lichdom.3.c
		ai_chance = { factor = 50 }
		
		add_mil_power = -100
		add_ruler_modifier = { name = studying_lichdom_blood duration = -1 }
	}
}

country_event = { #Lichdom 4 - Phylactery 3 - Enchanting the Phylactery
	id = magic_project_lichdom.4
	title = magic_project_lichdom.4.t
	desc = magic_project_lichdom.4.d
	picture = MAGE_MOON_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			if = {
				limit = { wyvernheart_is_floodborn_council = yes }
				capital_scope = {
					spawn_rebels = {
						size = 2
						type = mage_rebels
					}
				}
			}
		}
	}

	option = {	#Perform Dark Enchantments
		name = magic_project_lichdom.4.a
		ai_chance = { factor = 50 }
		
		add_adm_power = -100
		increase_witch_king_points_large = { level = necromancy_level_1_minimum }
		add_ruler_modifier = { name = lichdom_mod_1 duration = -1 }

		custom_tooltip = tooltip_magic_project_advance
	}
}

country_event = { #Lichdom 5 - Potion 1 - Collecting Reagents 1
	id = magic_project_lichdom.5
	title = magic_project_lichdom.5.t
	desc = magic_project_lichdom.5.d
	picture = TRADE_GOODS_PLANTATION_GOODS_IN_WAREHOUSE_eventPicture
	
	is_triggered_only = yes
	immediate = { set_country_flag = in_magic_progress_event }
	after = { clr_country_flag = in_magic_progress_event }
	
	option = {	#4 roots of Queen's Belladonna
		name = magic_project_lichdom.5.a
		ai_chance = { factor = 50 }
		
		add_treasury = -100
		add_ruler_modifier = { name = studying_lichdom_roots duration = -1 }
	}
	
	option = {	#2 bowls of grounded Halanna's Tears
		name = magic_project_lichdom.5.b
		ai_chance = { factor = 50 }
		
		add_treasury = -200
		add_ruler_modifier = { name = studying_lichdom_bowls duration = -1 }
	}
	
	option = {	#10 blooms of Fey-touched Hemlock
		name = magic_project_lichdom.5.c
		ai_chance = { factor = 50 }
		
		add_treasury = -300
		add_ruler_modifier = { name = studying_lichdom_blooms duration = -1 }
	}
}

country_event = { #Lichdom 6 - Potion 2 - Collecting Reagents 2
	id = magic_project_lichdom.6
	title = magic_project_lichdom.6.t
	desc = magic_project_lichdom.6.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	immediate = { set_country_flag = in_magic_progress_event }
	after = { clr_country_flag = in_magic_progress_event }
	
	option = {	#3 grams of Black Damestear
		name = magic_project_lichdom.6.a
		ai_chance = { factor = 50 }
		
		add_treasury = -100
		add_ruler_modifier = { name = studying_lichdom_korashi duration = -1 }
	}
	
	option = {	#6 drops of Neratic Asp Venom
		name = magic_project_lichdom.6.b
		ai_chance = { factor = 50 }
		
		add_treasury = -200
		add_ruler_modifier = { name = studying_lichdom_venom duration = -1 }
	}
	
	option = {	#1 tincture of Wyvern Blood
		name = magic_project_lichdom.6.c
		ai_chance = { factor = 50 }
		
		add_treasury = -300
		add_ruler_modifier = { name = studying_lichdom_wyvern duration = -1 }
	}
}

country_event = { #Lichdom 7 - Potion 3 - Getting the vessel
	id = magic_project_lichdom.7
	title = magic_project_lichdom.7.t
	desc = magic_project_lichdom.7.d
	picture = muslimgfx_NEW_HEIR_eventPicture
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			if = {
				limit = { wyvernheart_is_floodborn_council = yes }
				capital_scope = {
					spawn_rebels = {
						size = 3
						type = mage_rebels
					}
				}
			}
		}
	}

	option = {	#Obtain the heart of an innocent
		name = magic_project_lichdom.7.a
		ai_chance = { factor = 50 }
		
		add_mil_power = -100
		increase_witch_king_points_medium = { level = necromancy_level_2_minimum }
		add_ruler_modifier = { name = lichdom_mod_2 duration = -1 }

		custom_tooltip = tooltip_magic_project_advance
	}
	
	option = {	#Find me a unicorn and bring me its horn!
		name = magic_project_lichdom.7.b
		ai_chance = { factor = 50 }
		
		add_treasury = -100
		increase_witch_king_points_large = { level = necromancy_level_2_minimum }
		add_ruler_modifier = { name = lichdom_mod_2 duration = -1 }

		custom_tooltip = tooltip_magic_project_advance
	}	
	
	option = {	#The first one but more so
		name = magic_project_lichdom.7.c
		ai_chance = { factor = 50 }
		trigger = { has_heir = yes }
		highlight = yes
		
		kill_heir = { allow_new_heir = no }
		increase_witch_king_points_large = { level = necromancy_level_2_minimum }
		add_ruler_modifier = { name = lichdom_mod_2 duration = -1 }

		custom_tooltip = tooltip_magic_project_advance
	}	
}

country_event = { #Lichdom 8 - Dark Ritual 1 - Preparing the wards
	id = magic_project_lichdom.8
	title = magic_project_lichdom.8.t
	desc = magic_project_lichdom.8.d
	picture = END_OF_TIME_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			if = {
				limit = { wyvernheart_is_floodborn_council = yes }
				capital_scope = {
					spawn_rebels = {
						size = 2
						type = mage_rebels
					}
				}
			}
		}
		set_country_flag = in_magic_progress_event
	}
	after = { clr_country_flag = in_magic_progress_event }

	option = {	#Make the preparations
		name = magic_project_lichdom.8.a
		ai_chance = { factor = 50 }
		
		add_adm_power = -100
		add_dip_power = -100
		add_mil_power = -100
		
		add_ruler_modifier = { name = studying_lichdom_prep duration = -1 }
	}
	
	option = {	#Draw a Circle of Power to improve my chances
		name = magic_project_lichdom.8.b
		trigger = { is_ruler_abjuration_level_2_minimum = yes }
		ai_chance = { factor = 1000 }
		highlight = yes
		
		add_adm_power = -100
		
		add_ruler_modifier = { name = studying_lichdom_circle duration = -1 }
	}
	
	#Summon an outsider to give its dark blessing
	
	#Pray to my Dark Patron
	
}

country_event = { #Lichdom 9 - Dark Ritual 2 - Cleansing and putting yourself to near death
	id = magic_project_lichdom.9
	title = magic_project_lichdom.9.t
	desc = magic_project_lichdom.9.d
	picture = MIRACLE_MONK_eventPicture
	
	is_triggered_only = yes
	immediate = { set_country_flag = in_magic_progress_event }
	after = { clr_country_flag = in_magic_progress_event }
	
	option = {	#Begin the cleanse
		name = magic_project_lichdom.9.a
		ai_chance = { factor = 50 }
		
		add_ruler_modifier = {
			name = studying_lichdom_cleansing
			duration = -1
		}
	}
	
	option = {	#Transmutation spells will help quicken the process
		name = magic_project_lichdom.9.b
		trigger = { is_ruler_transmutation_level_2_minimum = yes }
		ai_chance = { factor = 1000 }
		highlight = yes
		
		add_ruler_modifier = {
			name = studying_lichdom_cleansinger
			duration = -1
		}
	}
}

country_event = { #Lichdom 10 - Dark Ritual 3 - drinking it
	id = magic_project_lichdom.10
	title = magic_project_lichdom.10.t
	desc = magic_project_lichdom.10.d
	picture = LOOMING_DEATH_eventPicture
	
	is_triggered_only = yes
	
	option = {	#Drink
		name = magic_project_lichdom.10.a
		ai_chance = { factor = 50 }
		
		remove_country_modifier = studying_lichdom_amulet
		remove_country_modifier = studying_lichdom_box
		remove_country_modifier = studying_lichdom_parchment
		remove_country_modifier = studying_lichdom_runes
		remove_country_modifier = studying_lichdom_blood
		remove_country_modifier = lichdom_mod_1
		remove_country_modifier = studying_lichdom_roots
		remove_country_modifier = studying_lichdom_bowls
		remove_country_modifier = studying_lichdom_blooms
		remove_country_modifier = studying_lichdom_korashi
		remove_country_modifier = studying_lichdom_venom
		remove_country_modifier = studying_lichdom_wyvern
		remove_country_modifier = lichdom_mod_2
		remove_country_modifier = studying_lichdom_prep
		remove_country_modifier = studying_lichdom_circle
		remove_country_modifier = studying_lichdom_cleansing
		remove_country_modifier = studying_lichdom_cleansinger
		
		tooltip = {
			kill_ruler = yes
			random = {
				chance = 1
				country_event = { id = magic_project_lichdom.11 }
			}
		}
		hidden_effect = {
			play_sound = newmonarch
			country_event = { id = magic_project_lichdom.11 }
		}
	}
}

country_event = { #Lichdom 11 - Lichdom
	id = magic_project_lichdom.11
	title = magic_project_lichdom.11.t
	desc = {
		trigger = {
			NOT = { TAG = H16 }
		}
	   desc = magic_project_lichdom.11.d
	}
	desc = {
		trigger = {
			TAG = H16
		}
		desc = magic_project_lichdom.11.db
	}
	picture = PRIEST_PHANTOM_eventPicture
	
	is_triggered_only = yes

	option = {
		name = magic_project_lichdom.11.a

		become_a_lich_effect = yes
		become_a_witch_king_effect = yes
	}
}

country_event = { #Lich - Gov change to Magocracy
	id = magic_project_lichdom.12
	title = magic_project_lichdom.12.t
	desc = magic_project_lichdom.12.d
	picture = MAGES_ESTATE_eventPicture

	is_triggered_only = yes
	
	trigger = {
		ruler_is_lich = yes
		NOT = { has_government_attribute = is_magocracy }
		NOT = { has_government_attribute = locked_T1_reform }
		has_estate = estate_mages

		NOT = { government = tribal }
		NOT = { has_ruler_flag = denied_magocracy }
		NOT = { has_country_flag = b38_entef_ruler }
		NOT = { is_lesser_in_union = yes }
		NOT = { has_reform = argordstun_gleaming_council } #This is a T2 reform
		NOT = { has_reform = argordstun_stubborn_reformists }
	}
	
	immediate = {
		magic_project_clear_lichdom_government_flags = yes #In case government was changed
		if = {
			limit = { has_government_attribute = is_raja }
			set_country_flag = original_gov_raja
		}
		else_if = {
			limit = { government = monarchy }
			set_country_flag = wizard_king_magocracy
			set_country_flag = original_gov_monarchy
		}
		else_if = {
			limit = { government = republic }
			set_country_flag = original_gov_republic
		}
		else_if = {
			limit = { government = theocracy }
			set_country_flag = original_gov_theocracy
			if = {
				limit = { has_reform = leading_clergy_reform }
				set_country_flag = original_gov_clergy
			}
			else_if = {
				limit = { has_reform = monastic_order_reform }
				set_country_flag = original_gov_monastic
			}
			else_if = {
				limit = { has_reform = secular_order_reform }
				set_country_flag = original_gov_secular
			}
			else_if = {
				limit = { has_reform = adventurer_reform }
				set_country_flag = original_gov_adventurer
			}
			else_if = {
				limit = { has_reform = oracular_order_reform }
				set_country_flag = original_gov_oracular
			}
		}
		else_if = {
			limit = { government = tribal }
			set_country_flag = original_gov_tribal
		}
	}
	
	option = {
		name = magic_project_lichdom.12.a
		ai_chance = { factor = 99 }
		
		add_stability_or_adm_power = yes
		
		if = {
			limit = { has_government_attribute = is_raja }
			change_government = theocracy
			add_government_reform = raja_magocracy_reform
		}
		else = {
			change_government = theocracy
			add_government_reform = magocracy_reform
		}
	}
	
	option = {
		name = magic_project_lichdom.12.b
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				has_government_attribute = is_raja
			}
		}
		
		add_prestige = -10
		set_ruler_flag = denied_magocracy
	}
}

country_event = { #Lichless Death - Gov change
	id = magic_project_lichdom.13
	title = magic_project_lichdom.13.t
	desc = magic_project_lichdom.13.d
	picture = RELIGIOUS_TURMOIL_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		government = theocracy
		NOT = { has_reform = black_demesne_reform }	#they have their own stuffs about this
		NOT = { has_reform = black_acolyte_reform }
	}
	
	#...unfortunately late lich raised a worthy successor
	option = {
		name = magic_project_lichdom.13.a
		trigger = { ruler_is_powerful_mage = yes  }
		ai_chance = { factor = 75 }
		highlight = yes
		
		add_prestige = 10
	}
	
	#...the dark acolytes retained controlled of the state
	option = {
		name = magic_project_lichdom.13.b
		ai_chance = {
			factor = 33
			modifier = {
				factor = 100
				estate_influence = {
					estate = estate_mages
					influence = 60
				}
			}
		}
		
		add_prestige = -10
		
	}
	
	#revert to old ways
	option = {
		name = magic_project_lichdom.13.c
		ai_chance = {
			factor = 66
		}
		
		if = {
			limit = { has_country_flag = original_gov_monarchy }
			change_government = monarchy
			
			exile_ruler_as = { name = old_lich_gov_ruler }
		}
		else_if = {
			limit = { has_country_flag = original_gov_raja }
			change_government = monarchy
			add_government_reform = raja_reform
		}
		else_if = {
			limit = { has_country_flag = original_gov_republic }
			change_government = republic
			
			exile_ruler_as = { name = old_lich_gov_ruler }
		}
		else_if = {
			limit = { has_country_flag = original_gov_theocracy }
			
			if = {
				limit = { has_country_flag = original_gov_clergy }
				add_government_reform = leading_clergy_reform
			}
			else_if = {
				limit = { has_country_flag = original_gov_monastic }
				add_government_reform = monastic_order_reform
			}
			else_if = {
				limit = { has_country_flag = original_gov_secular }
				add_government_reform = secular_order_reform
			}
			else_if = {
				limit = { has_country_flag = original_gov_adventurer }
				add_government_reform = adventurer_reform
			}
			else_if = {
				limit = { has_country_flag = original_gov_oracular }
				add_government_reform = oracular_order_reform
			}
			
			exile_ruler_as = { name = old_lich_gov_ruler }
		}
		else_if = {
			limit = { has_country_flag = original_gov_tribal }
			change_government = tribal
			
			if = {
				limit = { primary_culture = emerald_orc }
				add_government_reform = emerald_horde
			}
			else_if = {
				limit = {
					OR = {
						culture_group = goblin
						culture_group = orcish
					}
				}
				if = {
					limit = { capital_scope = { NOT = { continent = serpentspine } } }
					add_government_reform = greentide_horde
				}
				else_if = {
					limit = { capital_scope = { OR = { has_terrain = dwarven_hold has_terrain = dwarven_hold_surface } } }
					add_government_reform = dwarovar_squatter
				}
				else = { add_government_reform = dwarovar_warband }
			}
			else_if = {
				limit = {
					OR = {
						culture_is_troll = yes
						culture_group = kobold
					}
				}
				add_government_reform = settled_horde
			}
			else_if = {
				limit = {
					OR = {
						culture_group = harpy
						culture_group = gnollish
					}
				}
				add_government_reform = roaming_horde
			}
			else_if = {
				limit = {
					primary_culture = desert_elf
				}
				add_government_reform = desert_legion
			}
			
			exile_ruler_as = { name = old_lich_gov_ruler }
		}

		magic_project_clear_lichdom_government_flags = yes
		add_stability_or_adm_power = yes
	}
}

country_event = { #Lich Revival Interregnum
	id = magic_project_lichdom.14
	title = magic_project_lichdom.14.t
	desc = {
		trigger = { has_country_flag = b38_entef_ruler }
		desc = "elikhand_resurection.d" #Elikhand loc
	}
	desc = {
		trigger = { NOT = { has_country_flag = b38_entef_ruler } }
		desc = "magic_project_lichdom.14.d"
	}
	picture = PRIEST_PHANTOM_eventPicture
	
	is_triggered_only = yes	#this should be triggered by other events like adventurers destroying phylactery
	
	trigger = {
		ruler_is_lich = yes
		
		NOT = { has_country_flag = interregnum }
		NOT = { government = republic }
		
		NOT = {
			has_ruler_modifier = entef_ruler
			has_ruler_modifier = lich_ruler
		}
	}
	
	immediate = {
		hidden_effect = {
			#Prevent this event from firing itself
			set_country_flag = interregnum
			
			#Prevents additional stab loss while we shuffle rulers around
			add_country_modifier = { name = immortality_revival_temp duration = -1 hidden = yes }

			# Ruler is revived here
			if = {
				limit = { has_country_flag = b38_entef_ruler }
				define_ruler = { age = 33 name = "Entef" dynasty = "of Wibnuat" male = yes max_random_adm = 0 max_random_dip = 0 max_random_mil = 0 hide_skills = yes }
			}
			else_if = {
				limit = { has_country_flag = gemradcurt_immariel_lich }
				define_ruler = { age = 33 name = "Immarel" dynasty = "Winterswrath" female = yes max_random_adm = 0 max_random_dip = 0 max_random_mil = 0 hide_skills = yes }
			}
			else_if = {
				limit = { has_country_flag = chaingrasper_lichdom_achieved }
				define_ruler = { age = 33 name = "Dak" dynasty = "Chaingrasper" max_random_adm = 0 max_random_dip = 0 max_random_mil = 0 hide_skills = yes }
			}
			else_if = {
				limit = { has_country_flag = esthil_varina_lich }
				define_ruler = { age = 33 name = "Varina" dynasty = "Escer" female = yes max_random_adm = 0 max_random_dip = 0 max_random_mil = 0 hide_skills = yes }
			}
			else_if = {
				limit = { has_country_flag = wyvernheart_the_regent_lich }
				define_ruler = { age = 33 name = "The Regent" dynasty = "of Wyvernheart" female = yes max_random_adm = 0 max_random_dip = 0 max_random_mil = 0 hide_skills = yes }
			}
			else = {
				restore_saved_dynasty = yes
				if = { limit = { has_country_flag = lich_ruler_female } define_heir = { age = 33 dynasty = ROOT female = yes max_random_adm = 0 max_random_dip = 0 max_random_mil = 0 hide_skills = yes } }
				else = { define_heir = { age = 33 dynasty = ROOT male = yes max_random_adm = 0 max_random_dip = 0 max_random_mil = 0 hide_skills = yes } }

				set_country_flag = in_revival_heir
			}
		}
	}
	
	# Revive Ruler
	option = {
		name = magic_project_lichdom.14.a
		ai_chance = { factor = 50 }
		
		# Revied Rulers are slightly worse than normal ones, you don't want your ruler to die
		if = {
			limit = { has_country_flag = b38_entef_ruler }
			tooltip = { define_ruler = { age = 33 name = "Entef" dynasty = "of Wibnuat" male = yes max_random_adm = 0 max_random_dip = 0 max_random_mil = 0 hide_skills = yes } }
		}
		else_if = {
			limit = { has_country_flag = gemradcurt_immariel_lich }
			tooltip = { define_ruler = { age = 33 name = "Immarel" dynasty = "Winterswrath" female = yes max_random_adm = 0 max_random_dip = 0 max_random_mil = 0 hide_skills = yes } }
		}
		else_if = {
			limit = { has_country_flag = chaingrasper_lichdom_achieved }
			tooltip = { define_ruler = { age = 33 name = "Dak" dynasty = "Chaingrasper" max_random_adm = 0 max_random_dip = 0 max_random_mil = 0 hide_skills = yes } }
		}
		else_if = {
			limit = { has_country_flag = esthil_varina_lich }
			tooltip = { define_ruler = { age = 33 name = "Varina" dynasty = "Escer" female = yes max_random_adm = 0 max_random_dip = 0 max_random_mil = 0 hide_skills = yes } }
		}
		else_if = {
			limit = { has_country_flag = wyvernheart_the_regent_lich }
			tooltip = { define_ruler = { age = 33 name = "The Regent" dynasty = "of Wyvernheart" female = yes max_random_adm = 0 max_random_dip = 0 max_random_mil = 0 hide_skills = yes } }
		}
		else_if = {
			limit = { has_country_flag = lich_ruler_female }
			tooltip = { define_heir = { age = 33 dynasty = ROOT female = yes max_random_adm = 0 max_random_dip = 0 max_random_mil = 0 hide_skills = yes } }
			hidden_effect = { kill_ruler = yes } #Sets this guy as your ruler
		}
		else = {
			tooltip = { define_heir = { age = 33 dynasty = ROOT male = yes max_random_adm = 0 max_random_dip = 0 max_random_mil = 0 hide_skills = yes } }
			hidden_effect = { kill_ruler = yes }
		}
		
		restore_ruler_stats = yes #Out here for tooltip purposes
		revival_stat_loss = yes
		save_ruler_stats = yes
		
		hidden_effect = { #Clean up
			clr_country_flag = interregnum
			remove_country_modifier = immortality_revival_temp

			#clear first in case player lets a month go by before clicking
			if = {
				limit = { religion = neokttareum }
				clear_ancestor_ruler_personalities = yes
				add_ruler_personality = ancestor_mage_personality
			}
			else = {
				clear_ruler_personalities = yes
				apply_saved_persistent_ruler_personalities = yes
			}
			define_powerful_mage = { type = ruler saved_levels = immortal save_levels = immortal }

			if = { #Get back witch-king status
				limit = { ruler_is_witch_king = yes }
				become_a_witch_king_effect = yes
			}

			if = { #MT content
				limit = {
					has_country_flag = b38_entef_buried_well
					has_country_flag = b38_entef_ruler
				}
				add_ruler_personality = charismatic_negotiator_personality
			}
			
			set_ruler_flag = long_lived_ruler #Re-define the lich ruler flags/mods
			if = {
				limit = { has_country_flag = b38_entef_ruler }
				add_ruler_modifier = { name = entef_ruler duration = -1 }
			}
			else = {
				add_ruler_modifier = { name = lich_ruler duration = -1 }
			}
		}
	}
}

province_event = { #Occupying army searches for phylactery
	id = magic_project_lichdom.15
	title = magic_project_lichdom.15.t
	desc = {
		trigger = { owner = { has_country_flag = b38_entef_ruler } }
		desc = "elikhand_sarcophagus.d" #Elikhand loc
	}
	desc = {
		trigger = { NOT = { owner = { has_country_flag = b38_entef_ruler } } }
		desc = "magic_project_lichdom.15.d"
	}
	picture = SIEGE_eventPicture
	goto = root
	
	is_triggered_only = yes
	
	trigger = {
		owner = { ruler_is_lich = yes }
		OR = {
			AND = {
				NOT = { owner = { has_country_flag = b38_entef_ruler } }
				is_capital = yes
			}
			AND = {
				owner = { has_country_flag = b38_entef_ruler }
				province_id = 769
			}
		}
		NOT = { controlled_by = owner }
		NOT = { #Sacrifice at Talazdvoger
			controller = {
				owns = 6104
				6104 = { has_great_project = { type = ger_bexamurr tier = 2 } }
				culture_group = gnollish
				religion = xhazobkult
			}
		}
	}
	
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					owner = { has_country_flag = b38_entef_ruler }
				}
				owner = {
					trigger_switch = {
						on_trigger = has_ruler_flag
						
						abjuration_3 = { ROOT = { province_event = { id = magic_project_lichdom.17 days = 150 random = 90 } } }
						abjuration_2 = { ROOT = { province_event = { id = magic_project_lichdom.17 days = 120 random = 60 } } }
						abjuration_1 = { ROOT = { province_event = { id = magic_project_lichdom.17 days = 90 random = 30 } } }
					}
				}
			}
			else_if = {
				limit = {
					owner = { is_ruler_abjuration_level_0 = yes }
				}
				province_event = { id = magic_project_lichdom.17 days = 15 random = 15 }
			}
			else = {
				owner = {
					trigger_switch = {
						on_trigger = has_ruler_flag
						
						abjuration_3 = { ROOT = { province_event = { id = magic_project_lichdom.17 days = 90 random = 90 } } }
						abjuration_2 = { ROOT = { province_event = { id = magic_project_lichdom.17 days = 60 random = 60 } } }
						abjuration_1 = { ROOT = { province_event = { id = magic_project_lichdom.17 days = 30 random = 30 } } }
					}
				}
			}
			controller = { country_event = { id = magic_project_lichdom.16 days = 1 } } #Notif for the other side
		}
	}
	
	#It is only a matter of time until the phylactery is found
	option = {
		name = magic_project_lichdom.15.a
		trigger = { owner = { is_ruler_abjuration_level_0 = yes } }
		ai_chance = {
			factor = 10
		}
		
		owner = { add_prestige = -10 }
	}
	
	#Wards will slow them down
	option = {
		name = magic_project_lichdom.15.b
		trigger = { owner = { is_ruler_abjuration_level_1_minimum = yes } }
		ai_chance = {
			factor = 10
		}
		
		owner = { add_prestige = -5 }
	}
}

country_event = { #Occupier phylactery search notification
	id = magic_project_lichdom.16
	title = magic_project_lichdom.16.t
	desc = magic_project_lichdom.16.d
	picture = northamericagfx_EXPLORERS_eventPicture
	
	is_triggered_only = yes
	
	#Inform hold province to destroy phylactery
	option = {
		name = magic_project_lichdom.16.a
		ai_chance = {
			factor = 100
		}
	}
}

province_event = { #Phylactery found by occupiers if not retaken
	id = magic_project_lichdom.17
	title = magic_project_lichdom.17.t
	desc = magic_project_lichdom.17.d
	picture = END_OF_TIME_eventPicture
	
	is_triggered_only = yes
	hidden = yes
	
	trigger = {
		owner = { ruler_is_lich = yes }
		NOT = { controlled_by = owner }
	}

	#Phylactery destroyed
	option = {
		name = magic_project_lichdom.17.a
		ai_chance = {
			factor = 100
		}
		
		owner = { country_event = { id = magic_project_lichdom.18 days = 1 } }
		controller = { country_event = { id = magic_project_lichdom.19 days = 1 } }
	}
}

country_event = { #Lich Destruction - Phylactery destroyed
	id = magic_project_lichdom.18
	title = magic_project_lichdom.18.t
	desc = magic_project_lichdom.18.d
	picture = southamericagfx_FAMINE_eventPicture
	
	is_triggered_only = yes	#this should be triggered by other events like adventurers destroying phylactery
	
	trigger = { ruler_is_lich = yes }
	
	option = {
		name = magic_project_lichdom.18.a
		ai_chance = { factor = 50 }
		
		kill_a_lich_effect = yes
	}
}

country_event = { #Occupier destroys phylactery
	id = magic_project_lichdom.19
	title = magic_project_lichdom.19.t
	desc = magic_project_lichdom.19.d
	picture = PROTESTANT_GREAT_REFORMER_eventPicture
	
	is_triggered_only = yes
	
	#Destroyed phylactery
	option = {
		name = magic_project_lichdom.19.a
		ai_chance = { factor = 100 }
		
		add_prestige = 20
		add_country_modifier = {
			name = lichdom_destroyed_phylactery
			duration = 3650
		}
	}
}

##################
### HOMUNCULUS ###
##################
#1 - Make the core
#2 - Make the body
#3 - Bind it to you
#4 - Decide what to do with it
#5 - (If applicable) Decide whether to stay quiet or go loud

namespace = magic_project_homunculus

country_event = { #Homunculus event handler
	id = magic_project_homunculus.0
	title = magic_project_homunculus.0.t
	desc = magic_project_homunculus.0.d
	picture = ANGRY_MOB_eventPicture

	is_triggered_only = yes
	hidden = yes

	option = {
		name = magic_project_homunculus.0.a
		ai_chance = { factor = 1 }

		if = {
			limit = { has_country_flag = magic_project_completed_flag }
			if = {
				limit = { at_least_magic_project_level = { project = homunculus level = 3 } }
				country_event = { id = magic_project_homunculus.7 }
			}
			else_if = {
				limit = { at_least_magic_project_level = { project = homunculus level = 2 } }
				country_event = { id = magic_project_homunculus.6 }
			}
			else = { country_event = { id = magic_project_homunculus.5 } }
		}
		else_if = {
			limit = {
				check_variable = { current_experience_percent = 33 }
				NOT = {
					has_country_modifier = studying_homunculus_body_mud
					has_country_modifier = studying_homunculus_body_stone
					has_country_modifier = studying_homunculus_body_blood
				}
			}
			country_event = { id = magic_project_homunculus.3 }
		}
		else_if = {
			limit = {
				check_variable = { current_experience_percent = 67 }
				NOT = {
					has_country_modifier = studying_homunculus_loyalty_law
					has_country_modifier = studying_homunculus_loyalty_child
					has_country_modifier = studying_homunculus_loyalty_magic
				}
			}
			country_event = { id = magic_project_homunculus.4 }
		}
	}
}


country_event = { #Homunculus bounceback for trying old options
	id = magic_project_homunculus.1
	title = magic_project_homunculus.1.t
	desc = magic_project_homunculus.1.d
	picture = CIVIL_WAR_eventPicture
	
	is_triggered_only = yes
	hidden = yes

	option = {
		name = magic_project_homunculus.1.a
		ai_chance = { factor = 1 }

		trigger_switch = {
			on_trigger = has_country_flag

			homunculus_in_event_1 = { clr_country_flag = homunculus_in_event_1 country_event = { id = magic_project_homunculus.2 } }
			homunculus_in_event_2 = { clr_country_flag = homunculus_in_event_2 country_event = { id = magic_project_homunculus.3 } }
			homunculus_in_event_3 = { clr_country_flag = homunculus_in_event_3 country_event = { id = magic_project_homunculus.4 } }
			homunculus_in_event_4 = { clr_country_flag = homunculus_in_event_4 country_event = { id = magic_project_homunculus.8 } }
		}
	}
}

country_event = { #Homunculus 1 - Heart
	id = magic_project_homunculus.2
	title = magic_project_homunculus.2.t
	desc = magic_project_homunculus.2.d
	picture = INVENTION_eventPicture
	
	is_triggered_only = yes
	immediate = { set_country_flag = in_magic_progress_event }

	after = {
		clr_country_flag = in_magic_progress_event
		hidden_effect = {
			if = {
				limit = { has_country_flag = homunculus_in_event_1 }
				country_event = { id = magic_project_homunculus.1 }
			}
		}
	}

	option = {	#Animal Heart
		name = magic_project_homunculus.2.a
		ai_chance = { factor = 1 }
		trigger = { NOT = { has_country_flag = homunculus_tried_option_1_1 } }

		if = {
			limit = { at_least_magic_project_level = { project = homunculus level = 1 } }
			custom_tooltip = homunculus_already_tried
			set_country_flag = homunculus_in_event_1
			set_country_flag = homunculus_tried_option_1_1
			tooltip = {
				random_owned_province = { add_devastation = 1 }
				add_country_modifier = { name = studying_homunculus_core_animal duration = -1 desc = until_advancement_concludes }
			}
		}
		else = {
			random_owned_province = { add_devastation = 1 }
			add_country_modifier = { name = studying_homunculus_core_animal duration = -1 desc = until_advancement_concludes }
		}
	}
	
	option = {	#Clockwork Mechanism
		name = magic_project_homunculus.2.b
		ai_chance = { factor = 1 }
		trigger = {
			at_least_magic_project_level = { project = homunculus level = 1 }
			NOT = { has_country_flag = homunculus_tried_option_1_2 }
		}
		
		if = {
			limit = { at_least_magic_project_level = { project = homunculus level = 2 } }
			custom_tooltip = homunculus_already_tried
			set_country_flag = homunculus_in_event_1
			set_country_flag = homunculus_tried_option_1_2
			tooltip = {
				add_treasury = -120
				add_country_modifier = { name = studying_homunculus_core_clockwork duration = -1 desc = until_advancement_concludes }
			}
		}
		else = {
			add_treasury = -120
			add_country_modifier = { name = studying_homunculus_core_clockwork duration = -1 desc = until_advancement_concludes }
			clr_country_flag = homunculus_tried_option_1_1
		}
	}
	
	option = {	#A Pure Damestear core
		name = magic_project_homunculus.2.c
		ai_chance = { factor = 1 }
		trigger = { at_least_magic_project_level = { project = homunculus level = 2 } }
		
		random_owned_province = {
			add_base_tax = -1
			add_base_production = -1
			add_base_manpower = -1
		}
		add_country_modifier = { name = studying_homunculus_core_damestear duration = -1 desc = until_advancement_concludes }
		clr_country_flag = homunculus_tried_option_1_1
		clr_country_flag = homunculus_tried_option_1_2
	}
}

country_event = { #Homunculus 2 - Body
	id = magic_project_homunculus.3
	title = magic_project_homunculus.3.t
	desc = magic_project_homunculus.3.desc
	picture = BUDDHA_eventPicture
	
	is_triggered_only = yes
	immediate = { set_country_flag = in_magic_progress_event }

	after = {
		clr_country_flag = in_magic_progress_event
		hidden_effect = {
			if = {
				limit = { has_country_flag = homunculus_in_event_2 }
				country_event = { id = magic_project_homunculus.1 }
			}
		}
	}

	option = {	#Mud Body
		name = magic_project_homunculus.3.a
		ai_chance = { factor = 1 }
		trigger = { NOT = { has_country_flag = homunculus_tried_option_2_1 } }

		if = {
			limit = { at_least_magic_project_level = { project = homunculus level = 1 } }
			custom_tooltip = homunculus_already_tried
			set_country_flag = homunculus_in_event_2
			set_country_flag = homunculus_tried_option_2_1
			tooltip = {
				add_prestige = -10
				add_country_modifier = { name = studying_homunculus_body_mud duration = -1 desc = until_advancement_concludes }
			}
		}
		else = {
			add_prestige = -10
			add_country_modifier = { name = studying_homunculus_body_mud duration = -1 desc = until_advancement_concludes }
		}
	}
	
	option = {	#Sculpture Body
		name = magic_project_homunculus.3.b
		ai_chance = { factor = 1 }
		trigger = {
			at_least_magic_project_level = { project = homunculus level = 1 }
			NOT = { has_country_flag = homunculus_tried_option_2_2 }
		}
		
		if = {
			limit = { at_least_magic_project_level = { project = homunculus level = 2 } }
			custom_tooltip = homunculus_already_tried
			set_country_flag = homunculus_in_event_2
			set_country_flag = homunculus_tried_option_2_2
			tooltip = {
				kill_advisor = random
				capital_scope = { add_unrest = 10 }
				add_country_modifier = { name = studying_homunculus_body_stone duration = -1 desc = until_advancement_concludes }
			}
		}
		else = {
			kill_advisor = random
			capital_scope = { add_unrest = 10 }
			add_country_modifier = { name = studying_homunculus_body_stone duration = -1 desc = until_advancement_concludes }
			clr_country_flag = homunculus_tried_option_2_1
		}
	}
	
	option = {	#Concentrated Flesh
		name = magic_project_homunculus.3.c
		ai_chance = { factor = 1 }
		trigger = { at_least_magic_project_level = { project = homunculus level = 2 } }

		increase_estate_witch_king_points = { size = large }
		add_manpower = -0.5
		random_owned_province = {
			limit = { base_manpower = 2 }
			add_base_manpower = -1
		}
		random_owned_province = {
			limit = { base_manpower = 2 }
			add_base_manpower = -1
		}
		random_owned_province = {
			limit = { base_manpower = 2 }
			add_base_manpower = -1
		}
		add_country_modifier = { name = studying_homunculus_body_blood duration = -1 desc = until_advancement_concludes }
		clr_country_flag = homunculus_tried_option_2_1
		clr_country_flag = homunculus_tried_option_2_2
	}

	option = { #No
		name = magic_project_homunculus.3.d
		ai_chance = { factor = 0 }
		trigger = {
			hidden_trigger = {
				has_country_flag = homunculus_tried_option_2_1
				has_country_flag = homunculus_tried_option_2_2
			}
		}
		highlight = yes

		magic_advancement_abort_all_effect = yes
	}
}

country_event = { #Homunculus 3 - Binding
	id = magic_project_homunculus.4
	title = magic_project_homunculus.4.t
	desc = magic_project_homunculus.4.d
	picture = southamericagfx_COURT_eventPicture
	
	is_triggered_only = yes
	immediate = { set_country_flag = in_magic_progress_event }

	after = {
		clr_country_flag = in_magic_progress_event
		hidden_effect = {
			if = {
				limit = { has_country_flag = homunculus_in_event_3 }
				country_event = { id = magic_project_homunculus.1 }
			}
		}
	}

	option = {	#Three laws of robotics
		name = magic_project_homunculus.4.a
		ai_chance = { factor = 1 }
		trigger = { NOT = { has_country_flag = homunculus_tried_option_3_1 } }

		if = {
			limit = { at_least_magic_project_level = { project = homunculus level = 1 } }
			custom_tooltip = homunculus_already_tried
			set_country_flag = homunculus_in_event_3
			set_country_flag = homunculus_tried_option_3_1
			tooltip = {
				add_adm_power = -50
				add_country_modifier = { name = studying_homunculus_loyalty_law duration = -1 desc = until_advancement_concludes }
			}
		}
		else = {
			add_adm_power = -50
			add_country_modifier = { name = studying_homunculus_loyalty_law duration = -1 desc = until_advancement_concludes }
		}
	}
	
	option = {	#Bring it up right
		name = magic_project_homunculus.4.b
		ai_chance = { factor = 1 }
		trigger = {
			at_least_magic_project_level = { project = homunculus level = 1 }
			NOT = { has_country_flag = homunculus_tried_option_3_2 }
		}
		
		if = {
			limit = { at_least_magic_project_level = { project = homunculus level = 2 } }
			custom_tooltip = homunculus_already_tried
			set_country_flag = homunculus_in_event_3
			set_country_flag = homunculus_tried_option_3_2
			tooltip = {
				add_adm_power = -50
				add_dip_power = -50
				add_country_modifier = { name = studying_homunculus_loyalty_child duration = -1 desc = until_advancement_concludes }
			}
		}
		else = {
			add_adm_power = -50
			add_dip_power = -50
			add_country_modifier = { name = studying_homunculus_loyalty_child duration = -1 desc = until_advancement_concludes }
			clr_country_flag = homunculus_tried_option_3_1
		}
	}
	
	option = {	#Magic Ritual
		name = magic_project_homunculus.4.c
		ai_chance = { factor = 1 }
		trigger = { at_least_magic_project_level = { project = homunculus level = 2 } }

		add_adm_power = -50
		add_dip_power = -50
		add_mil_power = -50
		add_country_modifier = { name = studying_homunculus_loyalty_magic duration = -1 desc = until_advancement_concludes }
		clr_country_flag = homunculus_tried_option_3_1
		clr_country_flag = homunculus_tried_option_3_2
	}
}

country_event = { #Homunculus, Rude
	id = magic_project_homunculus.5
	title = magic_project_homunculus.5.t
	desc = magic_project_homunculus.5.d
	picture = SMALLPOX_eventPicture

	is_triggered_only = yes

	after = { hidden_effect = { country_event = { id = magic_project_homunculus.8 } } }

	option = {
		name = magic_project_homunculus.5.a
		ai_chance = { factor = 1 }
		add_country_modifier = { name = homunculus_study duration = -1 }
		custom_tooltip = tooltip_magic_project_advance
	}
	option = {
		name = magic_project_homunculus.5.b
		ai_chance = { factor = 1 }
		add_country_modifier = { name = homunculus_training duration = -1 }
		custom_tooltip = tooltip_magic_project_advance
	}
	option = {
		name = magic_project_homunculus.5.c
		ai_chance = { factor = 1 }
		add_country_modifier = { name = homunculus_operating_theatre duration = -1 }
		custom_tooltip = tooltip_magic_project_advance
	}
}
country_event = { #Homunculus, Vivum
	id = magic_project_homunculus.6
	title = magic_project_homunculus.6.t
	desc = magic_project_homunculus.6.d
	picture = southamericagfx_NEW_HEIR_eventPicture

	is_triggered_only = yes
	immediate = {
		hidden_effect = {
			randnum_effect = {
				max = 7
				case7 = " #Humane - Rarest since you can't get it via recalc
					if = {
						limit = { NOT = { is_emperor_of_china = yes } }
						randnum_recalc = { max = 6 }
					}
				"
				case6 = " #Papal Puppetmaster
					if = {
						limit = { NOT = { religion = ravelian } }
						randnum_recalc = { max = 5 }
					}
				"
				case5 = " #Legendary Pirate
					if = {
						limit = { NOT = { num_of_ports = 1 } }
						randnum_recalc = { max = 4 }
					}
				"
			}
		}
	}

	after = { hidden_effect = { country_event = { id = magic_project_homunculus.8 } } }

	option = { #Heir, male
		name = magic_project_homunculus.6.a
		ai_chance = { factor = 1 }
		trigger = {
			has_government_attribute = heir
			NOT = { has_government_attribute = is_magocracy }
			NOT = { has_ruler_flag = xhazob_patron }
			NOT = { has_global_modifier_value = { which = female_advisor_chance value = 1 } }
		}
		custom_tooltip = homunculi_no_mage_hint_tt
		remove_heir = {  }
		define_heir = {
			dynasty = ROOT
			age = 20
			adm = 4
			dip = 4
			mil = 4
			claim = 25
			no_consort_with_heir = yes
			male = yes
		}
		set_heir_flag = long_lived_ruler
		set_heir_flag = is_a_homunculus #Keeps them immortal
		custom_tooltip = homunculus_is_male_tt
		if = {
			limit = { check_variable = { randnum = 7 } }
			force_add_heir_personality = { personality = humane_personality }
		}
		else_if = {
			limit = { check_variable = { randnum = 6 } }
			force_add_heir_personality = { personality = fu_papal_puppetmaster_personality }
		}
		else_if = {
			limit = { check_variable = { randnum = 5 } }
			force_add_heir_personality = { personality = legendary_pirate_personality }
		}
		else_if = {
			limit = { check_variable = { randnum = 4 } }
			force_add_heir_personality = { personality = legendary_conqueror_personality }
		}
		else_if = {
			limit = { check_variable = { randnum = 3 } }
			force_add_heir_personality = { personality = great_engineer_personality }
		}
		else_if = {
			limit = { check_variable = { randnum = 2 } }
			force_add_heir_personality = { personality = iron_crowned_personality }
		}
		else = {
			force_add_heir_personality = { personality = peasant_revolt_leader_personality }
		}
		custom_tooltip = tooltip_magic_project_advance
	}
	option = { #Heir, female
		name = magic_project_homunculus.6.a
		ai_chance = { factor = 1 }
		trigger = {
			has_government_attribute = heir
			NOT = { has_government_attribute = is_magocracy }
			NOT = { has_ruler_flag = xhazob_patron }
			has_global_modifier_value = { which = female_advisor_chance value = 0.01 }
		}
		custom_tooltip = homunculi_no_mage_hint_tt
		remove_heir = {  }
		define_heir = {
			dynasty = ROOT
			age = 20
			adm = 4
			dip = 4
			mil = 4
			claim = 25
			no_consort_with_heir = yes
			female = yes
		}
		set_heir_flag = long_lived_ruler
		set_heir_flag = is_a_homunculus #Keeps them immortal
		custom_tooltip = homunculus_is_female_tt
		if = {
			limit = { check_variable = { randnum = 7 } }
			force_add_heir_personality = { personality = humane_personality }
		}
		else_if = {
			limit = { check_variable = { randnum = 6 } }
			force_add_heir_personality = { personality = fu_papal_puppetmaster_personality }
		}
		else_if = {
			limit = { check_variable = { randnum = 5 } }
			force_add_heir_personality = { personality = legendary_pirate_personality }
		}
		else_if = {
			limit = { check_variable = { randnum = 4 } }
			force_add_heir_personality = { personality = legendary_conqueror_personality }
		}
		else_if = {
			limit = { check_variable = { randnum = 3 } }
			force_add_heir_personality = { personality = great_engineer_personality }
		}
		else_if = {
			limit = { check_variable = { randnum = 2 } }
			force_add_heir_personality = { personality = iron_crowned_personality }
		}
		else = {
			force_add_heir_personality = { personality = peasant_revolt_leader_personality }
		}
		custom_tooltip = tooltip_magic_project_advance
	}
	option = {
		name = magic_project_homunculus.6.b
		ai_chance = { factor = 1 }

		add_country_modifier = { name = homunculus_eminence_grise duration = -1 }
		add_power_projection = { type = homonculus_eminence_grise_pp amount = 15 }
		custom_tooltip = tooltip_magic_project_advance
	}
	option = {
		name = magic_project_homunculus.6.c
		ai_chance = { factor = 1 }
		trigger = { has_government_attribute = queen }

		if = { 
			limit = { has_consort = yes }
			remove_consort = yes
		}
		if = {
			limit = {
				OR = {
					AND = { is_female = yes NOT = { has_ruler_flag = is_gay } }
					AND = { is_female = no has_ruler_flag = is_gay }
				}
			}
			define_consort = {
				dynasty = ROOT
				age = 20
				adm = 4
				dip = 4
				mil = 4
				male = yes	
			}
		}
		else_if = {
			limit = {
				OR = {
					AND = { is_female = no NOT = { has_ruler_flag = is_gay } }
					AND = { is_female = yes has_ruler_flag = is_gay }
				}
			}
			define_consort = {
				dynasty = ROOT
				age = 20
				adm = 4
				dip = 4
				mil = 4
				female = yes
			}
		}

		set_consort_flag = long_lived_ruler
		set_consort_flag = is_a_homunculus #Keeps them immortal
		add_country_modifier = { name = homunculus_consort duration = -1 }
		if = {
			limit = { check_variable = { randnum = 7 } }
			force_add_consort_personality = { personality = humane_personality }
		}
		else_if = {
			limit = { check_variable = { randnum = 6 } }
			force_add_consort_personality = { personality = fu_papal_puppetmaster_personality }
		}
		else_if = {
			limit = { check_variable = { randnum = 5 } }
			force_add_consort_personality = { personality = legendary_pirate_personality }
		}
		else_if = {
			limit = { check_variable = { randnum = 4 } }
			force_add_consort_personality = { personality = legendary_conqueror_personality }
		}
		else_if = {
			limit = { check_variable = { randnum = 3 } }
			force_add_consort_personality = { personality = great_engineer_personality }
		}
		else_if = {
			limit = { check_variable = { randnum = 2 } }
			force_add_consort_personality = { personality = iron_crowned_personality }
		}
		else = {
			force_add_consort_personality = { personality = peasant_revolt_leader_personality }
		}
		custom_tooltip = tooltip_magic_project_advance
	}
}
country_event = { #Homunculus Genius Loci
	id = magic_project_homunculus.7
	title = magic_project_homunculus.7.t
	desc = magic_project_homunculus.7.d
	picture = southamericagfx_ADVISOR_eventPicture

	is_triggered_only = yes

	after = { hidden_effect = { country_event = { id = magic_project_homunculus.8 } } }
	
	option = {
		name = artist
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				stability = -3
				NOT = { stability = 1 }
			}
		}
		add_country_modifier = { name = artist_homunculus duration = -1 }
		custom_tooltip = tooltip_magic_project_complete
	}
	
	option = {
		name = inquisitor
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				num_of_owned_provinces_with = {
					value = 2
					has_missionary = yes
				}
			}
		}
		add_country_modifier = { name = inquisitor_homunculus duration = -1 }
		custom_tooltip = tooltip_magic_project_complete
	}
	
	option = {
		name = master_of_mint
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				inflation = 2
			}
		}
		add_country_modifier = { name = master_of_mint_homunculus duration = -1 }
		custom_tooltip = tooltip_magic_project_complete
	}
	
	option = {
		name = natural_scientist
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_capitalist
			}	
		}		
		add_country_modifier = { name = natural_scientist_homunculus duration = -1 }
		custom_tooltip = tooltip_magic_project_complete
	}
	
	option = {
		name = philosopher
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				NOT = { prestige = 20 }
			}
		}
		add_country_modifier = { name = philosopher_homunculus duration = -1 }
		custom_tooltip = tooltip_magic_project_complete
	}
	
	option = {
		name = theologian
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				ROOT = { average_unrest = 5 }
			}
		}
		add_country_modifier = { name = theologian_homunculus duration = -1 }
		custom_tooltip = tooltip_magic_project_complete
	}
	
	option = {
		name = treasurer
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_capitalist
			}
		}
		add_country_modifier = { name = treasurer_homunculus duration = -1 }
		custom_tooltip = tooltip_magic_project_complete
	}
	
	option = {
		name = colonial_governor
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_colonialist 
			}
		}
		add_country_modifier = { name = colonial_governor_homunculus duration = -1 }
		custom_tooltip = tooltip_magic_project_complete
	}
	
	option = {
		name = diplomat
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_diplomat
			}
		}
		add_country_modifier = { name = diplomat_homunculus duration = -1 }		
		custom_tooltip = tooltip_magic_project_complete
	}
	
	option = {
		name = naval_reformer
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				navy_size = 20
			}
		}
		add_country_modifier = { name = naval_reformer_homunculus duration = -1 }		
		custom_tooltip = tooltip_magic_project_complete
	}
	
	option = {
		name = navigator
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_colonialist
			}
		}
		
		add_country_modifier = { name = navigator_homunculus duration = -1 }
		custom_tooltip = tooltip_magic_project_complete
	}
	
	option = {
		name = spymaster
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				has_idea_group = spy_ideas
			}
		}
		add_country_modifier = { name = spymaster_homunculus duration = -1 }		
		custom_tooltip = tooltip_magic_project_complete
	}
	
	option = {
		name = statesman
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				diplomatic_reputation = 2
			}
		}
		add_country_modifier = { name = statesman_homunculus duration = -1 }		
		custom_tooltip = tooltip_magic_project_complete
	}
	
	option = {
		name = trader
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_capitalist
			}
		}
		add_country_modifier = { name = trader_homunculus duration = -1 }	
		custom_tooltip = tooltip_magic_project_complete
		
	}
	
	option = {
		name = army_organiser
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				army_size_percentage = 0.75
			}
		}
		add_country_modifier = { name = army_organiser_homunculus duration = -1 }		
		custom_tooltip = tooltip_magic_project_complete
	}
	
	option = {
		name = army_reformer
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_militarist
			}
		}
		add_country_modifier = { name = army_reformer_homunculus duration = -1 }
		custom_tooltip = tooltip_magic_project_complete
	}
	
	option = {
		name = commandant
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_militarist
			}
		}
		
		add_country_modifier = { name = commandant_homunculus duration = -1 }
		custom_tooltip = tooltip_magic_project_complete
	}
	
	option = {
		name = grand_captain
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				army_size_percentage = 0.75
			}
		}
		add_country_modifier = { name = grand_captain_homunculus duration = -1 }		
		custom_tooltip = tooltip_magic_project_complete
	}
	
	option = {
		name = recruitmaster
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				NOT = { manpower_percentage = 0.25 }
			}
		}
		add_country_modifier = { name = recruitmaster_homunculus duration = -1 }		
		custom_tooltip = tooltip_magic_project_complete
	}
	
	option = {
		name = fortification_expert
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				num_of_owned_provinces_with = {
					value = 3
					has_siege = yes
				}
			}
		}
		add_country_modifier = { name = fortification_expert_homunculus duration = -1 }
		custom_tooltip = tooltip_magic_project_complete
	}
	
	option = {
		name = quartermaster
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				personality = ai_militarist
			}
		}
		
		add_country_modifier = { name = quartermaster_homunculus duration = -1 }
		custom_tooltip = tooltip_magic_project_complete
	}
}

country_event = { #Homunculus, Hide or Reveal?
	id = magic_project_homunculus.8
	title = magic_project_homunculus.8.t
	desc = magic_project_homunculus.8.d
	picture = CROSSROAD_eventPicture

	is_triggered_only = yes

	option = { #Go loud
		name = magic_project_homunculus.8.a
		ai_chance = { factor = 1 }
		trigger = { exactly_magic_project_level = { project = homunculus level = 2 } }

		if = {
			limit = { has_heir_flag = is_a_homunculus }
			add_country_modifier = { name = homunculus_court_unrest duration = 3650 }
		}
		else_if = {
			limit = { has_consort_flag = is_a_homunculus }
			add_country_modifier = { name = homunculus_court_unrest duration = 3650 }
		}
		else_if = {
			limit = { has_ruler_flag = is_a_homunculus }
			add_country_modifier = { name = homunculus_court_unrest duration = 3650 }
		}
		else = { #You chose the jester
			add_country_modifier = { name = homunculus_court_unrest duration = 3650 }
		}

		add_dip_power = -100
		anb_add_accepted_culture_or_dip_power = { culture = homunculi free = yes }
	}

	option = { #Stay quiet
		name = magic_project_homunculus.8.b
		ai_chance = { factor = 1 }
		trigger = { NOT = { at_least_magic_project_level = { project = homunculus level = 3 } } }

		if = {
			limit = { exactly_magic_project_level = { project = homunculus level = 1 } }
			custom_tooltip = homunculus_no_need_tt
			tooltip = {
				country_event = { id = magic_project_homunculus.15 days = 29200 } #Old Age
				country_event = { id = magic_project_homunculus.9 days = 3650 random = 32850 } #Discovery!
			}
			set_country_flag = homunculus_in_event_4
			hidden_effect = { country_event = { id = magic_project_homunculus.1 } }
		}
		else = {
			set_country_flag = hiding_a_homunculus
			country_event = { id = magic_project_homunculus.15 days = 29200 } #Old Age
			country_event = { id = magic_project_homunculus.9 days = 3650 random = 32850 } #Discovery!
		}
	}

	option = { #Too bad, I chose already
		name = magic_project_homunculus.8.c
		ai_chance = { factor = 1 }
		trigger = {
			custom_trigger_tooltip = {
				tooltip = homunculus_no_choose_tt
				at_least_magic_project_level = { project = homunculus level = 3 }
			}
		}
		highlight = yes

		add_country_modifier = { name = homunculus_court_unrest duration = 365 }
	}

	option = { #What are you talking about
		name = magic_project_homunculus.8.e
		ai_chance = { factor = 100 }
		trigger = {
			hidden_trigger = { exactly_magic_project_level = { project = homunculus level = 1 } }
			if = {
				limit = { has_country_modifier = homunculus_study }
				has_country_modifier = homunculus_study
			}
			else_if = {
				limit = { has_country_modifier = homunculus_training }
				has_country_modifier = homunculus_training
			}
			else = { has_country_modifier = homunculus_operating_theatre }
		}
		highlight = yes

		add_prestige = -0.1 #value intended
	}
}

country_event = { #Homunculus reveal event sorter  these are the worst outcomes
	id = magic_project_homunculus.9
	title = magic_project_homunculus.9.t
	desc = magic_project_homunculus.9.d
	picture = KINGS_CHOICE_eventPicture

	is_triggered_only = yes
	hidden = yes

	trigger = { has_country_flag = hiding_a_homunculus }

	option = {
		name = magic_project_homunculus.9.a
		ai_chance = { factor = 1 }

		if = {
			limit = { has_heir_flag = is_a_homunculus }
			country_event = { id = magic_project_homunculus.10 }
		}
		else_if = {
			limit = { has_ruler_flag = is_a_homunculus }
			country_event = { id = magic_project_homunculus.11 }
		}
		else_if = {
			limit = { has_consort_flag = is_a_homunculus }
			country_event = { id = magic_project_homunculus.12 }
		}
		else_if = {
			limit = { has_country_modifier = homunculus_eminence_grise }
			country_event = { id = magic_project_homunculus.13 }
		}
	}
}
country_event = { #Homunculus - Exposing Heir
	id = magic_project_homunculus.10
	title = magic_project_homunculus.10.t
	desc = magic_project_homunculus.10.d
	picture = ACCUSATION_eventPicture
	
	is_triggered_only = yes
	immediate = { clr_country_flag = hiding_a_homunculus }
	
	option = {	# So what?
		name = magic_project_homunculus.10.a
		ai_chance = { factor = 75 }
		
		add_country_modifier = { name = homunculus_court_unrest duration = 3650 }
		random_owned_province = {
			spawn_rebels = {
				type = pretender_rebels
				size = 10
				win = yes
			}
			add_local_autonomy = 25
		}
	}
	
	option = {	# Disinherit the Homunculus
		name = magic_project_homunculus.10.b
		ai_chance = {
			factor = 25
		}
		
		kill_heir = { allow_new_heir = no }
	}
}

country_event = { #Homunculus - Exposing Ruler
	id = magic_project_homunculus.11
	title = magic_project_homunculus.11.t
	desc = magic_project_homunculus.11.d
	picture = ACCUSATION_eventPicture
	
	is_triggered_only = yes
	immediate = {
		clr_country_flag = hiding_a_homunculus
		random_neighbor_country = { save_event_target_as = neighbor_country }
	}
	
	option = {	# I don't think so
		name = magic_project_homunculus.11.a
		ai_chance = { factor = 95 }
		
		add_country_modifier = { name = homunculus_court_unrest duration = 3650 }
		random_owned_province = {
			spawn_rebels = {
				type = pretender_rebels
				size = 10
				win = yes
			}
			add_local_autonomy = 25
		}
	}
	
	option = {	# Abdicate
		name = magic_project_homunculus.11.b
		ai_chance = { factor = 5 }
		
		exile_ruler_as = { name = abdicated_homunculus_ruler_@ROOT } #TODO future homunculus content I guess? roaming the map?
	}
}
country_event = { #Homunculus - Exposing Consort
	id = magic_project_homunculus.12
	title = magic_project_homunculus.12.t
	desc = magic_project_homunculus.12.d
	picture = ACCUSATION_eventPicture
	
	is_triggered_only = yes
	immediate = { clr_country_flag = hiding_a_homunculus }
	
	option = {	# Nothing can get in the way of love!
		name = magic_project_homunculus.12.a
		ai_chance = { factor = 50 }
		
		add_country_modifier = { name = homunculus_court_unrest duration = 3650 }
		add_legitimacy = -50
		add_devotion = -50
		add_horde_unity = -50
		add_republican_tradition = -25
		add_meritocracy = -20
	}
	
	option = {	# Relegate consort as a mistress
		name = magic_project_homunculus.12.b
		ai_chance = { factor = 5 }
		
		remove_consort_effect = yes
	}
}
country_event = { #Homunculus - Exposing Eminence
	id = magic_project_homunculus.13
	title = magic_project_homunculus.13.t
	desc = magic_project_homunculus.13.d
	picture = ACCUSATION_eventPicture
	
	is_triggered_only = yes
	immediate = { clr_country_flag = hiding_a_homunculus }
	
	option = {	# But they're funny
		name = magic_project_homunculus.13.a
		ai_chance = { factor = 50 }
		
		add_prestige = -100
		add_country_modifier = { name = homunculus_court_unrest duration = 3650 }
	}
	
	option = {	# Oh, very well...
		name = magic_project_homunculus.13.b
		ai_chance = { factor = 5 }
		
		remove_country_modifier = homunculus_eminence_grise
	}
}
country_event = { #New Homunculus ruler
	id = magic_project_homunculus.14
	title = magic_project_homunculus.14.t
	desc = magic_project_homunculus.14.d
	picture = KINGS_CHOICE_eventPicture
	
	is_triggered_only = yes
	trigger = { has_ruler_flag = is_a_homunculus }

	option = { #Come Out
		name = magic_project_homunculus.14.a
		ai_chance = { factor = 1 }
		trigger = { has_country_flag = hiding_a_homunculus }
		

		add_ruler_modifier = {
			name = homunculus_ruler
			duration = -1
		}
		add_dip_power = -100
		anb_add_accepted_culture_or_dip_power = { culture = homunculi free = yes }

		random_owned_province = {
			spawn_rebels = {
				type = pretender_rebels
				size = 5
				win = yes
			}
			add_local_autonomy = 25
		}
		add_country_modifier = { name = homunculus_court_unrest duration = 3650 }
		clr_country_flag = hiding_a_homunculus
	}

	option = { #Cool
		name = magic_project_homunculus.14.b
		ai_chance = { factor = 1 }
		
		add_ruler_modifier = {
			name = homunculus_ruler
			duration = -1
		}
	}
}

country_event = { #Homunculus Getting Old...
	id = magic_project_homunculus.15
	title = magic_project_homunculus.15.t
	desc = magic_project_homunculus.15.d
	picture = SPY_eventPicture
	
	is_triggered_only = yes
	trigger = {
		has_country_flag = hiding_a_homunculus
		OR = { #check they haven't died
			has_ruler_flag = is_a_homunculus
			has_consort_flag = is_a_homunculus
			has_heir_flag = is_a_homunculus
			has_country_modifier = homunculus_eminence_grise
		}
	}
	
	option = {	# "age" them accordingly
		name = magic_project_homunculus.15.a
		ai_chance = { factor = 95 }
		
		add_years_of_income = -0.25
		add_adm_power = -15
		add_dip_power = -15
		add_mil_power = -15
	}
	
	option = {	# It's my youthful complexion: honest!
		name = magic_project_homunculus.15.b
		ai_chance = { factor = 5 }
		
		reduce_stability_or_adm_power = yes
	}
}

#Assassination Attempt on Homunculus Heir

#Assassination Attempt on Homunculus Consort (not as likely only happens if no heir)


#SALLA DRENNEN PROJECT

namespace = magic_project_drennen_project_1

country_event = { 
	id = magic_project_drennen_project_1.0
	title = magic_project_drennen_project_1.0.t
	desc = magic_project_drennen_project_1.0.d
	picture = SPY_eventPicture
	is_triggered_only = yes
	hidden = yes
	trigger = {
		
	}
	
	option = {
		name = magic_project_drennen_project_1.0.a
		if = {
			limit = { has_country_flag = magic_project_completed_flag }
			country_event = {
				id = magic_project_drennen_project_1.1
			}
		}
	}
}

country_event = {
	id = magic_project_drennen_project_1.1
	title = magic_project_drennen_project_1.1.t
	desc = magic_project_drennen_project_1.1.d
	picture = SPY_eventPicture
	is_triggered_only = yes
	
	option = {
		name = magic_project_drennen_project_1.1.a
		if = {
			limit = { at_least_magic_project_level = { project = drennen_project_1 level = 3 } }
			country_event = { id = salla_drennen.20 }
		}
		else = {
			country_event = { id = salla_drennen.19 }
		}
	}
}
