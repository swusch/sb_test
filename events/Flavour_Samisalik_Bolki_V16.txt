namespace = sb

country_event = { #Lake Fed Treasure Fleet Feudalism 
	id = sb.1
	title = sb.1.t
	desc = sb.1.d
	picture = HORDE_ON_HORSEBACK_eventPicture
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		tag = V16
	}
	
	option = {	
		name = sb.1.a
		tuusbulak_area = {
			add_institution_embracement = {
				which = feudalism
				value = 100
			}
			add_base_production = 1
		}
		add_treasury = -200
	}
}

country_event = { #Human Admin Vasall
	id = sb.2
	title = sb.2.t
	desc = sb.2.d
	picture = HORDE_ON_HORSEBACK_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		tag = V16
	}
	
	option = {	
		name = sb.2.a
		custom_tooltip = sb_event_2_effect_1_tt
		hidden_effect = {
			set_country_flag = sb_human_governance_flag
			set_country_flag = sb_show_control_flag
			set_country_flag = sb_show_reversed_flag
			gozengun_superregion = {
				remove_core = Y95
			}
			yanshen_superregion = {
				remove_core = Y95
			}
			5360 = {
				add_core = Y95
			}
			create_vassal = Y95
			create_subject = {
				subject_type = trollish_administrator
				subject = Y95
			}
			Y95 = {
				change_religion = neokttareum
				change_government = republic
				add_republican_tradition = 100
				add_adm_power = 400
				add_dip_power = 400
				add_mil_power = 400
				override_country_name = "Glogenschen Lanmar"
				set_estate_privilege = estate_church_land_rights
				set_estate_privilege = estate_church_religious_state
				set_estate_privilege = estate_church_one_faith_one_culture
				set_estate_privilege = estate_church_independent_inquisition
				set_estate_privilege = estate_church_clerical_oversight
				set_estate_privilege = estate_nobles_land_rights
				set_estate_privilege = estate_nobles_nobility_primacy
				set_estate_privilege = estate_nobles_levies
				set_estate_privilege = estate_nobles_advisors
				set_estate_privilege = estate_nobles_supremacy_over_crown
				set_estate_privilege = estate_nobles_noble_officer_right
				set_estate_privilege = estate_burghers_land_rights
				set_estate_privilege = estate_burghers_land_of_commerce
				set_estate_privilege = estate_burghers_free_enterprise
				set_estate_privilege = estate_burghers_financial_demand
				set_estate_privilege = estate_burghers_promote_burgher_bookkeeping
				set_estate_privilege = estate_adventurers_organization_licensed_adventurers
				set_estate_privilege = estate_adventurers_advisors
				set_estate_privilege = estate_adventurers_ennoblement_of_adventurers
				set_estate_privilege = estate_mages_organization_guilds
				set_estate_privilege = estate_mages_magocratic_administration
				set_estate_privilege = estate_mages_seek_magical_advice
				set_estate_privilege = estate_mages_reduced_research_regulations
				add_government_reform = gowon_republic
				add_country_modifier = {
					name = sb_trollish_administrator_buff
					duration = -1
					hidden = yes
				}
			}
			5360 = {
				add_province_modifier = {
					name = sb_human_city
					duration = -1
				}
				every_neighbor_province = {
					limit = {
						NOT = { has_province_modifier = sb_human_city }
					}
					change_culture = hill_troll
					change_religion = neokttareum
					every_neighbor_province = {
						limit = {
							NOT = { has_province_modifier = sb_human_city }
						}
						change_culture = hill_troll
						change_religion = neokttareum
					}
				}
			}
			sb_update_control = yes
		}
	}
}

country_event = { #non-Troll Province malus
	id = sb.3
	title = sb.3.t
	desc = sb.3.d
	picture = HORDE_ON_HORSEBACK_eventPicture
	
	fire_only_once = yes
	
	trigger = {
		tag = V16
		any_owned_province = {
			NOT = { culture = hill_troll}
		}
	}
	
	immediate = {
		hidden_effect = {
			every_owned_province = { 
				limit = { NOT = { culture = hill_troll } }
				add_province_modifier = {
					name = sb_governance_malus
					duration = -1
				}
			}
			set_country_flag = sb_governance_malus_flag
		}
	}
	option = {	
		name = sb.3.a
		custom_tooltip = sb_event_3_effect_1_tt
	}
}

country_event = { #HIDDEN PULSE Governing Center Zone of Control Update
	id = sb.4
	title = sb.4.t
	desc = sb.4.d
	picture = HORDE_ON_HORSEBACK_eventPicture
	
	is_triggered_only = yes
	hidden = yes
	
	trigger = {
		tag = V16
	}
	
	immediate = {
		hidden_effect = {
			sb_update_control = yes
		}
	}

	option = {	
		name = sb.4.a
		
	}
}

country_event = { #Teachings of Ravgaenki
	id = sb.5
	title = sb.5.t
	desc = sb.5.d
	picture = HORDE_ON_HORSEBACK_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		tag = V16
	}
	
	option = {	
		name = sb.5.a
		define_ruler = {
			name = "Roon"
			dynasty = "of the Hills"
			adm = 4
			dip = 3
			mil = 4
			culture = hill_troll
			religion = neokttareum
		}
		hidden_effect = {
			define_powerful_mage = {
				type = ruler
				necromancy = 2
				conjuration = 1
			}
			add_ruler_modifier = {
				name = exceptional_willpower_100
				hidden = yes
			}
		}
	}
}

country_event = { #Tianlou Capital
	id = sb.6
	title = sb.6.t
	desc = sb.6.d
	picture = HORDE_ON_HORSEBACK_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		tag = V16
	}
	
	option = {	
		name = sb.6.a
		trigger = {
			4925 = { owned_by = V16 }
		}
		set_capital = 4925
		4925 = {
			add_province_modifier = {
				name = sb_tianlou_capital
				duration = -1
			}
		}
	}

	option = {	
		name = sb.6.b
		trigger = {
			4979 = { owned_by = V16 }
		}
		set_capital = 4979
		4979 = {
			add_province_modifier = {
				name = sb_tianlou_capital
				duration = -1
			}
		}
	}

	option = {	
		name = sb.6.c
		trigger = {
			4871 = { owned_by = V16 }
		}
		set_capital = 4871
		4871 = {
			add_province_modifier = {
				name = sb_tianlou_capital
				duration = -1
			}
		}
	}

	option = {	
		name = sb.6.e
		
	}
}

country_event = { #Notification Event Autonomy Malus
	id = sb.7
	title = sb.7.t
	desc = sb.7.d
	picture = HORDE_ON_HORSEBACK_eventPicture
	
	fire_only_once = yes
	
	trigger = {
		tag = V16
		any_owned_province = {
			NOT = { culture = hill_troll }
		}
	}

	immediate = {
		hidden_effect = {
			sb_update_control = yes
		}
	}
	
	option = {	
		name = sb.7.a
		custom_tooltip = sb_non_troll_provinces_malus_tt
	}
}

province_event = { #HIDDEN Trolls take over province
	id = sb.8
	title = sb.8.t
	desc = sb.8.d
	picture = HORDE_ON_HORSEBACK_eventPicture
	
	is_triggered_only = yes
	hidden = yes
	
	trigger = {
	}

	immediate = {
		hidden_effect = {
			change_culture = hill_troll
			change_religion = neokttareum
			add_province_modifier = {
				name = human_minority_integrated_large
				duration = -1
			}
		}
	}
	
	option = {	
		name = sb.8.a
	}
}

country_event = { #Ruler Sacrifice Ritual done
	id = sb.9
	title = sb.9.t
	desc = sb.9.d
	picture = HORDE_ON_HORSEBACK_eventPicture
	
	trigger = {
		tag = V16
		OR = {
			AND = {
				has_ruler_flag = sb_peace_sacrifice_done
				NOT = { has_country_modifier = sb_ruler_sacrifice_peace_buff }
			}
			AND = { 
				NOT =  { has_ruler_flag = sb_peace_sacrifice_done }
				has_country_modifier = sb_ruler_sacrifice_peace_buff
			}
			AND = {
				has_ruler_flag = sb_war_sacrifice_done
				NOT = { has_country_modifier = sb_ruler_sacrifice_war_buff }
			}
			AND = {
				NOT = { has_ruler_flag = sb_war_sacrifice_done }
				has_country_modifier = sb_ruler_sacrifice_war_buff
			}
		}
	}

	immediate = {
	}
	
	option = {	# Peace Buff run out
		name = sb.9.a
		trigger = {
			has_ruler_flag = sb_peace_sacrifice_done
			NOT = { has_country_modifier = sb_ruler_sacrifice_peace_buff }
		}
		if = {
			limit = {
				check_variable = {
					which = sb_peace_challenge
					value = 50
				}
			}
			custom_tooltip = sb_peace_challenge_yes_tt
			add_years_of_income = 2
		}
		else = {
			custom_tooltip = sb_peace_challenge_no_tt
			tooltip = {
				add_years_of_income = 2
			}
		}
		if = {
			limit = {
				ruler_is_lich = yes
			}
			add_country_modifier = {
				name = sb_ruler_sacrifice_peace_debuff_with_lich
				duration = 1825
			}
		}
		else = {
			add_country_modifier = {
				name = sb_ruler_sacrifice_peace_debuff_no_lich
				duration = 1825
			}
		}
		kill_ruler = yes
		hidden_effect = {
			restore_country_color = yes
			set_variable = {
				which = sb_peace_challenge
				value = 0
			}
			clr_country_flag = sb_peace_sacrifice_flag
		}
	}

	option = {	# Peace Ruler died before end of sacrifice
		name = sb.9.b
		trigger = {
			NOT =  { has_ruler_flag = sb_peace_sacrifice_done }
			has_country_modifier = sb_ruler_sacrifice_peace_buff
		}
		if = {
			limit = {
				check_variable = {
					which = sb_peace_challenge
					value = 50
				}
			}
			custom_tooltip = sb_peace_challenge_yes_tt
			add_years_of_income = 2
		}
		else = {
			custom_tooltip = sb_peace_challenge_no_tt
			tooltip = {
				add_years_of_income = 2
			}
		}
		if = {
			limit = {
				ruler_is_lich = yes
			}
			add_country_modifier = {
				name = sb_ruler_sacrifice_peace_debuff_with_lich
				duration = 1825
			}
		}
		else = {
			add_country_modifier = {
				name = sb_ruler_sacrifice_peace_debuff_no_lich
				duration = 1825
			}
		}
		hidden_effect = {
			restore_country_color = yes
			remove_country_modifier = sb_ruler_sacrifice_peace_buff
			set_variable = {
				which = sb_peace_challenge
				value = 0
			}
			clr_country_flag = sb_peace_sacrifice_flag
		}
	}

	option = {	# War Buff run out
		name = sb.9.c
		trigger = {
			has_ruler_flag = sb_war_sacrifice_done
			NOT = { has_country_modifier = sb_ruler_sacrifice_war_buff }
		}
		if = {
			limit = {
				check_variable = {
					which = sb_war_challenge
					value = 10
				}
			}
			custom_tooltip = sb_war_challenge_yes_tt
			add_yearly_manpower = 2
		}
		else = {
			custom_tooltip = sb_war_challenge_no_tt
			tooltip = {
				add_yearly_manpower = 2
			}
		}
		if = {
			limit = {
				ruler_is_lich = yes
			}
			add_country_modifier = {
				name = sb_ruler_sacrifice_war_debuff_with_lich
				duration = 1825
			}
		}
		else = {
			add_country_modifier = {
				name = sb_ruler_sacrifice_war_debuff_no_lich
				duration = 1825
			}
		}
		kill_ruler = yes
		hidden_effect = {
			restore_country_color = yes
			set_variable = {
				which = sb_war_challenge
				value = 0
			}
			clr_country_flag = sb_war_sacrifice_flag
		}
	}

	option = {	# War Ruler died before end of sacrifice
		name = sb.9.c
		trigger = {
			NOT = { has_ruler_flag = sb_war_sacrifice_done }
			has_country_modifier = sb_ruler_sacrifice_war_buff
		}
		if = {
			limit = {
				check_variable = {
					which = sb_war_challenge
					value = 10
				}
			}
			custom_tooltip = sb_war_challenge_yes_tt
			add_yearly_manpower = 2
		}
		else = {
			custom_tooltip = sb_war_challenge_no_tt
			tooltip = {
				add_yearly_manpower = 2
			}
		}
		if = {
			limit = {
				ruler_is_lich = yes
			}
			add_country_modifier = {
				name = sb_ruler_sacrifice_war_debuff_with_lich
				duration = 1825
			}
		}
		else = {
			add_country_modifier = {
				name = sb_ruler_sacrifice_war_debuff_no_lich
				duration = 1825
			}
		}
		hidden_effect = {
			restore_country_color = yes
			remove_country_modifier = sb_ruler_sacrifice_war_buff
			set_variable = {
				which = sb_war_challenge
				value = 0
			}
			clr_country_flag = sb_war_sacrifice_flag
		}
	}
}

country_event = { #Choose Province highlighting
	id = sb.10
	title = sb.10.t
	desc = sb.10.d
	picture = HORDE_ON_HORSEBACK_eventPicture
	
	is_triggered_only = yes
	
	trigger = {

	}
	
	option = {	
		name = sb.10.a
		trigger = {
			has_country_flag = sb_vasall_upgrade_1_flag
		}
		custom_tooltip = sb_highlight_control_tt
		hidden_effect = {
			clr_country_flag = sb_show_mage_tower_flag
			clr_country_flag = sb_show_adm_flag
			clr_country_flag = sb_show_dip_flag
			clr_country_flag = sb_show_mil_flag
			clr_country_flag = sb_show_state_house_flag
			set_country_flag = sb_show_control_flag
		}
	}

	option = {	
		name = sb.10.b
		trigger = {
			has_country_flag = sb_vasall_upgrade_1_flag
		}
		custom_tooltip = sb_highlight_mage_tower_tt
		hidden_effect = {
			clr_country_flag = sb_show_control_flag
			clr_country_flag = sb_show_adm_flag
			clr_country_flag = sb_show_dip_flag
			clr_country_flag = sb_show_mil_flag
			clr_country_flag = sb_show_state_house_flag
			set_country_flag = sb_show_mage_tower_flag
		}
	}

	option = {	
		name = sb.10.c
		trigger = {
			has_country_flag = sb_vasall_upgrade_2_flag
		}
		custom_tooltip = sb_highlight_adm_tt
		hidden_effect = {
			clr_country_flag = sb_show_control_flag
			clr_country_flag = sb_show_mage_tower_flag
			clr_country_flag = sb_show_dip_flag
			clr_country_flag = sb_show_mil_flag
			clr_country_flag = sb_show_state_house_flag
			set_country_flag = sb_show_adm_flag
		}
	}

	option = {	
		name = sb.10.e
		trigger = {
			has_country_flag = sb_vasall_upgrade_2_flag
		}
		custom_tooltip = sb_highlight_dip_tt
		hidden_effect = {
			clr_country_flag = sb_show_control_flag
			clr_country_flag = sb_show_mage_tower_flag
			clr_country_flag = sb_show_adm_flag
			clr_country_flag = sb_show_mil_flag
			clr_country_flag = sb_show_state_house_flag
			set_country_flag = sb_show_dip_flag
		}
	}

	option = {	
		name = sb.10.e
		trigger = {
			has_country_flag = sb_vasall_upgrade_2_flag
		}
		custom_tooltip = sb_highlight_mil_tt
		hidden_effect = {
			clr_country_flag = sb_show_control_flag
			clr_country_flag = sb_show_mage_tower_flag
			clr_country_flag = sb_show_adm_flag
			clr_country_flag = sb_show_dip_flag
			clr_country_flag = sb_show_state_house_flag
			set_country_flag = sb_show_mil_flag
		}
	}

	option = {	
		name = sb.10.e
		trigger = {
			has_country_flag = sb_vasall_upgrade_2_flag
		}
		custom_tooltip = sb_highlight_state_house_tt
		hidden_effect = {
			clr_country_flag = sb_show_control_flag
			clr_country_flag = sb_show_mage_tower_flag
			clr_country_flag = sb_show_adm_flag
			clr_country_flag = sb_show_dip_flag
			clr_country_flag = sb_show_mil_flag
			set_country_flag = sb_show_state_house_flag
		}
	}

	option = {	
		name = sb.10.e
		custom_tooltip = sb_highlight_reversed_tt
		hidden_effect = {
			if = {
				limit = {
					NOT = { has_country_flag = sb_show_reversed_flag }
				}
				set_country_flag = sb_show_reversed_flag
			}
			else = {
				clr_country_flag = sb_show_reversed_flag
			}
			sb_update_control = yes
		}
	}
}